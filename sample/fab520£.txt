     H            D.J
     *****************************************************************
     *                                                               *
     *                   SUIVI DE FABRICATION                        *
     *****************************************************************
     *  LE 07/09/09 : MODIFS                                         *
     *  - AFFICHAGE TOUTES NATURE DE CDE MÊME SI FERME               *
     *  - AFFICHAGE CODE DE GESTION 'D' SUR FOND ROUGE CLIGNOTANT    *
     *  - AFFICHAGE NATURE CDE, CODE DE GESTION, MINI/MAXI DANS F10  *
     *                                                               *
     *****************************************************************
    H**  AUTEUR !    DATE    ! OBJET DE LA MODIFICATION              *
    H** --------!------------!---------------------------------------*
    H**  TMAGPI ! 04-06-2013 ! IC 681273: Erreur N°  Forme sur opt8  *
    H**         !            ! Change PRODAL8 en PRODAL9 (pas de     *
    H**         !            ! lecture RECAPT qui polluait le fmt F94*
    H** --------!------------!---------------------------------------*
    H**  TMAGPI ! 13-06-2013 ! IC 657019, 629183, 649459: Modifs NE, *
    H**         !            ! rjout d'option plus gestion inverse   *
    H**         !            ! vidéo sur décor et matériel CR et DAC *
    H** --------!------------!---------------------------------------*
    H**  TMAGPI ! 13-11-2013 ! IC 753971: Rajout infos réglages pour *
    H**         !            ! NE (Demande Y.ROUFF)                  *
    H** --------!------------!---------------------------------------*
    H**  TMAGPI ! 26-03-2014 ! TASK0012138: Rajout options C et V    *
    H**         !            ! pour Cr et visu consignes (D.BOUNY/TY)*
    H**         !            ! *****   EN COURS      ************    *
    H*****************************************************************
    H*****************************************************************
     FFAB02L01IF  E           K        DISK
     FFAB03L01IF  E           K        DISK
     FFAB03L02IF  E           K        DISK
     F            XFAB03                            KRENAMEYFAB03
     FFAB03L03IF  E           K        DISK
     F            XFAB03                            KRENAMEZFAB03
     FFAB04L01IF  E           K        DISK
     FFAB05L05IF  E           K        DISK
     FFAB05L06IF  E           K        DISK
     F            XFAB05                            KRENAMEYFAB05
    FFAB05L07UF  E           K        DISK
     F            XFAB05                            KRENAMEZFAB05
    FFAB05L09UF  E           K        DISK
     F            XFAB05                            KRENAMETFAB05
     FFAB08L01IF  E           K        DISK
     FFAB09L02IF  E           K        DISK
     FFAB10L09IF  E           K        DISK
     FFAB10L10IF  E           K        DISK
     F            XFAB10                            KRENAMEZFAB10
     FFAB10L23IF  E           K        DISK
     F            XFAB10                            KRENAMETFAB10
     FFAB11L09IF  E           K        DISK
     FFAB11L10IF  E           K        DISK
     F            XFAB11                            KRENAMEZFAB11
     FFAB13L01IF  E           K        DISK
    FFAB15L01UF  E           K        DISK
    FFAB16L01UF  E           K        DISK                      A
     FFAB16L03IF  E           K        DISK
    FFAB16L06UF  E           K        DISK
     FFAB16L05IF  E           K        DISK
    FFAB16L11UF  E           K        DISK
    FFAB17L01UF  E           K        DISK                      A
     FFAB17L02IF  E           K        DISK
     FFAB17L04IF  E           K        DISK
     F            XFAB17                            KRENAMEYFAB17
    FFAB17L05UF  E           K        DISK
     F            XFAB17                            KRENAMEZFAB17
    FFAB18L01IF  E           K        DISK                      A
    FFAB19L01UF  E           K        DISK                      A
    FFAB21L01O   E           K        DISK                      A
     FCALENSL4IF  E           K        DISK
     FCALENS  IF  E           K        DISK
     F            CALENDF1                          KRENAMECALENDZ1
     FCODBARL2IF  E           K        DISK
     FCDESL1  IF  E           K        DISK
     FPARAME  IF  E           K        DISK
     * SD 681273 Tmagpi
     *RODAL8 IF  E           K        DISK
     FPRODAL9 IF  E           K        DISK
     *
    FPRLANCXHUF  E           K        DISK
     FCLIENTS1IF  E           K        DISK
     FPREIMP2 IF  E           K        DISK
     FPRODST3 IF  E           K        DISK
     FMACHIN  IF  E           K        DISK
     FFORMAG  IF  E           K        DISK
     FTRASPE  IF  E           K        DISK                               PROD02
     FCARCDEL1IF  E           K        DISK
     FPREACOP2IF  E           K        DISK
    FPREFOUL2UF  E           K        DISK
     *
     FPLAMAL1 IF  E           K        DISK
     FCARCDEZ1IF  E           K        DISK
     F            CARCDEF1                          KRENAMECARCDEZ
     FMALFACL5IF  E           K        DISK
     FCSGCMDL1IF  E           K        DISK
     *
     FFAB520D CF  E                    WORKSTN
     F                                        RCD   KSFILE F02
     F                                        RCX   KSFILE F06
     F                                        RCY   KSFILE F11
     F                                        RCT   KSFILE F19
     E                    TCAD        4  2
     E                    THAD        4  4 0
     E                    TTAD        4  1
     E                    TEAD        4  1 0
     E                    TLAD        4 12
     E                    TAD1        6  2               HISTOFA2:CODES AD
     E                    TAD2        6  4 2             HISTOFA2:TEMPS AD
     E                    TAD3        6  1               HISTOFA2:INCLUS AD
     E                    TAD4        6  1 0             HISTOFA2:EFFECTIFS AD
     E                    SVTAD2      6  4 2             HISTOFA2:CODES AD
     E                    EBCAD       6  2               HISTOFA2:CODES AD
     E                    EBTAD       6  4 2             HISTOFA2:TEMPS AD
     E                    EBIAD       6  1               HISTOFA2:INCLUS AD
     E                    EBEAD       6  1 0             HISTOFA2:EFFECTIFS AD
     E                    PAG        50  2
     E                    PA2        50  3 0
     E                    AF1         9  2
     E                    AF2         9 30
     E                    AF3         9 30
     E                    TTOBS       3 40
     E                    CALJ       48  1
     E                    ZO      1   9 10
     E                    TM      1   4 13
     E                    EQ      1   3 10                                PA010
     E                    LIFI    1   3 29                                PA010
     E                    LIBF    1   3 15                                PA010
     E                    LIBP    1   2 24                                PA010
     E                    LB      1   1 20                                PA010
     E                    TBU     5   5  1 0                              PA010
     E                    TEQ     1  15  8 0                              PA010
     E                    LIBV    1   1 50                                PA010
     *
     E                    ETA     1   7  1   LET    12
     *
     IPREACOPF
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOCLI                           XNOCLI
     I              MAC                             XMAC
     IZFAB05
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     IZFAB10
     I              FAUSIN                          XAUSIN
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              FATENC                          XATENC
     I              FAOPNU                          XAOPNU
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              PPEQUI                          XPEQUI
     I              PPAA                            XPAA
     I              PPMM                            XPMM
     I              PPJJ                            XPJJ
     I              FAAENT                          XAAENT
     I              FAMENT                          XAMENT
     I              FAJENT                          XAJENT
     I              FAHENT                          XAHENT
     ITFAB10
     I              FAUSIN                          XAUSIN
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              FATENC                          XATENC
     I              FAOPNU                          XAOPNU
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              PPEQUI                          XPEQUI
     I              PPAA                            XPAA
     I              PPMM                            XPMM
     I              PPJJ                            XPJJ
     I              FAAENT                          XAAENT
     I              FAMENT                          XAMENT
     I              FAJENT                          XAJENT
     I              FAHENT                          XAHENT
     IXFAB15
     I              USINE                           XUSINE
     IXFA16D
     I              FACONF                          TACONF
     I              FASEQ                           TASEQ
     I              FAISEQ                          TAISEQ
     I              NOPRO                           TNOPRO
     I              FAOPNU                          TAOPNU
     I              PPAA                            TPAA
     I              PPMM                            TPMM
     I              PPJJ                            TPJJ
     I              PPEQUI                          TPEQUI
     I              CMATR                           TCMATR
     I              FA1601                          TA1601
     I              FA1602                          TA1602
     IYFAB17
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              NOPRO                           XNOPRO
     I              FAOPNU                          XAOPNU
     I              PPPAS                           XPPAS
     I              PPFAA                           XPFAA
     I              PPFMM                           XPFMM
     I              PPFJJ                           XPFJJ
     I              FAEVCO                          XAEVCO
     I              PPORD                           XPORD
     I              FAEVTY                          XAEVTY
     I              FANOMB                          XANOMB
     I              FA1701                          XA1701
     I              FA1702                          XA1702
     IZFAB17
     I              PPFAA                           XPFAA
     I              PPFMM                           XPFMM
     I              PPFJJ                           XPFJJ
     I              PPHDEB                          XPHDEB
     I              PPHFIN                          XPHFIN
     IPRODUIF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              AGENT                           XAGENT
     I              MACLI                           XMACLI
     I              MICLI                           XMICLI
     *ECAPTF1      SD 681273 TMAGPI
     *             USINE                           XUSINE
     *             STE                             XSTE
     *             NCONF                           XCONF
     *             NOCLI                           XNOCLI
     *             AGENT                           XAGENT
     I              UVENT                           XVENT
     IPRODARF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              AGENT                           XAGENT
     I              FACON                           XACON
     I              UVENT                           XVENT
     I              MACLI                           XMACLI
     I              MICLI                           XMICLI
     IPRODSTF2
     I              MAIME1                          XAIME1
     I              MAIME2                          XAIME2
     I              MAIME3                          XAIME3
     I              MAIME4                          XAIME4
     I              MAIME5                          XAIME5
     I              MIMRE1                          XIMRE1
     I              MIMRE2                          XIMRE2
     I              MIMRE3                          XIMRE3
     I              MIMRE4                          XIMRE4
     I              MIMRE5                          XIMRE5
     I              RMIME1                          XMIME1
     I              RMIME2                          XMIME2
     I              RMIME3                          XMIME3
     I              RMIME4                          XMIME4
     I              RMIME5                          XMIME5
     I              RMIRE1                          XMIRE1
     I              RMIRE2                          XMIRE2
     I              RMIRE3                          XMIRE3
     I              RMIRE4                          XMIRE4
     I              RMIRE5                          XMIRE5
     I              MAGAU1                          XAGAU1
     I              MAGAU2                          XAGAU2
     ICDESF1
     I              NCONF                           YZCONF
     I              NOPRO                           YZPRO
     I              STE                             YZSTE
     I              NOCLI                           YZCLI
     I              AGENT                           YZAGEN
     I              USINE                           YZUSI
     ICARCDEF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              AGENT                           YAGENT
     I              UVENT                           XVENT
     I              USEXT                           XSEXT
     I              USINT                           XSINT
     ITRASPEF1
     I              NOMAC                           RRMAC
     *  ZONES DE PLAMA    RENOMMEES
     IPLAMAF1
     I              USFAC                           XUSFAC
     I              DEC                             XYZ
     *  ZONES DE CARCDEZ  RENOMMEES
     ICARCDEZ
     I              AGENT                           WW1
     I              CDEPRE                          WW5
     *  ZONES DE MALFAC   RENOMMEES
     IMALFACF1
     I              DATE                            WWDAT
     *
     I           IDS
     I                                        1   80DATLUE                CCS013
     I                                        1   20CALJJ                 CCS013
     I                                        3   40CALMM                 CCS013
     I                                        5   60CALSS                 CCS013
     I                                        7   80CALAA                 CCS013
     I           IDS
     I                                        1  170DH                    CCS013
     I                                        1   40FAAFA                 CCS013
     I                                        5   60FAMFA                 CCS013
     I                                        7   80FAJFA                 CCS013
     I                                        9  140FAHFA                 CCS013
     I                                       15  170FANOP                 CCS013
     I           IDS
     I                                        1   80DATE                  CCS013
     I                                        1   20ZAJFA                 CCS013
     I                                        3   40ZAMFA                 CCS013
     I                                        5   80ZAAFA                 CCS013
     I           IDS
     I                                        1   80DELAI                 CCS013
     I                                        1   20JJDEL                 CCS013
     I                                        3   40MMDEL                 CCS013
     I                                        5   60SSDEL                 CCS013
     I                                        7   80ANDEL                 CCS013
     I           IDS
     I                                        1   80DATEQ                 CCS013
     I                                        1   20PPJJ                  CCS013
     I                                        3   40PPMM                  CCS013
     I                                        5   80PPAA                  CCS013
     I           IDS
     I                                        1   80DATOUV                CCS013
     I                                        1   20FAJJ                  CCS013
     I                                        3   40FAMM                  CCS013
     I                                        5   80FAAA                  CCS013
     I           IDS
     I                                        1   80TDATEQ                CCS013
     I                                        1   20TPJJ                  CCS013
     I                                        3   40TPMM                  CCS013
     I                                        5   80TPAA                  CCS013
     I           IDS
     I                                        1   80DATEVE                CCS013
     I                                        1   20PPFJJ                 CCS013
     I                                        3   40PPFMM                 CCS013
     I                                        5   80PPFAA                 CCS013
     I           IDS
     I                                        1   80XATEVE                CCS013
     I                                        1   20XPFJJ                 CCS013
     I                                        3   40XPFMM                 CCS013
     I                                        5   80XPFAA                 CCS013
     I           IDS
     I                                        1   80DATLIV                CCS013
     I                                        1   20FAJLI                 CCS013
     I                                        3   40FAMLI                 CCS013
     I                                        5   80FAALI                 CCS013
     I           IDS
     I                                        1   80FADJA1                CCS013
     I                                        1   20FAJJA1                CCS013
     I                                        3   40FAMJA1                CCS013
     I                                        5   80FAAJA1                CCS013
     I           IDS
     I                                        1   80FADJA2                CCS013
     I                                        1   20FAJJA2                CCS013
     I                                        3   40FAMJA2                CCS013
     I                                        5   80FAAJA2                CCS013
     I           IDS
     I                                        1   80DTOPD                 CCS013
     I                                        1   20FAJCAD                CCS013
     I                                        3   40FAMCAD                CCS013
     I                                        5   80FAACAD                CCS013
     I           IDS
     I                                        1   80DTOPF                 CCS013
     I                                        1   20FAJTIF                CCS013
     I                                        3   40FAMTIF                CCS013
     I                                        5   80FAATIF                CCS013
     I           IDS
     I                                        1   80DATREC                CCS013
     I                                        1   20FAJRE                 CCS013
     I                                        3   40FAMRE                 CCS013
     I                                        5   80FAARE                 CCS013
     I           IDS
     I                                        1  18 CDE
     I                                        1   10USINE                 CCS013
     I                                        2   60FACONF                CCS013
     I                                        7   80FASEQ                 CCS013
     I                                        9   90FAISEQ                CCS013
     I                                       10  130NOPRO                 CCS013
     I                                        2  13 CDE1
     I                                       14  140STE                   CCS013
     I                                       15  180NOCLI                 CCS013
     I           IDS
     I                                        1   2 FAATEL
     I                                        1   1 SECT                  CCS013
     I                                        2   2 SSECT                 CCS013
     I           IDS
     I                                        1   5 P1
     I                                        1   10ZUSI                  CCS013
     I                                        2   5 ZRESS
     I                                        2   2 ZSECT                 CCS013
     I                                        3   3 ZSSECT                CCS013
     I                                        4   5 ZNOMAC                CCS013
     I           IDS
     I                                        1   8 TCAD
     I                                        1   2 CARD1                 CCS013
     I                                        3   4 CARD2                 CCS013
     I                                        5   6 CARD3                 CCS013
     I                                        7   8 CARD4                 CCS013
     I           IDS
     I                                        1  160THAD
     I                                        1   40HARD1                 CCS013
     I                                        5   80HARD2                 CCS013
     I                                        9  120HARD3                 CCS013
     I                                       13  160HARD4                 CCS013
     I           IDS
     I                                        1   4 TTAD
     I                                        1   1 TARD1                 CCS013
     I                                        2   2 TARD2                 CCS013
     I                                        3   3 TARD3                 CCS013
     I                                        4   4 TARD4                 CCS013
     I           IDS
     I                                        1   40TEAD
     I                                        1   10EARD1                 CCS013
     I                                        2   20EARD2                 CCS013
     I                                        3   30EARD3                 CCS013
     I                                        4   40EARD4                 CCS013
     I           IDS
     I                                        1  48 TLAD
     I                                        1  12 LARD1                 CCS013
     I                                       13  24 LARD2                 CCS013
     I                                       25  36 LARD3                 CCS013
     I                                       37  48 LARD4                 CCS013
     I           IDS
     I                                        1 120 TTOBS
     I                                        1  40 OBSQU1                CCS013
     I                                       41  80 OBSQU2                CCS013
     I                                       81 120 OBSQU3                CCS013
     ILIBEL      IDS
     I                                        1  40 BLOC1
     I                                        1  18 LIB20
     I                                       41  80 BLOC2
     I                                       81 120 BLOC4
     IDSCOMM      DS
     I                                        1   10YYSTE
     I                                        2   50YYCLI
     I                                       16  190DSPRO
     I                                       22  22 ZONE95
     I                                       24  24 MODIFE
     I                                       40  41 DSGAR
     I                                       42  460DSCNF
     I                                       47  51 DSFOR
     I                                      100 100 Z100
     I                                      101 101 Z101
     I                                      102 102 Z102
     I                                      103 110 ZMDP
     IPARMA       DS                             23
     I I            0                         1   10WSTE                  CCS013
     I I            0                         2   50WNOCLI
     I I            0                         6   90WOPRO                 CCS013
     I I            0                        10  140WFACON                CCS013
     I I            0                        15  160WFASEQ                CCS013
     I                                       17  17 WSECT                 CCS013
     I                                       18  18 WSSECT                CCS013
     I                                       19  20 WNOMAC                CCS013
     I I            0                        21  210WEQUIP                CCS013
     I I            0                        22  220WSTOND
     I                                       23  23 CODGOF
     I           IDS
     I                                        1  35 PARM4
     I                                        1  26 PARM15
     I                                        1   10YAUSIN
     I                                        2   2 YSECT
     I                                        3   3 YSSECT
     I                                        2   3 YAATEL
     I                                        4   5 YNOMAC
     I                                        6  100YACONF
     I                                       11  120YASEQ
     I                                       13  130YAISEQ
     I                                       14  140YSTE
     I                                       15  180YNOCLI
     I                                       19  220YNOPRO
     I                                       23  260YAOPNU
     I                                       27  280YPJJ
     I                                       29  300YPMM
     I                                       31  340YPAA
     I                                       27  340YATEQ
     I                                       35  350YPEQUI
     I           IDS
     I                                        1  59 PARM5
     I                                        1   10XXUSIN                CCS013
     I                                        2   60XXCONF                CCS013
     I                                        7   80XXSEQ                 CCS013
     I                                        9   90XXISEQ                CCS013
     I                                       10  130XXPRO                 CCS013
     I                                        2  130XXCDE
     I                                       14  140XXEQU                 CCS013
     I                                       15  180XXAA                  CCS013
     I                                       19  200XXMM                  CCS013
     I                                       21  220XXJJ                  CCS013
     I                                       15  220XXDT1                 CCS013
     I                                       23  260XXHDEQ                CCS013
     I                                       27  300XXHFEQ                CCS013
     I                                       31  370XXMAT                 CCS013
     I                                       38  380XXEFC                 CCS013
     I                                       39  390XXEFR                 CCS013
     I                                       40  460XXCTR1                CCS013
     I                                       47  530XXCTR2                CCS013
     I                                       54  54 XXSEC                 CCS013
     I                                       55  55 XXSSEC                CCS013
     I                                       56  57 XXMAC                 CCS013
     I                                       58  580XXEQ11                CCS013
     I                                       59  59 XXF11                 CCS013
     I           IDS
     I                                        1  50 PARM6
     I                                        1  10 FANPRT                CCS013
     I                                       11  14 £OPRO                 CCS013
     I                                       15  19 £CONF                 CCS013
     I                                       20  21 £EQFAB                CCS013
     I                                       22  28 £AQTE                 CCS013
     I                                       29  30 £PJJ                  CCS013
     I                                       31  32 £PMM                  CCS013
     I                                       33  36 £PAA                  CCS013
     I                                       37  37 £PEQUI                CCS013
     I                                       38  41 £RESS                 CCS013
     I           IDS
     I                                        1  18 PARM7
     I                                        1   10WAUSIN
     I                                        2   60WACONF
     I                                        7   80WASEQ
     I                                        9   90WAISEQ
     I                                       10  130WNOPRO
     I                                       14  170WAOPNU
     I                                       18  18 TAGOK
     I           IDS
     I                                        1  18 PARM8
     I                                        1   10VAUSIN
     I                                        2   60VACONF
     I                                        7   80VASEQ
     I                                        9   90VAISEQ
     I                                       10  130VNOPRO
     I                                       14  170VAOPNU
     I                                       18  18 T2207
     I            DS
     I                                        1  18 AF1
     I                                        1   2 TYP001
     I                                        3   4 TYP002
     I                                        5   6 TYP003
     I                                        7   8 TYP004
     I                                        9  10 TYP005
     I                                       11  12 TYP006
     I                                       13  14 TYP007
     I                                       15  16 TYP008
     I                                       17  18 TYP009
     I            DS
     I                                        1 270 AF2
     I                                        1  30 LIB001
     I                                       31  60 LIB002
     I                                       61  90 LIB003
     I                                       91 120 LIB004
     I                                      121 150 LIB005
     I                                      151 180 LIB006
     I                                      181 210 LIB007
     I                                      211 240 LIB008
     I                                      241 270 LIB009
     I           IDS
     I                                        1   40FAOPNU
     I                                        1   20PRIOR1
     I                                        3   30RANG1
     I                                        4   40PASAGE
     IENREG2     IDS
     I                                        1 186 ENR2
     I                                        1   10EBUSIN
     I                                        2   60EBCONF
     I                                        7   80EBSEQ
     I                                        9   90EBSTE
     I                                       10  130EBCLI
     I                                       14  170EBPRO
     I                                       18  18 EBSEC
     I                                       19  19 EBSSEC
     I                                       20  21 EBMAC
     I                                       22  290EBDAT1
     I                                       30  370EBDAT2
     I                                       38  410EBHEUR
     I                                       42  420EBEQU
     I                                       43  430EBPAS
     I                                       44  500EBCOND
     I                                       51  552EBTCAL
     I                                       56  602EBTROU
     I                                       61  652EBTDIV
     I                                       66  660EBEFFC
     I                                       67  670EBEFFR
     I                                       68  740EBQTOT
     I                                       75  810EBQBON
     I                                       82  880EBQRC
     I                                       89  950EBQRR
     I                                       96  97 EBCAD1
     I                                       98  99 EBCAD2
     I                                      100 101 EBCAD3
     I                                      102 103 EBCAD4
     I                                      104 105 EBCAD5
     I                                      106 107 EBCAD6
     I                                       96 107 EBCAD
     I                                      108 1112EBTAD1
     I                                      112 1152EBTAD2
     I                                      116 1192EBTAD3
     I                                      120 1232EBTAD4
     I                                      124 1272EBTAD5
     I                                      128 1312EBTAD6
     I                                      108 131 EBTAD
     I                                      132 1320EBEAD1
     I                                      133 1330EBEAD2
     I                                      134 1340EBEAD3
     I                                      135 1350EBEAD4
     I                                      136 1360EBEAD5
     I                                      137 1370EBEAD6
     I                                      132 137 EBEAD
     I                                      138 138 EBIAD1
     I                                      139 139 EBIAD2
     I                                      140 140 EBIAD3
     I                                      141 141 EBIAD4
     I                                      142 142 EBIAD5
     I                                      143 143 EBIAD6
     I                                      138 143 EBIAD
     I                                      144 145 EBETIQ
     I                                      146 1460EBCOUL
     I                                      147 147 EBTVER
     I                                      148 150 EBCELI
     I                                      151 1570EBQELI
     I                                      158 1620EBOPNU
     I                                      163 164 EBOPST
     I                                      165 165 EBSUP
     I                                      166 166 EBTAG
     I                                      167 168 EBTRSP
     I                                      169 1732EBPOS1
     I                                      174 1782EBPOS2
     I                                      179 1850EBQACO
     I                                      186 1860EBNCAL
     I           IDS
     I                                        1   40HENT                  CCS013
     I                                        1   20XXDEBH                CCS013
     I                                        3   40XXDEBM                CCS013
     I           IDS
     I                                        1  17 PARM9
     I                                        1   10VVUSI                 CCS013
     I                                        2   60VVCONF                CCS013
     I                                        7   80VVSEQ                 CCS013
     I                                        9   90VVISEQ                CCS013
     I                                       10  130VVPRO                 CCS013
     I                                       14  15 VVETAT                CCS013
     I                                       16  170VVPRIO                CCS013
     I           IDS
     I                                        1  23 PARM10
     I                                        1   10SAUSIN
     I                                        2   60SACONF
     I                                        7   80SASEQ
     I                                        9   90SAISEQ
     I                                       10  130SNOPRO
     I                                       14  170SAOPNU
     I                                       18  18 SPSECT
     I                                       19  19 SSSECT
     I                                       20  21 SNOMAC
     I                                       22  23 SETAOP
     I           IDS
     I                                        1 100 PARMBF
     I                                        1   50KKCONF                CCS013
     I                                        6   90KKPRO                 CCS013
     I                                       10  110KKSEQ                 CCS013
     I                                       12  12 IN95                  CCS013
     I           IDS
     I                                        1  17 PARM11
     I                                        1   10JAUSIN
     I                                        2   60JACONF
     I                                        7   80JASEQ
     I                                        9   90JAISEQ
     I                                       10  130JNOPRO
     I                                       14  170JAOPNU
     I           IDS
     I                                        1 119 PARM12
     I                                        1   4 TYPOND
     I                                        5   6 TYPCOL
     I                                        7   9 PAPEXT
     I                                       10  120GRAEXT
     I                                       13  161LAIEXT
     I                                       17  25 PREEXT
     I                                       26  320KGBEXT
     I                                       33  35 PAPCAN
     I                                       36  380GRACAN
     I                                       39  421LAICAN
     I                                       43  51 PRECAN
     I                                       52  580KGBCAN
     I                                       59  61 PAPINT
     I                                       62  640GRAINT
     I                                       65  681LAIINT
     I                                       69  77 PREINT
     I                                       78  840KGBINT
     I                                       85  880FOLEXT
     I                                       89  920FOHEXT
     I                                       93  98 FOUEXT
     I                                       99 1010GRREXT
     I                                      102 107 FOUCAN
     I                                      108 1100GRRCAN
     I                                      111 116 FOUINT
     I                                      117 1190GRRINT
     I           IDS
     I                                        1  18 PARM13
     I                                        1   10XYUSI                 CCS013
     I                                        2   20XYSTE                 CCS013
     I                                        3   60XYCLI                 CCS013
     I                                        7  100XYPRO                 CCS013
     I                                       11  150XYCONF                CCS013
     I                                       16  170XYSEQ                 CCS013
     I                                       18  18 XYSOLD                CCS013
     I           IDS
     I                                        1  26 PARM14
     I                                        1   10WWUSIN
     I                                        2   60WWCONF
     I                                        7   80WWSEQ
     I                                        9   90WWISEQ
     I                                       10  130WWPRO
     I                                       14  170WWOPNU
     I                                       18  19 WWSPRE
     I                                       20  260WWQPRE
     I           IDS
     I                                        1  22 PARM24
     I                                        1   50ZTCONF                CCS013
     I                                        6   70ZTSEQ                 CCS013
     I                                        8   80ZTISEQ                CCS013
     I                                        9  120ZTPRO                 CCS013
     I                                       13  160ZTOPNU
     I                                       17  170ZTUSI
     I                                       18  18 ZTSECT
     I                                       19  19 ZTSSEC
     I                                       20  21 ZTMAC
     I                                       22  22 ZTPF
     I           IDS
     I                                        1  30 PARM25
     I                                        1   10ZYUSIN
     I                                        2   60ZYCONF
     I                                        7   80ZYSEQ
     I                                        9   90ZYISEQ
     I                                       10  130ZYPRO
     I                                       14  170ZYOPNU
     I                                       18  21 ZYMACH
     I                                       22  23 ZYOPST
     I                                       24  300ZYQTE
     I           IDS
     I                                        1  32 PARM26
     I                                        1   10ZXUSIN                CCS013
     I                                        2   20ZXSTE                 CCS013
     I                                        3   60ZXCLI                 CCS013
     I                                        7  100ZXPRO
     I                                       11  150ZXCONF
     I                                       16  170ZXSEQ
     I                                       18  180ZXISEQ
     I                                       19  250ZXQTE1                CCS013
     I                                       26  320ZXQTE2
     I                                       45  45 ZXSECT
     I                                       46  46 ZXSSEC
     I                                       47  48 ZXNOMA
     I           IDS
     I                                        1  22 PARA0
     I                                        1   10XZUSI
     I                                        2   60XZCONF
     I                                        7   80XZSEQ
     I                                        9   90XZISEQ
     I                                       10  130XZPRO
     I                                       14  14 XZSECT
     I                                       15  15 XZSSEC
     I                                       16  17 XZMAC
     I                                       18  180XZSTE
     I                                       19  220XZCLI
     *
     I           IDS
     I                                        1  54 PARA1
     I                                        1   9 SUP1
     I                                       10  12 PAP1
     I                                       13  150GRA1
     I                                       16  191LAI1
     I                                       20  230FOL1
     I                                       24  270FOH1
     I                                       28  36 PRE1
     I                                       37  430KGB1
     I                                       44  45 UNI1
     I                                       46  51 FOU1
     I                                       52  540GRR1
     I           IDS
     I                                        1  54 PARA2
     I                                        1   9 SUP2
     I                                       10  12 PAP2
     I                                       13  150GRA2
     I                                       16  191LAI2
     I                                       20  230FOL2
     I                                       24  270FOH2
     I                                       28  36 PRE2
     I                                       37  430KGB2
     I                                       44  45 UNI2
     I                                       46  51 FOU2
     I                                       52  540GRR2
     I           IDS
     I                                        1  54 PARA3
     I                                        1   9 SUP3
     I                                       10  12 PAP3
     I                                       13  150GRA3
     I                                       16  191LAI3
     I                                       20  230FOL3
     I                                       24  270FOH3
     I                                       28  36 PRE3
     I                                       37  430KGB3
     I                                       44  45 UNI3
     I                                       46  51 FOU3
     I                                       52  540GRR3
     I           IDS
     I                                        1  54 PARA4
     I                                        1   9 SUP4
     I                                       10  12 PAP4
     I                                       13  150GRA4
     I                                       16  191LAI4
     I                                       20  230FOL4
     I                                       24  270FOH4
     I                                       28  36 PRE4
     I                                       37  430KGB4
     I                                       44  45 UNI4
     I                                       46  51 FOU4
     I                                       52  540GRR4
     I           IDS
     I                                        1  54 PARA5
     I                                        1   9 SUP5
     I                                       10  12 PAP5
     I                                       13  150GRA5
     I                                       16  191LAI5
     I                                       20  230FOL5
     I                                       24  270FOH5
     I                                       28  36 PRE5
     I                                       37  430KGB5
     I                                       44  45 UNI5
     I                                       46  51 FOU5
     I                                       52  540GRR5
     I            DS
     I                                        1   20TONDUL
     I                                        1   10ONDUL
     I                                        2   20CCOL
     I            DS
     I                                        1  50 PPOBS
     I                                        1   2 PPOB2
     I                                        4  50 PPOB47
     I           IDS
     I                                        1  46 PARM91
     I                                        1   10FYUSI
     I                                        2   2 FYSECT
     I                                        3   3 FYSSEC
     I                                        4   5 FYMAC
     I                                        6  100FYCONF
     I                                       11  120FYSEQ                 CCS013
     I                                       13  130FYISEQ                CCS013
     I                                       14  170FYPRO                 CCS013
     I                                       18  210FYOPNU                CCS013
     I                                       22  230FYJJ                  CCS013
     I                                       24  250FYMM                  CCS013
     I                                       26  290FYAA                  CCS013
     I                                       22  290FYDTEQ                CCS013
     I                                       30  300FYEQUI                CCS013
     I                                       31  310FYSTE
     I                                       32  350FYCLI
     I                                       36  390NPFOUR
     I                                       40  460QTFOUR
     I           IDS
     I                                        1  31 PARM30
     I                                        1   10XJUSIN
     I                                        2   2 XJSECT
     I                                        3   3 XJSSEC
     I                                        4   5 XJNOMA
     I                                        6  100XJCONF
     I                                       11  120XJSEQ
     I                                       13  130XJISEQ
     I                                       14  170XJPRO
     I                                       18  210XJOPNU
     I                                       22  250XJPPAA
     I                                       26  270XJPPMM
     I                                       28  290XJPPJJ
     I                                       30  300XJEQUI
     I                                       31  310XJNBCA
     I           IDS
     I                                        1  16 PARM83
     I                                        1   50UXCONF                CCS013
     I                                        6   90UXPRO
     I                                       10  110UXSEQ                 CCS013
     I                                       12  120UXISEQ                CCS013
     I                                       13  160UXOPNU                CCS013
     I           IDS
     I                                        1  13 PARM84
     I                                        1   50UYCONF                CCS013
     I                                        6   90UYPRO
     I                                       10  110UYSEQ                 CCS013
     I                                       12  120UYISEQ                CCS013
     I                                       13  130UYUSI                 CCS013
     I           IDS
     I                                        1 124 PARM71                CCS013
     I                                        1   10ZQUSI                 CCS013
     I                                        2   60ZQCONF                CCS013
     I                                        7   80ZQSEQ                 CCS013
     I                                        9   90ZQISEQ                CCS013
     I                                       10  130ZQPRO
     I                                       14  14 ZQSECT                CCS013
     I                                       15  15 ZQSSEC                CCS013
     I                                       16  17 ZQMAC                 CCS013
     I                                       14  17 ZQMACH                CCS013
     I                                       18  240ZQQTE                 CCS013
     I                                       25  26 ZQUNIT                CCS013
     I                                       27  330TOTBON                CCS013
     I                                       34  400TOTCON                CCS013
     I                                       41  470PPGACA                CCS013
     I                                       48  540PPQFMA                CCS013
     I                                       55  610DIFQUA                CCS013
     I                                       62  662TX1                   CCS013
     I                                       67  712TX2                   CCS013
     I                                       72  780CMATR                 CCS013
     I                                       79  820ZQOPNU                CCS013
     I                                       83  890DIFREA                CCS013
     I                                       90  960DIFMAX                CCS013
     I                                       97 111 ABRCLI                CCS013
     I                                      112 1140ZQJJ                  CCS013
     I                                      114 1150ZQMM                  CCS013
     I                                      116 1190ZQAA                  CCS013
     I                                      112 1190ZQEQ                  CCS013
     I                                      120 1200ZQEQUI                CCS013
     I                                      121 1240ZQCLI                 CCS013
     I           IDS
     I                                        1 160 PARM72                CCS013
     I                                        1  40 ZQOBS1                CCS013
     I                                       41  80 ZQOBS2                CCS013
     I                                       81 120 ZQOBS3                CCS013
     I                                      121 160 NOMPRE                CCS013
     I           IDS
     I                                        1  21 PARM81
     I                                        1   10JJUSI
     I                                        2   2 JJSECT
     I                                        3   3 JJSSEC
     I                                        4   5 JJNOMA
     I                                        6  100JJCONF
     I                                       11  120JJSEQ                 CCS013
     I                                       13  130JJISEQ                CCS013
     I                                       14  170JJPRO                 CCS013
     I                                       18  210JJOPNU                CCS013
     I           IDS
     I                                        1  28 PARM82
     I                                        1   70JOTBON
     I                                        8  140JOTELI
     I                                       15  210JOTREG
     I                                       22  280JOTROU
     I           IDS
     I                                        1  48 CALJ
     I                                        1   1 FAH01
     I                                        2   2 FAH02
     I                                        3   3 FAH03
     I                                        4   4 FAH04
     I                                        5   5 FAH05
     I                                        6   6 FAH06
     I                                        7   7 FAH07
     I                                        8   8 FAH08
     I                                        9   9 FAH09
     I                                       10  10 FAH10
     I                                       11  11 FAH11
     I                                       12  12 FAH12
     I                                       13  13 FAH13
     I                                       14  14 FAH14
     I                                       15  15 FAH15
     I                                       16  16 FAH16
     I                                       17  17 FAH17
     I                                       18  18 FAH18
     I                                       19  19 FAH19
     I                                       20  20 FAH20
     I                                       21  21 FAH21
     I                                       22  22 FAH22
     I                                       23  23 FAH23
     I                                       24  24 FAH24
     I                                       25  25 FAH25
     I                                       26  26 FAH26
     I                                       27  27 FAH27
     I                                       28  28 FAH28
     I                                       29  29 FAH29
     I                                       30  30 FAH30
     I                                       31  31 FAH31
     I                                       32  32 FAH32
     I                                       33  33 FAH33
     I                                       34  34 FAH34
     I                                       35  35 FAH35
     I                                       36  36 FAH36
     I                                       37  37 FAH37
     I                                       38  38 FAH38
     I                                       39  39 FAH39
     I                                       40  40 FAH40
     I                                       41  41 FAH41
     I                                       42  42 FAH42
     I                                       43  43 FAH43
     I                                       44  44 FAH44
     I                                       45  45 FAH45
     I                                       46  46 FAH46
     I                                       47  47 FAH47
     I                                       48  48 FAH48
     *
     IDSPARA      DS                             47
     I I            0                         1   50NCF92
     I I            0                         6   90NOP92
     I I            0                        10  160SURF
     I I            0                        17  203SF
     I I            0                        21  270MINI
     I I            0                        28  340MAXI
     I                                       35  35 EXP
     I I            0                        36  420SURFF
     I I            0                        44  470NOC92
     *
     I           IDS
     I                                        1   3 TDECO
     I                                        3   3 TDECO9
     *
     IF720        DS                             14
     I                                        1   1 US720
     I                                        2   3 SS720
     I                                        4   5 MAC720
     I                                        6  13 DT720
     I                                       14  14 EQ720
     IPARMYZ      DS                             30
     I                                        1   10YZUSIN
     I                                        2   60YZCONF
     I                                        7   80YZSEQ                 CCS013
     I                                        9   90YZISEQ                CCS013
     I                                       10  130YZPRO                 CCS013
     I                                       14  14 YZSECT
     I                                       15  15 YZSSEC
     I                                       16  17 YZMAC
     I                                       18  210YZOPNU                CCS013
     I                                       22  230YZJJ                  CCS013
     I                                       24  250YZMM                  CCS013
     I                                       26  290YZAA                  CCS013
     I                                       30  300YZEQUI                CCS013
     *
     I           IDS
     I                                        1 100 BFECR
     I                                        1   10$SINE
     I                                        2   60$ACONF
     I                                        7   80$ASEQ
     I                                        9  120$OPRO
     I                                       13  16 $RESS
     I                                       17  200$PNUM
     *
     IDSPARM      DS
     I                                        1   8 TBLNOM
     I                                        9  18 TBVAR
     I                                       19  200LG
     I I            ' '                      81  81 FICH
    C*          Rajout IC 629183 Tmagpi
     I           IDS
     I                                        1  10 QPARM
     I                                        1   1 QOCCUR
     I                                        2   20QSTE
     I                                        3   60QCLI
     I                                        7  100QPRO
    C*          Rajout IC 649459 Tmagpi
     I            DS
     I                                        1 100 PARM1
     I                                        1   1 BIDON
     I                                        2   20STEA
     I                                        3   60CLIAP
     I                                        7  100PROA
     I                                       11  150CONFAP
     I                                       16  170SEQA
     I                                       18  180SUPPOR
     I                                       19  260DTLAN
     I                                       19  200JJLA
     I                                       21  220MMLA
     I                                       23  240SSLA
     I                                       25  260AALA
     I                                       27  340DTSYS
     I                                       27  280SSSYS
     I                                       29  300AASYS
     I                                       31  320MMSYS
     I                                       33  340JJSYS
    C*          Rajout IC 753971 Tmagpi
     I           IDS
     I                                        1 134 PARM76
     I                                        1   10GUSIN
     I                                        2   2 GECT
     I                                        3   3 GSECT
     I                                        4   5 GOMAC
     I                                        6  100GACONF
     I                                       11  120GASEQ
     I                                       13  130GAISEQ
     I                                       14  14 ECHTY
     I                                       15  54 OBSI1
     I                                       55  94 OBSI2
     I                                       95 134 OBSI3
    C*          Rajout TASK0012138 Tmagpi
     I           IDS
     I                                        1  72 PARM37
     I                                        1   10HSTE
     I                                        2   20HUSINE
     I                                        3   70HNCONF
     I                                        8   90HSEQ
     I                                       10  100HISEQ
     I                                       11  11 HSECT
     I                                       12  12 HSSECT
     I                                       13  14 HNOMAC
     I                                       15  15 HAUTHO
     I                                       16  190HNOCLI
     I                                       20  34 HABRCL
     I                                       35  380HNOPRO
     I                                       39  56 HLIBPR
     I                                       57  72 HTITET
    C**
     *
    C**
    C******  DEFINITION DES ZONES TRAVAIL
    C**
     C           *LIKE     DEFN RCX       SAVRCX
     C           *LIKE     DEFN DH        SAVDH
     C           *LIKE     DEFN RCD       SAVRCD
     C           *LIKE     DEFN RCX       DERRCX
     C           *LIKE     DEFN DATEQ     SAVDEQ
     C           *LIKE     DEFN PPEQUI    SAVEQ
     C           *LIKE     DEFN LIBEQU    SVLIEQ
     C           *LIKE     DEFN PPEQUI    SVEQUI
     C           *LIKE     DEFN FAEVTY    ZAEVTY
     C           *LIKE     DEFN PPORD     SAVORD
     C           *LIKE     DEFN PPORD     SVORD1
     C           *LIKE     DEFN RCY       SAVRCY
     C           *LIKE     DEFN RCY       SVRCY1
     C           *LIKE     DEFN RCY       DERRCY
     C           *LIKE     DEFN RCY       RCY2
     C           *LIKE     DEFN PPHFIN    TREF
     C           *LIKE     DEFN PPQFEU    TOTFEU
     C           *LIKE     DEFN RCT       SAVRCT
     C           *LIKE     DEFN PPOROB    SAVORB
     C           *LIKE     DEFN PPOBS     SAVOBS
     C           *LIKE     DEFN PPHDEB    SVHDEB
     C           *LIKE     DEFN PPHFIN    SVHFIN
     C           *LIKE     DEFN PPHFIN    SVHFI2
     C           *LIKE     DEFN DATEVE    SVDEVE
     C           *LIKE     DEFN DATEVE    SAVEVE
     C           *LIKE     DEFN PPHDEQ    HDEQ
     C           *LIKE     DEFN PPHFEQ    HFEQ
     C           *LIKE     DEFN PPHDEB    HDEB
     C           *LIKE     DEFN PPHFIN    HFIN
     C           *LIKE     DEFN PPHTIR    TOTTPS
     C           *LIKE     DEFN TOTHRE    SVTHRE
     C           *LIKE     DEFN DATLUE    DATMIN
     C           *LIKE     DEFN DATLUE    DATMAX
     C           *LIKE     DEFN DATLUE    DATJOU
     C           *LIKE     DEFN FAOPST    SVOPST
     C           *LIKE     DEFN TOTBON    SVTBON
     C           *LIKE     DEFN TOTBON    TOTEQ
     C           *LIKE     DEFN TOTBON    TOTEQG
     C           *LIKE     DEFN TOTBON    TOTEQD
     C           *LIKE     DEFN TOTBON    TOTEQ2
     C           *LIKE     DEFN FAEVCO    EVCO
     C           *LIKE     DEFN PPHCAL    SVHCAL
     C           *LIKE     DEFN PPHTIR    SVHTIR
     C           *LIKE     DEFN PPHARR    SVHARR
     C           *LIKE     DEFN PPHPAN    SVHPAN
     C           *LIKE     DEFN PPHFIN    TPSEVE
     C           *LIKE     DEFN PPHFIN    TPSEQ
     C           *LIKE     DEFN PPHFIN    HRFIN
     C           *LIKE     DEFN FATRSP    SVTRSP
     C           *LIKE     DEFN FAOPNU    YYOPNU
     C           *LIKE     DEFN FATENC    SVTENC
     C           *LIKE     DEFN NOMAC     MACH2
     C           *LIKE     DEFN FACONF    SWCONF
     C           *LIKE     DEFN FASEQ     SWSEQ
     C           *LIKE     DEFN FAISEQ    SWISEQ
     C           *LIKE     DEFN NOPRO     SWPRO
     C           *LIKE     DEFN FAOPNU    SWOPNU
     C           *LIKE     DEFN PPAA      SWAA
     C           *LIKE     DEFN PPMM      SWMM
     C           *LIKE     DEFN PPJJ      SWJJ
     C           *LIKE     DEFN PPEQUI    SWEQUI
     C           *LIKE     DEFN NOPRO     SVPRO
     C           *LIKE     DEFN PPGACA    JOTGAC
     C           *LIKE     DEFN PPGACA    JOTMAX
     C           *LIKE     DEFN PPGACA    JOTMA2
    C**
    C******  DEFINITION DES CLES
    C**
     C           KEYUSI    KLIST
     C                     KFLD           PXARGU
     C                     KFLD           PXVALE
     C           KCLI01    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C           KIMP2     KLIST
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C           KEYPRO    KLIST
    C*                    KFLD           STE               SD681273 Tmagpi
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C           KCASIE    KLIST
     C                     KFLD           NOFOR
     C                     KFLD           USINE
     C           KEYAMA    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           ORD
     C           KMAC02    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KTRASP    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           MACH2
     C                     KFLD           FATRSP
     C           KPRFOU    KLIST
     C                     KFLD           XYUSI
     C                     KFLD           XYSTE
     C                     KFLD           XYCLI
     C                     KFLD           XYPRO
     C                     KFLD           XYCONF
     C                     KFLD           XYSEQ
     C           KCAL01    KLIST
     C                     KFLD           CALJJ
     C                     KFLD           CALMM
     C                     KFLD           CALSS
     C                     KFLD           CALAA
     C           KCAL02    KLIST
     C                     KFLD           CALSS
     C                     KFLD           CALAA
     C                     KFLD           CALMM
     C                     KFLD           CALJJ
     C           KFAB02    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAAA
     C                     KFLD           FAMM
     C                     KFLD           FAJJ
     C           KFAB03    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVCO
     C           KFAB3A    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C           KFAB3B    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVTY
     C                     KFLD           FAEVCO
     C           KFAB3C    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVTY
     C           KFAB3D    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVNO
     C                     KFLD           FAEVCO
     C           KFAB04    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           CMATR
     C           KFAB05    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAAFA
     C                     KFLD           FAMFA
     C                     KFLD           FAJFA
     C                     KFLD           FAHFA
     C                     KFLD           FANOP
     C           KFAB5A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KFAB5B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAAFA
     C                     KFLD           FAMFA
     C                     KFLD           FAJFA
     C                     KFLD           FAHFA
     C           KFAB5C    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFAB5D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C           KFAB09    KLIST
     C                     KFLD           USINE
     C                     KFLD           FANMPC
     C           KFAB10    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           FACBPA
     C                     KFLD           NOBOU
     C           KFA10A    KLIST
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FATENC
     C                     KFLD           YYOPNU
     C                     KFLD           FACBPA
     C                     KFLD           NOBOU
     C           KFA10B    KLIST
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FATENC
     C           KFAB11    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PAPI
     C                     KFLD           GRAMM
     C                     KFLD           REFOUR
     C                     KFLD           GRAREL
     C                     KFLD           FOUB
     C                     KFLD           FACBPA
     C           KFAB13    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAEFC
     C                     KFLD           FATENC
     C           KFA13A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAEFC
     C           KFAB15    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAISEQ
     C                     KFLD           FAOPNU
     C           KFAB16    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA16A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFA16B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA16C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KFA16X    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           TACONF
     C                     KFLD           TASEQ
     C                     KFLD           TAISEQ
     C                     KFLD           TNOPRO
     C                     KFLD           TAOPNU
     C                     KFLD           TPAA
     C                     KFLD           TPMM
     C                     KFLD           TPJJ
     C                     KFLD           TPEQUI
     C           KFAB17    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPFAA
     C                     KFLD           PPFMM
     C                     KFLD           PPFJJ
     C                     KFLD           PPORD
     C           KFA17A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPORD
     C           KFA17B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPFAA
     C                     KFLD           PPFMM
     C                     KFLD           PPFJJ
     C                     KFLD           PPHDEB
     C                     KFLD           PPHFIN
     C           KFA17C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA17D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPORD
     C           KFAB18    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPCARD
     C           KFAB19    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPOROB
     C           KFA19X    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           TACONF
     C                     KFLD           TASEQ
     C                     KFLD           TAISEQ
     C                     KFLD           TNOPRO
     C                     KFLD           TAOPNU
     C                     KFLD           TPAA
     C                     KFLD           TPMM
     C                     KFLD           TPJJ
     C                     KFLD           TPEQUI
     C                     KFLD           PPOROB
     C           KPREOP    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAISEQ
     C                     KFLD           FAOPNU
     C           KLAN01    KLIST
     C                     KFLD           FACONF
     C                     KFLD           NOPRO
     C                     KFLD           FASEQ
     C                     KFLD           PRIORI
     C           KEYCDE    KLIST
     C                     KFLD           FACONF
     C                     KFLD           NOPRO
     C                     KFLD           FASEQ
     C           KCDES     KLIST
     C                     KFLD           FACONF
     C                     KFLD           NOPRO
     *  CLE D'ACCES FICHIER PLAMA
     C           KPLAM1    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           FACONF
     *
     C           KPLAM2    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     *
     C           KPLAM3    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           FACONF
     C                     KFLD           WWQFAB
     *  CLE D'ACCES FICHIER CARCDEZ1
     C           KCARLU    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           FACONF
     *  CLE D'ACCES FICHIER MALFACL5
     C           KMALFA    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
    C** CLE D'ACCES FICHIER CSGCMDL1
     C           KCSG1     KLIST
     C                     KFLD           STE
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
    C**
     *
    C**
    C******  RECEPTION DES PARAMETRES
    C**
     C           *ENTRY    PLIST
     C           PASUS     PARM PASUS     PASUS   1
     C           PASPC     PARM PASPC     PASPC  10
     C           PASMAC    PARM PASMAC    PASMAC  4
     C                     MOVE PASUS     USINE
     C                     MOVE PASPC     FANMPC
     C                     Z-ADD0         TONDUL
    C**
     C           *NAMVAR   DEFN           TOLFOU  60
    C**
    C******  SI USINE = ROCHE,TOURY,NEUVI,CHABA==> ZONES COMPTEURS
    C******         NON AFFICHABLES  INDICATEUR 30=ON
    C**
D1  C           USINE     IFEQ 2
    C           USINE     OREQ 3
    C           USINE     OREQ 4
    C           USINE     OREQ 5
     C                     MOVE *ON       *IN30
X1  C                     ELSE
     C                     MOVE *OFF      *IN30
F1  C                     ENDIF
    C**
     C                     EXSR GESFEN
    C**
    C******  SI MACHINE RENSEIGNEE ==> INUTILE CHERCHER MACHINE PAR PC
    C**
D1  C           PASMAC    IFNE *BLANK
     C                     MOVELPASMAC    FAATEL
     C                     MOVE PASMAC    NOMAC
X1  C                     ELSE
     **
     ******  LECTURE DE LA MACHINE GEREE PAR CE TERMINAL DE SAISIE
     **
     C           KFAB09    CHAINXFAB09               99
D2  C           *IN99     IFEQ *ON
     C                     MOVE *ON       *IN03
     C                     EXSR GESFEN
    C                     GOTO FIN
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  LECTURE USINE
    C**
     C                     MOVE 'USDE'    PXARGU
     C                     MOVE USINE     PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C                     MOVE *BLANKS   LIBUS1
     C           KEYUSI    CHAINPARAMEF1             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PXLIBE    LIBUS1
X1  C                     ELSE
     C                     MOVEL'INCONNU' LIBUS1
F1  C                     ENDIF
    C**
    C******  LECTURE SECTION/SS-SECTION
    C**
     C                     MOVE 'SSEC'    PXARGU
     C                     MOVE FAATEL    PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C           KEYUSI    CHAINPARAMEF1             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PXLIBE    LIBAT1
X1  C                     ELSE
     C                     MOVEL'INCONNU' LIBAT1
F1  C                     ENDIF
    C**
    C******  LECTURE MACHINE
    C**
     C           KMAC02    CHAINMACHIN               99
D1  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    TITETE
     C                     MOVEL'INCONNU' TITETE
F1  C                     ENDIF
    C**
    C******  LECTURE CALENDRIER OUVERTURE MACHINE => MAINT.PREV.
    C**
     C                     MOVE *OFF      *IN63
     C                     Z-ADD0         HDMP
     C                     Z-ADD0         HFMP
     C                     EXSR LECSYS
     C                     MOVELSYSA      DATOUV
     C                     MOVEL'20'      SYSC
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      DATOUV
     C           KFAB02    CHAINXFAB02               99
D1  C           *IN99     IFEQ *OFF
    C           FAHRTM    ANDGT0
    C**
     C                     MOVE *ON       *IN63
     C                     Z-ADD0         OO      20
D2  C                     DO   48        OO
D3  C           CALJ,OO   IFEQ 'M'
     C                     LEAVE
F3  C                     ENDIF
F2  C                     ENDDO
    C**
     C                     SUB  1         OO
     C           OO        MULT 0,50      HDMP2   42
     C           HDMP2     ADD  FAHRTM    HFMP2   42
     C                     MOVE HDMP2     DECIM   20
     C           HDMP2     MULT 100       HDMP
D2  C           DECIM     IFEQ 50
     C                     MOVE 30        HDMP
F2  C                     ENDIF
     C                     MOVE HFMP2     DECIM
     C           HFMP2     MULT 100       HFMP
D2  C           DECIM     IFEQ 50
     C                     MOVE 30        HFMP
F2  C                     ENDIF
    C**
F1  C                     ENDIF
    C**
    C******  AFFICHAGE DES OF PLANIFIES POUR CETTE MACHINE
    C**
     C           SSFIC     TAG
     C                     SETOF                     80
     C                     MOVEA'100'     *IN,60
     C                     WRITEF03
     C                     Z-ADD0         RCD
     C                     Z-ADD0         SAVRCD
     C                     Z-ADD0         SAVDH
     C                     Z-ADD0         DH
     C                     Z-ADD0         SONDUL
     C                     SETOF                     60
     C           KFAB05    SETLLXFAB05
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           LAB       TAG
D1  C                     DO   10
     C           LAB1      TAG
     C           KFAB5A    READEXFAB05                 8580
D2  C           *IN80     IFEQ *ON
    C                     GOTO SUITE
F2  C                     ENDIF
    C**
    C******  OP NON DISPO => PAS AFFICHABLE SAUF NEUVILLE/OFFSET
    C**
D2  C           USINE     IFNE 4
    C           FAOPST    CABEQ*BLANK    LAB1
X2  C                     ELSE
D3  C           FAATEL    IFNE '14'
    C           FAATEL    ANDNE'15'
    C           FAOPST    CABEQ*BLANK    LAB1
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  LECTURE DE LA DATE ET DU CODE DU DELAI
    C**
     C                     MOVE *BLANKS   CODEL
     C                     Z-ADD0         DELAI
    C*          FAATEL    IFGE '70'
     C           KEYCDE    CHAINCARCDEF1             99
    C*                    ENDIF
    C**
    C******  LECTURE CLIENT
    C**
     C                     MOVE *BLANK    ABRCLI
D2  C           STE       IFNE 0
     C           KCLI01    CHAINCLIENTS1             99
D3  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' ABRCLI
F3  C                     ENDIF
     **
     ******  LECTURE PRE-IMPRIME STOCKE SI STE=0
     **
X2  C                     ELSE
     C                     CLEARLIBEL
     C           KIMP2     CHAINPREIMP2              99
D3  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' ABRCLI
X3  C                     ELSE
     C                     MOVEL'STOCKE'  ABRCLI
     C                     MOVELDPRIMP    BLOC1
     C                     MOVE REFEXS    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE TVERS     ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE *BLANK    REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         FACON
     C                     Z-ADD0         UVENT
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  LECTURE PRODUIT
    C**
D2  C           STE       IFNE 0
     C                     CLEARLIBEL
    C*          KEYPRO    CHAINPRODAL8              99    SD 681273 Tmagpi
     C           KEYPRO    CHAINPRODAL9              99    SD 681273 Tmagpi
D3  C           *IN99     IFEQ *ON
    C**
     C           KIMP2     CHAINPRODSTF2             99
D4  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    LIB20
     C                     MOVEL'INCONNU' LIB20
     C                     MOVE *BLANK    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE *BLANK    ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE *BLANK    REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         FACON
     C                     Z-ADD0         UVENT
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
X4  C                     ELSE
     C                     MOVE *BLANK    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE *BLANK    ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE NOGF1     REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         FACON
     C                     Z-ADD0         UVENT
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
F4  C                     ENDIF
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  SI FORMAT ONDULE = FORMAT DECOUPE = 0
    C**
D2  C           ONDL      IFEQ 0
    C           ONDH      ANDEQ0
     C                     Z-ADDFMINL     ONDL
     C                     Z-ADDFMINH     ONDH
D3  C           ONDL      IFEQ 0
    C           ONDH      ANDEQ0
     C                     Z-ADDDECL      ONDL
     C                     Z-ADDDECH      ONDH
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  RECHERCHE DU NUMERO DE CASIER
    C**
     C                     MOVE *BLANKS   CASIER
     C           KCASIE    CHAINFORMAGF1             99
    C**
D2  C           USINE     IFEQ 3
    C           POSF2     ANDGT0
    C           FAATEL    ANDGE'21'
    C           FAATEL    ANDLT'70'
     C                     MOVE 'A côté :'LIBPO2
X2  C                     ELSE
     C                     MOVE *BLANKS   LIBPO2
F2  C                     ENDIF
    C**
    C******  LECTURE ARTICLE PRODUIT SI AMALGAMME
    C**
     C                     MOVE *BLANKS   REFCO
     C                     MOVE *OFF      *IN56
D2  C           FAORDA    IFNE 0
     C                     MOVE FAORDA    ORD
     C           KEYAMA    CHAINCODBARF1             99
     C                     MOVE *ON       *IN56
X2  C                     ELSE
     C                     MOVE *OFF      *IN56
F2  C                     ENDIF
    C**
    C******  CALCUL QTE DEJA PRODUITE SUR CETTE OP
    C**
     C                     Z-ADD0         TOTBON
     C                     Z-ADD0         INIBON
     C                     Z-ADD0         DATEQ
     C                     Z-ADD0         PPEQUI
     C           KFAB16    SETLLXFAB16
     C           LEC16     TAG
     C           KFA16A    READEXFAB16              N    99
D2  C           *IN99     IFEQ *OFF
     **
     ******  TEST SI EQUIPE EQUIPE TERMINEE => SI OUI LECTURE QTE FABRIQUEE
     **
D3  C           FA1601    IFEQ 'T'
     C                     ADD  PPQFEU    TOTBON
     C                     Z-ADDTOTBON    INIBON
X3  C                     ELSE
     **
     ******  SI EQUIPE EN COURS => CALCUL QTE FABRIQUEE DS FAB10P
     **
     C                     EXSR CALFAB
     C                     ADD  TOTEQ     TOTBON
F3  C                     ENDIF
     **
    C                     GOTO LEC16
F2  C                     ENDIF
    C**
    C******  MISE EN PLACE N° PASSAGE
    C**
     C                     MOVE FAOPNU    PPPAS
D2  C           PPPAS     IFGT 5
    C           PPPAS     ANDLT9
     C                     SUB  5         PPPAS
F2  C                     ENDIF
     **
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 Z-ADD1         PPPAS
    C****                 ENDIF
     **
     ******  RECHERCHE SI REPIQUAGE
     ******  OFFSET : OP 6261(1ER PASSAGE) ET 6271 (2EME PASSAGE)
     ******  FLEXO  : OP 3151(1ER PASSAGE) ET 3161 (2EME PASSAGE)
     **
     C                     MOVE 'N'       TAGOK
D2  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
     C                     Z-ADDUSINE     WAUSIN
     C                     Z-ADDFACONF    WACONF
     C                     Z-ADDFASEQ     WASEQ
     C                     Z-ADDFAISEQ    WAISEQ
     C                     Z-ADDNOPRO     WNOPRO
     C                     Z-ADDFAOPNU    WAOPNU
     C                     MOVE 'N'       TAGOK
     C                     CALL 'FAB580£'              85
     C           PARM7     PARM PARM7     PARM7
     **
D3  C           TAGOK     IFEQ 'O'
     C                     Z-ADD2         PPPAS
F3  C                     ENDIF
     **
F2  C                     ENDIF
     **
     ******  SI ROCHECHOUART PASABAN : 1303 EN TANDEM
     ******  SI TANDEM : TAGOK='O'  ET
     ******  INDICATEUR 28=ON ==> CDE EN DSPATR(RI) DANS FORMAT
     **
     C                     MOVE 'N'       T2207
     C                     SETOF                       28
     C                     Z-ADD0         IN28
D2  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D3  C           T2207     IFEQ 'O'
     C                     Z-ADD1         PPPAS
     C                     Z-ADD1         IN28
F3  C                     ENDIF
F2  C                     ENDIF
    C**
     C           *LIKE     DEFN TONDUL    SONDUL
D2  C           FAATEL    IFEQ '21'
    C           FAATEL    OREQ '31'
D3  C           TONDUL    IFNE SONDUL
     C                     Z-ADD1         IN28
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  TEST SI COMPLEXEUSE : 2206 EN TANDEM
     ******  SI TANDEM : TAGOK='O'  ET
     ******  INDICATEUR 28=ON ==> CDE EN DSPATR(RI) DANS FORMAT
     **
    C**
    C******  RECUP DU CODE TANDEM DS PREACOP
    C**
     C           KPREOP    CHAINPREACOPF             99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD0         TANDEM
F2  C                     ENDIF
    C**
D2  C           USINE     IFEQ 2
    C           TANDEM    ANDEQ1
    C           FAATEL    ANDEQ'22'
    C           NOMAC     ANDEQ'06'
     C                     Z-ADD1         IN28
F2  C                     ENDIF
    C**
    C******  TEST SI QTE FAB=0 ET OP TERMINEE EN MANUEL => PAS D'AFF
    C**
    C**         FAOPST    IFEQ 'TR'
    C**         TOTBON    CABEQ0         LAB1
    C**                   ENDIF
    C**
    C******  MISE EN PLACE COULEUR SUR ETAT OP
    C**
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
    C**
    C******  LECTURE TOLERANCES MINI/MAXI DS FICHIER CDES
    C**
     C           KCDES     CHAINCDESF1               99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD0         MACLI
     C                     Z-ADD0         MICLI
F2  C                     ENDIF
    C**
    C******  LECTURE ETAT OP PRECEDENTE DS LA GAMME
    C**
     C                     MOVE *BLANK    STAPRE
     C                     Z-ADDUSINE     WWUSIN
     C                     Z-ADDFACONF    WWCONF
     C                     Z-ADDFASEQ     WWSEQ
     C                     Z-ADDFAISEQ    WWISEQ
     C                     Z-ADDNOPRO     WWPRO
     C                     Z-ADDFAOPNU    WWOPNU
     C                     MOVE *BLANK    WWSPRE
     C                     Z-ADD0         WWQPRE
     C                     CALL 'FAB655£'
     C           PARM14    PARM PARM14    PARM14
     C                     MOVE WWSPRE    STAPRE
    C**
     C                     ADD  1         RCD
     C                     Z-ADDRCD       SAVRCD
     C                     MOVE *BLANK    CHOIX
     C                     Z-ADDDH        SAVDH
    C**
     C                     Z-ADDFAJFA     ZAJFA
     C                     Z-ADDFAMFA     ZAMFA
     C                     Z-ADDFAAFA     ZAAFA
    C**
    C****** RECHERCHE CODE DE GESTION DE L'OF
    C**
     C                     Z-ADDSTE       WSTE
     C                     Z-ADDNOCLI     WNOCLI
     C                     Z-ADDNOPRO     WOPRO
     C                     Z-ADDFACONF    WFACON
     C                     Z-ADDFASEQ     WFASEQ
     C                     MOVE *BLANK    CODGOF
     C                     CALL 'FAB015£'
     C                     PARM           PARMA
     *
     C                     MOVE '0'       *IN23
D2  C           CODGOF    IFEQ 'D'
     C                     MOVE '1'       *IN23
F2  C                     ENDIF
     *
     C                     MOVE *BLANK    ECHTY
D2  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'70'
    C           USINE     OREQ 3
    C           FAATEL    ANDEQ'82'
     C           'ARIANE'  SCAN BLOC2                    99
D3  C           *IN99     IFEQ '1'
     C                     MOVE 'A'       ECHTY   1
F3  C                     ENDIF
F2  C                     ENDIF
     *
    C*                    Rajout IC 753971 Tmagpi - Rajout info Réglage pour NE
D2  C           USINE     IFEQ 4
    C******  TEST SI INFO PRE REGLAGE EXISTE DANS REGOBS
    C**
     C                     Z-ADDUSINE     GUSIN
     C                     MOVELFAATEL    GECT
     C                     MOVE FAATEL    GSECT
     C                     MOVE NOMAC     GOMAC
     C                     Z-ADDFACONF    GACONF
     C                     Z-ADDFASEQ     GASEQ
     C                     Z-ADDFAISEQ    GAISEQ
     C                     MOVEL'N'       ECHTY
     C                     MOVE *BLANK    OBSI1
     C                     MOVE *BLANK    OBSI2
     C                     MOVE *BLANK    OBSI3
     C                     CALL 'FAB676£2'
     C                     PARM           PARM76
     *
F2  C                     ENDIF
     *
    C**
     C           IN28      COMP 1                        28
     *
    C**
    C*                    Rajout IC 629183 Tmagpi - Détection CR et DAC
     C                     EXSR SRCRDC
    C*
    C*                    Rajout TASK001238 Tmagpi - Détection TY pour consigne
     C                     MOVE '0'       *IN77
D1  C           USINE     IFEQ 3
     C                     MOVE '1'       *IN77            Détection TOURY
     C                     EXSR SRCCSG
F1  C                     END
    C*
     C                     WRITEF02
     C                     Z-ADDTONDUL    SONDUL
F1  C                     ENDDO
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F03
    C**
     C           SUITE     TAG
     C                     WRITEF01
     C                     SETON                     62
     C           RCD       COMP 0                    61
    C**
     C                     EXFMTF03
    C**
    C******  F3=FIN TRAVAIL
    C**
D1  C           *IN03     IFEQ *ON
     C                     EXSR GESFEN
    C                     GOTO FIN
F1  C                     ENDIF
    C**
    C******  F5=REAFFICHAGE
    C**
D1  C           *IN05     IFEQ *ON
    C                     GOTO SSFIC
F1  C                     ENDIF
    C**
    C******  F6=RENDRE DISPO UNE COMMANDE
    C**
D1  C           *IN06     IFEQ *ON
    C***  NON AUTORISE À ROCHECHOUART
    C***               À TOURY
    C***               À CHABANAIS
    C           USINE     CABEQ2         SUITE
    C           USINE     CABEQ3         SUITE
    C           USINE     CABEQ5         SUITE
    C**
     C                     Z-ADD0         FACONF
     C                     Z-ADD0         FASEQ
     C                     Z-ADD0         NOPRO
     C           DISP1     TAG
     C                     EXFMTF00
     **
D2  C           *IN12     IFEQ *ON
     C                     UNLCKFAB05L09
    C                     GOTO SSFIC
F2  C                     ENDIF
     **
     C           KFAB5D    CHAINTFAB05               40
    C           *IN40     CABEQ*ON       DISP1
     C                     MOVE 'DI'      FAOPST
     C                     MOVE '1'       FAHOF2
     C                     EXCPTMAJ05A
    C                     GOTO SSFIC
F1  C                     ENDIF
    C**
    C******  F10=PROGRAMMES ANNEXES (EX=CHARGEMENT POLICES ET FDP)
    C**
D1  C           *IN10     IFEQ *ON
     C                     MOVE PARM6     PAS6
     C                     CALL 'FAB579£'
     C           INDIC1    PARM INDIC1    INDIC1
     C           PAS6      PARM PAS6      PAS6
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C******  F17=DEBLOQUER UNE EQUIPE TERMINEE PAR ERREUR (DERNIERE)
    C**
D1  C           *IN17     IFEQ *ON
     C           KFA16C    CHAINXFA16B               99
    C           *IN99     CABEQ*OFF      SUITE          42
     C                     Z-ADD99999999  DATEQ
     C                     Z-ADD9         PPEQUI
     C           KFA16B    SETGTXFA16E
     C           KFA16C    REDPEXFA16E                   42
    C           *IN42     CABEQ*ON       SUITE
     C                     Z-ADDPPHFRE    NEWHRE
     C                     EXFMTF92
    C           *IN12     CABEQ*ON       SUITE
     **
     ******  RAZ HEURE DE FIN EQUIPE DS TRAVAIL PRECEDENT
     **
     C                     Z-ADD0         PPHFRE
     C                     EXCPTMAJ16E
     **
     ******  MAJ HEURE FIN SUR DERNIER EVENEMENT TRAVAIL PRECEDENT
     **
     C                     Z-ADD99        PPORD
     C           KFA17A    SETGTZFAB17
     C           KFAB16    REDPEZFAB17                   99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDNEWHRE    XPHFIN
     C                     EXCPTMAJ17E
F2  C                     ENDIF
     **
     ******  MAJ OBSERVATION : BILAN A REVALIDER
     **
     C                     Z-ADD99        PPOROB
     C           KFAB19    SETGTXFAB19
     C           KFAB16    REDPEXFAB19                   99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD1         PPOROB
X2  C                     ELSE
     C                     ADD  1         PPOROB
F2  C                     ENDIF
     C                     MOVE LIBV,1    PPOBS
     C                     WRITEXFAB19
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C******  PAGINATION AVANT : DATE SUIVANTE
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN80     IFEQ *OFF
     C                     MOVE SAVDH     DH
     C                     Z-ADDSAVRCD    RCD
     C           KFAB05    SETGTXFAB05
    C                     GOTO LAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCD    RCD
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER F02
    C**
     C           NEXT      TAG
     C                     READCF02                    8981
    C           *IN89     CABEQ*ON       SSFIC
    C           *IN81     CABEQ*ON       SSFIC
    C*---------------------------------------------------------------*
    C*       OPTION 1:AFFICHAGE FABRICATION SUR L'OP SELECTIONNEE    *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '1'
     **
     ******  TEST POUR OFFSET OU HELIO DANS LE CAS DE 2 PASSAGES
     ******  QUE L'ORDRE SOIT RESPECTÉ
     **
     C                     Z-ADDUSINE     SAUSIN
     C                     Z-ADDFACONF    SACONF
     C                     Z-ADDFASEQ     SASEQ
     C                     Z-ADDFAISEQ    SAISEQ
     C                     Z-ADDNOPRO     SNOPRO
     C                     Z-ADDFAOPNU    SAOPNU
     C                     MOVE SECT      SPSECT
     C                     MOVE SSECT     SSSECT
     C                     MOVE NOMAC     SNOMAC
     C                     MOVE *BLANKS   SETAOP
     C                     CALL 'FAB625£'              85
     C           PARM10    PARM PARM10    PARM10
     ******  SETAOP = '' ==> OPERATION PRÉCDENTE NON FAITE
    C           SETAOP    CABEQ'DI'      SUITE          43
     **
     ******  TEST SI LA COMMANDE EXISTE DS LE CARNET
     ******  OU N'EST PAS UNE SEQUENCE DE FABRICATION
     **
D2  C           FACONF    IFLT 99000
     C           KEYCDE    CHAINCARCDEF1             99
D3  C           *IN99     IFEQ *ON
     C                     Z-ADDNOPRO     SVPRO
     C           KIMP2     CHAINPRODSTF2             41
    C           *IN41     CABEQ*ON       SUITE
     C                     Z-ADDPRODOR    NOPRO
     C           KEYCDE    CHAINCARCDEF1             41
D4  C           *IN41     IFEQ *ON
     C                     Z-ADDSVPRO     NOPRO
    C                     GOTO SUITE
X4  C                     ELSE
     C                     Z-ADDSVPRO     NOPRO
F4  C                     ENDIF
F3  C                     ENDIF
     **
D3  C           QTIMP     IFEQ 0
    C           QTFAC     ANDEQ0
     C                     MOVE *ON       *IN41
    C                     GOTO SUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  TEST SI OP=2206 ET TANDEM CREATION EQUIPE IMPOSSIBLE
     **
    C**
    C******  RECUP DU CODE TANDEM DS PREACOP
    C**
     C           KPREOP    CHAINPREACOPF             99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD0         TANDEM
F2  C                     ENDIF
D2  C           USINE     IFEQ 2
    C           TANDEM    ANDEQ1
    C           FAATEL    ANDEQ'22'
    C           NOMAC     ANDEQ'06'
    C                     GOTO SUITE
F2  C                     ENDIF
    C**
     **
     ******  TEST SI OP ENCORE PLANIFIEE SUR CETTE MACHINE
     **
     C           KFAB5C    CHAINZFAB05              N99
    C           *IN99     CABEQ*ON       SSFIC
D2  C           SECT      IFNE XSECT
    C           SSECT     ORNE XSSECT
    C           NOMAC     ORNE XNOMAC
    C                     GOTO SSFIC
F2  C                     ENDIF
     **
    C           FAOPST    CABEQ*BLANK    SUITE          40
     C                     MOVE *BLANK    CHOIX
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     EXSR SUIFAB
     C           RCD       CHAINF02                  99
D2  C           *IN99     IFEQ *OFF
     C                     MOVE SVOPST    FAOPST
     C                     Z-ADDSVTBON    TOTBON
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D3  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X3  C                     ELSE
     C                     MOVE *ON       *IN33
F3  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
F2  C                     ENDIF
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 2:EDITION BONS DE FABRICATION                    *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '2'
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     Z-ADDFACONF    KKCONF
     C                     Z-ADDFASEQ     KKSEQ
     C                     Z-ADDNOPRO     KKPRO
     C                     MOVE '1'       IN95
     C                     CALL 'PLAN53£'
     C           PARMBF    PARM PARMBF    PARMBF
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 5:AFFICHAGE DONNEES PLANIFICATION PREACTOR       *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '5'
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C           KFAB5B    CHAINYFAB05               99
     C           FAOPST    CHAINXFAB08               99
     C                     EXFMTF04
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 6 : PAPIERS UTILISES                             *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '6'
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
    C**
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
    C**
D2  C           USINE     IFGT 1
     C                     Z-ADDUSINE     XZUSI
     C                     Z-ADDFACONF    XZCONF
     C                     Z-ADDFASEQ     XZSEQ
     C                     Z-ADDFAISEQ    XZISEQ
     C                     Z-ADDNOPRO     XZPRO
     C                     MOVE SECT      XZSECT
     C                     MOVE SSECT     XZSSEC
     C                     MOVE NOMAC     XZMAC
     C                     Z-ADDNOPRO     XZPRO
     C                     Z-ADDSTE       XZSTE
     C                     Z-ADDNOCLI     XZCLI
     C                     CALL 'FAB624LA'
     C           PARA0     PARM PARA0     PARA0
     C           PARA1     PARM PARA1     PARA1
     C           PARA2     PARM PARA2     PARA2
     C           PARA3     PARM PARA3     PARA3
     C           PARA4     PARM PARA4     PARA4
     C           PARA5     PARM PARA5     PARA5
     C           PARA6     PARM PARA6     PARA6   4
     C           PARA7     PARM PARA7     PARA7   2
     C                     MOVE PARA6     TYPOND
     C                     MOVE PARA7     TYPCOL
     C                     EXFMTF93A
X2  C                     ELSE
     **
     ******  PLUS UTILISE : ANCIEN PROGRAMME FABRP624 POUR TOURY
     **
     C                     Z-ADDUSINE     JAUSIN
     C                     Z-ADDFACONF    JACONF
     C                     Z-ADDFASEQ     JASEQ
     C                     Z-ADDFAISEQ    JAISEQ
     C                     Z-ADDNOPRO     JNOPRO
     C                     Z-ADDFAOPNU    JAOPNU
     C                     CALL 'FAB624L'
     C           PARM11    PARM PARM11    PARM11
     C           PARM12    PARM PARM12    PARM12
     C                     EXFMTF93
F2  C                     ENDIF
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 7 : SUIVI OF                                     *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '7'
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     MOVE CDE       PASCDE
     C                     CALL 'FAB610£'
     C           PASCDE    PARM PASCDE    PASCDE
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 8 = OUTILLAGE & DIVERS                           *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ '8'
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     EXFMTF94
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION E:EDITION ETIQUETTES CAISSES ==> SLT SI PF       *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 'E'
     **
     ******  TEST USINE => SEULEMENT TOURY ET ROCHE
     **
D2  C           USINE     IFNE 3
    C           USINE     ANDNE2
     C                     MOVE *ON       *IN45
    C                     GOTO SUITE
F2  C                     ENDIF
     **
     ******  TEST SI OP 'TR' => EDITION ETIQUETTE IMPOSSIBLE
     **
    C           FAOPST    CABEQ'TR'      SUITE          46
     **
     ******  POSSIBLE SLT SI DERNIERE OP DE LA GAMME
     **
     C                     Z-ADDUSINE     ZTUSI
     C                     MOVE SECT      ZTSECT
     C                     MOVE SSECT     ZTSSEC
     C                     MOVE NOMAC     ZTMAC
     C                     Z-ADDFACONF    ZTCONF
     C                     Z-ADDFASEQ     ZTSEQ
     C                     Z-ADDFAISEQ    ZTISEQ
     C                     Z-ADDFAOPNU    ZTOPNU
     C                     Z-ADDNOPRO     ZTPRO
     C                     MOVE *BLANK    ZTPF
     C                     CALL 'FAB637£'
     C           PARM24    PARM PARM24    PARM24
    C           ZTPF      CABNE'O'       SUITE      4444
     **
     C                     MOVE *BLANK    CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     **
     ******  RECHERCHE OP PRECEDENTE : ETAT ET QTE FABRIQUEE
     **
     C                     Z-ADDUSINE     ZYUSIN
     C                     Z-ADDNOPRO     ZYPRO
     C                     Z-ADDFACONF    ZYCONF
     C                     Z-ADDFASEQ     ZYSEQ
     C                     Z-ADDFAISEQ    ZYISEQ
     C                     Z-ADDFAOPNU    ZYOPNU
     C                     MOVELFAATEL    ZYMACH
     C                     MOVE NOMAC     ZYMACH
     C                     MOVE *BLANK    ZYOPST
     C                     Z-ADD0         ZYQTE
     C                     CALL 'FAB618£A'
     C           PARM25    PARM PARM25    PARM25
     **
     C                     Z-ADDUSINE     ZXUSIN
     C                     Z-ADDSTE       ZXSTE
     C                     Z-ADDNOCLI     ZXCLI
     C                     Z-ADDNOPRO     ZXPRO
     C                     Z-ADDFACONF    ZXCONF
     C                     Z-ADDFASEQ     ZXSEQ
     C                     Z-ADDFAISEQ    ZXISEQ
     C                     Z-ADDFAQTE     ZXQTE1
     C           ZYQTE     MULT POSF1     ZXQTE2
     C                     MOVE SECT      ZXSECT
     C                     MOVE SSECT     ZXSSEC
     C                     MOVE NOMAC     ZXNOMA
     C                     CALL 'ETIC01L'
     C           PARM26    PARM PARM26    PARM26
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION X : POUR INFORMATIQUE => MET UN 'S' DS ZONE      *
    C*                  FA0501 SI FAOPST='TR'                        *
    C*                  CA ENLEVE L'OP DU PLANNING MACHINE           *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 'X'
     C                     MOVE *BLANK    CHOIX
    C**
    C           FAOPST    CABNE'TR'      NEXT
     C                     MOVE *ON       *IN33
    C**
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
    C**
     C                     Z-ADDFACONF    UXCONF
     C                     Z-ADDFASEQ     UXSEQ
     C                     Z-ADDFAISEQ    UXISEQ
     C                     Z-ADDNOPRO     UXPRO
     C                     Z-ADDFAOPNU    UXOPNU
     C                     CALL 'FAB683£'
     C           PARM83    PARM PARM83    PARM83
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION Y : POUR INFORMATIQUE => MET UN 'S' DS ZONE      *
    C*                  FA0601 SI FAOPST='TR'                        *
    C*                  CA ENLEVE L'OF DE LA REMONTEE DS PREACTOR    *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 'Y'
     C                     MOVE *BLANK    CHOIX
    C**
    C           FAOPST    CABNE'TR'      NEXT
     C                     MOVE *ON       *IN33
    C**
     C           IN28      COMP 1                        28
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
    C**
     C                     Z-ADDFACONF    UYCONF
     C                     Z-ADDFASEQ     UYSEQ
     C                     Z-ADDFAISEQ    UYISEQ
     C                     Z-ADDNOPRO     UYPRO
     C                     Z-ADDUSINE     UYUSI
     C                     CALL 'FAB684£'
     C           PARM84    PARM PARM84    PARM84
F1  C                     ENDIF
    C**
    C******  OPTION B= BONS DE FABRICATION ECRAN
    C**
D1  C           CHOIX     IFEQ 'B'
     C                     MOVE *BLANK    CHOIX
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     Z-ADDUSINE     $SINE
     C                     Z-ADDFACONF    $ACONF
     C                     Z-ADDFASEQ     $ASEQ
     C                     Z-ADDNOPRO     $OPRO
     C                     MOVELFAATEL    $RESS
     C                     MOVE NOMAC     $RESS
     C                     Z-ADDFAOPNU    $PNUM
     C                     CALL 'FAB810L'
     C           BFECR     PARM BFECR     BFECR
F1  C                     ENDIF
    C* Rajout IC 629183 Tmagpi ---------------------------------------------
    C**
    C******  OPTION Q=QUALITE -> APPEL PGM AFFICHAGE FICHE DE CONFORMITE
    C**
D1  C           CHOIX     IFEQ 'Q'
    C           USINE     ANDEQ4
     C                     MOVE *BLANK    CHOIX
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     MOVE *BLANK    QOCCUR
     C                     Z-ADDSTE       QSTE
     C                     Z-ADDNOCLI     QCLI
     C                     Z-ADDNOPRO     QPRO
     C                     CALL 'MALF19£'
     C           QPARM     PARM QPARM     QPARM
F1  C                     ENDIF
    C* Rajout IC 649459 Tmagpi ---------------------------------------------
    C**
    C******  OPTION G=GAMME -> APPEL PGM RESERVATION TEMPS MACHINE/GAMME
    C**
D1  C           CHOIX     IFEQ 'G'
D2  C           USINE     IFEQ 4
     C           USINE     OREQ 2
     C                     MOVE *BLANK    CHOIX
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     Z-ADDFACONF    KKCONF
     C                     Z-ADDFASEQ     KKSEQ
     C                     Z-ADDNOPRO     KKPRO
     C                     MOVE '1'       IN95
     C                     CALL 'PLAN07£'
     C           PARMBF    PARM PARMBF    PARMBF
F1  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  OPTION P=PAL -> APPEL PGM INTERROGATION HISTORIQUE DE PRODUCTION
    C**
D1  C           CHOIX     IFEQ 'P'
D2  C           USINE     IFEQ 4
     C           USINE     OREQ 2
     C                     MOVE *BLANK    CHOIX
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C                     MOVE 'Z'       BIDON
     C                     Z-ADDSTE       STEA
     C                     Z-ADDNOCLI     CLIAP
     C                     Z-ADDNOPRO     PROA
     C                     Z-ADDFACONF    CONFAP
     C                     Z-ADDFASEQ     SEQA
     C                     Z-ADD0         DTSYS
     C                     CALL 'PROD21£'
     C           PARM1     PARM PARM1     PARM1
F1  C                     ENDIF
F2  C                     ENDIF
    C**
    C* Rajout IC 753971 Tmagpi ---------------------------------------------
    C******  OPTION R=Rg  -> POUR VISU DES OBSERVATIONS REGLAGE (REGOBS)
    C**
D1  C           CHOIX     IFEQ 'R'
    C           USINE     ANDEQ4
     C                     MOVE ECHTY     PRERGL
     C                     MOVELFAATEL    MACH
     C                     MOVE NOMAC     MACH
     C                     EXFMTF25
     C                     MOVE *BLANK    CHOIX
     C                     EXSR CRDAC                      Init CR - DAC
     C                     UPDATF02
     C*                    Z-ADDUSINE     GUSIN
     C*                    MOVELFAATEL    GECT
     C*                    MOVE FAATEL    GSECT
     C*                    MOVE NOMAC     GOMAC
     C*                    Z-ADDFACONF    GACONF
     C*                    Z-ADDFASEQ     GASEQ
     C*                    Z-ADDFAISEQ    GAISEQ
     C*                    MOVEL'N'       ECHTY
     C*                    MOVE *BLANK    OBSI1
     C*                    MOVE *BLANK    OBSI2
     C*                    MOVE *BLANK    OBSI3
     C*                    CALL 'FAB676£2'
     C*                    PARM           PARM76
F1  C                     ENDIF
    C* ---------------------------------------------------------------------
    C**
    C* Rajout TASK0012138 Tmagpi  ------------------------------------------
    C******  OPTION V=CSG ou C=CSG => Créate ou Visu des consignes sur cette
    C*                                cmde (Demande D.Bouny - Toury))
    C**
D1  C           USINE     IFEQ 3
D2  C           CHOIX     IFEQ 'C'
    C           CHOIX     OREQ 'V'
     C                     MOVE '0'       *IN73
     C                     Z-ADDSTE       HSTE
     C                     Z-ADDUSINE     HUSINE
     C                     Z-ADDFACONF    HNCONF
     C                     Z-ADDFASEQ     HSEQ
     C                     Z-ADDFAISEQ    HISEQ
     C                     MOVELFAATEL    HSECT
     C                     MOVE FAATEL    HSSECT
     C                     MOVE NOMAC     HNOMAC
     C                     MOVE CHOIX     HAUTHO
     C                     Z-ADDNOCLI     HNOCLI
     C                     MOVE ABRCLI    HABRCL
     C                     Z-ADDNOPRO     HNOPRO
     C                     MOVE LIB20     HLIBPR
     C                     MOVE TITETE    HTITET
    C*
     C                     CALL 'FAB537£'
     C                     PARM           PARM37
D3  C           HAUTHO    IFEQ 'N'
    C*                    Option autorisée aux seuls chefs d'équipe
     C                     MOVE '1'       *IN73
    C                     GOTO SUITE
F3  C                     ENDIF
     C                     MOVE *BLANK    CHOIX
     C                     EXSR SRCCSG
     C                     UPDATF02
    C*
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C                     GOTO NEXT
    C**
     C           FIN       TAG
     C                     MOVE '1'       *INLR
    C*****************************************************************
    C*                                                               *
    C*       SR : AFFICHAGE CARNET DE COMMANDE                       *
    C*                                                               *
    C*****************************************************************
    C           CARNET    BEGSR
     C                     MOVE '1'       ZONE95
     C                     MOVE STE       YYSTE
     C                     MOVE FACONF    DSCNF
     C                     MOVE NOCLI     YYCLI
    C**
    C******  TEST SI AFFICHE => COMMANDE SUR PRODUIT ORIGINE
    C**
     C           KIMP2     CHAINPRODSTF2             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PRODOR    DSPRO
X1  C                     ELSE
     C                     MOVE NOPRO     DSPRO
F1  C                     ENDIF
    C**
     C                     CALL 'CDEC20L'
     C           DSCOMM    PARM DSCOMM    DSCOMM
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : AFFICHAGE DES EQUIPES SUR L'OP CHOISIE             *
    C*                                                               *
    C*****************************************************************
    C           SUIFAB    BEGSR
     C           FAOPST    CHAINXFAB08               99
     C                     MOVE *BLANKS   LIBETA
     C                     MOVEL'BILAN OP'LIBETA
    C**
     C           XSFIC     TAG
     C                     SETOF                     90
     C                     MOVEA'100'     *IN,70
     C                     WRITEF07
     C                     Z-ADD0         RCX
     C                     Z-ADD0         SAVRCX
     C                     Z-ADD0         DERRCX
     C                     Z-ADD0         DATEQ
     C                     Z-ADD0         PPEQUI
     C                     Z-ADD0         SAVDEQ
     C                     Z-ADD0         SAVEQ
    C**
     C                     Z-ADD0         TOTCAL
     C                     Z-ADD0         TOTROU
     C                     Z-ADD0         TOTARR
     C                     Z-ADD0         TOTBON
     C                     Z-ADD0         TOTREB
     C                     Z-ADD0         TOTCAD
    C**
     C                     SETOF                     70
     C           KFAB16    SETLLXFAB16
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           XAB       TAG
     C           KFA16A    READEXFAB16              N  8590
D1  C           *IN90     IFEQ *ON
D2  C           RCX       IFGT 0
     C                     Z-ADD1         RCX
F2  C                     ENDIF
    C                     GOTO XUITE
F1  C                     ENDIF
     **
     C                     ADD  1         RCX
     C                     Z-ADDRCX       SAVRCX
     C                     Z-ADDRCX       DERRCX
     C                     Z-ADD0         CHOIX2
     C                     Z-ADDDATEQ     SAVDEQ
     C                     Z-ADDPPEQUI    SAVEQ
     C                     ADD  PPHCAL    TOTCAL
     C                     ADD  PPHTIR    TOTROU
     C                     ADD  PPHARR    TOTARR
     **
D1  C           FA1601    IFEQ 'T'
     C                     Z-ADDPPQFEU    PPQBON
D2  C           PPHTIR    IFNE 0
     C           PPQBON    DIV  PPHTIR    CADENC    H
X2  C                     ELSE
     C                     Z-ADD0         CADENC
F2  C                     ENDIF
     C           PPQFMA    ADD  PPGACA    PPQREB
     C                     ADD  PPQFEU    TOTBON
     C                     ADD  PPQFMA    TOTREB
     C                     ADD  PPGACA    TOTREB
D2  C           TOTROU    IFNE 0
     C           TOTBON    DIV  TOTROU    TOTCAD    H
X2  C                     ELSE
     C                     Z-ADD0         TOTCAD
F2  C                     ENDIF
X1  C                     ELSE
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     PPQBON
D2  C           PPHTIR    IFNE 0
     C           PPQBON    DIV  PPHTIR    CADENC    H
X2  C                     ELSE
     C                     Z-ADD0         CADENC
F2  C                     ENDIF
     C                     Z-ADDTOTEQ2    PPQREB
     C                     ADD  TOTEQ     TOTBON
D2  C           TOTROU    IFNE 0
     C           TOTBON    DIV  TOTROU    TOTCAD    H
X2  C                     ELSE
     C                     Z-ADD0         TOTCAD
F2  C                     ENDIF
     C                     ADD  TOTEQ2    TOTREB
F1  C                     ENDIF
     **
     ****** EST-CE QUE LE TRAVAIL EST COMMENCE?
     **
D1  C           FA1601    IFNE 'T'
     C           KFAB16    CHAINXFAB17              N99
D2  C           *IN99     IFEQ *OFF
     C                     MOVE 'E'       FA1601
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ****** L'OP EST ELLE INTERROMPUE?
     **
D1  C           PPTFIN    IFEQ 'I'
    C           FA1603    OREQ 'I'
     C                     MOVE 'I'       STOP
X1  C                     ELSE
     C                     MOVE *BLANK    STOP
F1  C                     ENDIF
     **
     ****** LECTURE NOM CONDUCTEUR DS FAB04P
     **
     C                     MOVE *BLANK    NOMPRE
     C           KFAB04    CHAINXFAB04               99
D1  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' NOMPRE
F1  C                     ENDIF
     **
     C                     WRITEF06
    C                     GOTO XAB
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F07
    C**
     C           XUITE     TAG
    C**
    C****** RECHERCHE NATURE DE CDE CLIENT ET CODE DE GESTION DE L'OF
    C**
     C                     MOVE *BLANK    NATCDE
     C                     MOVEL*BLANKS   LNATCD
     C                     MOVE '0'       *IN22
     C                     Z-ADDSTE       WSTE
     C                     Z-ADDNOCLI     WNOCLI
     C                     Z-ADDNOPRO     WOPRO
     C                     Z-ADDFACONF    WFACON
     C                     Z-ADDFASEQ     WFASEQ
     C                     MOVE SECT      WSECT
     C                     MOVE SSECT     WSSECT
     C                     MOVE NOMAC     WNOMAC
     C                     Z-ADDSAVEQ     WEQUIP
     C                     Z-ADD0         WSTOND
     C                     MOVE *BLANK    CODGOF
     C                     MOVE *BLANKS   LCODGO
     C                     CALL 'FAB015£'
     C                     PARM           PARMA
     C                     MOVE 'NCDE'    PXARGU
     C                     MOVE WSTOND    PXVALE    P
     C           KEYUSI    CHAINPARAME               99
D1  C           *IN99     IFEQ '0'
     C                     MOVE PXVALE    NATCDE
     C                     MOVELPXLIBE    LNATCD
X1  C                     ELSE
     C                     MOVE '1'       *IN22
F1  C                     ENDIF
     *
D1  C           CODGOF    IFNE *BLANK
     C                     MOVE 'CGES'    PXARGU
     C                     MOVE CODGOF    PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             99
D2  C           *IN99     IFEQ '0'
     C                     MOVELPXLIBE    LCODGO
F2  C                     ENDIF
F1  C                     ENDIF
     *
     C                     MOVE '0'       *IN21
D1  C           CODGOF    IFNE 'D'
     C                     MOVE '1'       *IN21
F1  C                     ENDIF
    C**
    C******  RECHERCHE MINI MAXI
    C**
     C                     EXSR MINMAX
     *
     C                     WRITEF05
     C                     SETON                     72
     C           RCX       COMP 0                    71
     C                     SETOF                     95
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'82'
D2  C           NOMAC     IFEQ '98'
    C           NOMAC     OREQ '96'
    C           NOMAC     OREQ '95'
     C                     SETON                     95
F2  C                     END
F1  C                     END
     C                     EXFMTF07
    C**
D1  C           *IN12     IFEQ *ON
     C                     Z-ADDTOTBON    SVTBON
     C                     MOVE FAOPST    SVOPST
    C                     GOTO SUIFAF
F1  C                     ENDIF
    C**
    C****** F1=ECRAN AIDE
    C**
D1  C           *IN01     IFEQ *ON
     C                     EXFMTF09
    C                     GOTO XUITE
F1  C                     ENDIF
    C**
    C****** F6=CREATION NOUVELLE EQUIPE => TEST STATUS OP SI POSSIBLE
    C******    SI EQUIPE PRECEDENTE NON TERMINEE => NLLE EQUIPE IMPOSSIBLE
    C**
D1  C           *IN06     IFEQ *ON
    C           FAOPST    CABEQ'TR'      XUITE          40
     **
D2  C           FAOPST    IFNE 'DI'
    C           FAOPST    ANDNE'EC'
    C           FAOPST    ANDNE'IN'
     C                     MOVE *ON       *IN41
    C                     GOTO XUITE
F2  C                     ENDIF
     **
D2  C           DERRCX    IFGT 0
     C           DERRCX    CHAINF06                  99
D3  C           *IN99     IFEQ *OFF
    C           FA1601    CABNE'T'       XUITE      4242
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  TEST SI TRAVAIL EST EN COURS SUR LA MACHINE => AVERTISSEM
     ******  TERMINER ARBITRAIREMENT LE TRAVAIL SUR L'EQUIPE TROUVEE
     **
     C           KFA16C    CHAINXFA16D               9985
    C******  TEST SI ENREGISTREMENT VERROUILLE
D2  C           *IN85     IFEQ *ON
     C                     CALL 'FAB609£'
    C                     GOTO XUITE
F2  C                     ENDIF
     **
D2  C           *IN99     IFEQ *OFF
     C                     EXFMTF17
D3  C           *IN12     IFEQ *ON
     C                     UNLCKFAB16L06
    C                     GOTO XUITE
F3  C                     ENDIF
     **
     C                     MOVE 'T'       TA1601
     C                     MOVE 'T'       TA1602
     C                     EXCPTMAJ16D
     **
     ******  MAJ OBSERVATION : BILAN A REVALIDER
     **
     C                     Z-ADDFACONF    SWCONF
     C                     Z-ADDFASEQ     SWSEQ
     C                     Z-ADDFAISEQ    SWISEQ
     C                     Z-ADDNOPRO     SWPRO
     C                     Z-ADDFAOPNU    SWOPNU
     C                     Z-ADDPPAA      SWAA
     C                     Z-ADDPPMM      SWMM
     C                     Z-ADDPPJJ      SWJJ
     C                     Z-ADDPPEQUI    SWEQUI
     **
     C                     Z-ADD99        PPOROB
     C           KFA19X    SETGTXFAB19
     C           KFA16X    REDPEXFAB19                   99
D3  C           *IN99     IFEQ *ON
     C                     Z-ADD1         PPOROB
X3  C                     ELSE
     C                     ADD  1         PPOROB
F3  C                     ENDIF
     C                     MOVE LIBV,1    PPOBS
     **
     C                     Z-ADDTACONF    FACONF
     C                     Z-ADDTASEQ     FASEQ
     C                     Z-ADDTAISEQ    FAISEQ
     C                     Z-ADDTNOPRO    NOPRO
     C                     Z-ADDTAOPNU    FAOPNU
     C                     Z-ADDTPAA      PPAA
     C                     Z-ADDTPMM      PPMM
     C                     Z-ADDTPJJ      PPJJ
     C                     Z-ADDTPEQUI    PPEQUI
     **
     C                     WRITEXFAB19
     **
     C                     Z-ADDSWCONF    FACONF
     C                     Z-ADDSWSEQ     FASEQ
     C                     Z-ADDSWISEQ    FAISEQ
     C                     Z-ADDSWPRO     NOPRO
     C                     Z-ADDSWOPNU    FAOPNU
     C                     Z-ADDSWAA      PPAA
     C                     Z-ADDSWMM      PPMM
     C                     Z-ADDSWJJ      PPJJ
     C                     Z-ADDSWEQUI    PPEQUI
F2  C                     ENDIF
     **
     C                     EXSR CREEQ
    C           *IN12     CABEQ*ON       XUITE
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
     C                     MOVE *OFF      *IN38
     C                     MOVE *BLANK    LIBFIN
     C                     EXSR OPERA
    C           *IN10     CABEQ*ON       SSFIC
    C           *IN11     CABEQ*ON       XSFIC
    C                     GOTO XSFIC
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER F06
    C**
     C           XEXT      TAG
     C                     READCF06                    8981
    C           *IN89     CABEQ*ON       XUITE
    C           *IN81     CABEQ*ON       XSFIC
    C**
    C******  OPTION 1=SAISIE DES EVENEMENTS SUR UNE OP
    C******  SI EQUIPE TERMINEE : VISUALISATION UNIQUEMENT
    C**
D1  C           CHOIX2    IFEQ 1
     C                     Z-ADD0         CHOIX2
     C                     UPDATF06
     C           KFAB16    CHAINXFAB16              N99
     **
     ******  EQUIPE TERMINEE MAIS INTERROMPUE => REPRISE POSSIBLE
     ******  SUR LA DERNIERE EQUIPE LE MEME JOUR
     ******  DEPOINTAGE MATIERES,EVENEMENTS DS FAB16P + ETAT OP DS FAB05P
     **
D2  C           FA1601    IFEQ 'T'
D3  C           PPTFIN    IFEQ 'I'
    C           RCX       ANDEQDERRCX
    C           DATEQ     ANDEQ*DATE
     **
     ******  TEST SI TRAVAIL EST EN COURS SUR LA MACHINE => IMPOSSIBLE
     **
     C           KFA16C    CHAINXFA16D              N99
D4  C           *IN99     IFEQ *OFF
     C                     EXFMTF17
    C                     GOTO XUITE
F4  C                     ENDIF
     **
     ******  TEST SI L'HORAIRE EST > À L'HEURE DE FIN D'EQUIPE        05P
     **
     C                     TIME           HEURE
     C                     MOVELHEURE     HEURE1  40
D4  C           PPEQUI    IFEQ 3
    C           HEURE1    ANDLE500
     C                     ADD  2400      HEURE1
F4  C                     ENDIF
    C**
    C           HEURE1    CABGTPPHFEQ    XUITE      44
     **
     ******  ECRAN DE CONFIRMATION DE REPRISE DU TRAVAIL              05P
     **
     C                     EXFMTF97
    C           *IN12     CABEQ*ON       XUITE
     **
     C                     MOVE LIBF,3    LIBFIN
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
     C           ZEC16     TAG
     C           KFAB16    CHAINXFAB16               9985
    C**
    C******  TEST SI ENREGISTREMENT VERROUILLE
    C**
D4  C           *IN85     IFEQ *ON
     C                     CALL 'FAB609£'
    C                     GOTO ZEC16
F4  C                     ENDIF
    C**
D4  C           *IN99     IFEQ *OFF
     C                     MOVE *BLANK    FA1601
     **
     ******  PAS DE SAISIE DE MATIERES SI CLICHERIE (ATELIER=18)      05P
     ******    ==> POINTEUR MATIERES DEJA CLOTURÉE                    05P
     **
D5  C           FAATEL    IFNE '18'
     C                     MOVE *BLANK    FA1602
X5  C                     ELSE
     C                     MOVE 'T'       FA1602
F5  C                     ENDIF
     **
     C                     EXCPTMAJ16
F4  C                     ENDIF
     C           KFAB5C    CHAINZFAB05               99
D4  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      FAOPST
     C           FAOPST    CHAINXFAB08               99
     C                     EXCPTMAJ05
F4  C                     ENDIF
X3  C                     ELSE
     C                     MOVE LIBF,1    LIBFIN
     C                     MOVE *ON       *IN35
     C                     MOVE *ON       *IN39
F3  C                     ENDIF
X2  C                     ELSE
     C                     MOVE *BLANK    LIBFIN
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
F2  C                     ENDIF
     **
D2  C           PPHFRE    IFGT 0
     C                     MOVE *ON       *IN38
     C                     MOVE LIBF,2    LIBFIN
X2  C                     ELSE
     C                     MOVE *OFF      *IN38
F2  C                     ENDIF
     C                     EXSR OPERA
    C           *IN10     CABEQ*ON       SSFIC
    C           *IN11     CABEQ*ON       XSFIC
    C                     GOTO XSFIC
F1  C                     ENDIF
    C**
    C******  OPTION 4=SUPPRESSION EQUIPE SLT SI NON COMMENCEE
    C**
D1  C           CHOIX2    IFEQ 4
    C           FA1601    CABNE*BLANK    XUITE      4343
    C**  TEST SI RIEN N'A ÉTÉ FAIT AUX MATIERES
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFAB16    CHAINXFAB10               99
     C   99      KFAB16    CHAINZFAB10               99
     C                     MOVE *BLANKS   PAPI
     C                     Z-ADD0         GRAMM
     C                     MOVE *BLANKS   REFOUR
     C                     Z-ADD0         GRAREL
     C                     MOVE *BLANKS   FOUB
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         BOUCH2
     C   99      KFAB16    CHAINXFAB11               99
     C   99      KFAB16    CHAINZFAB11               99
    C**
D2  C           *IN99     IFEQ *OFF
     C                     SETON                     43
    C                     GOTO XUITE
F2  C                     ENDIF
    C**
     C           KFAB16    CHAINXFAB16               99
D2  C           *IN99     IFEQ *OFF
     C                     DELETXFAB16
    C                     GOTO XSFIC
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  OPTION 6=ETIQUETTES CAISSE NOKIA
    C**
D1  C           CHOIX2    IFEQ 6
    C           FAATEL    ANDEQ'82'
    C           NOMAC     ANDEQ'95'
    C           CHOIX2    OREQ 6
    C           FAATEL    ANDEQ'82'
    C           NOMAC     ANDEQ'96'
    C           CHOIX2    OREQ 6
    C           FAATEL    ANDEQ'82'
    C           NOMAC     ANDEQ'98'
     C                     Z-ADD0         CHOIX2
     C                     UPDATF06
     C                     MOVE NOPRO     £OPRO
     C                     MOVE FACONF    £CONF
     C                     MOVE FASEQ     £EQFAB
     C                     MOVE '0000000' £AQTE
     C                     MOVE PPJJ      £PJJ
     C                     MOVE PPMM      £PMM
     C                     MOVE PPAA      £PAA
     C                     MOVE PPEQUI    £PEQUI
     C                     MOVELFAATEL    £RESS
     C                     MOVE NOMAC     £RESS
     C                     MOVE PARM6     PAS6
     C                     CALL 'ETIC08LP'
     C           PAS6      PARM PAS6      PAS6
F1  C                     END
    C**
    C                     GOTO XEXT
    C           SUIFAF    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : AJOUT D'UNE NOUVELLE EQUIPE SUR L'OP               *
    C*                                                               *
    C*****************************************************************
    C           CREEQ     BEGSR
    C**
     C                     MOVE TM,1      MODE
     C                     MOVE *OFF      *IN48
    C**
    C******  MISE EN PLACE LIBELLE : N° EQUIPE OU N° PERIODE SELON USINE
    C**
D1  C           USINE     IFEQ 7
     C                     MOVE LIBP,1    LIBPER
X1  C                     ELSE
     C                     MOVE LIBP,2    LIBPER
F1  C                     ENDIF
    C**
    C******  RECHERCHE DES DATES POSSIBLES POUR UNE NOUVELLE EQUIPE
    C******  DATE DU JOUR OU DATE VEILLE SI EQUIPE DE NUIT
    C**
     C                     Z-ADD*DATE     DATMAX
     C                     Z-ADD*DATE     DATLUE
     C           KCAL02    SETLLCALENDZ1
     C                     READPCALENDZ1                 99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDDATLUE    DATMIN
X1  C                     ELSE
     C                     Z-ADD0         DATMIN
F1  C                     ENDIF
     C                     Z-ADDUSINE     XXUSIN
     C                     Z-ADDFACONF    XXCONF
     C                     Z-ADDFASEQ     XXSEQ
     C                     Z-ADDFAISEQ    XXISEQ
     C                     Z-ADDNOPRO     XXPRO
     C                     Z-ADD0         XXEQU
     C                     Z-ADD*YEAR     XXAA
     C                     Z-ADDUMONTH    XXMM
     C                     Z-ADDUDAY      XXJJ
     C                     Z-ADD0         XXHDEQ
     C                     Z-ADD0         XXHFEQ
     C                     Z-ADD0         XXMAT
     C                     Z-ADD0         XXEFC
     C                     Z-ADD0         XXEFR
     C                     Z-ADD0         XXCTR1
     C                     Z-ADD0         XXCTR2
     C                     MOVE SECT      XXSEC
     C                     MOVE SSECT     XXSSEC
     C                     MOVE NOMAC     XXMAC
     C                     Z-ADD0         XXEQ11
     C                     MOVE ' '       XXF11
     C                     CALL 'FAB520£B'
     C           PARM5     PARM PARM5     PARM5
     **
     C                     Z-ADDXXEQU     PPEQUI
     C                     Z-ADDXXJJ      PPJJ
     C                     Z-ADDXXMM      PPMM
     C                     Z-ADDXXAA      PPAA
     C                     Z-ADDXXHDEQ    PPHDEQ
     C                     Z-ADDXXHFEQ    PPHFEQ
     C                     Z-ADDXXMAT     CMATR
     C                     Z-ADDXXEFC     PPEFFC
     C                     Z-ADDXXEFR     PPEFFR
     C                     Z-ADDXXCTR1    PPCTR1
     C                     Z-ADDXXCTR2    PPCTR2
    C**
    C******  RECUP DE L'UNITE DE QTE DE L'OP DS PREACOP
    C**
     C                     MOVE FAOPNU    TYPOP   10
D1  C           TYPOP     IFGT 5
    C           TYPOP     ANDLT9
     C                     MOVE '1'       FAOPNU
F1  C                     ENDIF
    C**
     C           KPREOP    CHAINPREACOPF             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE OPUNQT    PPUNIT
X1  C                     ELSE
     C                     MOVE FAUNIT    PPUNIT
     **
    C******  MAJ PPUNIT SI NON TROUVE DS PREACOP:TOURY-CHABANAIS-ROCHE
    C******  ==>  TRES IMPORTANT POUR L'ENTREE EN STOCK PRODUITS FINIS
D2  C           USINE     IFEQ 3
    C           USINE     OREQ 5
    C           USINE     OREQ 2
    C*
D3  C           FAATEL    IFGE '70'
    C           PPUNIT    ANDEQ'  '
     C                     MOVE 'PF'      PPUNIT
F3  C                     ENDIF
    C*
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     MOVE TYPOP     FAOPNU
    C**
    C******  RECUP : COULEUR, TYPE VERNIS, SECPAP, SUPOR
    C******            ET EFFECTIFS DANS FAB15P
    C**
     C           KFAB15    CHAINXFAB15              N99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDCOULX     PPNCCA
     C                     MOVE VERNIS    PPVERN
D2  C           PPEFFC    IFEQ 0
    C           PPEFFR    ANDEQ0
     C                     Z-ADDOPEFCA    PPEFFC
     C                     Z-ADDOPEFRO    PPEFFR
F2  C                     ENDIF
    C**
    C*****   EN FONCTION DE LA ZONE FACON (DU PRODUI2)
    C*****        MAJ ZONE FATRSP=DE ; FE ; RL
    C**
D2  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'21'
    C           FATRSP    ANDEQ'  '
    C**
D3  C           NOMAC     IFEQ '04'
    C           NOMAC     OREQ '38'
    C           NOMAC     OREQ '48'
    C**
D4  C                     SELEC
     C           FACON     WHEQ 4
     C                     MOVE 'DE'      FATRSP
     C           FACON     WHEQ 5
    C           FACON     OREQ 6
    C           FACON     OREQ 7
    C           FACON     OREQ 8
     C                     MOVE 'FE'      FATRSP
     C           FACON     WHEQ 1
    C           FACON     OREQ 2
    C           FACON     OREQ 9
     C                     MOVE 'RL'      FATRSP
     C                     OTHER
     C                     MOVE *BLANKS   FATRSP
F4  C                     ENDSL
F3  C                     ENDIF
F2  C                     ENDIF
    C**
X1  C                     ELSE
    C**
    C*****   EN FONCTION DE LA ZONE FACON (DU PRODUI2)
    C*****        MAJ ZONE FATRSP=DE ; FE ; RL
    C**
D2  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'21'
    C**
D3  C           NOMAC     IFEQ '04'
    C           NOMAC     OREQ '38'
    C           NOMAC     OREQ '48'
    C**
D4  C                     SELEC
     C           FACON     WHEQ 4
     C                     MOVE 'DE'      FATRSP
     C           FACON     WHEQ 5
    C           FACON     OREQ 6
    C           FACON     OREQ 7
    C           FACON     OREQ 8
     C                     MOVE 'FE'      FATRSP
     C           FACON     WHEQ 1
    C           FACON     OREQ 2
    C           FACON     OREQ 9
     C                     MOVE 'RL'      FATRSP
     C                     OTHER
     C                     MOVE *BLANKS   FATRSP
F4  C                     ENDSL
F3  C                     ENDIF
F2  C                     ENDIF
    C******               MOVE *BLANK    PPUNIT
     C                     MOVE *BLANKS   SECPAP
     C                     MOVE *BLANKS   SUPOR
     C                     MOVE *BLANKS   PPVERN
     C                     Z-ADD0         PPNCCA
     C                     Z-ADD0         PPEFFC
     C                     Z-ADD0         PPEFFR
F1  C                     ENDIF
    C**
    C******  TEST SI PPUNIT NON TROUVEE => PRENDRE FAUNIT DE FAB05P
    C**
D1  C           PPUNIT    IFEQ *BLANK
     C                     MOVE FAUNIT    PPUNIT
F1  C                     ENDIF
     **
     C                     MOVE *BLANK    NOMPRE
D1  C           CMATR     IFNE 0
     C           KFAB04    CHAINXFAB04               99
D2  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' NOMPRE
F2  C                     ENDIF
F1  C                     ENDIF
     **
     C                     Z-ADD0         PPHCAL
     C                     Z-ADD0         PPHTIR
     C                     Z-ADD0         PPHARR
     C                     Z-ADD0         PPHADI
     C                     Z-ADD0         PPHFRE
     C                     MOVE ' '       PPTFIN
     C                     Z-ADD0         PPQFEU
     C                     Z-ADD0         PPQFMA
     C                     Z-ADD0         PPGACA
     C                     Z-ADD0         PPQELI
     C                     MOVE *BLANK    PPDECH
     C                     MOVE *BLANK    PPOR
     C                     MOVE *BLANK    PPGAUF
     C                     MOVE *BLANK    FA1601
     C                     MOVE *BLANK    FA1602
     C                     MOVE *BLANK    FA1603
    C**
     C                     MOVE *OFF      *IN31
     C           CRET2     TAG
     C                     EXFMTF08
    C**
D1  C           *IN12     IFEQ *ON
    C                     GOTO CREF
F1  C                     ENDIF
    C**
    C******  F4=RECHERCHE CONDUCTEUR OU CODE TRAVAIL SPECIAL
    C******     EN FONCTION DU POSITIONNEMENT DANS LA LIGNE
    C**
D1  C           *IN04     IFEQ *ON
     C                     Z-ADDUSINE     ZUSI
     C                     MOVE SECT      ZSECT
     C                     MOVE SSECT     ZSSECT
     C                     MOVE NOMAC     ZNOMAC
     C                     MOVE '10'      LIGNE
     C                     MOVE *BLANKS   POS10  10
     C                     MOVEL'CMATR'   POS10
D2  C           POS2      IFEQ POS10
     C                     MOVE *BLANKS   PAS1
     C                     MOVE P1        PAS3
     C                     MOVE *BLANKS   PAS2
     C                     CALL 'FEN502£'              85
     C           PAS1      PARM PAS1      PAS1
     C           INDIC     PARM INDIC     INDIC
     C           LIGNE     PARM LIGNE     LIGNE
     C           PAS2      PARM PAS2      PAS2
     C           PAS3      PARM PAS3      PAS3
    C**
     C                     MOVE PAS1      CMATR
     C                     MOVE PAS2      NOMPRE
     C                     MOVE *ON       *IN31
     **
     ******  MISE EN PLACE DES HORAIRES EQUIPES STANDARDS
     **
D3  C           PPEQUI    IFGT 0
    C           PPEQUI    ANDLE3
     C                     Z-ADD1         UU      10
     C           USINE     LOKUPTBU,UU                   99
    C           *IN99     CABEQ*OFF      CRET2
     C                     Z-ADDUU        ZZ      20
     C                     SUB  1         ZZ
     C                     MULT 3         ZZ
     C                     ADD  PPEQUI    ZZ
     C                     MOVELTEQ,ZZ    PPHDEQ
     C                     MOVE TEQ,ZZ    PPHFEQ
F3  C                     ENDIF
    C**
X2  C                     ELSE
    C**
     C                     MOVE *BLANKS   PASCOD
     C                     MOVE P1        PASRES
     C                     CALL 'FEN505£'              85
     C           PASRES    PARM PASRES    PASRES  4
     C           PASCOD    PARM PASCOD    PASCOD  2
     C           INDI1     PARM INDI1     INDI1   1
     C           LIGNE     PARM LIGNE     LIGNE   2
     C           NATRAV    PARM NATRAV    NATRAV 30
D3  C           PASCOD    IFNE *BLANKS
     C                     MOVE PASCOD    FATRSP
F3  C                     ENDIF
F2  C                     ENDIF
     **
    C                     GOTO CRET2
F1  C                     ENDIF
    C**
    C******  CONTROLE SAISIES
    C**
     C           CRET3A    TAG
     C                     EXSR CONTRO
    C**
    C           *IN39     CABEQ*ON       CRET2
    C**
    C******  DEMANDE DE CONFIRMATION EN CAS DE SAISIE DU COMPTEUR
    C******  USINE 7 (FEG) SEULEMENT
    C**
D1  C           USINE     IFEQ 7
D2  C           *IN48     IFEQ *OFF
    C           PPCTR1    CABNE0         CRET2      4848
X2  C                     ELSE
     C                     MOVE *OFF      *IN48
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB16P
    C**
     C                     MOVE FAOPNU    PPPAS
D1  C           PPPAS     IFGT 5
    C           PPPAS     ANDLT9
     C                     SUB  5         PPPAS
F1  C                     ENDIF
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 Z-ADD1         PPPAS
    C****                 ENDIF
     **
     ******  RECHERCHE SI REPIQUAGE
     ******  OFFSET : OP 6261(1ER PASSAGE) ET 6271 (2EME PASSAGE)
     ******  FLEXO  : OP 3151(1ER PASSAGE) ET 3161 (2EME PASSAGE)
     **
     C                     MOVE 'N'       TAGOK
D1  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
     C                     Z-ADDUSINE     WAUSIN
     C                     Z-ADDFACONF    WACONF
     C                     Z-ADDFASEQ     WASEQ
     C                     Z-ADDFAISEQ    WAISEQ
     C                     Z-ADDNOPRO     WNOPRO
     C                     Z-ADDFAOPNU    WAOPNU
     C                     MOVE 'N'       TAGOK
     C                     CALL 'FAB580£'              85
     C           PARM7     PARM PARM7     PARM7
     **
D2  C           TAGOK     IFEQ 'O'
     C                     Z-ADD2         PPPAS
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : TAGOK='O'
     **
     C                     MOVE 'N'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D2  C           T2207     IFEQ 'O'
     C                     Z-ADD1         PPPAS
F2  C                     ENDIF
    C**
F1  C                     ENDIF
     C                     Z-ADDPPCTR1    PPCTR2
    C**
    C******  USINE : TOURY ET CLICHERIE : ATELIER 18
    C******   ON SOLDE AUTOMATIQUEMENT LES MATIERES
    C**
D1  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'18'
     C                     MOVE 'T'       FA1602
F1  C                     ENDIF
    C**
     C                     WRITEXFAB16
    C**
    C******  MAJ FICHIER FAB05P ==> STATUS OPERATION 'EN COURS'
    C**
     C           KFAB5C    CHAINZFAB05               99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      FAOPST
     C           FAOPST    CHAINXFAB08               99
     C                     UPDATZFAB05
     C                     EXSR COMPLX
F1  C                     ENDIF
    C**
    C******  MAJ PRLANC => OFETA = 'EC'
    C**
     C                     Z-ADDPRIOR1    PRIORI
     C           KLAN01    CHAINPRLANCFZ             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      OFETA
     C                     EXCPTMAJLAN
F1  C                     ENDIF
    C**
    C******  MAJ FAB15P => TRAVAIL SPÉCIAL
    C**
     C                     MOVE FATRSP    SVTRSP
     C           KFAB15    CHAINXFAB15               99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE SVTRSP    FATRSP
     C                     EXCPTMAJ15
F1  C                     ENDIF
    C**
    C           CREF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CONTROLE DONNEES EQUIPE                            *
    C*                                                               *
    C*****************************************************************
    C           CONTRO    BEGSR
    C**
    C******  INITIALISATION INDICATEUR ERREUR
    C**
     C                     MOVE *ON       *IN39
    C**
D1  C           PPEQUI    IFEQ 0
    C           PPEQUI    ORGT 3
     C                     MOVE *ON       *IN40
    C                     GOTO CONTF
F1  C                     ENDIF
    C**  TEST SI EQUIPE SAISIE EST DIFFERENTE DE L'EQUIPE PRECEDENTE
    C**  DANS LE CAS OU CELLE-CI S'EST TERMINÉE PAR F11
D1  C           XXF11     IFEQ 'T'
    C           PPEQUI    ANDEQXXEQ11
     C                     MOVE *ON       *IN41
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
     C           KFAB04    CHAINXFAB04               42
    C           *IN42     CABEQ*ON       CONTF
    C**
     C                     Z-ADDPPJJ      CALJJ
     C                     Z-ADDPPMM      CALMM
     C                     MOVELPPAA      CALSS
     C                     MOVE PPAA      CALAA
     C           KCAL01    CHAINCALENDF1             43
    C           *IN43     CABEQ*ON       CONTF
    C**
     C                     TIME           HREDTE 140
     C                     MOVE HREDTE    NEWDAT  80
D1  C           DATEQ     IFNE DATMIN
    C           DATEQ     ANDNEDATMAX
    C           DATEQ     ANDNENEWDAT
     C                     MOVE *ON       *IN43
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
    C           PPHDEQ    CABEQ0         CONTF        4444
    C           PPHFEQ    CABEQ0         CONTF        4545
    C**
D1  C           PPHDEQ    IFNE 0
     C                     MOVE PPHDEQ    MN      20
     C                     MOVELPPHDEQ    HR      20
    C           HR        CABGT24        CONTF      44
    C           MN        CABGT59        CONTF      44
    C           PPHDEQ    CABLT100       CONTF        44
F1  C                     ENDIF
    C**
D1  C           PPHFEQ    IFNE 0
     C                     MOVE PPHFEQ    MN
     C                     MOVELPPHFEQ    HR
    C           HR        CABGT24        CONTF      45
    C           MN        CABGT59        CONTF      45
    C           PPHFEQ    CABLT030       CONTF        45
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 3
    C           PPHFEQ    CABGTPPHDEQ    CONTF      44
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 1
    C           PPEQUI    OREQ 2
    C           PPHFEQ    CABLTPPHDEQ    CONTF        45
     **
     C                     EXSR LECSYS
     C                     MOVELSYSA      DATJOU
     C                     MOVEL'20'      SYSC    4
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      DATJOU
    C           DATEQ     CABNEDATJOU    CONTF      4343
F1  C                     ENDIF
    C**
    C******  TEST SI UN EFFECTIF A ÉTÉ SAISI
    C**
D1  C           PPEFFC    IFEQ 0
    C           PPEFFR    ANDEQ0
     C                     SETON                     47
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
    C******  TEST SI MEME EQUIPE DEJA EXISTANTE SUR CETTE OP
    C**
     C           KFAB16    CHAINXFA16C               99
    C           *IN99     CABEQ*OFF      CONTF          41
    C**
    C******  TEST SI LE CODE SPECIAL EST EXISTANT
    C**
D1  C           FATRSP    IFNE *BLANKS
     C                     MOVE NOMAC     MACH2
    C**   CAS PARTICULIER DE L'ONDULEUSE 3/8
D2  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'21'
    C           NOMAC     ANDEQ'38'
     C                     MOVE '03'      MACH2
F2  C                     ENDIF
     C           KTRASP    CHAINTRASPEF1             49
    C           *IN49     CABEQ*ON       CONTF
F1  C                     ENDIF
    C**
    C******  AUCUNE ERREUR DETECTEE
    C**
     C                     MOVE *OFF      *IN39
    C**
    C           CONTF     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : GESTION DES OPERATIONS FABRICATION                 *
    C*                                                               *
    C*****************************************************************
    C           OPERA     BEGSR
     C                     MOVE *OFF      *IN98
    C**
    C******  CALCUL QTE FABRIQUEE SUR LE TRAVAIL EN COURS
    C**
     C                     Z-ADD0         TOTENC
     C                     EXSR CALFAB
D1  C           FAATEL    IFNE '82'
     C                     Z-ADDTOTEQ     TOTENC
X1  C                     ELSE
D2  C           FAUSIN    IFEQ 3
    C           FAUSIN    OREQ 5
     C                     Z-ADDTOTEQ     TOTENC
X2  C                     ELSE
     C                     Z-ADDPPQBON    TOTENC
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  RECHERCHE DES EVENEMENTS DEJA EXECUTEES SUR CETTE EQUIPE
    C**
     C                     Z-ADDPPEQUI    P       10
     C                     MOVE EQ,P      LIBEQU
    C**
     C           OSFIC     TAG
     C                     MOVEA'100'     *IN,65
     C                     WRITEF12
     C                     Z-ADD0         RCY
     C                     Z-ADD0         DERRCY
     C                     Z-ADD0         SAVRCY
     C                     Z-ADD0         PPORD
     C                     Z-ADD0         SAVORD
     C                     Z-ADD0         DATEVE
     C                     Z-ADD0         SAVEVE
     C                     Z-ADD0         TOTHRE
     C                     Z-ADD0         TMN4
    C**
     C                     Z-ADD0         SIMUHD
     C                     Z-ADD0         SIMUHF
     C                     Z-ADD0         SIMUDT
    C**
     C                     SETOF                     65
     C           KFAB17    SETLLXFAB17
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER F11
    C**
     C           OAB       TAG
     C           KFAB16    READEXFAB17                 9368
D1  C           *IN68     IFEQ *ON
     **
     ****** SI EQUIPE TERMINEE OU COMMENCEE => POSITION EN DEBUT SSFIC
     **
D2  C           FA1601    IFNE *BLANK
    C           RCY       ANDGT0
     C                     Z-ADD1         RCY
F2  C                     ENDIF
     **
     ******  TEST SI OBSERVATIONS SAISIES
     **
     C                     MOVE *OFF      *IN48
D2  C           FA1601    IFEQ 'T'
     C           KFAB16    CHAINXFAB19              N48
F2  C                     ENDIF
     **
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C           *IN93     CABEQ*ON       OAB
     C           KFAB03    CHAINXFAB03               99
    C**
D1  C           PPHFIN    IFNE 0
     C                     EXSR TEMPS
F1  C                     ENDIF
    C**
     C                     ADD  1         RCY
     C                     Z-ADDRCY       SAVRCY
     C                     Z-ADDRCY       DERRCY
     C                     Z-ADDPPORD     SAVORD
    C**
    C****** ZONE H.DEBUT ET H.FIN PROTEGEE SI RENSEIGNEE
    C**
     C                     MOVE *OFF      *IN29
D1  C           PPHDEB    IFNE 0
    C           PPHFIN    ANDNE0
     C                     MOVE *ON       *IN29
F1  C                     ENDIF
    C**
     C                     WRITEF11
    C                     GOTO OAB
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F12
    C**
     C           OUITE     TAG
    C**
    C******  RECALCUL DES QTES PRODUITES
    C**
     C                     Z-ADD0         TOTENC
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     TOTENC
    C**
D1  C           *IN39     IFEQ *OFF
     C           INIBON    ADD  TOTENC    TOTBON
X1  C                     ELSE
     C                     Z-ADDINIBON    TOTBON
F1  C                     ENDIF
    C**
    C****** RECHERCHE NATURE DE CDE CLIENT ET CODE DE GESTION DE L'OF
    C**
     C                     MOVE *BLANK    NATCDE
     C                     MOVEL*BLANKS   LNATCD
     C                     MOVE '0'       *IN22
     C                     Z-ADDSTE       WSTE
     C                     Z-ADDNOCLI     WNOCLI
     C                     Z-ADDNOPRO     WOPRO
     C                     Z-ADDFACONF    WFACON
     C                     Z-ADDFASEQ     WFASEQ
     C                     MOVE SECT      WSECT
     C                     MOVE SSECT     WSSECT
     C                     MOVE NOMAC     WNOMAC
     C                     Z-ADDSAVEQ     WEQUIP
     C                     Z-ADD0         WSTOND
     C                     MOVE *BLANK    CODGOF
     C                     MOVE *BLANKS   LCODGO
     C                     CALL 'FAB015£'
     C                     PARM           PARMA
     C                     MOVE 'NCDE'    PXARGU
     C                     MOVE WSTOND    PXVALE    P
     C           KEYUSI    CHAINPARAME               99
D1  C           *IN99     IFEQ '0'
     C                     MOVE PXVALE    NATCDE
     C                     MOVELPXLIBE    LNATCD
X1  C                     ELSE
     C                     MOVE '1'       *IN22
F1  C                     ENDIF
     *
D1  C           CODGOF    IFNE *BLANK
     C                     MOVE 'CGES'    PXARGU
     C                     MOVE CODGOF    PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             99
D2  C           *IN99     IFEQ '0'
     C                     MOVELPXLIBE    LCODGO
F2  C                     ENDIF
F1  C                     ENDIF
     *
     C                     MOVE '0'       *IN21
D1  C           CODGOF    IFNE 'D'
     C                     MOVE '1'       *IN21
F1  C                     ENDIF
    C**
    C******  RECHERCHE MINI MAXI
    C**
     C                     EXSR MINMAX
    C**
     C                     WRITEF10
     C                     SETON                     67
     C           RCY       COMP 0                    66
     C                     EXFMTF12
    C**
    C******  F12 : ABANDON SAISIE ==> RETOUR AFFICHAGE EQUIPES
    C**
D1  C           *IN12     IFEQ *ON
     C                     Z-ADD0         PPORD
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F1 : MODULE GESTION DES ENCOURS/MATIERES
    C******       INTERRO OU SAISIE SELON ZONE FASCAN DS FAB09P
    C**
D1  C           *IN01     IFEQ *ON
     C                     Z-ADDUSINE     YAUSIN
     C                     MOVE SECT      YSECT
     C                     MOVE SSECT     YSSECT
     C                     MOVE NOMAC     YNOMAC
     C                     Z-ADDFACONF    YACONF
     C                     Z-ADDFASEQ     YASEQ
     C                     Z-ADDFAISEQ    YAISEQ
     C                     Z-ADDSTE       YSTE
     C                     Z-ADDNOCLI     YNOCLI
     C                     Z-ADDNOPRO     YNOPRO
     C                     Z-ADDFAOPNU    YAOPNU
     C                     Z-ADDDATEQ     YATEQ
     C                     Z-ADDPPEQUI    YPEQUI
     **
     C                     MOVE PARM4     PAS4   35
D2  C           FASCAN    IFEQ 'O'
     C                     CALL 'FAB523£'
     C           PAS4      PARM PAS4      PAS4
     C           PASPC     PARM PASPC     PASPC
X2  C                     ELSE
    C*****
    C***** VISU. ENCOURS SUR 1ER ECRAN ==> NON AUTORISÉ SI 2 ÉCRANS
    C*****                CALL 'FAB532£'
    C*****      PAS4      PARM PAS4      PAS4
    C                     GOTO OUITE
F2  C                     ENDIF
     **
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F4 : AFFICHAGE SUIVI OF   ==> NON AUTORISÉ
    C**
D1  C           *IN04     IFEQ *ON
    C                     GOTO OUITE
     C                     MOVE CDE       PASCDE 18
     C                     MOVE 'N'       PASAUT  1
     C                     CALL 'FAB521£'
     C           PASCDE    PARM PASCDE    PASCDE
     C           PASAUT    PARM PASAUT    PASAUT
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F5 : AFFICHAGE DU BILAN PRODUCTION
    C**
D1  C           *IN05     IFEQ *ON
     C                     EXSR BILAN
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F6 : CREATION NOUVEL EVENEMENT ET MAJ TEMPS DEBUT
    C**
D1  C           *IN06     IFEQ *ON
D2  C           DERRCY    IFNE 0
     C           DERRCY    CHAINF11                  99
    C           PPHFIN    CABEQ0         OUITE          41
     **
     ******  TREF = HEURE FIN OPERATION N-1 ==> HEURE DEBUT OPER N
     ******  SI REPRISE APRES INTERRUPTION => RECHERCHE HEURE FIN OP PREC
     **
D3  C           PPTFIN    IFEQ 'I'
     C                     EXSR RECTIM
X3  C                     ELSE
     C                     Z-ADDPPHFIN    TREF
F3  C                     ENDIF
     **
     ******  NOUVELLE OP => RECHERCHE HEURE FIN OP PRECEDENTE
     **
X2  C                     ELSE
     C                     EXSR RECTIM
F2  C                     ENDIF
    C**
     C                     EXSR CREOP
    C           *IN12     CABEQ*ON       OUITE
    C                     GOTO OSFIC
F1  C                     ENDIF
    C**
    C******  F7 : SAISIE OBSERVATIONS
    C**
D1  C           *IN07     IFEQ *ON
    C           *IN48     CABEQ*ON       OUITE
     C                     EXSR WINOB
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F8 : SIMULATION D'HORAIRE DEBUT ET FIN EVENEMENT/MAQUETT E
    C**                     ==> NON AUTORISE
    C**
D1  C           *IN08     IFEQ *ON
    C                     GOTO OUITE
     C                     EXFMTF99
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F9 : FIN EVENEMENT : MAJ HEURE DE FIN DS FICHIER FAB17P
    C**
D1  C           *IN09     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          46
     C           DERRCY    CHAINF11                  99
    C           PPHFIN    CABGT0         OUITE      46
     **
     ******  TEST SI HORAIRE EVENEMENT > 20H00 => ERREUR HORAIRE EQUIPE
     **
D2  C           SIMUHF    IFNE 0
     C                     MOVELSIMUHF    HEURE
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     C                     MOVELHEURE     PPHFIN
     **
D2  C           PPEQUI    IFLT 3
D3  C           PPHFIN    IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
D2  C           PPEQUI    IFEQ 3
    C           PPHFIN    ANDLTPPHDEQ
D3  C           PPHFIN    IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
     C           PPHFIN    SUB  PPHDEB    TPSEVE
D2  C           TPSEVE    IFLT 0
     C                     ADD  2400      TPSEVE
F2  C                     ENDIF
     C           PPHFEQ    SUB  PPHDEQ    TPSEQ
D2  C           TPSEQ     IFLT 0
     C                     ADD  2400      TPSEQ
F2  C                     ENDIF
D2  C           TPSEVE    IFGT TPSEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN36
    C                     GOTO OUITE
F2  C                     ENDIF
     **
     C           FINOP     TAG
     C                     EXFMTF15
    C           *IN12     CABEQ*ON       OUITE
     C           DERRCY    CHAINF11                  99
     **
     ******  SI HEURE SIMULATION RENSEIGNEE ==> HEURE SIMULATION
     **
D2  C           SIMUHF    IFNE 0
     C                     Z-ADD0         HEURE
     C                     MOVELSIMUHF    HEURE
     C                     Z-ADD0         SIMUHF
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     **
     C                     MOVELHEURE     PPHF    40
     C                     MOVELHEURE     PPHFIN
D2  C           PPHFIN    IFEQ 0
     C                     Z-ADD2359      PPHFIN
     C                     Z-ADD2359      PPHF
F2  C                     ENDIF
    C**
     C                     UPDATF11
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHF      PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F10 : FIN DE TRAVAIL SUR UNE OP : SAISIE BILAN
    C**
D1  C           *IN10     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          43
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
     C           KFAB16    CHAINXFAB16              N99
    C           FA1602    CABNE'T'       OUITE      3737
     **
     ******  TEST SI HORAIRE FIN OP > HORAIARE FIN EQUIPE => FAIRE F11E
     **
D2  C           SIMUHF    IFNE 0
     C                     MOVELSIMUHF    HEURE
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     C                     MOVELHEURE     HRFIN
     **
D2  C           PPEQUI    IFLT 3
D3  C           HRFIN     IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
D2  C           PPEQUI    IFEQ 3
    C           HRFIN     ANDLTPPHDEQ
D3  C           HRFIN     IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  VALIDATION DES MODIFS HORAIRES EVENTUELLES
    C**
     C                     READCF11                    8981
D2  C           *IN81     DOWEQ'0'
D3  C           *IN89     IFNE *ON
     C                     EXSR MODHOR
    C           *IN44     CABEQ*ON       OUITE
    C           *IN45     CABEQ*ON       OUITE
    C           *IN47     CABEQ*ON       OUITE
F3  C                     END
     C                     READCF11                    8981
F2  C  N81                END
     **
     C                     EXSR TESHOR
    C           *IN40     CABEQ*ON       OUITE
     C                     EXSR FINEQU
    C           *IN12     CABEQ*ON       OUITE
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F11 : FIN D'EQUIPE ==> SAISIE DU BILAN
    C**
D1  C           *IN11     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          43
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
     C           KFAB16    CHAINXFAB16              N99
    C           FA1602    CABNE'T'       OUITE      3737
    C**
    C******  VALIDATION DES MODIFS HORAIRES EVENTUELLES
    C**
     C                     READCF11                    8981
D2  C           *IN81     DOWEQ'0'
D3  C           *IN89     IFNE *ON
     C                     EXSR MODHOR
    C           *IN44     CABEQ*ON       OUITE
    C           *IN45     CABEQ*ON       OUITE
    C           *IN47     CABEQ*ON       OUITE
F3  C                     END
     C                     READCF11                    8981
F2  C  N81                END
     **
     C                     EXSR TESHOR
    C           *IN40     CABEQ*ON       OUITE
     C                     EXSR FINEQU
D2  C           *IN12     IFEQ *ON
    C                     GOTO OUITE
F2  C                     ENDIF
     *
     C                     MOVE USINE     US720
     C                     MOVE FAATEL    SS720
     C                     MOVE NOMAC     MAC720
     C                     MOVE DATEQ     DT720
     C                     MOVE PPEQUI    EQ720
    C*                    CALL 'FAB720£'                  SD 1381325
    C*                    PARM           F720
     **
     ******  LEAN => IMPRESSION DES BILANS DE FACTIONS : PROD ET OBS  ON)
     ******          AUTORISATIONS TESTEES DANS CLP FABRC690          ON)
     **
     C                     MOVE FAATEL    PAZATE
     C                     MOVE NOMAC     PAZMAC
     C                     MOVE DATEQ     PASDTE
     C                     MOVE PPEQUI    PASEQ
     C                     MOVE FANPRT    PASPRT 10
     C                     CALL 'FAB690L'
     C           PASUS     PARM PASUS     PASUS
     C           PAZATE    PARM PAZATE    PAZATE  2
     C           PAZMAC    PARM PAZMAC    PAZMAC  2
     C           PASDTE    PARM PASDTE    PASDTE  8
     C           PASEQ     PARM PASEQ     PASEQ   1
     C           PASPRT    PARM PASPRT    PASPRT
     **
     ******  SI EQUIPE 3 ET FIN EQUIPE => FIN SESSION (CHGT DATE SESSION)
     **
D2  C           PPEQUI    IFEQ 3
     C                     EXSR GESFEN
     C                     SETON                     LR
     C                     RETRN
F2  C                     ENDIF
     **
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F17 : DEBLOCAGE SAISIE MATIERES/ENCOURS SI DEJA CLOTUREE E
    C**
D1  C           *IN17     IFEQ *ON
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
     C           KFAB16    CHAINXFAB16              N99
    C           FA1602    CABNE'T'       OUITE      3434
     C                     EXFMTF96
    C           *IN12     CABEQ*ON       OUITE
     C           KFAB16    CHAINXFAB16               99
     C                     MOVE ' '       FA1602
     C                     EXCPTMAJ16B
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F18 = BONS DE FABRICATION ECRAN
    C**
D1  C           *IN18     IFEQ *ON
     C                     Z-ADDUSINE     $SINE
     C                     Z-ADDFACONF    $ACONF
     C                     Z-ADDFASEQ     $ASEQ
     C                     Z-ADDNOPRO     $OPRO
     C                     MOVELFAATEL    $RESS
     C                     MOVE NOMAC     $RESS
     C                     Z-ADDFAOPNU    $PNUM
     C                     CALL 'FAB810L'
     C           BFECR     PARM BFECR     BFECR
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  ROLLUP : PAGE AVANT : REMPLISSAGE DU SOUS-FICHIER
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN68     IFEQ *OFF
     C                     Z-ADDSAVORD    PPORD
     C                     Z-ADDSAVEVE    DATEVE
     C                     Z-ADDSAVRCY    RCY
     C           KFAB17    SETGTXFAB17
    C                     GOTO OAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCY    RCY
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER
    C**
     C           OEXT      TAG
     C                     READCF11                    8981
    C           *IN89     CABEQ*ON       OUITE
    C           *IN81     CABEQ*ON       OSFIC
    C**
    C****** MODIFICATION HORAIRES EVENEMENT SI OP NON TERMINEE
    C**
D1  C           *IN35     IFEQ *OFF
     C                     EXSR MODHOR
    C           *IN44     CABEQ*ON       OUITE
    C           *IN45     CABEQ*ON       OUITE
    C           *IN47     CABEQ*ON       OUITE
F1  C                     ENDIF
    C**
    C                     GOTO OEXT
    C**
    C           OINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CREATION D'UN NOUVEL EVENEMENT                     *
    C*                                                               *
    C*****************************************************************
    C           CREOP     BEGSR
    C           *IN98     CABEQ*ON       CRET20
     C                     SETON                     98
     C                     Z-ADDSAVORD    SVORD1
     C                     Z-ADDSAVRCY    SVRCY1
     C                     Z-ADDSAVORD    PPORD
     C                     Z-ADDSAVRCY    RCY
    C**
     C           KFAB17    SETGTXFAB17
D1  C                     DO   *HIVAL
    C**
     C           CRET1     TAG
     C           KFAB16    READEXFAB17              N  9368
    C           *IN68     CABEQ*ON       CRET20
    C           *IN93     CABEQ*ON       CRET1
     C                     ADD  1         RCY
     C                     Z-ADDRCY       DERRCY
     C                     Z-ADDRCY       SAVRCY
     C                     MOVE PPORD     SAVORD
     C                     WRITEF11
F1  C                     ENDDO
    C**
    C******  RECHERCHE EVENEMENT DS FENETRE : SS-PROG WIN01
    C**
     C           CRET20    TAG
     C                     MOVE *BLANKS   FAEVLI
     C                     MOVE *BLANK    ZAEVTY
     C                     EXSR WIN
    C**
D1  C           *IN12     IFEQ *ON
     C                     MOVE SVORD1    PPORD
D2  C           SVRCY1    IFEQ 0
     C                     Z-ADDSAVRCY    RCY
X2  C                     ELSE
     C                     Z-ADDSVRCY1    RCY
F2  C                     ENDIF
    C                     GOTO CREF2
F1  C                     ENDIF
    C**
     C           KFAB03    CHAINXFAB03               99
    C           *IN99     CABEQ*ON       CRET20
    C**
    C******  SI EQUIPE NUIT => DATE FAB=DATE JOUR SINON DATE DEB EQUIP
    C******  ATTENTION AU CAS : HEURE EFFECTIVE=20H58 ET DEBUT EQUIPE
    C******  =21H00 => ON AJOUTE LE TEST HEUR4 < 8H00 MATIN
    C**
     C                     TIME           HEURE   60
     C                     MOVELHEURE     HEUR4   40
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      HEUR4
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 3
D2  C           HEUR4     IFLT PPHDEQ
    C           HEUR4     ANDLT800
     C                     Z-ADDPPJJ      CALJJ
     C                     Z-ADDPPMM      CALMM
     C                     MOVELPPAA      CALSS
     C                     MOVE PPAA      CALAA
     C           KCAL02    SETGTCALENDZ1
     C                     READ CALENDZ1                 99
     C                     Z-ADDDATLUE    DATEVE
X2  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F2  C                     ENDIF
X1  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F1  C                     ENDIF
    C**
    C******  HEURE DEBUT=HEURE REELLE
    C**
     C                     MOVELHEURE     PPHDEB
     C                     Z-ADD0         PPHFIN
    C**
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      PPHDEB
F1  C                     ENDIF
D1  C           PPHDEB    IFEQ 2400
     C                     Z-ADD0         PPHDEB
F1  C                     ENDIF
     **
     ******  SI SIMULATION HEURE DEBUT RENSEIGNEE ==> HEURE SIMULATION
     **
D1  C           SIMUHD    IFNE 0
    C           SIMUDT    ANDNE0
     C                     Z-ADDSIMUHD    PPHDEB
     C                     Z-ADDSIMUDT    DATEVE
     C                     Z-ADD0         SIMUHD
     C                     Z-ADD0         SIMUDT
F1  C                     ENDIF
    C**
    C******  CALCUL DU N° ORDRE EVENEMENT SUR CETTE EQUIPE
    C**
     C                     Z-ADD99        PPORD
     C           KFA17A    SETGTXFA17A
     C           KFAB16    REDPEXFA17A                   99
D1  C           *IN99     IFEQ *ON
     C                     Z-ADD1         PPORD
X1  C                     ELSE
     C                     ADD  1         PPORD
    C           PPORD     CABEQ0         CREF2
F1  C                     ENDIF
    C**
     C                     WRITEXFAB17
    C**
    C******  AJOUT NLLE OPERATION DS SS-FICHIER F11
    C**
     C                     Z-ADDSAVRCY    RCY
     C                     ADD  1         RCY
     C                     Z-ADDRCY       SAVRCY
     C                     Z-ADDRCY       DERRCY
     C                     WRITEF11
     C                     Z-ADDPPORD     SAVORD
    C**
    C           CREF2     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : MODIFICATION DES HORAIRES D'UN EVENEMENT           *
    C*                                                               *
    C*****************************************************************
    C           MODHOR    BEGSR
    C**
    C******  SUPPRESSION EVENEMENT EN COURS==> HEURE DEBUT=HEURE FIN=0
    C**
D1  C           PPHDEB    IFEQ 0
    C           PPHFIN    ANDEQ0
    C**
D2  C           RCY       IFEQ DERRCY
     C           KFA17D    CHAINZFAB17               99
D3  C           *IN99     IFEQ *OFF
     C                     DELETZFAB17
F3  C                     ENDIF
    C                     GOTO MODHOF
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C*                    GOTO MODHOF
    C******  MODIFICATION => TEST HEURE DEBUT ET FIN
    C**
     C                     MOVE PPHDEB    MN      20
     C                     MOVELPPHDEB    HR      20
    C           HR        CABGT24        MODHOF     44
    C           MN        CABGT59        MODHOF     44
    C**
     C                     MOVE PPHFIN    MN
     C                     MOVELPPHFIN    HR
    C           HR        CABGT24        MODHOF     45
    C           MN        CABGT59        MODHOF     45
    C**
    C******  MODIFICATION => TEST DATE FABRICATION
    C**
D1  C           DATEVE    IFNE DATEQ
    C**
     C                     Z-ADDPPFJJ     CALJJ
     C                     Z-ADDPPFMM     CALMM
     C                     MOVELPPFAA     CALSS
     C                     MOVE PPFAA     CALAA
     C           KCAL01    CHAINCALENDF1             47
    C           *IN47     CABEQ*ON       MODHOF
    C           DATEVE    CABLTDATEQ     MODHOF       47
F1  C                     ENDIF
    C**
    C******  CONTROLE VRAISEMBLANCE HORAIRES / EQUIPE
    C**
     C                     Z-ADDPPHDEQ    HDEQ
     C                     Z-ADDPPHFEQ    HFEQ
     C                     Z-ADDPPHDEB    HDEB
     C                     Z-ADDPPHFIN    HFIN
D1  C           PPHFEQ    IFLT PPHDEQ
     C           PPHFEQ    ADD  2400      HFEQ
F1  C                     ENDIF
    C**
D1  C           PPHFIN    IFNE 0
     C                     Z-ADDPPHDEB    HDEB
     C                     Z-ADDPPHFIN    HFIN
D2  C           PPHFIN    IFLT PPHDEB
     C           PPHFIN    ADD  2400      HFIN
F2  C                     ENDIF
F1  C                     ENDIF
    C**
D1  C           DATEVE    IFGT DATEQ
     C           PPHDEB    ADD  2400      HDEB
     C           PPHFIN    ADD  2400      HFIN
F1  C                     ENDIF
    C**
D1  C           PPHFIN    IFNE 0
    C           HFIN      CABLTHDEB      MODHOF       45
F1  C                     ENDIF
    C           HDEB      CABLTHDEQ      MODHOF       44
    C           HDEB      CABGTHFEQ      MODHOF     44
    C           HFIN      CABGTHFEQ      MODHOF     45
D1  C           PPHFIN    IFNE 0
    C           HFIN      CABLTHDEQ      MODHOF       45
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB17P
    C**
     C           KFA17D    CHAINZFAB17               99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHDEB    XPHDEB
     C                     Z-ADDPPHFIN    XPHFIN
     C                     Z-ADDDATEVE    XATEVE
     C                     UPDATZFAB17
F1  C                     ENDIF
    C**
    C           MODHOF    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : TEST CONTINUITE EN TEMPS DES EVENEMENTS            *
    C*                                                               *
    C*****************************************************************
    C           TESHOR    BEGSR
    C**
    C******  SI TRAVAIL REPRIS APRES INTERRUPTION => TEST NON EFFECTUE
    C**
    C           PPTFIN    CABEQ'I'       TESHOF
    C**
     C                     MOVE *OFF      *IN40
     C                     MOVE *OFF      *IN96
     C                     Z-ADD0         DATEVE
     C                     Z-ADD0         PPORD
    C**
     C           KFAB17    SETLLXFAB17
     C           TESHO1    TAG
     C           KFAB16    READEXFAB17              N    99
    C**
    C           *IN99     CABEQ*ON       TESHOF
    C**
    C******  1ERE LECTURE
    C**
D1  C           *IN96     IFEQ *OFF
     C                     MOVE *ON       *IN96
     C                     Z-ADDPPHFIN    SVHFIN
    C                     GOTO TESHO1
F1  C                     ENDIF
    C**
D1  C           PPHDEB    IFEQ SVHFIN
     C                     Z-ADDPPHFIN    SVHFIN
    C                     GOTO TESHO1
F1  C                     ENDIF
    C**
    C******  ERREUR DE DISCONTINUITE => *IN40 ON
    C**
     C                     MOVE *ON       *IN40
    C**
     C           TESHOF    TAG
     C                     MOVE *OFF      *IN96
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : CALCUL DIFFERENCE DE TEMPS EN MINUTES                *
    C*                                                               *
    C*****************************************************************
    C           TEMPS     BEGSR
     C                     MOVE PPHDEB    MN
     C                     MOVELPPHDEB    HR
     C           HR        MULT 60        TMN1    40
     C                     ADD  MN        TMN1
     C                     MOVE PPHFIN    MN
     C                     MOVELPPHFIN    HR
     C           HR        MULT 60        TMN2    40
     C                     ADD  MN        TMN2
D1  C           PPHDEB    IFGT PPHFIN
     C                     ADD  1440      TMN2
F1  C                     ENDIF
    C**
    C******  CALCUL DIFFERENCE EN MINUTES : FIN-DEBUT
    C**
     C           TMN2      SUB  TMN1      TMN3    40
     C                     ADD  TMN3      TMN4    40
    C**
    C******  TRANSFORMATION TOTAL MINUTE EN HEURE:MINUTE
    C**
     C           TMN4      DIV  60        HR
     C                     MVR            MN
     C                     MOVELHR        TOTHRE
     C                     MOVE MN        TOTHRE
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : RECHERCHE HEURE DE FIN DU TRAVAIL PRECEDENT        *
    C*                                                               *
    C*****************************************************************
    C           RECTIM    BEGSR
     C                     Z-ADD9999      PPHDEB
     C                     Z-ADD9999      PPHFIN
     C                     Z-ADD99999999  DATEVE
     C                     Z-ADD0         TREF
     C           KFA17B    SETGTYFAB17
     C           LEC17B    TAG
     C           KFA17C    REDPEYFAB17                   99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHFIN    TREF
X1  C                     ELSE
     C                     Z-ADDPPHDEQ    TREF
F1  C                     ENDIF
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*  SR : AFFICHAGE FENETRE CHOIX OPERATION FABRICATION/MACHINE   *
    C*                                                               *
    C*****************************************************************
    C           WIN       BEGSR
     C                     MOVE *BLANK    FAEVCO
     C                     Z-ADD0         FAEVNO
     C           RAZ       TAG
     C                     MOVE *BLANK    AF1
     C                     MOVE *BLANK    AF2
     C                     MOVE *BLANK    AF3
     C                     MOVE *BLANK    PAG
     C                     Z-ADD0         PA2
     C                     Z-ADD0         I
     C                     MOVE *OFF      *IN88
     C                     Z-ADD1         SEIT
    C**
    C******  LECTURE DU FICHIER FAB03P
    C**
     C                     MOVE *BLANK    FAEVLI
     C                     MOVE *BLANK    FAEVCO
     C                     Z-ADD0         FAEVNO
    C**
     C           RELEC     TAG
     C                     Z-ADD0         I       30
     C                     MOVE *BLANK    AF1
     C                     MOVE *BLANK    AF2
     C                     MOVE *BLANK    AF3
    C**
D1  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3D    SETLLZFAB03
X1  C                     ELSE
     C                     MOVE ZAEVTY    FAEVTY
     C           KFAB3B    SETLLYFAB03
F1  C                     ENDIF
    C**
D1  C                     DO   9         I
     C           LEC       TAG
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3A    READEZFAB03                   88
X2  C                     ELSE
     C           KFAB3C    READEYFAB03                   88
F2  C                     ENDIF
    C**
D2  C           *IN88     IFEQ *ON
     C                     LEAVE
F2  C                     ENDIF
    C**
    C****** SI EVENEMENT HORODATE => OMISSION DES ARRETS DIVERS
    C****** +  OMISSION DES N°ORDRE 999 => EVENEMENTS PLUS UTILISES
    C**
D2  C           ZAEVTY    IFEQ *BLANK
    C           FAEVTY    CABEQ'D'       LEC
    C           FAEVNO    CABEQ999       LEC
F2  C                     ENDIF
    C**
D2  C           I         IFEQ 1
     C                     Z-ADDSEIT      Q       20
     C                     MOVE FAEVCO    PAG,Q
     C                     Z-ADDFAEVNO    PA2,Q
F2  C                     ENDIF
     C                     MOVE FAEVCO    AF1,I
     C                     MOVE FAEVLI    AF2,I
     C                     MOVE FAEVLI    AF3,I
F1  C                     ENDDO
    C**
    C******  AFFICHAGE D'UNE PAGE
    C**
     C           AFF       TAG
     C                     EXFMTF22
D1  C           *IN12     IFEQ *ON
     C                     MOVE *BLANK    FAEVCO
     C                     MOVE *BLANK    FAEVLI
    C                     GOTO WINF
F1  C                     ENDIF
    C**
    C******  ENTREE : CHOIX DU CODE EVENEMENT
    C**
D1  C           *IN25     IFEQ *OFF
    C           *IN26     ANDEQ*OFF
     C                     Z-ADD1         Z       20
     C           POS2      LOKUPZO,Z                     99
    C           *IN99     CABEQ*OFF      AFF
    C           AF1,Z     CABEQ*BLANK    AFF
     C                     MOVE AF1,Z     FAEVCO
     C                     MOVE AF3,Z     FAEVLI
    C                     GOTO WINF
F1  C                     ENDIF
    C**
    C******  PAGE AVANT
    C**
D1  C           *IN26     IFEQ *ON
     C                     ADD  1         SEIT
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3D    SETGTZFAB03
X2  C                     ELSE
     C           KFAB3B    SETGTYFAB03
F2  C                     ENDIF
    C**
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3A    READEZFAB03                   88
X2  C                     ELSE
     C           KFAB3C    READEYFAB03                   88
F2  C                     ENDIF
D2  C           *IN88     IFEQ *ON
     C                     SUB  1         SEIT
    C                     GOTO AFF
F2  C                     ENDIF
    C                     GOTO RELEC
F1  C                     ENDIF
    C**
    C******  PAGE ARRIERE
    C**
D1  C           *IN25     IFEQ *ON
     C                     SUB  1         SEIT
D2  C           SEIT      IFLT 1
     C                     ADD  1         SEIT
    C                     GOTO AFF
F2  C                     ENDIF
     C                     Z-ADDSEIT      Q
     C                     MOVE PAG,Q     FAEVCO
     C                     Z-ADDPA2,Q     FAEVNO
    C                     GOTO RELEC
F1  C                     ENDIF
    C**
    C******  RETOUR A L'AFFICHAGE
    C**
    C                     GOTO AFF
    C           WINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : FIN EQUIPE : SAISIE DU BILAN OPERATION               *
    C*                                                               *
    C*****************************************************************
    C           FINEQU    BEGSR
     C                     MOVE *OFF      *IN39
     C                     Z-ADD0         TPSTOT
     C                     MOVE *BLANK    TCAD
     C                     Z-ADD0         THAD
     C                     MOVE *BLANK    TTAD
     C                     Z-ADD0         TEAD
     C                     MOVE *BLANK    TLAD
    C**
    C**  POSITIONNEMENT DU CURSEUR SUR QTE REBUTEE SI ATELIER FINITION
    C**            SINON SUR LA QUANTITÉE FABRIQUEE
    C**  SAUF POUR TOURY-CHABANAIS QUI FONT DES FICHES PALETTES PF
    C**            DANS CE CAS POSITIONNEMENT SUR QTE REBUTÉE
D1  C           FAATEL    IFEQ '81'
    C           FAATEL    OREQ '83'
    C**         FAATEL    OREQ '82'
    C**         USINE     ANDEQ2
    C**         FAATEL    OREQ '82'
    C**         USINE     ANDEQ4
    C           FAATEL    OREQ '82'
    C           USINE     ANDEQ7
     C                     MOVE *ON       *IN27
X1  C                     ELSE
     C                     MOVE *OFF      *IN27
F1  C                     ENDIF
    C**
     C                     MOVE *BLANK    TAD1
     C                     Z-ADD0         TAD2
     C                     Z-ADD0         SVTAD2
     C                     MOVE *BLANK    TAD3
     C                     Z-ADD0         TAD4
    C**
    C******  F10 = FIN D'OP (EQUIPE NON TERMINEE)
    C**
D1  C           *IN10     IFEQ *ON
     C                     Z-ADDTOTHRE    SVTHRE
     C                     MOVE LIFI,1    LIBFI1
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDPPHFIN    SVHFIN
     **
     ******  SI HEURE SIMULATION RENSEIGNEE ==> HEURE SIMULATION
     **
D2  C           SIMUHF    IFNE 0
     C                     Z-ADD0         HEURE
     C                     MOVELSIMUHF    HEURE
     C                     Z-ADD0         SIMUHF
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     **
     C                     MOVELHEURE     PPHFIN
D2  C           PPHFIN    IFEQ 0
     C                     Z-ADD2359      PPHFIN
F2  C                     ENDIF
     C                     UPDATF11
     C                     Z-ADDPPHFIN    SVHFI2
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFI2    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  F11 = FIN D'EQUIPE
    C**
D1  C           *IN11     IFEQ *ON
     C                     Z-ADDTOTHRE    SVTHRE
     C                     MOVE LIFI,2    LIBFI1
     **
     ******  MAJ HEURE FIN EQUIPE DS DERNIERE OPERATION
     **
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDPPHFIN    SVHFIN
     C                     Z-ADDPPHFEQ    PPHFIN
     C                     UPDATF11
     C                     Z-ADDPPHFIN    SVHFI2
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFI2    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C           YEC16     TAG
     C           KFAB16    CHAINXFAB16               9985
    C**
    C******  TEST SI ENREGISTREMENT VERROUILLE
    C**
D1  C           *IN85     IFEQ *ON
     C                     CALL 'FAB609£'
    C                     GOTO YEC16
F1  C                     ENDIF
    C**
    C******  LECTURE EVENEMENTS FABRICATION EXECUTES PAR CETTE EQUIPE
    C**
     C                     Z-ADD0         MNCAL
     C                     Z-ADD0         MNTIR
     C                     Z-ADD0         MNARR
     C                     Z-ADD0         MNPAN
     C                     Z-ADD0         MNARD
    C**
D1  C           1         DO   DERRCY    RCY2
     C           RCY2      CHAINF11                  99
D2  C           PPHDEB    IFNE *ZEROS
    C           PPHFIN    ANDNE*ZEROS
     C           KFAB03    CHAINXFAB03               99
     C                     EXSR TEMPS
D3  C           FAEVTY    IFEQ 'C'
     C                     ADD  TMN3      MNCAL   40
F3  C                     ENDIF
D3  C           FAEVTY    IFEQ 'R'
     C                     ADD  TMN3      MNTIR   40
F3  C                     ENDIF
D3  C           FAEVTY    IFEQ 'A'
     C                     ADD  TMN3      MNARR   40
     C                     EXSR ARDIV1
F3  C                     ENDIF
D3  C           FAEVTY    IFEQ 'P'
     C                     ADD  TMN3      MNPAN   40
     C                     EXSR ARDIV1
F3  C                     ENDIF
F2  C                     ENDIF
F1  C                     ENDDO
    C**
    C******  CALCUL TEMPS EN HEURES/CENTIEMES ET TEMPS TOTAL OP
    C**
D1  C           MNCAL     IFNE 0
     C           MNCAL     DIV  60        PPHCAL    H
X1  C                     ELSE
     C                     Z-ADD0         PPHCAL
F1  C                     ENDIF
    C**
D1  C           MNTIR     IFNE 0
     C           MNTIR     DIV  60        PPHTIR    H
X1  C                     ELSE
     C                     Z-ADD0         PPHTIR
F1  C                     ENDIF
    C**
D1  C           MNARR     IFNE 0
     C           MNARR     DIV  60        PPHARR    H
X1  C                     ELSE
     C                     Z-ADD0         PPHARR
F1  C                     ENDIF
    C**
D1  C           MNPAN     IFNE 0
     C           MNPAN     DIV  60        PPHPAN    H
X1  C                     ELSE
     C                     Z-ADD0         PPHPAN
F1  C                     ENDIF
    C**
    C******  SAUVEGARDE DES CUMULS TEMPS => SERT SI ARRETS DIVERS
    C**
     C                     Z-ADDPPHCAL    SVHCAL
     C                     Z-ADDPPHTIR    SVHTIR
     C                     Z-ADDPPHARR    SVHARR
     C                     Z-ADDPPHPAN    SVHPAN
    C**
     C           PPHCAL    ADD  PPHTIR    TPSTOT
     C                     ADD  PPHARR    TPSTOT
     C                     ADD  PPHPAN    TPSTOT
    C**
    C******  AFFICHAGE FORMAT F16 : VALIDATION PAR F20 OU F21
    C**
    C**
    C******  CALCUL QTE FABRIQUEE D'APRES LES PALETTES PRODUITES
    C**
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     PPQFEU
     C                     Z-ADDTOTEQ2    PPQFMA
    C**
    C******  USINE : TOURY ET CLICHERIE : ATELIER 18
    C******   ON SOLDE AUTOMATIQUEMENT LES MATIERES
    C**
D1  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'18'
     C                     Z-ADD1         PPQFEU
F1  C                     ENDIF
    C**
     C           FIN1      TAG
     C                     EXSR ARDIV3
     C                     EXFMTF16
    C**
    C****** F5=AFFICHAGE DU SUIVI OF
    C**
D1  C           *IN05     IFEQ *ON
     C                     MOVE CDE       PASCDE
     C                     CALL 'FAB610£'
     C           PASCDE    PARM PASCDE    PASCDE
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C****** F12=ABANDON ET DEBLOCAGE FAB16P
    C**
D1  C           *IN12     IFEQ *ON
     C           AF98B     TAG
     C                     MOVE *OFF      *IN37
     C                     Z-ADDSVTHRE    TOTHRE
     C                     UNLCKFAB16L01
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDSVHFIN    PPHFIN
     C                     UPDATF11
     **
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFIN    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
    C                     GOTO FINF
     C                     Z-ADDSVTHRE    TOTHRE
F1  C                     ENDIF
    C**
    C****** F4=RECHERCHE CODE ARRET DIVERS => TYPE 'D'
    C****** OU        DU CODE DECHET ELIMINES AVANT OP
    C**
D1  C           *IN04     IFEQ *ON
     C                     MOVE *BLANKS   POS10
     C                     MOVEL'PPDECH'  POS10
D2  C           POS2      IFNE POS10
     C                     MOVE 'D'       ZAEVTY
     C                     EXSR WIN
     C                     Z-ADD1         A
     C           '  '      LOKUPTCAD,A                   99
D3  C           *IN99     IFEQ *ON
     C                     MOVE FAEVCO    TCAD,A
F3  C                     ENDIF
    C**
X2  C                     ELSE
    C**
     C                     MOVE *BLANKS   PASCO2
     C                     MOVE '10'      LIGNE
     C                     MOVE *BLANKS   PXLIBE
     C                     CALL 'FEN504£'              85
     C           PASCO2    PARM PASCO2    PASCO2  3
     C           INDI2     PARM INDI2     INDI2   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           PXLIBE    PARM PXLIBE    PXLIBE
F2  C                     ENDIF
D2  C           PASCO2    IFNE *BLANKS
     C                     MOVE PASCO2    PPDECH
F2  C                     ENDIF
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C****** IN37 ON => VALIDATION BILAN
    C**
    C           *IN37     CABEQ*ON       OKBILA
    C**
     C                     Z-ADDSVHCAL    PPHCAL
     C                     Z-ADDSVHTIR    PPHTIR
     C                     Z-ADDSVHARR    PPHARR
     C                     Z-ADDSVHPAN    PPHPAN
    C**
    C******  CONTROLE NBRE GROUPES CALES SI IMPRESSION (12 ET 14)
    C**
D1  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
    C           PPNCCA    CABGT6         FIN1       40
D2  C           USINE     IFNE 3
    C           PPNCCA    CABEQ0         FIN1           40
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE QTE PRODUITE=0 ET PALETTES CREES ==> ANOMALIE
    C**
D1  C           TOTEQ     IFNE 0
    C           PPQFEU    CABEQ0         FIN1           41
F1  C                     ENDIF
    C**
    C******  CONTROLE QTE FEUILLES : OBLIGATOIRE PPHTIR <> 0
    C******  TEST SUPPRIME A CAUDE DE NEUVILLE : LE 18.02.2004 (JLH)
    C**
    C                     GOTO SQUEEZ
     C           PPQFEU    ADD  PPQFMA    TOTFEU
D1  C           PPHTIR    IFGT 0
D2  C           TOTEQ     IFNE 0
    C           TOTFEU    CABEQ0         FIN1           41
F2  C                     ENDIF
X1  C                     ELSE
    C           TOTFEU    CABNE0         FIN1       4141
F1  C                     ENDIF
     C           SQUEEZ    TAG
    C**
    C******  TEST SUPPRIME => ZONE PROTEGEE
    C**
    C                     GOTO SAUT9
D1  C           PPUNIT    IFNE 'FE'
    C           PPUNIT    ANDNE'DE'
    C           PPUNIT    ANDNE'KG'
    C           PPUNIT    ANDNE'UN'
    C           PPUNIT    ANDNE'ML'
    C           PPUNIT    ANDNE'M2'
     C                     MOVE *ON       *IN52
    C                     GOTO FIN1
F1  C                     ENDIF
     C           SAUT9     TAG
    C**
    C******  CONTROLE QTE ELIMINEE AVANT SECTION
    C**
D1  C           PPDECH    IFNE *BLANK
     C                     MOVE 'MALF'    PXARGU
     C                     MOVE PPDECH    PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C           KEYUSI    CHAINPARAMEF1             45
    C           *IN45     CABEQ*ON       FIN1
    C           PPQELI    CABEQ0         FIN1           44
F1  C                     ENDIF
    C**
    C******  CONTROLE CODE DECHET ELIMINE AVANT SECTION
    C**
D1  C           PPQELI    IFGT 0
    C           PPDECH    CABEQ*BLANK    FIN1           45
F1  C                     ENDIF
    C**
    C******  CONTROLE TYPE VERNIS
    C**
D1  C           PPVERN    IFNE *BLANK
D2  C           PPVERN    IFNE 'F'
    C           PPVERN    ANDNE'U'
    C           PPVERN    ANDNE'K'
    C           PPVERN    ANDNE'B'
    C           PPVERN    ANDNE'G'
    C           PPVERN    ANDNE'A'
    C           PPVERN    ANDNE'E'
    C           PPVERN    ANDNE'Q'
    C           PPVERN    ANDNE'S'
D3  C           USINE     IFNE 3
     C                     MOVE *ON       *IN43
    C                     GOTO FIN1
X3  C                     ELSE
D4  C           PPVERN    IFGE 'A'
    C           PPVERN    ANDLE'Z'
X4  C                     ELSE
     C                     MOVE *ON       *IN43
    C                     GOTO FIN1
F4  C                     ENDIF
F3  C                     ENDIF
F2  C                     ENDIF
F1  C                     ENDIF
D1  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
D2  C           PPNCCA    IFEQ 0
    C           PPVERN    ANDEQ' '
     C                     MOVE *ON       *IN43
    C                     GOTO FIN1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE OR/ALU/CUIVRE
    C**
D1  C           PPOR      IFNE *BLANK
D2  C           PPOR      IFNE 'O'
    C           PPOR      ANDNE'A'
    C           PPOR      ANDNE'C'
     C                     MOVE *ON       *IN46
    C                     GOTO FIN1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE DONNEES ARRET DIVERS
    C**
     C                     Z-ADD0         MNARD   40
     C                     Z-ADD0         PPHADI
     C                     Z-ADD0         A       10
     C                     Z-ADD0         B       10
     **
D1  C                     DO   4         A
D2  C           TCAD,A    IFNE *BLANK
     C                     MOVE TCAD,A    FAEVCO
     C           KFAB03    CHAINXFAB03               47
    C           *IN47     CABEQ*ON       FIN1
    C           FAEVTY    CABNE'D'       FIN1       4747
     **
     ******  TEST SI CODE ARRET DIVERS SAISI PLUSIEURS FOIS => ERREUR
     **
     C                     Z-ADD0         B
D3  C                     DO   4         B
D4  C           FAEVCO    IFEQ TCAD,B
    C           A         ANDNEB
     C                     MOVE *ON       *IN55
    C                     GOTO FIN1
F4  C                     ENDIF
F3  C                     ENDDO
     **
     C                     MOVE FAEVL2    TLAD,A
     **
    C           THAD,A    CABEQ0         FIN1           56
     C                     MOVELTHAD,A    HR
     C                     MOVE THAD,A    MN
    C           HR        CABGT24        FIN1       56
    C           MN        CABGT59        FIN1       56
     **
    C           TTAD,A    CABEQ*BLANK    FIN1           50
D3  C           TTAD,A    IFNE 'C'
    C           TTAD,A    ANDNE'R'
    C           TTAD,A    ANDNE'A'
    C           TTAD,A    ANDNE'P'
     C                     MOVE *ON       *IN50
    C                     GOTO FIN1
F3  C                     ENDIF
     **
    C           TEAD,A    CABEQ0         FIN1           49
     **
     C           HR        MULT 60        TMN1
     C                     ADD  MN        TMN1
     C                     ADD  TMN1      MNARD
    C**
X2  C                     ELSE
     C                     Z-ADD0         THAD,A
     C                     MOVE *BLANK    TTAD,A
     C                     Z-ADD0         TEAD,A
     C                     MOVE *BLANK    TLAD,A
F2  C                     ENDIF
    C**
     C                     EXSR ARDIV2
    C           *IN53     CABEQ*ON       FIN1
F1  C                     ENDDO
    C**
    C******  SAUVEGARDE TABLEAU ARRET POUR MAJ HISTOFA2
    C**
     C                     Z-ADDTAD2      SVTAD2
    C**
    C******  CALCUL TOTAL TEMPS ARRET DIVERS
    C**
D1  C           MNARD     IFNE 0
     C           MNARD     DIV  60        PPHADI    H
X1  C                     ELSE
     C                     Z-ADD0         PPHADI
F1  C                     ENDIF
     C           PPHCAL    ADD  PPHTIR    TOTTPS
     C                     ADD  PPHARR    TOTTPS
     C                     ADD  PPHPAN    TOTTPS
     C                     ADD  PPHADI    TOTTPS
    C           PPHADI    CABGTTOTTPS    FIN1       51
    C**
    C******  TEST SI CUMUL TEMPS < 0 DU FAIT DES ARRETS DIVERS
    C**
    C           PPHCAL    CABLT0         FIN1         54
    C           PPHTIR    CABLT0         FIN1         54
    C           PPHARR    CABLT0         FIN1         54
    C           PPHPAN    CABLT0         FIN1         54
    C**
    C******  TEST ETAT OP : E=OP NON FINIE  I=INTERROMPUE  T=TERMINEE
    C**
D1  C           PPTFIN    IFNE 'E'
    C           PPTFIN    ANDNE'I'
    C           PPTFIN    ANDNE'T'
     C                     MOVE *ON       *IN59
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C******   TEST SI OPERATEUR A SAISI OP TERMINEE
    C******   QUE L'OP PRECEDENTE SOIT TERMINEE
    C******   SAUF POUR LA CLICHERIE QUI EST INDEPENDANTE
    C******         REFUSÉE SINON
    C******   SI L'ETAT = 'ZZ' ==> PAS D'OP PRECEDENTE
    C**
D1  C           PPTFIN    IFEQ 'T'
    C           FAATEL    ANDNE'18'
     C                     Z-ADDUSINE     SAUSIN
     C                     Z-ADDFACONF    SACONF
     C                     Z-ADDFASEQ     SASEQ
     C                     Z-ADDFAISEQ    SAISEQ
     C                     Z-ADDNOPRO     SNOPRO
     C                     Z-ADDFAOPNU    SAOPNU
     C                     MOVE SECT      SPSECT
     C                     MOVE SSECT     SSSECT
     C                     MOVE NOMAC     SNOMAC
     C                     MOVE *BLANKS   SETAOP
     C                     CALL 'FAB618£'              85
     C           PARM10    PARM PARM10    PARM10
D2  C           SETAOP    IFNE 'ZZ'
    C           SETAOP    CABNE'TR'      FIN1       9494
F2  C                     ENDIF
F1  C                     ENDIF
    C**
D1  C           PPTFIN    IFEQ 'I'
     C                     MOVE LIFI,3    LIBFI1
F1  C                     ENDIF
    C**
    C******  TEST SI TOUS LES ENCOURS ONT ETE CONSOMMÉS
    C******  LORSQUE L'OPERATION EST DITE TERMINÉE
    C**
D1  C           PPTFIN    IFEQ 'T'
     C                     Z-ADD0         FATENC
     C                     MOVE 'C'       FAEFC
     C           KFAB13    SETLLXFAB13
     C           LEC13P    TAG
     C           KFA13A    READEXFAB13                   99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADD0         YYOPNU
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFA10A    SETLLTFAB10
     C           LEC10A    TAG
     C           KFA10B    READETFAB10                   99
D3  C           *IN99     IFEQ *OFF
    C           FAOPNU    CABEQXAOPNU    LEC10A
     C                     EXFMTF95
    C                     GOTO SAUTR1
F3  C                     ENDIF
    C                     GOTO LEC13P
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  NEUVILLE => CONTROLE CONSOMMATION FOURREAU SUR COLLEUSE
    C**
D1  C           USINE     IFEQ 4
    C           FAATEL    ANDEQ'82'
     C                     Z-ADDUSINE     FYUSI
     C                     MOVE SECT      FYSECT
     C                     MOVE SSECT     FYSSEC
     C                     MOVE NOMAC     FYMAC
     C                     Z-ADDFACONF    FYCONF
     C                     Z-ADDFASEQ     FYSEQ
     C                     Z-ADDFAISEQ    FYISEQ
     C                     Z-ADDNOPRO     FYPRO
     C                     Z-ADDFAOPNU    FYOPNU
     C                     Z-ADDDATEQ     FYDTEQ
     C                     Z-ADDPPEQUI    FYEQUI
     C                     Z-ADDSTE       FYSTE
     C                     Z-ADDNOCLI     FYCLI
     C                     Z-ADD0         NPFOUR
     C                     Z-ADD0         QTFOUR
     C                     CALL 'FAB661£'
     C           PARM91    PARM PARM91    PARM91
    C           NPFOUR    CABEQ0         SAUTR1
     **
     ******  LECTURE TOLERANCE MAXI AUTORISEE ENTRE DECOUPE ET FOURREAUX
     **
     C                     IN   TOLFOU
     **
     C           PPQFEU    SUB  QTFOUR    DIFOUR  70
D2  C           DIFOUR    IFGT TOLFOU
     C                     EXFMTF91
    C                     GOTO FIN1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C           SAUTR1    TAG
    C**
    C******  DOUBLE VALIDATION : *IN37 ON
    C**
D1  C           *IN37     IFEQ *OFF
     C                     MOVE *ON       *IN37
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C******  BILAN OK : TEST SI OP SOLDEE MAIS QTE NON ATTEINTE
    C******  SQUEEZE PROVISOIREMENT / JLH LE 20/10/2003
    C**
     C           OKBILA    TAG
     C                     MOVE FAUNIT    SSUNIT  2
     C                     EXSR SPBIL
     C                     EXFMTF16B
     C                     MOVE SSUNIT    FAUNIT
    C                     GOTO OKBILF
    C**
D1  C           PPTFIN    IFEQ 'T'
    C           TOTBON    ANDLTFAQTE
     **
     C           AF98      TAG
     C                     EXFMTF98
     **
D2  C           *IN12     IFEQ *OFF
    C           *IN05     ANDEQ*OFF
    C                     GOTO AF98
F2  C                     ENDIF
     **
    C           *IN12     CABEQ*ON       AF98B
     **
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB16P : EQUIPE TERMINEE
    C**
     C           OKBILF    TAG
    C**
     C                     MOVE *OFF      *IN37
    C**
     C                     MOVE 'T'       FA1601
     C                     TIME           HEURE
D1  C           *IN11     IFEQ *ON
     C                     MOVELHEURE     PPHFRE
X1  C                     ELSE
     C                     Z-ADD0         PPHFRE
F1  C                     ENDIF
    C**
    C******  MEMORISATION INTERRUPTION (SERVIRA SI MODIFICATION)
    C**
D1  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'I'       FA1603
F1  C                     ENDIF
    C**
     C                     UPDATXFAB16
    C**
    C******  MAJ FICHIER FAB18P : DETAIL TEMPS DIVERS
    C**
D1  C           PPHADI    IFGT 0
     C                     Z-ADD0         A
D2  C                     DO   4         A
D3  C           TCAD,A    IFNE *BLANK
     C                     MOVE TCAD,A    PPCARD
     C                     Z-ADDTHAD,A    PPHARD
     C                     MOVE TTAD,A    PPTARD
     C                     Z-ADDTEAD,A    PPEARD
     C                     WRITEXFAB18
F3  C                     ENDIF
F2  C                     ENDDO
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB05P : OPERATION TERMINEE
    C**
D1  C           PPTFIN    IFEQ 'T'
    C           PPTFIN    OREQ 'I'
     C           KFAB5C    CHAINZFAB05               99
D2  C           *IN99     IFEQ *OFF
D3  C           PPTFIN    IFEQ 'T'
     C                     MOVE 'TR'      FAOPST
F3  C                     ENDIF
D3  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'IN'      FAOPST
F3  C                     ENDIF
     C                     UPDATZFAB05
     C                     EXSR COMPLX
F2  C                     ENDIF
    C**
    C******  MAJ FICHIER PDFINI SI PRODUIT FABRIQUE = PRODUIT FINI
    C******  'S' SI OP TERMINEE ET 'P' SINON DS ZONE PASO
    C**
D2  C           USINE     IFEQ 3
    C           USINE     OREQ 5
    C           USINE     OREQ 4
    C           USINE     OREQ 2
D3  C           SVTENC    IFEQ 9
     C                     Z-ADDUSINE     XYUSI
     C                     Z-ADDSTE       XYSTE
     C                     Z-ADDNOCLI     XYCLI
     C                     Z-ADDNOPRO     XYPRO
     C                     Z-ADDFACONF    XYCONF
     C                     Z-ADDFASEQ     XYSEQ
D4  C           FAOPST    IFEQ 'TR'
     C                     MOVE 'S'       XYSOLD
X4  C                     ELSE
     C                     MOVE 'P'       XYSOLD
F4  C                     ENDIF
     C                     CALL 'FAB636£'
     C           PARM13    PARM PARM13    PARM13
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  MAJ FICHIER PREFOU SI PRODUIT FABRIQUE = PRODUIT FINI
    C******  'S' SI OP TERMINEE ET 'P' SINON DS ZONE PASO
    C**
D2  C           USINE     IFEQ 4
    C           TS1       ANDEQ'F'
    C           NOCLI     ANDEQ8928
    C           SVTENC    ANDEQ9
     C                     Z-ADDUSINE     XYUSI
     C                     Z-ADDSTE       XYSTE
     C                     Z-ADDNOCLI     XYCLI
     C                     Z-ADDNOPRO     XYPRO
     C                     Z-ADDFACONF    XYCONF
     C                     Z-ADDFASEQ     XYSEQ
     C           KPRFOU    CHAINPREFOUF1             99
D3  C           *IN99     IFEQ *OFF
D4  C           FAOPST    IFEQ 'TR'
     C                     MOVE '*'       SOBESO
X4  C                     ELSE
     C                     MOVE ' '       SOBESO
F4  C                     ENDIF
     C                     EXCPTMAJFOU
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  MAJ PRLANC => OFETA = 'TR'
    C**
D2  C           PPTFIN    IFEQ 'T'
     C                     Z-ADDUSINE     VVUSI
     C                     Z-ADDFACONF    VVCONF
     C                     Z-ADDFASEQ     VVSEQ
     C                     Z-ADDFAISEQ    VVISEQ
     C                     Z-ADDNOPRO     VVPRO
     C                     Z-ADDPRIOR1    VVPRIO
     C                     MOVE *BLANK    VVETAT
     C                     CALL 'FAB518£A'
     C           PARM9     PARM PARM9     PARM9
D3  C           VVETAT    IFEQ 'TR'
     C                     Z-ADDPRIOR1    PRIORI
     C           KLAN01    CHAINPRLANCFZ             99
D4  C           *IN99     IFEQ *OFF
     C                     MOVE 'TR'      OFETA
     C                     EXCPTMAJLAN
F4  C                     ENDIF
F3  C                     ENDIF
     ******  SOLDE DES RESERVATIONS
     C                     MOVE *BLANK    VVETAT
     C                     CALL 'FAB518£D'
     C           PARM9     PARM PARM9     PARM9
D3  C           VVETAT    IFEQ 'TR'
     C                     EXSR MAJRES
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  MAJ SS-FICHIER F02 => OP TERMINE
     **
     C           RCD       CHAINF02                  99
D2  C           *IN99     IFEQ *OFF
D3  C           PPTFIN    IFEQ 'T'
     C                     MOVE 'TR'      FAOPST
F3  C                     ENDIF
D3  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'IN'      FAOPST
F3  C                     ENDIF
     C           FAOPST    CHAINXFAB08               99
     C                     UPDATF02
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : T2207='O'
     **
     C                     MOVE 'N'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
F1  C                     ENDIF
    C**
    C******  MAJ DE HISTOFA2 => TRANSFERT DS ENR2 AU PROGRAMME REMI
    C**
     C                     CLEARENREG2
D1  C           SECPAP    IFNE 'I'
     C                     MOVE SECPAP    EBSUP
X1  C                     ELSE
     C                     MOVE SUPOR     EBSUP
F1  C                     ENDIF
    C**
     C                     Z-ADDUSINE     EBUSIN
     C                     Z-ADDFACONF    EBCONF
     C                     Z-ADDFASEQ     EBSEQ
    C**
    C*****  SI TANDEM COMPLEXE REMONTEE EN 2207
    C**
D1  C           T2207     IFEQ 'O'
     C                     MOVE '2'       EBSEC
     C                     MOVE '2'       EBSSEC
     C                     MOVE '07'      EBMAC
X1  C                     ELSE
     C                     MOVE SECT      EBSEC
     C                     MOVE SSECT     EBSSEC
     C                     MOVE NOMAC     EBMAC
F1  C                     ENDIF
    C**
    C******  MACHINE=6799 => RECHERCHE DS PREACOP DE LA MACHINE A
    C******  A REMONTER DANS PROD79£.
    C******  !! SI 6799 AJOUTEE A LA GAMME DS SUIVI => NE PAS REMONTER
    C**
D1  C           FAATEL    IFEQ '67'
    C           NOMAC     ANDEQ'99'
    C           FA0503    CABEQ'M'       SAUTRR
     C           KPREOP    CHAINPREACOPF             99
D2  C           *IN99     IFEQ *OFF
     C                     MOVE XSECT     EBSEC
     C                     MOVE XSSECT    EBSSEC
     C                     MOVE XMAC      EBMAC
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     Z-ADDSTE       EBSTE
     C                     Z-ADDNOCLI     EBCLI
     C                     Z-ADDNOPRO     EBPRO
     C                     Z-ADDPPEQUI    EBEQU
     C                     Z-ADDPPPAS     EBPAS
     C                     Z-ADDDATEQ     EBDAT1
     C                     EXSR LECSYS
     C                     MOVELSYSA      EBDAT2
     C                     MOVEL'20'      SYSC
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      EBDAT2
    C**
    C******  HEURE DE FIN OP : EQUIPE NUIT+DATE DU LENDEMAIN => +24H
    C**
     C                     Z-ADDSVHFI2    EBHEUR
D1  C           PPEQUI    IFEQ 3
    C           SVHFI2    ANDLT700
     C                     ADD  2400      EBHEUR
F1  C                     ENDIF
    C**
     C                     Z-ADDCMATR     EBCOND
     C                     Z-ADDPPHCAL    EBTCAL
     C                     Z-ADDPPHTIR    EBTROU
     C           PPHARR    ADD  PPHPAN    EBTDIV
     C                     ADD  PPHADI    EBTDIV
    C**
    C******  PAS D'EFFECTIF CALAGE SI HEURES CALAGE=0
    C**
D1  C           EBTCAL    IFEQ 0
     C                     Z-ADD0         EBEFFC
X1  C                     ELSE
D2  C           PPEFFC    IFNE 0
     C                     Z-ADDPPEFFC    EBEFFC
X2  C                     ELSE
     C                     Z-ADD1         EBEFFC
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  PAS D'EFFECTIF TIRAGE SI HEURES TIRAGE=0
    C**
D1  C           EBTROU    IFEQ 0
    C           EBTDIV    ANDEQ0
     C                     Z-ADD0         EBEFFR
X1  C                     ELSE
D2  C           PPEFFR    IFNE 0
     C                     Z-ADDPPEFFR    EBEFFR
X2  C                     ELSE
     C                     Z-ADD1         EBEFFR
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C           PPQFEU    ADD  PPGACA    EBQTOT
     C                     Z-ADDPPQFEU    EBQBON
     C                     Z-ADDPPGACA    EBQRC
     C                     Z-ADDPPQFMA    EBQRR
    C**
     C                     MOVE PPDECH    EBCELI
     C                     Z-ADDPPQELI    EBQELI
    C**
    C******  SI EFFECTIF ROULAGE NON RENSEIGNE ET QTE TOTALE >0
    C**
D1  C           EBQTOT    IFGT 0
    C           EBEFFR    ANDEQ0
     C                     Z-ADD1         EBEFFR
F1  C                     ENDIF
    C**
    C*****   CONVERSION DES QTES BOITES EN FEUILLES SI DECORTICAGE
    C*****    OU SI PRODUITS FINIS AVANT DECORTICAGE A TOURY
    C**
D1  C           POSF1     IFEQ 0
D2  C           USINE     IFEQ 3
    C           FAATEL    ANDEQ'21'
    C**   UVENT=3 ==> 100 ML  : QTE À DIVISER PAR POSLAI
    C           UVENT     ANDEQ3
    C**   CALCUL DE POSLAI
     C                     Z-ADD0         POSLAI
     C           LMINI     MULT 10        LMINIM  50
     C           FACON     COMP 5                    99  99
     C   99      FACON     COMP 8                      9999
     C   99      LMINIM    DIV  ONDL      POSLAI  20
     C  N99      LMINIM    DIV  DECL      POSLAI
     C                     Z-ADDPOSLAI    POSF1
X2  C                     ELSE
     C                     Z-ADD1         POSF1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
D1  C           FAATEL    IFEQ '70'
    C           NOMAC     ANDNE'10'
    C           NOMAC     ANDNE'03'
    C           FAATEL    ORGT '12'
    C           FAATEL    ANDLT'70'
    C           USINE     ANDEQ3
    C**
D2  C           PPUNIT    IFEQ 'PF'
    C           PPUNIT    OREQ 'DE'
    C           PPUNIT    OREQ 'ML'
    C           PPUNIT    OREQ 'KG'
     C           EBQTOT    DIV  POSF1     EBQTOT    H
     C           EBQBON    DIV  POSF1     EBQBON    H
     C           EBQTOT    SUB  EBQBON    EBQRC
     C           EBQRR     DIV  POSF1     EBQRR     H
     C           EBQELI    DIV  POSF1     EBQELI    H
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     MOVE *BLANK    EBETIQ
     C                     Z-ADD0         EBCBPA
     C                     Z-ADD0         EBTENC
     C                     Z-ADDPPNCCA    EBCOUL
     C                     MOVE PPVERN    EBTVER
    C**
    C******  MAJ N° OP => SI OP RAJOUTEE DS SUIVI (TYPE 6) => ENVOYER
    C******               SUR OP D'ORIGINE
    C**
     C                     Z-ADDFAOPNU    EBOPNU
     **
     C                     MOVE FAOPNU    TYPOP   10
D1  C           TYPOP     IFGE 6
    C           TYPOP     ANDLT9
     C                     SUB  5         TYPOP
     C                     MOVE TYPOP     EBOPNU
F1  C                     ENDIF
    C**
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 MOVE '1'       EBOPNU
    C****                 ENDIF
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D1  C           T2207     IFEQ 'O'
     C                     MOVE VAOPNU    EBOPNU
F1  C                     ENDIF
    C**
     C                     MOVE FAOPST    EBOPST
D1  C           EBOPST    IFEQ *BLANK
     C                     MOVE 'EC'      EBOPST
F1  C                     ENDIF
     C                     MOVE 'Z'       EBTAG
    C**
     C                     MOVE TAD1      EBCAD
     C                     Z-ADDSVTAD2    EBTAD
     C                     MOVE TAD3      EBIAD
     C                     Z-ADDTAD4      EBEAD
    C**
    C*****   GESTION DES A COTES : ONDULEUSE 10 DE TOURY
    C**
     C                     Z-ADD0         EBPOS1
     C                     Z-ADD0         EBPOS2
     C                     Z-ADD0         EBQACO
D1  C           USINE     IFEQ 3
    C           POSF2     ANDGT0
    C           FAATEL    ANDGE'21'
    C           FAATEL    ANDLT'70'
D2  C           TOTEQG    IFGT 0
     C                     Z-ADDPOSF1     EBPOS1
F2  C                     ENDIF
D2  C           TOTEQD    IFGT 0
     C                     Z-ADDPOSF2     EBPOS2
     C                     Z-ADDTOTEQD    EBQACO
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     MOVE FATRSP    EBTRSP
    C**
    C*****   SI OPERATION = MONTAGE CLICHERIE  (UTILISÉE À TOURY)
    C*****    PAS DE MAJ DE HISTOFA2
    C**
    C           FAATEL    CABEQ'18'      SAUTRR
    C**
    C*****   SI LA ZONE OPLIB (DU PRECAOP) = FINITION
    C*****        PAS DE MAJ DE HISTOFA2 ==> CONDITIONNEMENT
    C**
D1  C           USINE     IFEQ 4
    C           OPLIB     CABEQLB,1      SAUTRR
F1  C                     ENDIF
    C**
    C*****   SI OP FACONNAGE SE TERMINANT PAR 9 (OP TRANSFERT USINE)
    C*****        PAS DE MAJ DE HISTOFA2
    C**
D1  C           FAOPNU    IFGT 9000
     C                     MOVE FAOPNU    TYPOP2  10
    C           TYPOP2    CABEQ9         SAUTRR
F1  C                     ENDIF
    C**
    C*****  TEST SI DECOMPTAGE D'UN CALAGE SUR CETTE FAB
    C**
     C                     Z-ADDUSINE     XJUSIN
     C                     MOVE SECT      XJSECT
     C                     MOVE SSECT     XJSSEC
     C                     MOVE NOMAC     XJNOMA
     C                     Z-ADDFACONF    XJCONF
     C                     Z-ADDFASEQ     XJSEQ
     C                     Z-ADDFAISEQ    XJISEQ
     C                     Z-ADDNOPRO     XJPRO
     C                     Z-ADDFAOPNU    XJOPNU
     C                     Z-ADDPPAA      XJPPAA
     C                     Z-ADDPPMM      XJPPMM
     C                     Z-ADDPPJJ      XJPPJJ
     C                     Z-ADDPPEQUI    XJEQUI
     C                     Z-ADD0         XJNBCA
     C                     CALL 'FAB664£'
     C           PARM30    PARM PARM30    PARM30
     C                     Z-ADDXJNBCA    EBNCAL
    C**
    C*****   GESTION DES A COTES : TOURY
    C*****   DOUBLE MAJ DE HISTOFA2 APRÉS ONDULEUSE
    C**
D1  C           USINE     IFEQ 3
    C           POSF2     ANDGT0
    C           FAATEL    ANDGT'21'
    C           FAATEL    ANDLT'70'
D2  C           TOTEQG    IFGE 0
     C                     Z-ADDTOTEQG    EBQTOT
     C                     Z-ADDTOTEQG    EBQBON
     C                     Z-ADDPOSF1     EBPOS1
     C                     Z-ADD0         EBPOS2
     C                     Z-ADD0         EBQACO
    C*
     C                     CALL 'PROD79£'
     C           ENR2      PARM ENR2      ENR2
    C*
     C                     Z-ADDFAISEQ    EBISEQ
     C                     MOVE 'C'       EBMODI
     C                     WRITEXFAB21
F2  C                     ENDIF
    C**
D2  C           TOTEQD    IFGT 0
     C                     Z-ADDTOTEQD    EBQTOT
     C                     Z-ADDTOTEQD    EBQBON
     C                     Z-ADD0         EBQRC
     C                     Z-ADD0         EBQRR
     C                     Z-ADD0         EBPOS1
     C                     Z-ADDPOSF2     EBPOS2
     C                     Z-ADDTOTEQD    EBQACO
     C                     Z-ADD0         EBTCAL
     C                     Z-ADD0         EBTROU
     C                     Z-ADD0         EBTDIV
     C                     MOVE *BLANK    EBCELI
     C                     Z-ADD0         EBQELI
     C                     MOVE *BLANK    EBCAD
     C                     Z-ADD0         EBTAD
     C                     MOVE *BLANK    EBIAD
     C                     Z-ADD0         EBEAD
     C                     Z-ADD0         EBNCAL
    C*
     C                     CALL 'PROD79£'
     C           ENR2      PARM ENR2      ENR2
    C*
     C                     Z-ADDFAISEQ    EBISEQ
     C                     MOVE 'C'       EBMODI
     C                     WRITEXFAB21
F2  C                     ENDIF
    C******
X1  C                     ELSE
    C******  TOUS LES AUTRES CAS
     C                     CALL 'PROD79£'
     C           ENR2      PARM ENR2      ENR2
    C**
    C******  MAJ FAB21P => HISTORIQUE MVTS TRANSMIS A HISTOFA2
    C**
     C                     Z-ADDFAISEQ    EBISEQ
     C                     MOVE 'C'       EBMODI
     C                     WRITEXFAB21
F1  C                     ENDIF
    C**
     C           SAUTRR    TAG
    C**
    C******  MAJ ZONE : INIBON EN CAS DE CREATION D'UNE AUTRE EQUIPE
    C**
     C                     ADD  PPQFEU    INIBON
    C           FINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : AFFICHAGE DU BILAN SUR UNE OPERATION                 *
    C*                                                               *
    C*****************************************************************
    C           BILAN     BEGSR
     C                     MOVE *ON       *IN37
     C                     MOVE *BLANK    TCAD
     C                     Z-ADD0         THAD
     C                     MOVE *BLANK    TTAD
     C                     Z-ADD0         TEAD
     C                     MOVE *BLANK    TLAD
    C**
    C******  CALCUL TEMPS TOTAL PASSE
    C**
     C           PPHCAL    ADD  PPHTIR    TPSTOT
     C                     ADD  PPHARR    TPSTOT
     C                     ADD  PPHPAN    TPSTOT
     C                     ADD  PPHADI    TPSTOT
    C**
    C******  LECTURE DES ARRETS DIVERS DS FAB18P
    C**
     C                     Z-ADD0         A
     C                     MOVE *BLANK    PPCARD
     **
     C           KFAB18    SETLLXFAB18
     C           LEC18     TAG
     C           KFAB16    READEXFAB18                   99
D1  C           *IN99     IFEQ *OFF
     **
     C                     ADD  1         A
     C                     MOVE PPCARD    TCAD,A
     C                     Z-ADDPPHARD    THAD,A
     C                     Z-ADDPPEARD    TEAD,A
     C                     MOVE PPTARD    TTAD,A
     C                     MOVE PPCARD    FAEVCO
     C           KFAB03    CHAINXFAB03               99
     C                     MOVE FAEVL2    TLAD,A
    C                     GOTO LEC18
F1  C                     ENDIF
    C**
    C******  AFFICHAGE FORMAT F16
    C**
     C                     EXFMTF16
     C                     MOVE FAUNIT    SVUNIT  2
     C                     EXSR SPBIL
     C                     EXFMTF16B
     C                     MOVE SSUNIT    FAUNIT
    C**
     C                     MOVE *OFF      *IN37
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*  SR : AFFICHAGE FENETRE SAISIE OBSERVATIONS                   *
    C*                                                               *
    C*****************************************************************
    C           WINOB     BEGSR
    C**
    C****** TRAVAIL TERMINE => VISU SLT ET *IN49 ON
    C**
D1  C           FA1601    IFEQ 'T'
     C                     MOVE *ON       *IN49
X1  C                     ELSE
     C                     MOVE *OFF      *IN49
F1  C                     ENDIF
    C**
     C                     Z-ADD0         PPOROB
     C                     MOVE *BLANK    PPOBS
     C                     MOVEA'1000'    *IN,55
     C                     WRITEF20
     C                     Z-ADD0         RCT
     C                     Z-ADD0         SAVRCT
     C                     Z-ADD0         SAVORB
     C                     SETOF                     55
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           QAB       TAG
D1  C                     DO   7
     C                     ADD  1         PPOROB
    C**
    C****** NBRE MAXI OBSERVATIONS = 16 (99+1=00 DS UNE ZONE DE 2)
    C**
D2  C           PPOROB    IFEQ 17
     C                     MOVE *ON       *IN58
     C                     LEAVE
F2  C                     ENDIF
    C**
     C           KFAB19    CHAINXFAB19              N99
D2  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    PPOBS
F2  C                     ENDIF
    C**
     C                     ADD  1         RCT
     C                     Z-ADDRCT       SAVRCT
     C                     Z-ADDPPOROB    SAVORB
     C                     WRITEF19
F1  C                     ENDDO
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F20
    C**
     C           QUITE     TAG
     C                     SETON                     57
     C           RCT       COMP 0                    56
     C                     EXFMTF20
D1  C           *IN12     IFEQ *ON
     C                     Z-ADD0         PPOROB
    C                     GOTO QINF
F1  C                     ENDIF
    C**
D1  C           *IN04     IFEQ *ON
     C                     CLEARDSPARM
     C                     MOVEL'OBSA'    TBLNOM
     C                     Z-ADD6         LG
     C                     CALL 'DEV002£'
     C                     PARM           DSPARM
    C                     GOTO QUITE
F1  C                     ENDIF
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN58     IFEQ *OFF
     C                     Z-ADDSAVORB    PPOROB
     C                     Z-ADDSAVRCT    RCT
    C                     GOTO QAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCT    RCT
    C                     GOTO QUITE
F1  C                     ENDIF
    C**
    C           *IN49     CABEQ*ON       QINF
    C**
    C**
    C****** LECTURE DU SOUS-FICHIER
    C**
D1  C                     DO   17        KK      20
     C           KK        CHAINF19                  81
    C****** VERIFICATION SI CODE SAISIE
D2  C           PPOB2     IFNE *BLANKS
     C                     MOVE 'OBSA'    PXARGU
     C                     MOVE PPOB2     PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             69
    C           *IN69     CABEQ'1'       QUITE
F2  C                     END
    C**
D2  C           PPOBS     IFEQ *BLANK
     C           KFAB19    CHAINXFAB19               99
D3  C           *IN99     IFEQ *OFF
     C                     DELETXFAB19
F3  C                     ENDIF
X2  C                     ELSE
     C                     MOVE PPOBS     SAVOBS
     C           KFAB19    CHAINXFAB19               99
D3  C           *IN99     IFEQ *OFF
     C                     MOVE SAVOBS    PPOBS
     C                     UPDATXFAB19
X3  C                     ELSE
     C                     WRITEXFAB19
F3  C                     ENDIF
F2  C                     ENDIF
    C**
F1  C                     END
    C**
    C           QINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CALCUL QTE FABRIQUEE SUR UN TRAVAIL EN COURS       *
    C*                                                               *
    C*****************************************************************
    C           CALFAB    BEGSR
    C**
     C                     Z-ADD0         TOTEQ
     C                     Z-ADD0         TOTEQG
     C                     Z-ADD0         TOTEQD
     C                     Z-ADD0         TOTEQ2
     C                     Z-ADD0         SVTENC
    C**
D1  C           FAATEL    IFNE '13'
    C           FAATEL    ANDNE'15'
    C           FAATEL    ANDNE'22'
    C**
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFAB10    SETLLXFAB10
    C**
     C           LEC10     TAG
     C           KFAB16    READEXFAB10                   99
D2  C           *IN99     IFEQ *OFF
    C           NOBOU     CABNE0         LEC10
     C                     ADD  FAQTFE    TOTEQ
     C                     ADD  FAQTGA    TOTEQ2
D3  C           FA1001    IFEQ 'G'
     C                     ADD  FAQTFE    TOTEQG
F3  C                     ENDIF
D3  C           FA1001    IFEQ 'P'
     C                     ADD  FAQTFE    TOTEQD
F3  C                     ENDIF
     C                     Z-ADDFATENC    SVTENC
    C                     GOTO LEC10
F2  C                     ENDIF
    C**
X1  C                     ELSE
    C**
    C******  CALCUL DE LA QUANTITÉ PAPIER PRODUITE
    C**
     C                     MOVE *BLANKS   PAPI
     C                     Z-ADD0         GRAMM
     C                     MOVE *BLANKS   REFOUR
     C                     Z-ADD0         GRAREL
     C                     MOVE *BLANKS   FOUB
     C                     Z-ADD0         FACBPA
     C           KFAB11    SETLLZFAB11
     **
     C           LEC11     TAG
     C           KFAB16    READEZFAB11                   99
D2  C           *IN99     IFEQ *OFF
     C                     ADD  NBFE      TOTEQ
     C                     SUB  FAQRES    TOTEQ
    C                     GOTO LEC11
F2  C                     ENDIF
    C**
F1  C                     ENDIF
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR : REMPLISSAGE DES TABLES ARRETS DIVERS POUR MAJ HISTOFA2   *
    C*      EVENEMENTS HORODATES <=> FAEVCO = 'A' OU 'P'             *
    C*                                                               *
    C*****************************************************************
    C           ARDIV1    BEGSR
     C           TMN3      DIV  60        HCT     42H
    C           HCT       CABEQ0         ARDIF1
    C**
    C******  RECHERCHE DU 1ER POSTE DE LIBRE DS TABLEAU
    C**
     C                     Z-ADD1         Y       10
     C           FAEVCO    LOKUPTAD1,Y                   99
D1  C           *IN99     IFEQ *ON
     C                     ADD  HCT       TAD2,Y
X1  C                     ELSE
     C           '  '      LOKUPTAD1,Y                   99
     **
     ******  SI TABLEAU PLEIN <=> + 6 POSTES => IMPOSSIBLE
     **
    C           *IN99     CABEQ*OFF      ARDIF1         53
     **
     C                     ADD  HCT       TAD2,Y
     C                     MOVE FAEVCO    TAD1,Y
    C**
    C******  SI CODE="NU" : NON UTILISE ==> EFFECTIF=0
    C**
D2  C           TAD1,Y    IFEQ 'NU'
     C                     Z-ADD0         TAD4,Y
X2  C                     ELSE
     C                     Z-ADDPPEFFR    TAD4,Y
F2  C                     ENDIF
     C                     MOVE *BLANK    TAD3,Y
F1  C                     ENDIF
    C**
    C           ARDIF1    ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR : REMPLISSAGE DES TABLES ARRETS DIVERS POUR MAJ HISTOFA2   *
    C*      EVENEMENTS NON HORODATES <=> FAEVCO = 'D'                *
    C*                                                               *
    C*****************************************************************
    C           ARDIV2    BEGSR
    C           THAD,A    CABEQ0         ARDIF2
    C**
     C                     MOVE THAD,A    MN
     C                     MOVELTHAD,A    HR
     C           HR        MULT 60        TMN1
     C                     ADD  MN        TMN1
     C           TMN1      DIV  60        HCT       H
    C**
    C******  DEDUCTION TEMPS ARRET DIVERS DES AUTRES TOTAUX
    C**
D1  C           TTAD,A    IFEQ 'C'
     C                     SUB  HCT       PPHCAL
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'R'
     C                     SUB  HCT       PPHTIR
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'A'
     C                     SUB  HCT       PPHARR
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'P'
     C                     SUB  HCT       PPHPAN
F1  C                     ENDIF
    C**
    C******  RECHERCHE DU 1ER POSTE DE LIBRE DS TABLEAU
    C**
     C                     Z-ADD1         Y
     C                     MOVE TCAD,A    EVCO
     C           EVCO      LOKUPTAD1,Y                   99
D1  C           *IN99     IFEQ *ON
     C                     ADD  HCT       TAD2,Y
X1  C                     ELSE
     C           '  '      LOKUPTAD1,Y                   99
     **
     ******  SI TABLEAU PLEIN <=> + 6 POSTES => IMPOSSIBLE
     **
    C           *IN99     CABEQ*OFF      ARDIF2         53
     **
     C                     ADD  HCT       TAD2,Y
     C                     MOVE TCAD,A    TAD1,Y
     C                     Z-ADDTEAD,A    TAD4,Y
     C                     MOVE TTAD,A    TAD3,Y
F1  C                     ENDIF
    C**
    C           ARDIF2    ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR:REMISE A ZERO CUMULS TEMPS ARRETS DIVERS SI ERREUR TROUVEE *
    C*                                                               *
    C*****************************************************************
    C           ARDIV3    BEGSR
    C           *IN39     CABEQ*ON       ARDIF3
    C**
     C                     Z-ADD0         B
    C**
D1  C                     DO   6         B
     **
D2  C           TAD1,B    IFNE *BLANK
     C                     MOVE TAD1,B    FAEVCO
     C           KFAB03    CHAINXFAB03               99
     **
D3  C           *IN99     IFEQ *OFF
    C           FAEVTY    ANDEQ'D'
     C                     Z-ADD0         TAD2,B
F3  C                     ENDIF
F2  C                     ENDIF
F1  C                     ENDDO
    C**
    C           ARDIF3    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : LECTURE DATE SYSTEME PAR RTVSYSVAL                 *
    C*                                                               *
    C*****************************************************************
    C           LECSYS    BEGSR
     C                     MOVE *ZEROS    PASSYS  6
     C                     CALL 'FAB000L'
     C           PASSYS    PARM PASSYS    PASSYS
     C                     MOVELPASSYS    SYSA    4
     C                     MOVE PASSYS    SYSB    2
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : INITIALISATION DES FENETRES EXTERNES               *
    C*                                                               *
    C*****************************************************************
    C           GESFEN    BEGSR
D1  C           *IN03     IFEQ *ON
     C                     MOVE '2'       INDIC
     C                     MOVE '2'       INDIC1
     C                     MOVE '2'       INDI1
     C                     MOVE '2'       INDI2
X1  C                     ELSE
     C                     MOVE *BLANK    INDIC
     C                     MOVE *BLANK    INDIC1
     C                     MOVE *BLANK    INDI1
     C                     MOVE *BLANK    INDI2
F1  C                     ENDIF
    C**         FENETRE DES MATRICULES
     C                     CALL 'FEN502£'              85
     C           PAS1      PARM PAS1      PAS1    7
     C           INDIC     PARM INDIC     INDIC   1
     C           LIGNE     PARM LIGNE     LIGNE   2
     C           PAS2      PARM PAS2      PAS2   40
     C           PAS3      PARM PAS3      PAS3    5
    C**         FENETRE DES CODES TRAVAIL SPECIAL
     C                     CALL 'FEN505£'              85
     C           PASRES    PARM PASRES    PASRES  4
     C           PASCOD    PARM PASCOD    PASCOD  2
     C           INDI1     PARM INDI1     INDI1   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           NATRAV    PARM NATRAV    NATRAV
    C**         FENETRE DES CODES DECHETS ELIMINES AVANT OP
     C                     CALL 'FEN504£'              85
     C           PASCO2    PARM PASCO2    PASCO2  3
     C           INDI2     PARM INDI2     INDI2   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           PXLIBE    PARM PXLIBE    PXLIBE
    C**         FENETRE APPEL DES PROGRAMMES ANNEXES
     C                     CALL 'FAB579£'              85
     C           INDIC1    PARM INDIC1    INDIC1  1
     C           PAS6      PARM PAS6      PAS6   50
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : MAJ ETAT OP 2206 EQUIVALENT AU 1303 SI TANDEM 2207 *
    C*                                                               *
    C*****************************************************************
    C           COMPLX    BEGSR
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : T2207='O'
     **
     C                     MOVE 'O'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB604£'              85
     C           PARM8     PARM PARM8     PARM8
     **
F1  C                     ENDIF
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : SOLDE DES RESERVATIONS DE PAPIERS,D'IMPRIMÉS       *
    C*                  ET DE COMMANDES DE PRÉ-IMPRIMÉS              *
    C*                                                               *
    C*****************************************************************
    C           MAJRES    BEGSR
    C**  ATELIER 18:CLICHERIE ET > 54 PAS DE MAJ
    C           FAATEL    CABEQ'18'      FINRES
    C           FAATEL    CABGT'54'      FINRES
    C**  OP  S.E.D. NON TRAITÉE
    C           FACONF    CABGE99000     FINRES
    C**  MAJ UNIQUEMENT POUR LES USINES DE
    C**  ROCHECHOUART-TOURY-CHABANAIS
    C           USINE     CABEQ4         FINRES
    C           USINE     CABEQ7         FINRES
    C**  SOLDE DES RESERVATIONS DE PAPIERS      (RESPAP/RESCXH)
     C                     Z-ADDUSINE     YAUSIN
     C                     MOVE SECT      YSECT
     C                     MOVE SSECT     YSSECT
     C                     MOVE NOMAC     YNOMAC
     C                     Z-ADDFACONF    YACONF
     C                     Z-ADDFASEQ     YASEQ
     C                     Z-ADDFAISEQ    YAISEQ
     C                     Z-ADDSTE       YSTE
     C                     Z-ADDNOCLI     YNOCLI
     C                     Z-ADDNOPRO     YNOPRO
     C                     Z-ADDFAOPNU    YAOPNU
     C                     CALL 'FAB640£'
     C           PARM15    PARM PARM15    PARM15
    C**  SOLDE DES RESERVATIONS DE PRÉ-IMPRIMÉS (RESIMP)
     C                     CALL 'FAB640£A'
     C           PARM15    PARM PARM15    PARM15
    C**  SOLDE DES COMMANDES DE PRÉ-IMPRIMÉS    (PREVIM)
    C**  UNIQUEMENT POUR L'ATELIER FLEXO = 12
D1  C           FAATEL    IFEQ '12'
     C                     CALL 'FAB640£B'
     C           PARM15    PARM PARM15    PARM15
F1  C                     ENDIF
    C           FINRES    ENDSR
    C*****************************************************************
     * MINI/MAXI  ==> CDEC92C
    C           MINMAX    BEGSR
     C                     Z-ADD0         MINI
     C                     Z-ADD0         MAXI
     C                     Z-ADDNOPRO     NOP92
     C                     Z-ADDNOCLI     NOC92
     C                     Z-ADDFACONF    NCF92
     C                     Z-ADDFAQTE     SURF
     C                     Z-ADDFAQTE     SURFF
     C                     Z-ADD1,000     SF
     C                     MOVE '*'       EXP
     C                     CALL 'CDEC92C'
     C                     PARM           DSPARA
    C                     ENDSR
    C*****************************************************************
     * BILAN OP --> F16B
    C           SPBIL     BEGSR
     C                     Z-ADD*ZEROS    TCALF
     C                     Z-ADD*ZEROS    FATXTM
     C                     Z-ADD*ZEROS    FACAD
     C                     SETOF                     69
    C*
D1  C           USINE     IFEQ 3
    C           SECT      ANDEQ'1'
    C           SSECT     ANDEQ'2'
     C                     SETON                     69
     C                     Z-ADDPPNCCA    NBC     20
D2  C           PPVERN    IFEQ 'E'
     C                     ADD  2         NBC
X2  C                     ELSE
D3  C           PPVERN    IFNE *BLANK
     C                     ADD  1         NBC
F3  C                     END
F2  C                     END
     C           PPHCAL    DIV  NBC       TCALF
F1  C                     END
    C*
D1  C           SECT      IFEQ '2'
    C           SSECT     ANDEQ'1'
     C           ONDL      DIV  1000      DEVM    43
     C           PPQFEU    MULT DEVM      PPQTE
D2  C           LMINI     IFNE *ZEROS
    C           ONDL      ANDNE*ZEROS
     C                     MOVE LMINI     LMMM    40
     C           LMMM      DIV  ONDL      FENL    20
D3  C           FENL      IFNE *ZEROS
F3  C                     END
     C           PPQTE     DIV  FENL      PPQTE
F2  C                     END
     C                     MOVE 'ML'      FAUNIT
X1  C                     ELSE
     C                     Z-ADDPPQFEU    PPQTE   70
F1  C                     END
    C*
D1  C           PPHTIR    IFNE *ZEROS
     C           PPQTE     DIV  PPHTIR    FACAD
F1  C                     END
    C*
     C           PPHCAL    ADD  PPHTIR    PPTTT   62
     C           PPHADI    ADD  PPHARR    PPAAA   62
     C                     ADD  PPHPAN    PPAAA
     C                     Z-ADDUSINE     YZUSIN
     C                     MOVE SECT      YZSECT
     C                     MOVE SSECT     YZSSEC
     C                     MOVE NOMAC     YZMAC
     C                     Z-ADDFACONF    YZCONF
     C                     Z-ADDFASEQ     YZSEQ
     C                     Z-ADDFAISEQ    YZISEQ
     C                     Z-ADDNOPRO     YZPRO
     C                     Z-ADDFAOPNU    YZOPNU
     C                     Z-ADDPPJJ      YZJJ
     C                     Z-ADDPPMM      YZMM
     C                     Z-ADDPPAA      YZAA
     C                     Z-ADDPPEQUI    YZEQUI
     C                     MOVE *ZEROS    PARMYY  5
     C                     CALL 'FAB696£A'
     C                     PARM           PARMYZ
     C                     PARM           PARMYY
     C                     MOVE PARMYY    ARPLA   52
     C           PPAAA     SUB  ARPLA     PPAAA
     C                     ADD  PPAAA     PPTTT
D1  C           PPTTT     IFNE *ZEROS
     C           PPAAA     DIV  PPTTT     XXTXTM  54
     C           XXTXTM    MULT 100       FATXTM
F1  C                     END
    C*
    C                     ENDSR
    C* Rajout IC 629183 Tmagpi ---------------------------------------------
    C*****************************************************************
    C*                                                               *
    C*       SR : SOUS ROUTINE DE DETECTION MATERIEL 'CR' (*IN13)    *
    C*                                      DECOR 'CR'    (*IN16)    *
    C*                                      ET DAC        (*IN14)    *
    C*****************************************************************
    C           SRCRDC    BEGSR
     C                     MOVE '0'       *IN13            Stu Mat CR
     C                     MOVE *BLANK    IVCR
     *
     C                     MOVE '0'       *IN14            Détection DAC
     C                     MOVE *BLANK    IVDAC
     *
     C                     MOVE '0'       *IN16            Statut décor CR
     C                     MOVE *BLANK    IVDEC
     *
     C                     MOVE '0'       *IN15
     C                     MOVE '0'       *IN19
D2  C           USINE     IFEQ 4
     C                     MOVE '1'       *IN15            Détection NEUVILLE
F2  C                     END
D3  C           USINE     IFEQ 2
     C                     MOVE '1'       *IN19            Détection ROCHECHOUAR
F3  C                     END
     *
     * ***************************************
    C*          USINE     IFEQ 4
    C*                    MOVE *BLANKS   X021   12
    C*                    Z-ADD1         I       30
    C*                    Z-ADD1         J       30
    C*                    SETOF                     94
    C*          FASEQ     IFEQ 2
    C*          KCARLU    SETLLCARCDEZ1                 94
    C*                    END
    C*  94                Z-ADD01        WWQFAB  20
    C*  94      KPLAM3    SETLLPLAMAL1
    C* N94      KPLAM2    SETLLPLAMAL1
    C*          KPLAM1    READEPLAMAL1                  82
    C*          *IN82     IFEQ '0'
    C*                    Z-ADD1         J
    C*          ETAFOR    LOKUPETA,J                    55
    C*  55                MOVELLET,J     X021
     *
    C*                    ELSE
    C*                    MOVELLET,5     X021
    C*                    END
    C*                    MOVELX021      W021    2
    C**                   MOVELLIB20     WLIB20
    C*          W021      IFEQ 'CR'
    C*                    MOVE '1'       *IN13
    C*                    MOVE '1'       IVCR
    C*                    ELSE
    C*                    MOVE '0'       *IN13
    C*                    MOVE *BLANK    IVCR
    C*                    END
     *    --------------------------------------------------------------
     *  ---> MATERIEL IMPRESSION, MATERIEL DECOUPAGE
     *  --------------------------------------------
     *
D2  C           USINE     IFEQ 4
     C                     MOVE *BLANKS   X020   12
     C                     MOVE *BLANKS   X021   12
     C                     Z-ADD1         I       30
     C                     Z-ADD1         J       30
     C                     SETOF                     94
D3  C           FASEQ     IFEQ 2
     C           KCARLU    SETLLCARCDEZ1                 94
F3  C                     END
     C   94                Z-ADD01        WWQFAB  20
     C   94      KPLAM3    SETLLPLAMAL1
     C  N94      KPLAM2    SETLLPLAMAL1
     C           KPLAM1    READEPLAMAL1                  82
D3  C           *IN82     IFEQ '0'
D4  C           XSEXT     IFNE *ZERO
D5  C           TIM01     IFNE ' '
     C           ETAT01    LOKUPETA,I                    55
     C   55                MOVELLET,I     X020
F5  C                     END
D5  C           TIM02     IFNE ' '
     C           ETAT02    LOKUPETA,J                    55
     C   55      J         COMP I                      55
     C   55                MOVELLET,J     X020
     C   55                MOVE J         I
F5  C                     END
F4  C                     END
     *
     C                     Z-ADD1         J
D4  C           XSINT     IFNE *ZERO
D5  C           TIM03     IFNE ' '
     C           ETAT03    LOKUPETA,J                    55
     C   55      J         COMP I                      55
     C   55                MOVELLET,I     X020
     C   55                MOVE J         I
F5  C                     END
     C                     Z-ADD1         J
D5  C           TIM04     IFNE ' '
     C           ETAT04    LOKUPETA,J                    55
     C   55      J         COMP I                      55
     C   55                MOVELLET,J     X020
F5  C                     END
F4  C                     END
D4  C           FACON     IFEQ 6
    C           FACON     OREQ 7
    C           FACON     OREQ 8
    C           CCOL      OREQ 4
    C           CCOL      OREQ 7
     C                     Z-ADD1         J
     C           ETAFOR    LOKUPETA,J                    55
     C   55                MOVELLET,J     X021
F4  C                     END
     *
X3  C                     ELSE
     *
D4  C           XSEXT     IFNE *ZERO
    C           XSINT     ORNE *ZERO
     C                     MOVELLET,5     X020
F4  C                     END
D4  C           FACON     IFEQ 6
    C           FACON     OREQ 7
    C           FACON     OREQ 8
     C                     MOVELLET,5     X021
F4  C                     END
F3  C                     END
     *
     C                     MOVELX021      W021    2
     C                     MOVELX020      W020    2
    C**                   MOVELLIB20     WLIB20
D3  C           W021      IFEQ 'CR'
     C                     MOVE '1'       *IN13
     C                     MOVE '1'       IVCR
X3  C                     ELSE
     C                     MOVE '0'       *IN13
     C                     MOVE *BLANK    IVCR
F3  C                     END
D3  C           W020      IFEQ 'CR'
     C                     MOVE '1'       *IN16
     C                     MOVE '1'       IVDEC
X3  C                     ELSE
     C                     MOVE '0'       *IN16
     C                     MOVE *BLANK    IVDEC
F3  C                     END
     *  Prioritisation des inverses vidéo
     *    Si materiel = CR et decor = CR => Priorité au Jaune
D3  C           *IN13     IFEQ '1'
    C           *IN16     ANDEQ'1'
     C                     MOVE '0'       *IN16
     C                     MOVE *BLANK    IVDEC
F3  C                     END
     *    --------------------------------------------------------------
     *  Si Demande Action Corrective (DAC) par sce Qualité
     *  --> *IN14 à '1' pour surbrillance
     *
     C           KMALFA    SETLLMALFACL5                 99
D3  C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN14
     C                     MOVE '1'       IVDAC
X3  C                     ELSE
     C                     MOVE '0'       *IN14
     C                     MOVE *BLANK    IVDAC
F3  C                     ENDIF
F2  C                     ENDIF
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : SOUS ROUTINE DE DETECTION CONSIGNES  POUR TOURY    *
    C*                                                    (*IN74)    *
    C*****************************************************************
    C           SRCCSG    BEGSR
     C                     MOVE '0'       *IN74            Detection consignes
     C                     MOVE *BLANK    IVCSG
     *
     *    --------------------------------------------------------------
     *  Si Consigne existe --> *IN74 à '1' pour surbrillance
     *
    C*
     C           KCSG1     SETLLCSGCMDL1                 99
D1  C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN74
     C                     MOVE '1'       IVCSG
X1  C                     ELSE
     C                     MOVE '0'       *IN74
     C                     MOVE *BLANK    IVCSG
F1  C                     ENDIF
    C*
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : REINITIALISATION DES INDICATEURS CR ET DAC ET DEC  *
    C*            AU RETOUR DES OPTIONS                              *
    C*            IVCR et *IN13 = '1' ==> Inverse Video Jaune        *
    C*            IVDAC et *IN14 = '1' ==> Inverse Video Rose        *
    C*            IVDEC et *IN16 = '1' ==> Inverse Video Vert        *
    C*****************************************************************
    C           CRDAC     BEGSR
    C**
D1  C           IVCR      IFEQ '1'
     C                     MOVE '1'       *IN13
X1  C                     ELSE
     C                     MOVE '0'       *IN13
F1  C                     ENDIF
D1  C           IVDAC     IFEQ '1'
     C                     MOVE '1'       *IN14
X1  C                     ELSE
     C                     MOVE '0'       *IN14
F1  C                     ENDIF
D1  C           IVDEC     IFEQ '1'
     C                     MOVE '1'       *IN16
X1  C                     ELSE
     C                     MOVE '0'       *IN16
F1  C                     ENDIF
    C                     ENDSR
    C*===============================================================*
    C*                                                               *
    C*                     SORTIES FICHIERS                          *
    C*                                                               *
    C*===============================================================*
     OXFAB15  E                MAJ15
     O                         FATRSP
     OXFAB16  E                MAJ16
     O                         FA1601
     O                         FA1602
     OXFAB16  E                MAJ16B
     O                         FA1602
     OXFA16D  E                MAJ16D
     O                         TA1601
     O                         TA1602
     OXFA16E  E                MAJ16E
     O                         PPHFRE
     OZFAB17  E                MAJ17E
     O                         XPHFIN
     OZFAB05  E                MAJ05
     O                         FAOPST
     OTFAB05  E                MAJ05A
     O                         FAOPST
     O                         FAHOF2
     OPRLANCFZE                MAJLAN
     O                         OFETA
     OPREFOUF1E                MAJFOU
     O                         SOBESO
**
LIB001
LIB002
LIB003
LIB004
LIB005
LIB006
LIB007
LIB008
LIB009
**
CREATION
MODIFICATION
INTERROGATION
SUPPRESSION
**
  MATIN
APRES-MIDI
  NUIT
**
OP.  TERMINEE => CONFIRMER
EQUIPE TERMINEE => CONFIRMER
OP. INTERROMPUE => CONFIRMER
**
TRAVAIL TERMINE
EQUIPE TERMINEE
TRAV.INTERROMPU
**
N° Equipe ............ :
N° Faction ........... :
**
FINITION
**
23457
**
05001300
13002100
21000500
05001300
13002100
21000500
04301230
12302030
20300430
05001300
13002100
21000500
05001300
13002100
21000500
**
!! ATTENTION : BILAN A REVALIDER PAR MAITRISE !!
**  TABLE DES ETAT MATERIEL
CCREATION
MMODIFICATION
RREFECTION
EEXISTANT
 EXISTANT
NENTRETIEN
TTRANSFERT
