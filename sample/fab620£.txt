      *%CSTD===========================================================*
      ** Application. : EMAGE      Logiciel métier DS Smith            *
      ** Composant. . : FAB620£                       Type: RPG        *
      **===============================================================*
      ** Sous-système :                                                *
      ** Fonction . . :                                                *
      ** Sous-fonction:                                                *
      **%S=============================================================*
      ** Description des fonctionnalités:                              *
      **                                                               *
      **                                                               *
      **                                                               *
      **%E=============================================================*
      ** AUTEUR:                          00:00                        *
      ** MODIFS: 01 NOUZIERES  17/07/2023 14:23  90.91.11 FM 23/  110  *
      **           rename des machines                                 *
      *%ECSTD==========================================================*
     H            D.J
     *****************************************************************
     *                                                               *
     *                   SUIVI DE FABRICATION                        *
     *****************************************************************
     *  LE 04/09/09 : MODIFS                                         *
     *  - AFFICHAGE TOUTES NATURE DE CDE MÊME SI FERME               *
     *  - AFFICHAGE CODE DE GESTION 'D' SUR FOND ROUGE CLIGNOTANT    *
     *  - AFFICHAGE NATURE CDE, CODE DE GESTION, MINI/MAXI DANS F10  *
    H** --------!------------!---------------------------------------*
    H**  TMAGPI ! 26-03-2014 ! TASK0012138: Rajout options C et V    *
    H**         !            ! pour Cr et visu consignes (D.BOUNY/TY)*
    H*  TMAFBU   ! 03-10-2016 ! OFFSET 3B : POUR USINE = 2, S/SS =14 *
    H*           !            ! ET MAC = 16, NBRE GROUPE <= 9        *
    H*****************************************************************
     *****************************************************************
     FFAB02L01IF  E           K        DISK
     FFAB03L01IF  E           K        DISK
     FFAB03L02IF  E           K        DISK
     F            XFAB03                            KRENAMEYFAB03
     FFAB03L03IF  E           K        DISK
     F            XFAB03                            KRENAMEZFAB03
     FFAB04L01IF  E           K        DISK
     FFAB05L05IF  E           K        DISK
     FFAB05L06IF  E           K        DISK
     F            XFAB05                            KRENAMEYFAB05
    FFAB05L07UF  E           K        DISK
     F            XFAB05                            KRENAMEZFAB05
     FFAB08L01IF  E           K        DISK
     FFAB09L02IF  E           K        DISK
     FFAB10L09IF  E           K        DISK
     FFAB10L10IF  E           K        DISK
     F            XFAB10                            KRENAMEZFAB10
     FFAB10L11IF  E           K        DISK
     F            XFAB10                            KRENAMETFAB10
     FFAB10L18IF  E           K        DISK
    FFAB10L19UF  E           K        DISK
     FFAB10L20IF  E           K        DISK
     F            XFAB10                            KRENAMERFAB10
     FFAB11L09IF  E           K        DISK
     FFAB11L10IF  E           K        DISK
     F            XFAB11                            KRENAMEZFAB11
    FFAB11L13UF  E           K        DISK
     FFAB11L14IF  E           K        DISK
     FFAB11L15IF  E           K        DISK
     F            XFAB11                            KRENAMERFAB11
     FFAB13L01IF  E           K        DISK
    FFAB15L01UF  E           K        DISK
    FFAB16L01UF  E           K        DISK                      A
    FFAB16L06UF  E           K        DISK
     FFAB16L05IF  E           K        DISK
     FFAB16L03IF  E           K        DISK
    FFAB17L01UF  E           K        DISK                      A
     FFAB17L02IF  E           K        DISK
     FFAB17L04IF  E           K        DISK
     F            XFAB17                            KRENAMEYFAB17
    FFAB17L05UF  E           K        DISK
     F            XFAB17                            KRENAMEZFAB17
    FFAB18L01IF  E           K        DISK                      A
    FFAB19L01UF  E           K        DISK                      A
    FFAB21L01O   E           K        DISK                      A
     FCALENSL4IF  E           K        DISK
     FCALENS  IF  E           K        DISK
     F            CALENDF1                          KRENAMECALENDZ1
     FCODBARL2IF  E           K        DISK
     FPARAME  IF  E           K        DISK
     FPRODAL8 IF  E           K        DISK
    FPRLANCXHUF  E           K        DISK
     FCLIENTS1IF  E           K        DISK
     FPREIMP2 IF  E           K        DISK
     FPRODST3 IF  E           K        DISK
     FMACHIN  IF  E           K        DISK
     FFORMAG  IF  E           K        DISK
     FTRASPE  IF  E           K        DISK                               PROD02
     FCARCDEL1IF  E           K        DISK
     FPREACOP2IF  E           K        DISK
     FCSGCMDL1IF  E           K        DISK
     FFAB620D CF  E                    WORKSTN
     F                                        RCD   KSFILE F02
     F                                        RCX   KSFILE F06
     F                                        RCY   KSFILE F11
     F                                        RCT   KSFILE F19
     E                    TCAD        4  2
     E                    THAD        4  4 0
     E                    TTAD        4  1
     E                    TEAD        4  1 0
     E                    TLAD        4 12
     E                    TAD1        6  2               HISTOFA2:CODES AD
     E                    TAD2        6  4 2             HISTOFA2:TEMPS AD
     E                    TAD3        6  1               HISTOFA2:INCLUS AD
     E                    TAD4        6  1 0             HISTOFA2:EFFECTIFS AD
     E                    SVTAD2      6  4 2             HISTOFA2:CODES AD
     E                    EBCAD       6  2               HISTOFA2:CODES AD
     E                    EBTAD       6  4 2             HISTOFA2:TEMPS AD
     E                    EBIAD       6  1               HISTOFA2:INCLUS AD
     E                    EBEAD       6  1 0             HISTOFA2:EFFECTIFS AD
     E                    PAG        50  2
     E                    PA2        50  3 0
     E                    AF1         9  2
     E                    AF2         9 30
     E                    AF3         9 30
     E                    PREI        9  1
     E                    CALJ       48  1
     E                    ZO      1   9 10
     E                    TM      1   4 13
     E                    EQ      1   4 10                                PA010
     E                    LIFI    1   3 29                                PA010
     E                    LIBF    1   3 15                                PA010
     E                    LIBP    1   2 24                                PA010
     E                    LB      1   1 20                                PA010
     E                    TBU     5   5  1 0                              PA010
     E                    TEQ     1  15  8 0                              PA010
     E                    FLEX    1   1  9                                PA010
     IPREACOPF
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOCLI                           XNOCLI
     I              MAC                             XMAC
     IZFAB05
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              FA0501                          XA0501
     IZFAB10
     I              FAUSIN                          XAUSIN
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              FATENC                          XATENC
     I              FAOPNU                          XAOPNU
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              PPEQUI                          XPEQUI
     I              PPAA                            XPAA
     I              PPMM                            XPMM
     I              PPJJ                            XPJJ
     I              FAAENT                          XAAENT
     I              FAMENT                          XAMENT
     I              FAJENT                          XAJENT
     I              FAHENT                          XAHENT
     IRFAB10
     I              FAUSIN                          XAUSIN
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              FATENC                          XATENC
     I              FAOPNU                          XAOPNU
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              PPEQUI                          XPEQUI
     I              PPAA                            XPAA
     I              PPMM                            XPMM
     I              PPJJ                            XPJJ
     I              FAAENT                          XAAENT
     I              FAMENT                          XAMENT
     I              FAJENT                          XAJENT
     I              FAHENT                          XAHENT
     ITFAB10
     I              FAUSIN                          XAUSIN
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              FATENC                          XATENC
     I              FAOPNU                          XAOPNU
     I              SECT                            XSECT
     I              SSECT                           XSSECT
     I              NOMAC                           XNOMAC
     I              PPEQUI                          XPEQUI
     I              PPAA                            XPAA
     I              PPMM                            XPMM
     I              PPJJ                            XPJJ
     I              FAAENT                          XAAENT
     I              FAMENT                          XAMENT
     I              FAJENT                          XAJENT
     I              FAHENT                          XAHENT
     IXFA10B
     I              FFAA                            PPAA11
     I              FFMM                            PPMM11
     I              FFJJ                            PPJJ11
     I              FFEQUI                          PPEQ11
     IXFA10C
     I              STE                             XSTE
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     IXFA11B
     I              PPAA                            PPAA11
     I              PPMM                            PPMM11
     I              PPJJ                            PPJJ11
     I              PPEQUI                          PPEQ11
     IRFAB11
     I              PPEQUI                          XEQUI
     IXFAB15
     I              USINE                           XUSINE
     IXFA16D
     I              FACONF                          TACONF
     I              FASEQ                           TASEQ
     I              FAISEQ                          TAISEQ
     I              NOPRO                           TNOPRO
     I              FAOPNU                          TAOPNU
     I              PPAA                            TPAA
     I              PPMM                            TPMM
     I              PPJJ                            TPJJ
     I              PPEQUI                          TPEQUI
     I              CMATR                           TCMATR
     I              FA1601                          TA1601
     I              FA1602                          TA1602
     IYFAB17
     I              FACONF                          XACONF
     I              FASEQ                           XASEQ
     I              FAISEQ                          XAISEQ
     I              NOPRO                           XNOPRO
     I              FAOPNU                          XAOPNU
     I              PPPAS                           XPPAS
     I              PPFAA                           XPFAA
     I              PPFMM                           XPFMM
     I              PPFJJ                           XPFJJ
     I              FAEVCO                          XAEVCO
     I              PPORD                           XPORD
     I              FAEVTY                          XAEVTY
     I              FANOMB                          XANOMB
     I              FA1701                          XA1701
     I              FA1702                          XA1702
     IZFAB17
     I              PPFAA                           XPFAA
     I              PPFMM                           XPFMM
     I              PPFJJ                           XPFJJ
     I              PPHDEB                          XPHDEB
     I              PPHFIN                          XPHFIN
     IPRODUIF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              AGENT                           XAGENT
     IRECAPTF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              AGENT                           XAGENT
     IPRODARF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              AGENT                           XAGENT
     IPRODSTF2
     I              MAIME1                          XAIME1
     I              MAIME2                          XAIME2
     I              MAIME3                          XAIME3
     I              MAIME4                          XAIME4
     I              MAIME5                          XAIME5
     I              MIMRE1                          XIMRE1
     I              MIMRE2                          XIMRE2
     I              MIMRE3                          XIMRE3
     I              MIMRE4                          XIMRE4
     I              MIMRE5                          XIMRE5
     I              RMIME1                          XMIME1
     I              RMIME2                          XMIME2
     I              RMIME3                          XMIME3
     I              RMIME4                          XMIME4
     I              RMIME5                          XMIME5
     I              RMIRE1                          XMIRE1
     I              RMIRE2                          XMIRE2
     I              RMIRE3                          XMIRE3
     I              RMIRE4                          XMIRE4
     I              RMIRE5                          XMIRE5
     I              MAGAU1                          XAGAU1
     I              MAGAU2                          XAGAU2
     I              DMACP1                          XMACP1
     I              DMACP2                          XMACP2
     I              DMACP3                          XMACP3
     I              DMACP4                          XMACP4
     ICARCDEF1
     I              USINE                           XUSINE
     I              STE                             XSTE
     I              NCONF                           XCONF
     I              NOCLI                           XNOCLI
     I              NOPRO                           XNOPRO
     I              AGENT                           YAGENT
     I           IDS
     I                                        1  15 ABRCLI                CCS013
     I                                        1   9 ABRCL9                CCS013
     I           IDS
     I                                        1   80DATLUE                CCS013
     I                                        1   20CALJJ                 CCS013
     I                                        3   40CALMM                 CCS013
     I                                        5   60CALSS                 CCS013
     I                                        7   80CALAA                 CCS013
     I           IDS
     I                                        1  170DH                    CCS013
     I                                        1   40FAAFA                 CCS013
     I                                        5   60FAMFA                 CCS013
     I                                        7   80FAJFA                 CCS013
     I                                        9  140FAHFA                 CCS013
     I                                       15  170FANOP                 CCS013
     I           IDS
     I                                        1   80DATE                  CCS013
     I                                        1   20ZAJFA                 CCS013
     I                                        3   40ZAMFA                 CCS013
     I                                        5   80ZAAFA                 CCS013
     I           IDS
     I                                        1   80DATEQ                 CCS013
     I                                        1   20PPJJ                  CCS013
     I                                        3   40PPMM                  CCS013
     I                                        5   80PPAA                  CCS013
     I           IDS
     I                                        1   80DATOUV                CCS013
     I                                        1   20FAJJ                  CCS013
     I                                        3   40FAMM                  CCS013
     I                                        5   80FAAA                  CCS013
     I           IDS
     I                                        1   80TDATEQ                CCS013
     I                                        1   20TPJJ                  CCS013
     I                                        3   40TPMM                  CCS013
     I                                        5   80TPAA                  CCS013
     I           IDS
     I                                        1   80DATEVE                CCS013
     I                                        1   20PPFJJ                 CCS013
     I                                        3   40PPFMM                 CCS013
     I                                        5   80PPFAA                 CCS013
     I           IDS
     I                                        1   80XATEVE                CCS013
     I                                        1   20XPFJJ                 CCS013
     I                                        3   40XPFMM                 CCS013
     I                                        5   80XPFAA                 CCS013
     I           IDS
     I                                        1   80DATLIV                CCS013
     I                                        1   20FAJLI                 CCS013
     I                                        3   40FAMLI                 CCS013
     I                                        5   80FAALI                 CCS013
     I           IDS
     I                                        1   80FADJA1                CCS013
     I                                        1   20FAJJA1                CCS013
     I                                        3   40FAMJA1                CCS013
     I                                        5   80FAAJA1                CCS013
     I           IDS
     I                                        1   80FADJA2                CCS013
     I                                        1   20FAJJA2                CCS013
     I                                        3   40FAMJA2                CCS013
     I                                        5   80FAAJA2                CCS013
     I           IDS
     I                                        1   80DTOPD                 CCS013
     I                                        1   20FAJCAD                CCS013
     I                                        3   40FAMCAD                CCS013
     I                                        5   80FAACAD                CCS013
     I           IDS
     I                                        1   80DTOPF                 CCS013
     I                                        1   20FAJTIF                CCS013
     I                                        3   40FAMTIF                CCS013
     I                                        5   80FAATIF                CCS013
     I           IDS
     I                                        1   80DATREC                CCS013
     I                                        1   20FAJRE                 CCS013
     I                                        3   40FAMRE                 CCS013
     I                                        5   80FAARE                 CCS013
     I           IDS
     I                                        1  18 CDE
     I                                        1   10USINE                 CCS013
     I                                        2   60FACONF                CCS013
     I                                        7   80FASEQ                 CCS013
     I                                        9   90FAISEQ                CCS013
     I                                       10  130NOPRO                 CCS013
     I                                        2  13 CDE1
     I                                       14  140STE                   CCS013
     I                                       15  180NOCLI                 CCS013
     I           IDS
     I                                        1   2 FAATEL
     I                                        1   1 SECT                  CCS013
     I                                        2   2 SSECT                 CCS013
     I           IDS
     I                                        1   5 P1
     I                                        1   10ZUSI                  CCS013
     I                                        2   5 ZRESS
     I                                        2   2 ZSECT                 CCS013
     I                                        3   3 ZSSECT                CCS013
     I                                        4   5 ZNOMAC                CCS013
     I           IDS
     I                                        1   8 TCAD
     I                                        1   2 CARD1                 CCS013
     I                                        3   4 CARD2                 CCS013
     I                                        5   6 CARD3                 CCS013
     I                                        7   8 CARD4                 CCS013
     I           IDS
     I                                        1  160THAD
     I                                        1   40HARD1                 CCS013
     I                                        5   80HARD2                 CCS013
     I                                        9  120HARD3                 CCS013
     I                                       13  160HARD4                 CCS013
     I           IDS
     I                                        1   4 TTAD
     I                                        1   1 TARD1                 CCS013
     I                                        2   2 TARD2                 CCS013
     I                                        3   3 TARD3                 CCS013
     I                                        4   4 TARD4                 CCS013
     I           IDS
     I                                        1   40TEAD
     I                                        1   10EARD1                 CCS013
     I                                        2   20EARD2                 CCS013
     I                                        3   30EARD3                 CCS013
     I                                        4   40EARD4                 CCS013
     I           IDS
     I                                        1  48 TLAD
     I                                        1  12 LARD1                 CCS013
     I                                       13  24 LARD2                 CCS013
     I                                       25  36 LARD3                 CCS013
     I                                       37  48 LARD4                 CCS013
     ILIBEL      IDS
     I                                        1  40 BLOC1
     I                                        1  19 LIB20
     I                                       41  80 BLOC2
     I                                       81 120 BLOC4
     IDSCOMM      DS
     I                                        1   10YYSTE
     I                                        2   50YYCLI
     I                                       16  190DSPRO
     I                                       22  22 ZONE95
     I                                       24  24 MODIFE
     I                                       40  41 DSGAR
     I                                       42  460DSCNF
     I                                       47  51 DSFOR
     I                                      100 100 Z100
     I                                      101 101 Z101
     I                                      102 102 Z102
     I                                      103 110 ZMDP
     I           IDS
     I                                        1  35 PARM4
     I                                        1  26 PARM15
     I                                        1   10YAUSIN
     I                                        2   2 YSECT
     I                                        3   3 YSSECT
     I                                        2   3 YAATEL
     I                                        4   5 YNOMAC
     I                                        6  100YACONF
     I                                       11  120YASEQ
     I                                       13  130YAISEQ
     I                                       14  140YSTE
     I                                       15  180YNOCLI
     I                                       19  220YNOPRO
     I                                       23  260YAOPNU
     I                                       27  280YPJJ
     I                                       29  300YPMM
     I                                       31  340YPAA
     I                                       27  340YATEQ
     I                                       35  350YPEQUI
     I           IDS
     I                                        1  59 PARM5
     I                                        1   10XXUSIN                CCS013
     I                                        2   60XXCONF                CCS013
     I                                        7   80XXSEQ                 CCS013
     I                                        9   90XXISEQ                CCS013
     I                                       10  130XXPRO                 CCS013
     I                                        2  130XXCDE
     I                                       14  140XXEQU                 CCS013
     I                                       15  180XXAA                  CCS013
     I                                       19  200XXMM                  CCS013
     I                                       21  220XXJJ                  CCS013
     I                                       15  220XXDT1                 CCS013
     I                                       23  260XXHDEQ                CCS013
     I                                       27  300XXHFEQ                CCS013
     I                                       31  370XXMAT                 CCS013
     I                                       38  380XXEFC                 CCS013
     I                                       39  390XXEFR                 CCS013
     I                                       40  460XXCTR1                CCS013
     I                                       47  530XXCTR2                CCS013
     I                                       54  54 XXSEC                 CCS013
     I                                       55  55 XXSSEC                CCS013
     I                                       56  57 XXMAC                 CCS013
     I                                       58  580XXEQ11                CCS013
     I                                       59  59 XXF11                 CCS013
     I           IDS
     I                                        1  50 PARM6
     I                                        1  10 FANPRT                CCS013
     I           IDS
     I                                        1  18 PARM7
     I                                        1   10WAUSIN
     I                                        2   60WACONF
     I                                        7   80WASEQ
     I                                        9   90WAISEQ
     I                                       10  130WNOPRO
     I                                       14  170WAOPNU
     I                                       18  18 TAGOK
     I           IDS
     I                                        1  18 PARM8
     I                                        1   10VAUSIN
     I                                        2   60VACONF
     I                                        7   80VASEQ
     I                                        9   90VAISEQ
     I                                       10  130VNOPRO
     I                                       14  170VAOPNU
     I                                       18  18 T2207
     I           IDS
     I                                        1  31 PARM13
     I                                        1   50RCONF
     I                                        6   70RSEQ
     I                                        8  110RPRO
     I                                       12  12 RSECT
     I                                       13  13 RSSECT
     I                                       14  15 RMAC
     I                                       16  16 RTYPSO
     I                                       17  170RUSIN
     I                                       18  180RTYPST
     I                                       19  240RBOB
     I                                       25  280RQTE
     I                                       29  29 SMU
     I                                       30  30 ROK
     I                                       31  31 RVAL2
     I            DS
     I                                        1  18 AF1
     I                                        1   2 TYP001
     I                                        3   4 TYP002
     I                                        5   6 TYP003
     I                                        7   8 TYP004
     I                                        9  10 TYP005
     I                                       11  12 TYP006
     I                                       13  14 TYP007
     I                                       15  16 TYP008
     I                                       17  18 TYP009
     I            DS
     I                                        1 270 AF2
     I                                        1  30 LIB001
     I                                       31  60 LIB002
     I                                       61  90 LIB003
     I                                       91 120 LIB004
     I                                      121 150 LIB005
     I                                      151 180 LIB006
     I                                      181 210 LIB007
     I                                      211 240 LIB008
     I                                      241 270 LIB009
     I           IDS
     I                                        1   40FAOPNU
     I                                        1   20PRIOR1
     I                                        3   30RANG1
     I                                        4   40PASAGE
     IENREG2     IDS
     I                                        1 186 ENR2
     I                                        1   10EBUSIN
     I                                        2   60EBCONF
     I                                        7   80EBSEQ
     I                                        9   90EBSTE
     I                                       10  130EBCLI
     I                                       14  170EBPRO
     I                                       18  18 EBSEC
     I                                       19  19 EBSSEC
     I                                       20  21 EBMAC
     I                                       22  290EBDAT1
     I                                       30  370EBDAT2
     I                                       38  410EBHEUR
     I                                       42  420EBEQU
     I                                       43  430EBPAS
     I                                       44  500EBCOND
     I                                       51  552EBTCAL
     I                                       56  602EBTROU
     I                                       61  652EBTDIV
     I                                       66  660EBEFFC
     I                                       67  670EBEFFR
     I                                       68  740EBQTOT
     I                                       75  810EBQBON
     I                                       82  880EBQRC
     I                                       89  950EBQRR
     I                                       96  97 EBCAD1
     I                                       98  99 EBCAD2
     I                                      100 101 EBCAD3
     I                                      102 103 EBCAD4
     I                                      104 105 EBCAD5
     I                                      106 107 EBCAD6
     I                                       96 107 EBCAD
     I                                      108 1112EBTAD1
     I                                      112 1152EBTAD2
     I                                      116 1192EBTAD3
     I                                      120 1232EBTAD4
     I                                      124 1272EBTAD5
     I                                      128 1312EBTAD6
     I                                      108 131 EBTAD
     I                                      132 1320EBEAD1
     I                                      133 1330EBEAD2
     I                                      134 1340EBEAD3
     I                                      135 1350EBEAD4
     I                                      136 1360EBEAD5
     I                                      137 1370EBEAD6
     I                                      132 137 EBEAD
     I                                      138 138 EBIAD1
     I                                      139 139 EBIAD2
     I                                      140 140 EBIAD3
     I                                      141 141 EBIAD4
     I                                      142 142 EBIAD5
     I                                      143 143 EBIAD6
     I                                      138 143 EBIAD
     I                                      144 145 EBETIQ
     I                                      146 1460EBCOUL
     I                                      147 147 EBTVER
     I                                      148 150 EBCELI
     I                                      151 1570EBQELI
     I                                      158 1620EBOPNU
     I                                      163 164 EBOPST
     I                                      165 165 EBSUP
     I                                      166 166 EBTAG
     I                                      167 168 EBTRSP
     I                                      169 1732EBPOS1
     I                                      174 1782EBPOS2
     I                                      179 1850EBQACO
     I                                      186 1860EBNCAL
     I           IDS
     I                                        1   40HENT                  CCS013
     I                                        1   20XXDEBH                CCS013
     I                                        3   40XXDEBM                CCS013
     I           IDS
     I                                        1  17 PARM9
     I                                        1   10VVUSI                 CCS013
     I                                        2   60VVCONF                CCS013
     I                                        7   80VVSEQ                 CCS013
     I                                        9   90VVISEQ                CCS013
     I                                       10  130VVPRO                 CCS013
     I                                       14  15 VVETAT                CCS013
     I                                       16  170VVPRIO                CCS013
     I           IDS
     I                                        1  23 PARM10
     I                                        1   10SAUSIN
     I                                        2   60SACONF
     I                                        7   80SASEQ
     I                                        9   90SAISEQ
     I                                       10  130SNOPRO
     I                                       14  170SAOPNU
     I                                       18  18 SPSECT
     I                                       19  19 SSSECT
     I                                       20  21 SNOMAC
     I                                       22  23 SETAOP
     I           IDS
     I                                        1 100 PARMBF
     I                                        1   50KKCONF                CCS013
     I                                        6   90KKPRO                 CCS013
     I                                       10  110KKSEQ                 CCS013
     I                                       12  12 IN95                  CCS013
     I           IDS
     I                                        1  17 PARM11
     I                                        1   10JAUSIN
     I                                        2   60JACONF
     I                                        7   80JASEQ
     I                                        9   90JAISEQ
     I                                       10  130JNOPRO
     I                                       14  170JAOPNU
     I           IDS
     I                                        1 119 PARM12
     I                                        1   4 TYPOND
     I                                        5   6 TYPCOL
     I                                        7   9 PAPEXT
     I                                       10  120GRAEXT
     I                                       13  161LAIEXT
     I                                       17  25 PREEXT
     I                                       26  320KGBEXT
     I                                       33  35 PAPCAN
     I                                       36  380GRACAN
     I                                       39  421LAICAN
     I                                       43  51 PRECAN
     I                                       52  580KGBCAN
     I                                       59  61 PAPINT
     I                                       62  640GRAINT
     I                                       65  681LAIINT
     I                                       69  77 PREINT
     I                                       78  840KGBINT
     I                                       85  880FOLEXT
     I                                       89  920FOHEXT
     I                                       93  98 FOUEXT
     I                                       99 1010GRREXT
     I                                      102 107 FOUCAN
     I                                      108 1100GRRCAN
     I                                      111 116 FOUINT
     I                                      117 1190GRRINT
     I           IDS
     I                                        1  31 PARM30
     I                                        1   10XJUSIN
     I                                        2   2 XJSECT
     I                                        3   3 XJSSEC
     I                                        4   5 XJNOMA
     I                                        6  100XJCONF
     I                                       11  120XJSEQ
     I                                       13  130XJISEQ
     I                                       14  170XJPRO
     I                                       18  210XJOPNU
     I                                       22  250XJPPAA
     I                                       26  270XJPPMM
     I                                       28  290XJPPJJ
     I                                       30  300XJEQUI
     I                                       31  310XJNBCA
     I           IDS
     I                                        1  22 PARA0
     I                                        1   10XZUSI
     I                                        2   60XZCONF
     I                                        7   80XZSEQ
     I                                        9   90XZISEQ
     I                                       10  130XZPRO
     I                                       14  14 XZSECT
     I                                       15  15 XZSSEC
     I                                       16  17 XZMAC
     I                                       18  180XZSTE
     I                                       19  220XZCLI
     I           IDS
     I                                        1  54 PARA1
     I                                        1   9 SUP1
     I                                       10  12 PAP1
     I                                       13  150GRA1
     I                                       16  191LAI1
     I                                       20  230FOL1
     I                                       24  270FOH1
     I                                       28  36 PRE1
     I                                       37  430KGB1
     I                                       44  45 UNI1
     I                                       46  51 FOU1
     I                                       52  540GRR1
     I           IDS
     I                                        1  54 PARA2
     I                                        1   9 SUP2
     I                                       10  12 PAP2
     I                                       13  150GRA2
     I                                       16  191LAI2
     I                                       20  230FOL2
     I                                       24  270FOH2
     I                                       28  36 PRE2
     I                                       37  430KGB2
     I                                       44  45 UNI2
     I                                       46  51 FOU2
     I                                       52  540GRR2
     I           IDS
     I                                        1  54 PARA3
     I                                        1   9 SUP3
     I                                       10  12 PAP3
     I                                       13  150GRA3
     I                                       16  191LAI3
     I                                       20  230FOL3
     I                                       24  270FOH3
     I                                       28  36 PRE3
     I                                       37  430KGB3
     I                                       44  45 UNI3
     I                                       46  51 FOU3
     I                                       52  540GRR3
     I           IDS
     I                                        1  54 PARA4
     I                                        1   9 SUP4
     I                                       10  12 PAP4
     I                                       13  150GRA4
     I                                       16  191LAI4
     I                                       20  230FOL4
     I                                       24  270FOH4
     I                                       28  36 PRE4
     I                                       37  430KGB4
     I                                       44  45 UNI4
     I                                       46  51 FOU4
     I                                       52  540GRR4
     I           IDS
     I                                        1  54 PARA5
     I                                        1   9 SUP5
     I                                       10  12 PAP5
     I                                       13  150GRA5
     I                                       16  191LAI5
     I                                       20  230FOL5
     I                                       24  270FOH5
     I                                       28  36 PRE5
     I                                       37  430KGB5
     I                                       44  45 UNI5
     I                                       46  51 FOU5
     I                                       52  540GRR5
     I           IDS
     I                                        1   9 PREI
     I                                        1   1 PREI1
     I                                        2   2 PREI2
     I                                        3   3 PREI3
     I                                        4   4 PREI4
     I                                        5   5 PREI5
     I                                        6   6 PREI6
     I                                        7   7 PREI7
     I                                        8   8 PREI8
     I                                        9   9 PREI9
     I           IDS
     I                                        1  48 CALJ
     I                                        1   1 FAH01
     I                                        2   2 FAH02
     I                                        3   3 FAH03
     I                                        4   4 FAH04
     I                                        5   5 FAH05
     I                                        6   6 FAH06
     I                                        7   7 FAH07
     I                                        8   8 FAH08
     I                                        9   9 FAH09
     I                                       10  10 FAH10
     I                                       11  11 FAH11
     I                                       12  12 FAH12
     I                                       13  13 FAH13
     I                                       14  14 FAH14
     I                                       15  15 FAH15
     I                                       16  16 FAH16
     I                                       17  17 FAH17
     I                                       18  18 FAH18
     I                                       19  19 FAH19
     I                                       20  20 FAH20
     I                                       21  21 FAH21
     I                                       22  22 FAH22
     I                                       23  23 FAH23
     I                                       24  24 FAH24
     I                                       25  25 FAH25
     I                                       26  26 FAH26
     I                                       27  27 FAH27
     I                                       28  28 FAH28
     I                                       29  29 FAH29
     I                                       30  30 FAH30
     I                                       31  31 FAH31
     I                                       32  32 FAH32
     I                                       33  33 FAH33
     I                                       34  34 FAH34
     I                                       35  35 FAH35
     I                                       36  36 FAH36
     I                                       37  37 FAH37
     I                                       38  38 FAH38
     I                                       39  39 FAH39
     I                                       40  40 FAH40
     I                                       41  41 FAH41
     I                                       42  42 FAH42
     I                                       43  43 FAH43
     I                                       44  44 FAH44
     I                                       45  45 FAH45
     I                                       46  46 FAH46
     I                                       47  47 FAH47
     I                                       48  48 FAH48
     *
     IDSPARA      DS                             47
     I I            0                         1   50NCF92
     I I            0                         6   90NOP92
     I I            0                        10  160SURF
     I I            0                        17  203SF
     I I            0                        21  270MINI
     I I            0                        28  340MAXI
     I                                       35  35 EXP
     I I            0                        36  420SURFF
     I I            0                        44  470NOC92
     *
     IPARMA       DS                             23
     I I            0                         1   10WSTE                  CCS013
     I I            0                         2   50WNOCLI
     I I            0                         6   90WOPRO                 CCS013
     I I            0                        10  140WFACON                CCS013
     I I            0                        15  160WFASEQ                CCS013
     I                                       17  17 WSECT                 CCS013
     I                                       18  18 WSSECT                CCS013
     I                                       19  20 WNOMAC                CCS013
     I I            0                        21  210WEQUIP                CCS013
     I I            0                        22  220WSTOND
     I                                       23  23 CODGOF
     *
     I            DS
     I                                        1  50 PPOBS
     I                                        1   2 PPOB2
     I                                        4  50 PPOB47
     *
     IDSPARM      DS
     I                                        1   8 TBLNOM
     I                                        9  18 TBVAR
     I                                       19  200LG
     I I            ' '                      81  81 FICH
     *
     IF720        DS                             14
     I                                        1   1 US720
     I                                        2   3 SS720
     I                                        4   5 MAC720
     I                                        6  13 DT720
     I                                       14  14 EQ720
     IPARMYZ      DS                             30
     I                                        1   10YZUSIN
     I                                        2   60YZCONF
     I                                        7   80YZSEQ                 CCS013
     I                                        9   90YZISEQ                CCS013
     I                                       10  130YZPRO                 CCS013
     I                                       14  14 YZSECT
     I                                       15  15 YZSSEC
     I                                       16  17 YZMAC
     I                                       18  210YZOPNU                CCS013
     I                                       22  230YZJJ                  CCS013
     I                                       24  250YZMM                  CCS013
     I                                       26  290YZAA                  CCS013
     I                                       30  300YZEQUI                CCS013
     I           IDS
     I                                        1 100 PARBFD                Tmagpi
     I                                        1   10$USI
     I                                        2   60$CONF
     I                                        7   80$SEQ
     I                                        9  120$NOPRO
     I                                       13  16 $RESSO
     I                                       17  200$OPNU
    C*          Rajout TASK0012138 Tmagpi
     I           IDS
     I                                        1  72 PARM37
     I                                        1   10HSTE
     I                                        2   20HUSINE
     I                                        3   70HNCONF
     I                                        8   90HSEQ
     I                                       10  100HISEQ
     I                                       11  11 HSECT
     I                                       12  12 HSSECT
     I                                       13  14 HNOMAC
     I                                       15  15 HAUTHO
     I                                       16  190HNOCLI
     I                                       20  34 HABRCL
     I                                       35  380HNOPRO
     I                                       39  56 HLIBPR
     I                                       57  72 HTITET
    C**
    C******  DEFINITION DES ZONES TRAVAIL
    C**
     C           *LIKE     DEFN RCX       SAVRCX
     C           *LIKE     DEFN DH        SAVDH
     C           *LIKE     DEFN RCD       SAVRCD
     C           *LIKE     DEFN RCX       DERRCX
     C           *LIKE     DEFN DATEQ     SAVDEQ
     C           *LIKE     DEFN PPEQUI    SAVEQ
     C           *LIKE     DEFN LIBEQU    SVLIEQ
     C           *LIKE     DEFN PPEQUI    SVEQUI
     C           *LIKE     DEFN FAEVTY    ZAEVTY
     C           *LIKE     DEFN PPORD     SAVORD
     C           *LIKE     DEFN PPORD     SVORD1
     C           *LIKE     DEFN RCY       SAVRCY
     C           *LIKE     DEFN RCY       SVRCY1
     C           *LIKE     DEFN RCY       DERRCY
     C           *LIKE     DEFN RCY       RCY2
     C           *LIKE     DEFN PPHFIN    TREF
     C           *LIKE     DEFN PPQFEU    TOTFEU
     C           *LIKE     DEFN RCT       SAVRCT
     C           *LIKE     DEFN PPOROB    SAVORB
     C           *LIKE     DEFN PPOBS     SAVOBS
     C           *LIKE     DEFN PPHDEB    SVHDEB
     C           *LIKE     DEFN PPHFIN    SVHFIN
     C           *LIKE     DEFN PPHFIN    SVHFI2
     C           *LIKE     DEFN DATEVE    SVDEVE
     C           *LIKE     DEFN DATEVE    SAVEVE
     C           *LIKE     DEFN PPHDEQ    HDEQ
     C           *LIKE     DEFN PPHFEQ    HFEQ
     C           *LIKE     DEFN PPHDEB    HDEB
     C           *LIKE     DEFN PPHFIN    HFIN
     C           *LIKE     DEFN PPHTIR    TOTTPS
     C           *LIKE     DEFN TOTHRE    SVTHRE
     C           *LIKE     DEFN DATLUE    DATMIN
     C           *LIKE     DEFN DATLUE    DATMAX
     C           *LIKE     DEFN DATLUE    DATJOU
     C           *LIKE     DEFN FAOPST    SVOPST
     C           *LIKE     DEFN TOTBON    SVTBON
     C           *LIKE     DEFN TOTBON    TOTEQ
     C           *LIKE     DEFN TOTBON    TOTEQG
     C           *LIKE     DEFN TOTBON    TOTEQD
     C           *LIKE     DEFN TOTBON    TOTEQ2
     C           *LIKE     DEFN FAEVCO    EVCO
     C           *LIKE     DEFN PPHCAL    SVHCAL
     C           *LIKE     DEFN PPHTIR    SVHTIR
     C           *LIKE     DEFN PPHARR    SVHARR
     C           *LIKE     DEFN PPHPAN    SVHPAN
     C           *LIKE     DEFN PPHFIN    TPSEVE
     C           *LIKE     DEFN PPHFIN    TPSEQ
     C           *LIKE     DEFN PPHFIN    HRFIN
     C           *LIKE     DEFN FATRSP    SVTRSP
     C           *LIKE     DEFN FAOPNU    YYOPNU
     C           *LIKE     DEFN NOCLI     PASCLI
     C           *LIKE     DEFN STE       RRSTE
     C           *LIKE     DEFN NOCLI     RRCLI
     C           *LIKE     DEFN NOPRO     RRPRO
     C           *LIKE     DEFN NOPRO     SVPRO
    C**
    C******  DEFINITION DES CLES
    C**
     C           KEYUSI    KLIST
     C                     KFLD           PXARGU
     C                     KFLD           PXVALE
     C           KCLI01    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C           KIMP2     KLIST
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C           KEYPRO    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C           KCASIE    KLIST
     C                     KFLD           NOFOR
     C                     KFLD           USINE
     C           KEYAMA    KLIST
     C                     KFLD           STE
     C                     KFLD           NOCLI
     C                     KFLD           NOPRO
     C                     KFLD           ORD
     C           KMAC02    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KTRASP    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FATRSP
     C           KCAL01    KLIST
     C                     KFLD           CALJJ
     C                     KFLD           CALMM
     C                     KFLD           CALSS
     C                     KFLD           CALAA
     C           KCAL02    KLIST
     C                     KFLD           CALSS
     C                     KFLD           CALAA
     C                     KFLD           CALMM
     C                     KFLD           CALJJ
     C           KFAB02    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAAA
     C                     KFLD           FAMM
     C                     KFLD           FAJJ
     C           KFAB03    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVCO
     C           KFAB3A    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C           KFAB3B    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVTY
     C                     KFLD           FAEVCO
     C           KFAB3C    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVTY
     C           KFAB3D    KLIST
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           FAEVNO
     C                     KFLD           FAEVCO
     C           KFAB04    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           CMATR
     C           KFAB05    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAAFA
     C                     KFLD           FAMFA
     C                     KFLD           FAJFA
     C                     KFLD           FAHFA
     C                     KFLD           FANOP
     C           KFAB5A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KFAB5B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAAFA
     C                     KFLD           FAMFA
     C                     KFLD           FAJFA
     C                     KFLD           FAHFA
     C           KFAB5C    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFAB5D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C           KFAB09    KLIST
     C                     KFLD           USINE
     C                     KFLD           FANMPC
     C           KFAB10    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           FACBPA
     C                     KFLD           NOBOU
     C           KFA10A    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FATENC
     C                     KFLD           YYOPNU
     C                     KFLD           FACBPA
     C                     KFLD           NOBOU
     C           KFA10B    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FATENC
     C           KFA10C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FA1001
     C                     KFLD           RRSTE
     C                     KFLD           RRCLI
     C                     KFLD           RRPRO
     C                     KFLD           FAASOR
     C                     KFLD           FAMSOR
     C                     KFLD           FAJSOR
     C                     KFLD           FAHSOR
     C                     KFLD           FACBPA
     C                     KFLD           NOBOU
     C           KFA10D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FA1001
     C                     KFLD           RRSTE
     C                     KFLD           RRCLI
     C                     KFLD           RRPRO
     C           KFA10E    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           FACBPA
     C                     KFLD           BOUCH2
     C           KFA10F    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFA10G    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           FA1001
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFAB11    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PAPI
     C                     KFLD           GRAMM
     C                     KFLD           REFOUR
     C                     KFLD           GRAREL
     C                     KFLD           FOUB
     C                     KFLD           FACBPA
     C           KFA11A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           FACBPA
     C                     KFLD           BOUCH2
     C           KFA11B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFA11C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FA1101
     C                     KFLD           PAPI
     C                     KFLD           GRAMM
     C                     KFLD           REFOUR
     C                     KFLD           GRAREL
     C                     KFLD           FAAES
     C                     KFLD           FAMES
     C                     KFLD           FAJES
     C                     KFLD           FAHES
     C                     KFLD           FACBPA
     C                     KFLD           BOUCH2
     C           KFA11D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FA1101
     C                     KFLD           PAPI
     C                     KFLD           GRAMM
     C                     KFLD           REFOUR
     C                     KFLD           GRAREL
     C           KFA11E    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           FA1101
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFAB13    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAEFC
     C                     KFLD           FATENC
     C           KFA13A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FAEFC
     C           KFAB15    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAISEQ
     C                     KFLD           FAOPNU
     C           KFAB16    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA16A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C           KFA16B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA16C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C           KFAB17    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPFAA
     C                     KFLD           PPFMM
     C                     KFLD           PPFJJ
     C                     KFLD           PPORD
     C           KFA17A    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPORD
     C           KFA17B    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPFAA
     C                     KFLD           PPFMM
     C                     KFLD           PPFJJ
     C                     KFLD           PPHDEB
     C                     KFLD           PPHFIN
     C           KFA17C    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C           KFA17D    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPORD
     C           KFAB18    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPCARD
     C           KFAB19    KLIST
     C                     KFLD           USINE
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAOPNU
     C                     KFLD           PPAA
     C                     KFLD           PPMM
     C                     KFLD           PPJJ
     C                     KFLD           PPEQUI
     C                     KFLD           PPOROB
     C           KPREOP    KLIST
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           NOPRO
     C                     KFLD           FAISEQ
     C                     KFLD           FAOPNU
     C           KLAN01    KLIST
     C                     KFLD           FACONF
     C                     KFLD           NOPRO
     C                     KFLD           FASEQ
     C                     KFLD           PRIORI
     C           KEYCDE    KLIST
     C                     KFLD           FACONF
     C                     KFLD           NOPRO
     C                     KFLD           FASEQ
    C** CLE D'ACCES FICHIER CSGCMDL1
     C           KCSG1     KLIST
     C                     KFLD           STE
     C                     KFLD           USINE
     C                     KFLD           FACONF
     C                     KFLD           FASEQ
     C                     KFLD           FAISEQ
     C                     KFLD           SECT
     C                     KFLD           SSECT
     C                     KFLD           NOMAC
    C**
    C**
    C******  RECEPTION DES PARAMETRES
    C**
     C           *ENTRY    PLIST
     C           PASUS     PARM PASUS     PASUS   1
     C           PASPC     PARM PASPC     PASPC  10
     C           PASMAC    PARM PASMAC    PASMAC  4
     C                     MOVE PASUS     USINE
     C                     MOVE PASPC     FANMPC
    C**
    C******  SI USINE = ROCHE,TOURY , NEUVILLE ==> ZONES COMPTEURS
    C******         NON AFFICHABLES  INDICATEUR 30=ON
    C**
D1  C           USINE     IFEQ 2
    C           USINE     OREQ 3
    C           USINE     OREQ 4
     C                     MOVE *ON       *IN30
X1  C                     ELSE
     C                     MOVE *OFF      *IN30
F1  C                     ENDIF
    C**
     C                     EXSR GESFEN
    C**
    C******  SI MACHINE RENSEIGNEE ==> INUTILE CHERCHER MACHINE PAR PC
    C**
D1  C           PASMAC    IFNE *BLANK
     C                     MOVELPASMAC    FAATEL
     C                     MOVE PASMAC    NOMAC
X1  C                     ELSE
     **
     ******  LECTURE DE LA MACHINE GEREE PAR CE TERMINAL DE SAISIE
     **
     C           KFAB09    CHAINXFAB09               99
D2  C           *IN99     IFEQ *ON
     C                     MOVE *ON       *IN03
     C                     EXSR GESFEN
    C                     GOTO FIN
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  LECTURE USINE
    C**
     C                     MOVE 'USDE'    PXARGU
     C                     MOVE USINE     PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C                     MOVE *BLANKS   LIBUS1
     C           KEYUSI    CHAINPARAMEF1             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PXLIBE    LIBUS1
X1  C                     ELSE
     C                     MOVEL'INCONNU' LIBUS1
F1  C                     ENDIF
    C**
    C******  LECTURE SECTION/SS-SECTION
    C**
     C                     MOVE 'SSEC'    PXARGU
     C                     MOVE FAATEL    PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C           KEYUSI    CHAINPARAMEF1             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PXLIBE    LIBAT1
X1  C                     ELSE
     C                     MOVEL'INCONNU' LIBAT1
F1  C                     ENDIF
    C**
    C******  LECTURE MACHINE
    C**
     C           KMAC02    CHAINMACHIN               99
D1  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    TITETE
     C                     MOVEL'INCONNU' TITETE
F1  C                     ENDIF
    C**
    C******  LECTURE CALENDRIER OUVERTURE MACHINE => MAINT.PREV.
    C**
     C                     MOVE *OFF      *IN63
     C                     Z-ADD0         HDMP
     C                     Z-ADD0         HFMP
     C                     EXSR LECSYS
     C                     MOVELSYSA      DATOUV
     C                     MOVEL'20'      SYSC
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      DATOUV
     C           KFAB02    CHAINXFAB02               99
D1  C           *IN99     IFEQ *OFF
    C           FAHRTM    ANDGT0
    C**
     C                     MOVE *ON       *IN63
     C                     Z-ADD0         OO      20
D2  C                     DO   48        OO
D3  C           CALJ,OO   IFEQ 'M'
     C                     LEAVE
F3  C                     ENDIF
F2  C                     ENDDO
    C**
     C                     SUB  1         OO
     C           OO        MULT 0,50      HDMP2   42
     C           HDMP2     ADD  FAHRTM    HFMP2   42
     C                     MOVE HDMP2     DECIM   20
     C           HDMP2     MULT 100       HDMP
D2  C           DECIM     IFEQ 50
     C                     MOVE 30        HDMP
F2  C                     ENDIF
     C                     MOVE HFMP2     DECIM
     C           HFMP2     MULT 100       HFMP
D2  C           DECIM     IFEQ 50
     C                     MOVE 30        HFMP
F2  C                     ENDIF
    C**
F1  C                     ENDIF
    C**
    C******  AFFICHAGE DES OF PLANIFIES POUR CETTE MACHINE
    C**
     C           SSFIC     TAG
     C                     SETOF                     80
     C                     MOVEA'100'     *IN,60
     C                     WRITEF03
     C                     Z-ADD0         RCD
     C                     Z-ADD0         SAVRCD
     C                     Z-ADD0         SAVDH
     C                     Z-ADD0         DH
     C                     SETOF                     60
     C           KFAB05    SETLLXFAB05
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           LAB       TAG
D1  C                     DO   10
     C           LAB1      TAG
     C           KFAB5A    READEXFAB05                 8580
D2  C           *IN80     IFEQ *ON
    C                     GOTO SUITE
F2  C                     ENDIF
    C**
    C******  OP NON DISPO => PAS AFFICHABLE
    C**
    C           FAOPST    CABEQ*BLANK    LAB1
    C**
    C******  LECTURE CLIENT
    C**
     C                     MOVE *BLANK    ABRCLI
D2  C           STE       IFNE 0
     C           KCLI01    CHAINCLIENTS1             99
D3  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' ABRCLI
F3  C                     ENDIF
     **
     ******  LECTURE PRE-IMPRIME STOCKE SI STE=0
     **
X2  C                     ELSE
     C                     CLEARLIBEL
     C           KIMP2     CHAINPREIMP2              99
D3  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' ABRCLI
X3  C                     ELSE
     C                     MOVEL'STOCKE'  ABRCLI
     C                     MOVELDPRIMP    BLOC1
     C                     MOVE REFEXS    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE TVERS     ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE *BLANK    REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  LECTURE PRODUIT
    C**
D2  C           STE       IFNE 0
     C                     CLEARLIBEL
     C           KEYPRO    CHAINPRODAL8              99
D3  C           *IN99     IFEQ *ON
    C**
     C           KIMP2     CHAINPRODSTF2             99
D4  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    LIB20
     C                     MOVEL'INCONNU' LIB20
     C                     MOVE *BLANK    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE *BLANK    ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE *BLANK    REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
X4  C                     ELSE
     C                     MOVE *BLANK    REFEX
     C                     MOVE *BLANK    REFIN
     C                     MOVE *BLANK    ZB16
     C                     Z-ADD0         NOFOR
     C                     MOVE NOGF1     REFGAU
     C                     Z-ADD0         POSF2
     C                     Z-ADD0         ONDL
     C                     Z-ADD0         ONDH
F4  C                     ENDIF
F3  C                     ENDIF
F2  C                     ENDIF
    C**
    C******  RECHERCHE DU NUMERO DE CASIER
    C**
     C                     MOVE *BLANKS   CASIER
     C           KCASIE    CHAINFORMAGF1             99
    C**
D2  C           USINE     IFEQ 3
    C           POSF2     ANDGT0
    C           FAATEL    ANDGE'21'
    C           FAATEL    ANDLT'70'
     C                     MOVE 'A côté :'LIBPO2
X2  C                     ELSE
     C                     MOVE *BLANKS   LIBPO2
F2  C                     ENDIF
    C**
    C******  LECTURE ARTICLE PRODUIT SI AMALGAMME
    C**
     C                     MOVE *BLANKS   REFCO
     C                     MOVE *OFF      *IN56
D2  C           FAORDA    IFNE 0
     C                     MOVE FAORDA    ORD
     C           KEYAMA    CHAINCODBARF1             99
     C                     MOVE *ON       *IN56
X2  C                     ELSE
     C                     MOVE *OFF      *IN56
F2  C                     ENDIF
    C**
    C******  CALCUL QTE DEJA PRODUITE SUR CETTE OP
    C**
     C                     Z-ADD0         TOTBON
     C                     Z-ADD0         INIBON
     C                     Z-ADD0         DATEQ
     C                     Z-ADD0         PPEQUI
     C           KFAB16    SETLLXFAB16
     C           LEC16     TAG
     C           KFA16A    READEXFAB16              N    99
D2  C           *IN99     IFEQ *OFF
     **
     ******  TEST SI EQUIPE EQUIPE TERMINEE => SI OUI LECTURE QTE FABRIQUEE
     **
D3  C           FA1601    IFEQ 'T'
     C                     ADD  PPQFEU    TOTBON
     C                     Z-ADDTOTBON    INIBON
X3  C                     ELSE
     **
     ******  SI EQUIPE EN COURS => CALCUL QTE FABRIQUEE DS FAB10P
     **
     C                     EXSR CALFAB
     C                     ADD  TOTEQ     TOTBON
F3  C                     ENDIF
     **
    C                     GOTO LEC16
F2  C                     ENDIF
    C**
    C******  MISE EN PLACE N° PASSAGE
    C**
     C                     MOVE FAOPNU    PPPAS
D2  C           PPPAS     IFGT 5
     C                     SUB  5         PPPAS
F2  C                     ENDIF
     **
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 Z-ADD1         PPPAS
    C****                 ENDIF
     **
     ******  RECHERCHE SI REPIQUAGE
     ******  OFFSET : OP 6261(1ER PASSAGE) ET 6271 (2EME PASSAGE)
     ******  FLEXO  : OP 3151(1ER PASSAGE) ET 3161 (2EME PASSAGE)
     **
     C                     MOVE 'N'       TAGOK
D2  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
     C                     Z-ADDUSINE     WAUSIN
     C                     Z-ADDFACONF    WACONF
     C                     Z-ADDFASEQ     WASEQ
     C                     Z-ADDFAISEQ    WAISEQ
     C                     Z-ADDNOPRO     WNOPRO
     C                     Z-ADDFAOPNU    WAOPNU
     C                     MOVE 'N'       TAGOK
     C                     CALL 'FAB580£'              85
     C           PARM7     PARM PARM7     PARM7
     **
D3  C           TAGOK     IFEQ 'O'
     C                     Z-ADD2         PPPAS
F3  C                     ENDIF
     **
F2  C                     ENDIF
     **
     ******  SI ROCHECHOUART PASABAN : 1303 EN TANDEM
     ******  SI TANDEM : TAGOK='O'  ET
     ******  INDICATEUR 28=ON ==> CDE EN DSPATR(RI) DANS FORMAT
     **
     C                     MOVE 'N'       T2207
     C                     SETOF                       28
     C                     Z-ADD0         IN28
D2  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D3  C           T2207     IFEQ 'O'
     C                     Z-ADD1         PPPAS
     C                     Z-ADD1         IN28
F3  C                     ENDIF
    C**
F2  C                     ENDIF
     **
     ******  TEST SI COMPLEXEUSE : 2206 EN TANDEM
     ******  SI TANDEM : TAGOK='O'  ET
     ******  INDICATEUR 28=ON ==> CDE EN DSPATR(RI) DANS FORMAT
     **
    C**
    C******  RECUP DU CODE TANDEM DS PREACOP
    C**
     C           KPREOP    CHAINPREACOPF             99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD0         TANDEM
F2  C                     ENDIF
    C**
D2  C           USINE     IFEQ 2
    C           TANDEM    ANDEQ1
    C           FAATEL    ANDEQ'22'
    C           NOMAC     ANDEQ'06'
     C                     Z-ADD1         IN28
F2  C                     ENDIF
    C**
    C******  TEST SI QTE FAB=0 ET OP TERMINEE EN MANUEL => PAS D'AFF
    C**
D2  C           FAOPST    IFEQ 'TR'
    C**         TOTBON    CABEQ0         LAB1
F2  C                     ENDIF
    C**
    C******  LECTURE DES PAPIERS UTILISES
    C**
     C                     Z-ADDUSINE     JAUSIN
     C                     Z-ADDFACONF    JACONF
     C                     Z-ADDFASEQ     JASEQ
     C                     Z-ADDFAISEQ    JAISEQ
     C                     Z-ADDNOPRO     JNOPRO
     C                     Z-ADDFAOPNU    JAOPNU
     C                     CALL 'FAB624L'
     C           PARM11    PARM PARM11    PARM11
     C           PARM12    PARM PARM12    PARM12
     C                     EXSR TESPAP
    C**
    C******  MISE EN PLACE COULEUR SUR ETAT OP
    C**
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
    C**
     C                     ADD  1         RCD
     C                     Z-ADDRCD       SAVRCD
     C                     Z-ADD0         CHOIX
     C                     Z-ADDDH        SAVDH
    C**
     C                     Z-ADDFAJFA     ZAJFA
     C                     Z-ADDFAMFA     ZAMFA
     C                     Z-ADDFAAFA     ZAAFA
    C**
    C*                    Rajout TASK001238 Tmagpi - Détection TY pour consigne
     C                     MOVE '0'       *IN15
D2  C           USINE     IFEQ 3
     C                     MOVE '1'       *IN15            Détection TOURY
     C                     EXSR SRCCSG
F2  C                     END
    C*
     C           IN28      COMP 1                        28
     C                     WRITEF02
F1  C                     ENDDO
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F03
    C**
     C           SUITE     TAG
     C                     WRITEF01
     C                     SETON                     62
     C           RCD       COMP 0                    61
    C**
     C                     EXFMTF03
    C**
    C******  F3=FIN TRAVAIL
    C**
D1  C           *IN03     IFEQ *ON
     C                     EXSR GESFEN
    C                     GOTO FIN
F1  C                     ENDIF
    C**
    C******  F5=REAFFICHAGE
    C**
D1  C           *IN05     IFEQ *ON
    C                     GOTO SSFIC
F1  C                     ENDIF
    C**
    C******  F10=PROGRAMMES ANNEXES (EX=CHARGEMENT POLICES ET FDP)
    C**
D1  C           *IN10     IFEQ *ON
     C                     MOVE PARM6     PAS6
     C                     CALL 'FAB579£'
     C           INDIC1    PARM INDIC1    INDIC1
     C           PAS6      PARM PAS6      PAS6
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C******  F23=BILAN PROVISOIRE DE LA FACTION
    C**
D1  C           *IN23     IFEQ *ON
     C                     MOVE USINE     US720
     C                     MOVE FAATEL    SS720
     C                     MOVE NOMAC     MAC720
     C                     Z-ADD9999      FAAA
     C                     Z-ADD99        FAMM
     C                     Z-ADD99        FAJJ
     C           KFAB02    SETLLFAB16L03
     C           KFAB5A    REDPEFAB16L03                 20
D2  C           *IN20     IFEQ '0'
     C                     MOVE DATEQ     DT720
     C                     MOVE PPEQUI    EQ720
     C                     CALL 'FAB720£'
     C                     PARM           F720
F2  C                     END
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C******  PAGINATION AVANT : DATE SUIVANTE
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN80     IFEQ *OFF
     C                     MOVE SAVDH     DH
     C                     Z-ADDSAVRCD    RCD
     C           KFAB05    SETGTXFAB05
    C                     GOTO LAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCD    RCD
    C                     GOTO SUITE
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER F02
    C**
     C           NEXT      TAG
     C                     READCF02                    8981
    C           *IN89     CABEQ*ON       SUITE
    C           *IN81     CABEQ*ON       SUITE
    C*---------------------------------------------------------------*
    C*       OPTION 2=AFFICHAGE DES EQUIPES SUR OF DEJA LANCE        *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 2
     **
     ******  TEST SI LA COMMANDE EXISTE DS LE CARNET
     ******  OU N'EST PAS UNE SEQUENCE DE FABRICATION
     **
D2  C           FACONF    IFLT 99000
     C           KEYCDE    CHAINCARCDEF1             41
D3  C           *IN41     IFEQ *ON
     C                     Z-ADDNOPRO     SVPRO
     C           KIMP2     CHAINPRODSTF2             41
    C           *IN41     CABEQ*ON       SUITE
     C                     Z-ADDPRODOR    NOPRO
     C           KEYCDE    CHAINCARCDEF1             41
D4  C           *IN41     IFEQ *ON
     C                     Z-ADDSVPRO     NOPRO
    C                     GOTO SUITE
X4  C                     ELSE
     C                     Z-ADDSVPRO     NOPRO
F4  C                     ENDIF
F3  C                     ENDIF
     **
D3  C           QTIMP     IFEQ 0
    C           QTFAC     ANDEQ0
     C                     MOVE *ON       *IN41
    C                     GOTO SUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  TEST SI OP=2206 ET TANDEM CREATION EQUIPE IMPOSSIBLE
     **
    C**
    C******  RECUP DU CODE TANDEM DS PREACOP
    C**
     C           KPREOP    CHAINPREACOPF             99
D2  C           *IN99     IFEQ *ON
     C                     Z-ADD0         TANDEM
F2  C                     ENDIF
D2  C           USINE     IFEQ 2
    C           TANDEM    ANDEQ1
    C           FAATEL    ANDEQ'22'
    C           NOMAC     ANDEQ'06'
    C                     GOTO SUITE
F2  C                     ENDIF
    C**
     **
     ******  TEST SI OP ENCORE PLANIFIEE SUR CETTE MACHINE
     **
     C           KFAB5C    CHAINZFAB05              N99
    C           *IN99     CABEQ*ON       SSFIC
D2  C           SECT      IFNE XSECT
    C           SSECT     ORNE XSSECT
    C           NOMAC     ORNE XNOMAC
    C                     GOTO SSFIC
F2  C                     ENDIF
     **
    C           FAOPST    CABEQ*BLANK    SUITE          40
     C                     Z-ADD0         CHOIX
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C                     EXSR SUIFAB
     C           RCD       CHAINF02                  99
D2  C           *IN99     IFEQ *OFF
     C                     MOVE SVOPST    FAOPST
     C                     Z-ADDSVTBON    TOTBON
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D3  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X3  C                     ELSE
     C                     MOVE *ON       *IN33
F3  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
F2  C                     ENDIF
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 3=EDITION BONS DE FABRICATION                    *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 3
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C                     Z-ADDFACONF    KKCONF
     C                     Z-ADDFASEQ     KKSEQ
     C                     Z-ADDNOPRO     KKPRO
     C                     MOVE '1'       IN95
     C                     CALL 'PLAN53£'
     C           PARMBF    PARM PARMBF    PARMBF
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 5=AFFICHAGE DONNEES PLANIFICATION PREACTOR       *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 5
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C           KFAB5B    CHAINYFAB05               99
     C           FAOPST    CHAINXFAB08               99
     C                     EXFMTF04
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 1=LANCEMENT OF POUR ONDULEUSE 10 TOURY           *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 1
    C           FAOPST    CABEQ'TR'      SUITE          42
     C           KFA16C    CHAINXFA16D              N99
    C           *IN99     CABEQ*OFF      SUITE          42
     C                     EXSR SUIFA2
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
    C                     GOTO SUITE
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 6 = PAPIERS UTILISES                             *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 6
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     **
     C                     Z-ADDUSINE     XZUSI
     C                     Z-ADDFACONF    XZCONF
     C                     Z-ADDFASEQ     XZSEQ
     C                     Z-ADDFAISEQ    XZISEQ
     C                     Z-ADDNOPRO     XZPRO
     C                     MOVE SECT      XZSECT
     C                     MOVE SSECT     XZSSEC
     C                     MOVE NOMAC     XZMAC
     C                     Z-ADDNOPRO     XZPRO
     C                     Z-ADDSTE       XZSTE
     C                     Z-ADDNOCLI     XZCLI
     C                     CALL 'FAB624LA'
     C           PARA0     PARM PARA0     PARA0
     C           PARA1     PARM PARA1     PARA1
     C           PARA2     PARM PARA2     PARA2
     C           PARA3     PARM PARA3     PARA3
     C           PARA4     PARM PARA4     PARA4
     C           PARA5     PARM PARA5     PARA5
     C           PARA6     PARM PARA6     PARA6   4
     C           PARA7     PARM PARA7     PARA7   2
     C                     MOVE PARA6     TYPOND
     C                     MOVE PARA7     TYPCOL
     **
     ******  AJUSTEMENT LIBELLE PRE-IMPRIME STOCKE
     **
     C                     MOVEAPRE1      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE1
     C                     MOVEAPRE3      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE3
     C                     MOVEAPRE5      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE5
     **
     C                     EXFMTF93A
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 7=SUIVI OF   ==> NON AUTORISÉ                    *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 7
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C                     MOVE CDE       PASCDE
     C                     CALL 'FAB610£'
     C           PASCDE    PARM PASCDE    PASCDE
F1  C                     ENDIF
    C*---------------------------------------------------------------*
    C*       OPTION 8=OUTILLAGE                                      *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 8
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C                     EXFMTF94
F1  C                     ENDIF
    C* Rajout SD915319 TOURY
    C*---------------------------------------------------------------*
    C*       OPTION 9=BON FAB DEMATERIALISE                          *
    C*---------------------------------------------------------------*
D1  C           CHOIX     IFEQ 9
     C                     Z-ADD0         CHOIX
     **
     ******  MISE EN PLACE COULEUR SUR ETAT OP   INDICATEUR:33
     ******  INVERSION COMMANDE SI TANDEM        INDICATEUR:28
     **
D2  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X2  C                     ELSE
     C                     MOVE *ON       *IN33
F2  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
     C                     Z-ADDUSINE     $USI
     C                     Z-ADDFACONF    $CONF
     C                     Z-ADDFASEQ     $SEQ
     C                     Z-ADDNOPRO     $NOPRO
     C                     MOVE NOMAC     $RESSO
     C                     MOVELFAATEL    $RESSO
     C                     Z-ADDFAOPNU    $OPNU
     C                     CALL 'FAB810L'
     C           PARBFD    PARM PARBFD    PARBFD
F1  C                     ENDIF
    C**
    C* Rajout TASK0012138 Tmagpi  ------------------------------------------
    C******  OPTION V=CSG ou C=CSG => Créate ou Visu des consignes sur cette
    C*                                cmde (Demande D.Bouny - Toury))
    C**
    C*  SEULEMENT CONSIGNES EN VISU CAR ZONE CHOIX EST NUMERIQUE ET SEULE
    C*  OPTION 4 EST DISPONIBLE
    C**
D1  C           USINE     IFEQ 3                             Toury
D2  C           CHOIX     IFEQ 4                             Visu consigne
     C                     MOVE '0'       *IN13
    C*                    Z-ADD0         CHOIX
     C                     Z-ADDSTE       HSTE
     C                     Z-ADDUSINE     HUSINE
     C                     Z-ADDFACONF    HNCONF
     C                     Z-ADDFASEQ     HSEQ
     C                     Z-ADDFAISEQ    HISEQ
     C                     MOVELFAATEL    HSECT
     C                     MOVE FAATEL    HSSECT
     C                     MOVE NOMAC     HNOMAC
    C*                    MOVE CHOIX     HAUTHO
D3  C           CHOIX     IFEQ 4                             Visu consigne
     C                     MOVE 'V'       HAUTHO
F3  C                     ENDIF
     C                     Z-ADDNOCLI     HNOCLI
     C                     MOVE ABRCLI    HABRCL
     C                     Z-ADDNOPRO     HNOPRO
     C                     MOVELLIB20     HLIBPR
     C                     MOVE TITETE    HTITET
    C*
     C                     CALL 'FAB537£'
     C                     PARM           PARM37
D3  C           HAUTHO    IFEQ 'N'
    C*                    Option autorisée aux seuls chefs d'équipe
     C                     MOVE '1'       *IN13
    C                     GOTO SUITE
F3  C                     ENDIF
     C                     Z-ADD0         CHOIX
     C                     EXSR SRCCSG
D3  C           FAOPST    IFEQ 'DI'
     C                     MOVE *OFF      *IN33
X3  C                     ELSE
     C                     MOVE *ON       *IN33
F3  C                     ENDIF
     **
     C           IN28      COMP 1                        28
     C           IN74      COMP 1                        74
     C           IN75      COMP 1                        75
     C           IN76      COMP 1                        76
     C           IN77      COMP 1                        77
     C           IN78      COMP 1                        78
     C           IN79      COMP 1                        79
     C                     UPDATF02
    C*
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C                     GOTO NEXT
    C**
     C           FIN       TAG
     C                     MOVE '1'       *INLR
    C*****************************************************************
    C*                                                               *
    C*       SR : AFFICHAGE CARNET DE COMMANDE                       *
    C*                                                               *
    C*****************************************************************
    C           CARNET    BEGSR
     C                     MOVE '1'       ZONE95
     C                     MOVE STE       YYSTE
     C                     MOVE FACONF    DSCNF
     C                     MOVE NOCLI     YYCLI
    C**
    C******  TEST SI AFFICHE => COMMANDE SUR PRODUIT ORIGINE
    C**
     C           KIMP2     CHAINPRODSTF2             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE PRODOR    DSPRO
X1  C                     ELSE
     C                     MOVE NOPRO     DSPRO
F1  C                     ENDIF
    C**
     C                     CALL 'CDEC20L'
     C           DSCOMM    PARM DSCOMM    DSCOMM
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : AFFICHAGE DES EQUIPES SUR L'OP CHOISIE             *
    C*                                                               *
    C*****************************************************************
    C           SUIFAB    BEGSR
     C           FAOPST    CHAINXFAB08               99
     C                     MOVE *BLANKS   LIBETA
     C                     MOVEL'BILAN OP'LIBETA
    C**
     C           XSFIC     TAG
     C                     SETOF                     90
     C                     MOVEA'100'     *IN,70
     C                     WRITEF07
     C                     Z-ADD0         RCX
     C                     Z-ADD0         SAVRCX
     C                     Z-ADD0         DERRCX
     C                     Z-ADD0         DATEQ
     C                     Z-ADD0         PPEQUI
     C                     Z-ADD0         SAVDEQ
     C                     Z-ADD0         SAVEQ
    C**
     C                     Z-ADD0         TOTCAL
     C                     Z-ADD0         TOTROU
     C                     Z-ADD0         TOTARR
     C                     Z-ADD0         TOTBON
     C                     Z-ADD0         TOTREB
     C                     Z-ADD0         TOTCAD
    C**
     C                     SETOF                     70
     C           KFAB16    SETLLXFAB16
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           XAB       TAG
     C           KFA16A    READEXFAB16              N  8590
D1  C           *IN90     IFEQ *ON
D2  C           RCX       IFGT 0
     C                     Z-ADD1         RCX
F2  C                     ENDIF
    C                     GOTO XUITE
F1  C                     ENDIF
     **
     C                     ADD  1         RCX
     C                     Z-ADDRCX       SAVRCX
     C                     Z-ADDRCX       DERRCX
     C                     Z-ADD0         CHOIX2
     C                     Z-ADDDATEQ     SAVDEQ
     C                     Z-ADDPPEQUI    SAVEQ
     C                     ADD  PPHCAL    TOTCAL
     C                     ADD  PPHTIR    TOTROU
     C                     ADD  PPHARR    TOTARR
     **
D1  C           FA1601    IFEQ 'T'
     C                     Z-ADDPPQFEU    PPQBON
D2  C           PPHTIR    IFNE 0
     C           PPQBON    DIV  PPHTIR    CADENC    H
X2  C                     ELSE
     C                     Z-ADD0         CADENC
F2  C                     ENDIF
     C           PPQFMA    ADD  PPGACA    PPQREB
     C                     ADD  PPQFEU    TOTBON
     C                     ADD  PPQFMA    TOTREB
     C                     ADD  PPGACA    TOTREB
D2  C           TOTROU    IFNE 0
     C           TOTBON    DIV  TOTROU    TOTCAD    H
X2  C                     ELSE
     C                     Z-ADD0         TOTCAD
F2  C                     ENDIF
X1  C                     ELSE
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     PPQBON
D2  C           PPHTIR    IFNE 0
     C           PPQBON    DIV  PPHTIR    CADENC    H
X2  C                     ELSE
     C                     Z-ADD0         CADENC
F2  C                     ENDIF
     C                     Z-ADDTOTEQ2    PPQREB
     C                     ADD  TOTEQ     TOTBON
D2  C           TOTROU    IFNE 0
     C           TOTBON    DIV  TOTROU    TOTCAD    H
X2  C                     ELSE
     C                     Z-ADD0         TOTCAD
F2  C                     ENDIF
     C                     ADD  TOTEQ2    TOTREB
F1  C                     ENDIF
     **
     ****** EST-CE QUE LE TRAVAIL EST COMMENCE?
     **
D1  C           FA1601    IFNE 'T'
     C           KFAB16    CHAINXFAB17              N99
D2  C           *IN99     IFEQ *OFF
     C                     MOVE 'E'       FA1601
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ****** L'OP EST ELLE INTERROMPUE?
     **
D1  C           PPTFIN    IFEQ 'I'
    C           FA1603    OREQ 'I'
     C                     MOVE 'I'       STOP
X1  C                     ELSE
     C                     MOVE *BLANK    STOP
F1  C                     ENDIF
     **
     ****** LECTURE NOM CONDUCTEUR DS FAB04P
     **
     C                     MOVE *BLANK    NOMPRE
     C           KFAB04    CHAINXFAB04               99
D1  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' NOMPRE
F1  C                     ENDIF
     **
     C                     WRITEF06
    C                     GOTO XAB
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F07
    C**
     C           XUITE     TAG
    C**
    C****** RECHERCHE NATURE DE CDE CLIENT ET CODE DE GESTION DE L'OF
    C**
     C                     MOVE *BLANK    NATCDE
     C                     MOVEL*BLANKS   LNATCD
     C                     MOVE '0'       *IN22
     C                     Z-ADDSTE       WSTE
     C                     Z-ADDNOCLI     WNOCLI
     C                     Z-ADDNOPRO     WOPRO
     C                     Z-ADDFACONF    WFACON
     C                     Z-ADDFASEQ     WFASEQ
     C                     MOVE SECT      WSECT
     C                     MOVE SSECT     WSSECT
     C                     MOVE NOMAC     WNOMAC
     C                     Z-ADDSAVEQ     WEQUIP
     C                     Z-ADD0         WSTOND
     C                     MOVE *BLANK    CODGOF
     C                     MOVE *BLANKS   LCODGO
     C                     CALL 'FAB015£'
     C                     PARM           PARMA
     C                     MOVE 'NCDE'    PXARGU
     C                     MOVE WSTOND    PXVALE    P
     C           KEYUSI    CHAINPARAME               99
D1  C           *IN99     IFEQ '0'
     C                     MOVE PXVALE    NATCDE
     C                     MOVELPXLIBE    LNATCD
X1  C                     ELSE
     C                     MOVE '1'       *IN22
F1  C                     ENDIF
     *
D1  C           CODGOF    IFNE *BLANK
     C                     MOVE 'CGES'    PXARGU
     C                     MOVE CODGOF    PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             99
D2  C           *IN99     IFEQ '0'
     C                     MOVELPXLIBE    LCODGO
F2  C                     ENDIF
F1  C                     ENDIF
     *
     C                     MOVE '0'       *IN21
D1  C           CODGOF    IFNE 'D'
     C                     MOVE '1'       *IN21
F1  C                     ENDIF
    C**
    C******  RECHERCHE MINI MAXI
    C**
     C                     EXSR MINMAX
     *
     C                     WRITEF05
     C                     SETON                     72
     C           RCX       COMP 0                    71
     C                     EXFMTF07
    C**
D1  C           *IN12     IFEQ *ON
     C                     Z-ADDTOTBON    SVTBON
     C                     MOVE FAOPST    SVOPST
    C                     GOTO SUIFAF
F1  C                     ENDIF
    C**
    C****** F1=ECRAN AIDE
    C**
D1  C           *IN01     IFEQ *ON
     C                     EXFMTF09
    C                     GOTO XUITE
F1  C                     ENDIF
    C**
    C****** F6=CREATION NOUVELLE EQUIPE => TEST STATUS OP SI POSSIBLE
    C******    SI EQUIPE PRECEDENTE NON TERMINEE => NLLE EQUIPE IMPOSSIBLE
    C**
D1  C           *IN06     IFEQ *ON
    C           FAOPST    CABEQ'TR'      XUITE          40
     **
D2  C           FAOPST    IFNE 'DI'
    C           FAOPST    ANDNE'EC'
    C           FAOPST    ANDNE'IN'
     C                     MOVE *ON       *IN41
    C                     GOTO XUITE
F2  C                     ENDIF
     **
D2  C           DERRCX    IFGT 0
     C           DERRCX    CHAINF06                  99
D3  C           *IN99     IFEQ *OFF
    C           FA1601    CABNE'T'       XUITE      4242
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  TEST SI TRAVAIL EST EN COURS SUR LA MACHINE => AVERTISSEM
     ******  TERMINER ARBITRAIREMENT LE TRAVAIL SUR L'EQUIPE TROUVEE
     **
     C           KFA16C    CHAINXFA16D               99
D2  C           *IN99     IFEQ *OFF
     C                     EXFMTF17
D3  C           *IN12     IFEQ *ON
     C                     UNLCKFAB16L06
    C                     GOTO XUITE
F3  C                     ENDIF
     C                     MOVE 'T'       TA1601
     C                     MOVE 'T'       TA1602
     C                     EXCPTMAJ16D
F2  C                     ENDIF
     **
     C                     EXSR CREEQ
    C           *IN12     CABEQ*ON       XUITE
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
     C                     MOVE *OFF      *IN38
     C                     MOVE *BLANK    LIBFIN
     C                     EXSR OPERA
    C           *IN10     CABEQ*ON       SSFIC
    C           *IN11     CABEQ*ON       XSFIC
    C                     GOTO XSFIC
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER F06
    C**
     C           XEXT      TAG
     C                     READCF06                    8981
    C           *IN89     CABEQ*ON       XUITE
    C           *IN81     CABEQ*ON       XSFIC
    C**
    C******  OPTION 1=SAISIE DES EVENEMENTS SUR UNE OP
    C******  SI EQUIPE TERMINEE : VISUALISATION UNIQUEMENT
    C**
D1  C           CHOIX2    IFEQ 1
     C                     Z-ADD0         CHOIX2
     C                     UPDATF06
     C           KFAB16    CHAINXFAB16              N99
     **
     ******  EQUIPE TERMINEE MAIS INTERROMPUE => REPRISE POSSIBLE
     ******  SUR LA DERNIERE EQUIPE LE MEME JOUR
     ******  DEPOINTAGE MATIERES,EVENEMENTS DS FAB16P + ETAT OP DS FAB05P
     **
D2  C           FA1601    IFEQ 'T'
D3  C           PPTFIN    IFEQ 'I'
    C           RCX       ANDEQDERRCX
    C           DATEQ     ANDEQ*DATE
     **
     ******  TEST SI TRAVAIL EST EN COURS SUR LA MACHINE => IMPOSSIBLE
     **
     C           KFA16C    CHAINXFA16D               99
D4  C           *IN99     IFEQ *OFF
     C                     EXFMTF17
    C                     GOTO XUITE
F4  C                     ENDIF
     **
     ******  ECRAN DE CONFIRMATION DE REPRISE DU TRAVAIL              05P
     **
     C                     EXFMTF97
    C           *IN12     CABEQ*ON       XUITE
     **
     C                     MOVE LIBF,3    LIBFIN
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
     C           KFAB16    CHAINXFAB16               99
D4  C           *IN99     IFEQ *OFF
     C                     MOVE *BLANK    FA1601
     C                     MOVE *BLANK    FA1602
     C                     EXCPTMAJ16
F4  C                     ENDIF
     C           KFAB5C    CHAINZFAB05               99
D4  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      FAOPST
     C           FAOPST    CHAINXFAB08               99
     C                     EXCPTMAJ05
F4  C                     ENDIF
X3  C                     ELSE
     C                     MOVE LIBF,1    LIBFIN
     C                     MOVE *ON       *IN35
     C                     MOVE *ON       *IN39
F3  C                     ENDIF
X2  C                     ELSE
     C                     MOVE *BLANK    LIBFIN
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
F2  C                     ENDIF
     **
D2  C           PPHFRE    IFGT 0
     C                     MOVE *ON       *IN38
     C                     MOVE LIBF,2    LIBFIN
X2  C                     ELSE
     C                     MOVE *OFF      *IN38
F2  C                     ENDIF
     C                     EXSR OPERA
    C           *IN10     CABEQ*ON       SSFIC
    C           *IN11     CABEQ*ON       XSFIC
    C                     GOTO XSFIC
F1  C                     ENDIF
    C**
    C******  OPTION 4=SUPPRESSION EQUIPE SLT SI NON COMMENCEE
    C**
D1  C           CHOIX2    IFEQ 4
    C           FA1601    CABNE*BLANK    XUITE      4343
    C**  TEST SI RIEN N'A ÉTÉ FAIT AUX MATIERES
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFAB16    CHAINXFAB10               99
     C   99      KFAB16    CHAINZFAB10               99
     C                     MOVE *BLANKS   PAPI
     C                     Z-ADD0         GRAMM
     C                     MOVE *BLANKS   REFOUR
     C                     Z-ADD0         GRAREL
     C                     MOVE *BLANKS   FOUB
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         BOUCH2
     C   99      KFAB16    CHAINXFAB11               99
     C   99      KFAB16    CHAINZFAB11               99
    C**
D2  C           *IN99     IFEQ *OFF
     C                     SETON                     43
    C                     GOTO XUITE
F2  C                     ENDIF
    C**
     C           KFAB16    CHAINXFAB16               99
D2  C           *IN99     IFEQ *OFF
     C                     DELETXFAB16
    C                     GOTO XSFIC
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C                     GOTO XEXT
    C           SUIFAF    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : AJOUT D'UNE NOUVELLE EQUIPE SUR L'OP               *
    C*                                                               *
    C*****************************************************************
    C           CREEQ     BEGSR
    C**
     C                     MOVE TM,1      MODE
     C                     MOVE *OFF      *IN48
    C**
    C******  MISE EN PLACE LIBELLE : N° EQUIPE OU N° PERIODE SELON USINE
    C**
D1  C           USINE     IFEQ 7
     C                     MOVE LIBP,1    LIBPER
X1  C                     ELSE
     C                     MOVE LIBP,2    LIBPER
F1  C                     ENDIF
    C**
    C******  RECHERCHE DES DATES POSSIBLES POUR UNE NOUVELLE EQUIPE
    C******  DATE DU JOUR OU DATE VEILLE SI EQUIPE DE NUIT
    C**
     C                     Z-ADD*DATE     DATMAX
     C                     Z-ADD*DATE     DATLUE
     C           KCAL02    SETLLCALENDZ1
     C                     READPCALENDZ1                 99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDDATLUE    DATMIN
X1  C                     ELSE
     C                     Z-ADD0         DATMIN
F1  C                     ENDIF
     C                     Z-ADDUSINE     XXUSIN
     C                     Z-ADDFACONF    XXCONF
     C                     Z-ADDFASEQ     XXSEQ
     C                     Z-ADDFAISEQ    XXISEQ
     C                     Z-ADDNOPRO     XXPRO
     C                     Z-ADD0         XXEQU
     C                     Z-ADD*YEAR     XXAA
     C                     Z-ADDUMONTH    XXMM
     C                     Z-ADDUDAY      XXJJ
     C                     Z-ADD0         XXHDEQ
     C                     Z-ADD0         XXHFEQ
     C                     Z-ADD0         XXMAT
     C                     Z-ADD0         XXEFC
     C                     Z-ADD0         XXEFR
     C                     Z-ADD0         XXCTR1
     C                     Z-ADD0         XXCTR2
     C                     MOVE SECT      XXSEC
     C                     MOVE SSECT     XXSSEC
     C                     MOVE NOMAC     XXMAC
     C                     Z-ADD0         XXEQ11
     C                     MOVE ' '       XXF11
     C                     CALL 'FAB520£B'
     C           PARM5     PARM PARM5     PARM5
     **
     C                     Z-ADDXXEQU     PPEQUI
     C                     Z-ADDXXJJ      PPJJ
     C                     Z-ADDXXMM      PPMM
     C                     Z-ADDXXAA      PPAA
     C                     Z-ADDXXHDEQ    PPHDEQ
     C                     Z-ADDXXHFEQ    PPHFEQ
     C                     Z-ADDXXMAT     CMATR
     C                     Z-ADDXXEFC     PPEFFC
     C                     Z-ADDXXEFR     PPEFFR
     C                     Z-ADDXXCTR1    PPCTR1
     C                     Z-ADDXXCTR2    PPCTR2
    C**
    C******  RECUP DE L'UNITE DE QTE DE L'OP DS PREACOP
    C**
     C                     MOVE FAOPNU    TYPOP   10
D1  C           TYPOP     IFGT 5
    C           TYPOP     ANDLT9
     C                     MOVE '1'       FAOPNU
F1  C                     ENDIF
    C**
     C           KPREOP    CHAINPREACOPF             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE OPUNQT    PPUNIT
X1  C                     ELSE
     C                     MOVE *BLANK    PPUNIT
F1  C                     ENDIF
    C**
     C                     MOVE TYPOP     FAOPNU
    C**
    C******  RECUP : COULEUR, TYPE VERNIS, SECPAP, SUPOR
    C******            ET EFFECTIFS DANS FAB15P
    C**
     C           KFAB15    CHAINXFAB15              N99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDCOULX     PPNCCA
     C                     MOVE VERNIS    PPVERN
D2  C           PPEFFC    IFEQ 0
    C           PPEFFR    ANDEQ0
     C                     Z-ADDOPEFCA    PPEFFC
     C                     Z-ADDOPEFRO    PPEFFR
F2  C                     ENDIF
X1  C                     ELSE
    C**********           MOVE *BLANK    PPUNIT
     C                     MOVE *BLANKS   SECPAP
     C                     MOVE *BLANKS   SUPOR
     C                     MOVE *BLANKS   PPVERN
     C                     Z-ADD0         PPNCCA
     C                     Z-ADD0         PPEFFC
     C                     Z-ADD0         PPEFFR
F1  C                     ENDIF
    C**
    C******  TEST SI PPUNIT NON TROUVEE => PRENDRE FAUNIT DE FAB05P
    C**
D1  C           PPUNIT    IFEQ *BLANK
     C                     MOVE FAUNIT    PPUNIT
F1  C                     ENDIF
     **
     C                     MOVE *BLANK    NOMPRE
D1  C           CMATR     IFNE 0
     C           KFAB04    CHAINXFAB04               99
D2  C           *IN99     IFEQ *ON
     C                     MOVEL'INCONNU' NOMPRE
F2  C                     ENDIF
F1  C                     ENDIF
     **
     C                     Z-ADD0         PPHCAL
     C                     Z-ADD0         PPHTIR
     C                     Z-ADD0         PPHARR
     C                     Z-ADD0         PPHADI
     C                     Z-ADD0         PPHFRE
     C                     MOVE ' '       PPTFIN
     C                     Z-ADD0         PPQFEU
     C                     Z-ADD0         PPQFMA
     C                     Z-ADD0         PPGACA
     C                     Z-ADD0         PPQELI
     C                     MOVE *BLANK    PPDECH
     C                     MOVE *BLANK    PPOR
     C                     MOVE *BLANK    PPGAUF
     C                     MOVE *BLANK    FA1601
     C                     MOVE *BLANK    FA1602
     C                     MOVE *BLANK    FA1603
    C**
     C                     MOVE *OFF      *IN31
     C           CRET2     TAG
     C                     EXFMTF08
    C**
D1  C           *IN12     IFEQ *ON
    C                     GOTO CREF
F1  C                     ENDIF
    C**
    C******  F4=RECHERCHE CONDUCTEUR OU CODE TRAVAIL SPECIAL
    C******     EN FONCTION DU POSITIONNEMENT DANS LA LIGNE
    C**
D1  C           *IN04     IFEQ *ON
     C                     Z-ADDUSINE     ZUSI
     C                     MOVE SECT      ZSECT
     C                     MOVE SSECT     ZSSECT
     C                     MOVE NOMAC     ZNOMAC
     C                     MOVE '10'      LIGNE
     C                     MOVE *BLANKS   POS10  10
     C                     MOVEL'CMATR'   POS10
D2  C           POS2      IFEQ POS10
     C                     MOVE *BLANKS   PAS1
     C                     MOVE P1        PAS3
     C                     MOVE *BLANKS   PAS2
     C                     CALL 'FEN502£'              85
     C           PAS1      PARM PAS1      PAS1
     C           INDIC     PARM INDIC     INDIC
     C           LIGNE     PARM LIGNE     LIGNE
     C           PAS2      PARM PAS2      PAS2
     C           PAS3      PARM PAS3      PAS3
    C**
     C                     MOVE PAS1      CMATR
     C                     MOVE PAS2      NOMPRE
     C                     MOVE *ON       *IN31
     **
     ******  MISE EN PLACE DES HORAIRES EQUIPES STANDARDS
     **
D3  C           PPEQUI    IFGT 0
    C           PPEQUI    ANDLE3
     C                     Z-ADD1         UU      10
     C           USINE     LOKUPTBU,UU                   99
    C           *IN99     CABEQ*OFF      CRET2
     C                     Z-ADDUU        ZZ      20
     C                     SUB  1         ZZ
     C                     MULT 3         ZZ
     C                     ADD  PPEQUI    ZZ
     C                     MOVELTEQ,ZZ    PPHDEQ
     C                     MOVE TEQ,ZZ    PPHFEQ
F3  C                     ENDIF
    C**
X2  C                     ELSE
    C**
     C                     MOVE *BLANKS   PASCOD
     C                     MOVE P1        PASRES
     C                     CALL 'FEN505£'              85
     C           PASRES    PARM PASRES    PASRES  4
     C           PASCOD    PARM PASCOD    PASCOD  2
     C           INDI1     PARM INDI1     INDI1   1
     C           LIGNE     PARM LIGNE     LIGNE   2
     C           NATRAV    PARM NATRAV    NATRAV 30
D3  C           PASCOD    IFNE *BLANKS
     C                     MOVE PASCOD    FATRSP
F3  C                     ENDIF
F2  C                     ENDIF
     **
    C                     GOTO CRET2
F1  C                     ENDIF
    C**
    C******  CONTROLE SAISIES
    C**
     C           CRET3A    TAG
     C                     EXSR CONTRO
    C**
    C           *IN39     CABEQ*ON       CRET2
    C**
    C******  DEMANDE DE CONFIRMATION EN CAS DE SAISIE DU COMPTEUR
    C******  USINE 7 (FEG) SEULEMENT
    C**
D1  C           USINE     IFEQ 7
D2  C           *IN48     IFEQ *OFF
    C           PPCTR1    CABNE0         CRET2      4848
X2  C                     ELSE
     C                     MOVE *OFF      *IN48
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB16P
    C**
     C                     MOVE FAOPNU    PPPAS
D1  C           PPPAS     IFGT 5
     C                     SUB  5         PPPAS
F1  C                     ENDIF
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 Z-ADD1         PPPAS
    C****                 ENDIF
     **
     ******  RECHERCHE SI REPIQUAGE
     ******  OFFSET : OP 6261(1ER PASSAGE) ET 6271 (2EME PASSAGE)
     ******  FLEXO  : OP 3151(1ER PASSAGE) ET 3161 (2EME PASSAGE)
     **
     C                     MOVE 'N'       TAGOK
D1  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
     C                     Z-ADDUSINE     WAUSIN
     C                     Z-ADDFACONF    WACONF
     C                     Z-ADDFASEQ     WASEQ
     C                     Z-ADDFAISEQ    WAISEQ
     C                     Z-ADDNOPRO     WNOPRO
     C                     Z-ADDFAOPNU    WAOPNU
     C                     MOVE 'N'       TAGOK
     C                     CALL 'FAB580£'              85
     C           PARM7     PARM PARM7     PARM7
     **
D2  C           TAGOK     IFEQ 'O'
     C                     Z-ADD2         PPPAS
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : TAGOK='O'
     **
     C                     MOVE 'N'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D2  C           T2207     IFEQ 'O'
     C                     Z-ADD1         PPPAS
F2  C                     ENDIF
    C**
F1  C                     ENDIF
     C                     Z-ADDPPCTR1    PPCTR2
     C                     WRITEXFAB16
    C**
    C******  MAJ FICHIER FAB05P ==> STATUS OPERATION 'EN COURS'
    C**
     C           KFAB5C    CHAINZFAB05               99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      FAOPST
     C           FAOPST    CHAINXFAB08               99
     C                     UPDATZFAB05
     C                     EXSR COMPLX
F1  C                     ENDIF
    C**
    C******  MAJ PRLANC => OFETA = 'EC'
    C**
     C                     Z-ADDPRIOR1    PRIORI
     C           KLAN01    CHAINPRLANCFZ             99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE 'EC'      OFETA
     C                     EXCPTMAJLAN
F1  C                     ENDIF
    C**
    C******  MAJ FAB15P => TRAVAIL SPÉCIAL
    C**
     C                     MOVE FATRSP    SVTRSP
     C           KFAB15    CHAINXFAB15               99
D1  C           *IN99     IFEQ *OFF
     C                     MOVE SVTRSP    FATRSP
     C                     EXCPTMAJ15
F1  C                     ENDIF
    C**
    C******   MAJ EQUIPE POUR LES PALETTES DE PAPIERS
    C******   CONSOMMÉES AVANT QUE L'EQUIPE AVAIT ETE CRÉÉE
    C**
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         BOUCH2
     C           KFA11A    SETLLXFA11B
     C           LEC11B    TAG
     C           KFA11B    READEXFA11B                 8599
    C**
    C******  TEST SI ENREGISTREMENT VERROUILLE
    C**
D1  C           *IN85     IFEQ *ON
     C                     CALL 'FAB609£'
    C                     GOTO LEC11B
F1  C                     ENDIF
    C**
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPAA      PPAA11
     C                     Z-ADDPPMM      PPMM11
     C                     Z-ADDPPJJ      PPJJ11
     C                     Z-ADDPPEQUI    PPEQ11
     C                     EXCPTMAJ11
    C                     GOTO LEC11B
F1  C                     ENDIF
    C**
    C******   MAJ EQUIPE POUR LES PALETTES D'IMPRIMÉS
    C******   CONSOMMÉES AVANT QUE L'EQUIPE AVAIT ETE CRÉÉE
    C**
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFA10E    SETLLXFA10B
     C           LEC10B    TAG
     C           KFA10F    READEXFA10B                   99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPAA      PPAA11
     C                     Z-ADDPPMM      PPMM11
     C                     Z-ADDPPJJ      PPJJ11
     C                     Z-ADDPPEQUI    PPEQ11
     C                     EXCPTMAJ10
    C                     GOTO LEC10B
F1  C                     ENDIF
    C           CREF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CONTROLE DONNEES EQUIPE                            *
    C*                                                               *
    C*****************************************************************
    C           CONTRO    BEGSR
    C**
    C******  INITIALISATION INDICATEUR ERREUR
    C**
     C                     MOVE *ON       *IN39
    C**
D1  C           PPEQUI    IFEQ 0
    C           PPEQUI    ORGT 3
     C                     MOVE *ON       *IN40
    C                     GOTO CONTF
F1  C                     ENDIF
    C**  TEST SI EQUIPE SAISIE EST DIFFERENTE DE L'EQUIPE PRECEDENTE
    C**  DANS LE CAS OU CELLE-CI S'EST TERMINÉE PAR F11
D1  C           XXF11     IFEQ 'T'
    C           PPEQUI    ANDEQXXEQ11
     C                     MOVE *ON       *IN41
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
     C           KFAB04    CHAINXFAB04               42
    C           *IN42     CABEQ*ON       CONTF
    C**
     C                     Z-ADDPPJJ      CALJJ
     C                     Z-ADDPPMM      CALMM
     C                     MOVELPPAA      CALSS
     C                     MOVE PPAA      CALAA
     C           KCAL01    CHAINCALENDF1             43
    C           *IN43     CABEQ*ON       CONTF
    C**
     C                     TIME           HREDTE 140
     C                     MOVE HREDTE    NEWDAT  80
D1  C           DATEQ     IFNE DATMIN
    C           DATEQ     ANDNEDATMAX
    C           DATEQ     ANDNENEWDAT
     C                     MOVE *ON       *IN43
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
    C           PPHDEQ    CABEQ0         CONTF        4444
    C           PPHFEQ    CABEQ0         CONTF        4545
    C**
D1  C           PPHDEQ    IFNE 0
     C                     MOVE PPHDEQ    MN      20
     C                     MOVELPPHDEQ    HR      20
    C           HR        CABGT24        CONTF      44
    C           MN        CABGT59        CONTF      44
    C           PPHDEQ    CABLT100       CONTF        44
F1  C                     ENDIF
    C**
D1  C           PPHFEQ    IFNE 0
     C                     MOVE PPHFEQ    MN
     C                     MOVELPPHFEQ    HR
    C           HR        CABGT24        CONTF      45
    C           MN        CABGT59        CONTF      45
    C           PPHFEQ    CABLT100       CONTF        45
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 3
    C           PPHFEQ    CABGTPPHDEQ    CONTF      44
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 1
    C           PPEQUI    OREQ 2
    C           PPHFEQ    CABLTPPHDEQ    CONTF        45
     **
     C                     EXSR LECSYS
     C                     MOVELSYSA      DATJOU
     C                     MOVEL'20'      SYSC    4
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      DATJOU
    C           DATEQ     CABNEDATJOU    CONTF      4343
F1  C                     ENDIF
    C**
    C******  TEST SI UN EFFECTIF A ÉTÉ SAISI
    C**
D1  C           PPEFFC    IFEQ 0
    C           PPEFFR    ANDEQ0
     C                     SETON                     47
    C                     GOTO CONTF
F1  C                     ENDIF
    C**
    C******  TEST SI MEME EQUIPE DEJA EXISTANTE SUR CETTE OP
    C**
     C           KFAB16    CHAINXFA16C               99
    C           *IN99     CABEQ*OFF      CONTF          41
    C**
    C******  TEST SI LE CODE SPECIAL EST EXISTANT
    C**
D1  C           FATRSP    IFNE *BLANKS
     C           KTRASP    CHAINTRASPEF1             49
    C           *IN49     CABEQ*ON       CONTF
F1  C                     ENDIF
    C**
    C******  AUCUNE ERREUR DETECTEE
    C**
     C                     MOVE *OFF      *IN39
    C**
    C           CONTF     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : GESTION DES OPERATIONS FABRICATION                 *
    C*                                                               *
    C*****************************************************************
    C           OPERA     BEGSR
     C                     MOVE *OFF      *IN98
    C**
    C******  CALCUL QTE FABRIQUEE SUR LE TRAVAIL EN COURS
    C**
     C                     Z-ADD0         TOTENC
     C                     EXSR CALFAB
D1  C           FAATEL    IFNE '82'
     C                     Z-ADDTOTEQ     TOTENC
X1  C                     ELSE
     C                     Z-ADDPPQBON    TOTENC
F1  C                     ENDIF
    C**
    C******  RECHERCHE DES EVENEMENTS DEJA EXECUTEES SUR CETTE EQUIPE
    C**
     C                     Z-ADDPPEQUI    P       10
     C                     MOVE EQ,P      LIBEQU
    C**
     C           OSFIC     TAG
     C                     MOVEA'100'     *IN,65
     C                     WRITEF12
     C                     Z-ADD0         RCY
     C                     Z-ADD0         DERRCY
     C                     Z-ADD0         SAVRCY
     C                     Z-ADD0         PPORD
     C                     Z-ADD0         SAVORD
     C                     Z-ADD0         DATEVE
     C                     Z-ADD0         SAVEVE
     C                     Z-ADD0         TOTHRE
     C                     Z-ADD0         TMN4
    C**
     C                     Z-ADD0         SIMUHD
     C                     Z-ADD0         SIMUHF
     C                     Z-ADD0         SIMUDT
    C**
     C                     SETOF                     65
     C           KFAB17    SETLLXFAB17
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER F11
    C**
     C           OAB       TAG
     C           KFAB16    READEXFAB17                 9368
D1  C           *IN68     IFEQ *ON
     **
     ****** SI EQUIPE TERMINEE OU COMMENCEE => POSITION EN DEBUT SSFIC
     **
D2  C           FA1601    IFNE *BLANK
    C           RCY       ANDGT0
     C                     Z-ADD1         RCY
F2  C                     ENDIF
     **
     ******  TEST SI OBSERVATIONS SAISIES
     **
     C                     MOVE *OFF      *IN48
D2  C           FA1601    IFEQ 'T'
     C           KFAB16    CHAINXFAB19              N48
F2  C                     ENDIF
     **
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C           *IN93     CABEQ*ON       OAB
     C           KFAB03    CHAINXFAB03               99
    C**
D1  C           PPHFIN    IFNE 0
     C                     EXSR TEMPS
F1  C                     ENDIF
    C**
     C                     ADD  1         RCY
     C                     Z-ADDRCY       SAVRCY
     C                     Z-ADDRCY       DERRCY
     C                     Z-ADDPPORD     SAVORD
    C**
    C****** ZONE H.DEBUT ET H.FIN PROTEGEE SI RENSEIGNEE
    C**
     C                     MOVE *OFF      *IN29
D1  C           PPHDEB    IFNE 0
    C           PPHFIN    ANDNE0
     C                     MOVE *ON       *IN29
F1  C                     ENDIF
    C**
     C                     WRITEF11
    C                     GOTO OAB
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F12
    C**
     C           OUITE     TAG
    C**
    C******  RECALCUL DES QTES PRODUITES
    C**
     C                     Z-ADD0         TOTENC
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     TOTENC
    C**
D1  C           *IN39     IFEQ *OFF
     C           INIBON    ADD  TOTENC    TOTBON
X1  C                     ELSE
     C                     Z-ADDINIBON    TOTBON
F1  C                     ENDIF
    C**
    C****** RECHERCHE NATURE DE CDE CLIENT ET CODE DE GESTION DE L'OF
    C**
     C                     MOVE *BLANK    NATCDE
     C                     MOVEL*BLANKS   LNATCD
     C                     MOVE '0'       *IN22
     C                     Z-ADDSTE       WSTE
     C                     Z-ADDNOCLI     WNOCLI
     C                     Z-ADDNOPRO     WOPRO
     C                     Z-ADDFACONF    WFACON
     C                     Z-ADDFASEQ     WFASEQ
     C                     MOVE SECT      WSECT
     C                     MOVE SSECT     WSSECT
     C                     MOVE NOMAC     WNOMAC
     C                     Z-ADDPPEQUI    WEQUIP
     C                     Z-ADD0         WSTOND
     C                     MOVE *BLANK    CODGOF
     C                     MOVE *BLANKS   LCODGO
     C                     CALL 'FAB015£'
     C                     PARM           PARMA
     C                     MOVE 'NCDE'    PXARGU
     C                     MOVE WSTOND    PXVALE    P
     C           KEYUSI    CHAINPARAME               99
D1  C           *IN99     IFEQ '0'
     C                     MOVE PXVALE    NATCDE
     C                     MOVELPXLIBE    LNATCD
X1  C                     ELSE
     C                     MOVE '1'       *IN22
F1  C                     ENDIF
     *
D1  C           CODGOF    IFNE *BLANK
     C                     MOVE 'CGES'    PXARGU
     C                     MOVE CODGOF    PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             99
D2  C           *IN99     IFEQ '0'
     C                     MOVELPXLIBE    LCODGO
F2  C                     ENDIF
F1  C                     ENDIF
     *
     C                     MOVE '0'       *IN21
D1  C           CODGOF    IFNE 'D'
     C                     MOVE '1'       *IN21
F1  C                     ENDIF
    C**
    C******  RECHERCHE MINI MAXI
    C**
     C                     EXSR MINMAX
    C**
     C                     WRITEF10
     C                     SETON                     67
     C           RCY       COMP 0                    66
     C                     EXFMTF12
    C**
    C******  F12 : ABANDON SAISIE ==> RETOUR AFFICHAGE EQUIPES
    C**
D1  C           *IN12     IFEQ *ON
     C                     Z-ADD0         PPORD
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F1 : MODULE GESTION DES ENCOURS/MATIERES
    C******       INTERRO OU SAISIE SELON ZONE FASCAN DS FAB09P
    C**
D1  C           *IN01     IFEQ *ON
     C                     Z-ADDUSINE     YAUSIN
     C                     MOVE SECT      YSECT
     C                     MOVE SSECT     YSSECT
     C                     MOVE NOMAC     YNOMAC
     C                     Z-ADDFACONF    YACONF
     C                     Z-ADDFASEQ     YASEQ
     C                     Z-ADDFAISEQ    YAISEQ
     C                     Z-ADDSTE       YSTE
     C                     Z-ADDNOCLI     YNOCLI
     C                     Z-ADDNOPRO     YNOPRO
     C                     Z-ADDFAOPNU    YAOPNU
     C                     Z-ADDDATEQ     YATEQ
     C                     Z-ADDPPEQUI    YPEQUI
     **
     C                     MOVE PARM4     PAS4   35
D2  C           FASCAN    IFEQ 'O'
     C                     CALL 'FAB523£'
     C           PAS4      PARM PAS4      PAS4
     C           PASPC     PARM PASPC     PASPC
X2  C                     ELSE
    C*****
    C***** VISU. ENCOURS SUR 1ER ECRAN ==> NON AUTORISÉ SI 2 ÉCRANS
    C*****                CALL 'FAB532£'
    C*****      PAS4      PARM PAS4      PAS4
    C                     GOTO OUITE
F2  C                     ENDIF
     **
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C****** F2=VISU PAPIERS UTILISES
    C**
D1  C           *IN02     IFEQ *ON
     C                     Z-ADDUSINE     XZUSI
     C                     Z-ADDFACONF    XZCONF
     C                     Z-ADDFASEQ     XZSEQ
     C                     Z-ADDFAISEQ    XZISEQ
     C                     Z-ADDNOPRO     XZPRO
     C                     MOVE SECT      XZSECT
     C                     MOVE SSECT     XZSSEC
     C                     MOVE NOMAC     XZMAC
     C                     Z-ADDNOPRO     XZPRO
     C                     Z-ADDSTE       XZSTE
     C                     Z-ADDNOCLI     XZCLI
     C                     CALL 'FAB624LA'
     C           PARA0     PARM PARA0     PARA0
     C           PARA1     PARM PARA1     PARA1
     C           PARA2     PARM PARA2     PARA2
     C           PARA3     PARM PARA3     PARA3
     C           PARA4     PARM PARA4     PARA4
     C           PARA5     PARM PARA5     PARA5
     C           PARA6     PARM PARA6     PARA6   4
     C           PARA7     PARM PARA7     PARA7   2
     C                     MOVE PARA6     TYPOND
     C                     MOVE PARA7     TYPCOL
     **
     ******  AJUSTEMENT LIBELLE PRE-IMPRIME STOCKE
     **
     C                     MOVEAPRE1      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE1
     C                     MOVEAPRE3      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE3
     C                     MOVEAPRE5      PREI
     C                     EXSR LIBPRE
     C                     MOVEAPREI      PRE5
     **
     C                     EXFMTF93A
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F4 : AFFICHAGE SUIVI OF   ==> NON AUTORISÉ
    C**
D1  C           *IN04     IFEQ *ON
    C                     GOTO OUITE
     C                     MOVE CDE       PASCDE 18
     C                     MOVE 'O'       PASAUT  1
     C                     CALL 'FAB521£'
     C           PASCDE    PARM PASCDE    PASCDE
     C           PASAUT    PARM PASAUT    PASAUT
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F5 : AFFICHAGE DU BILAN PRODUCTION
    C**
D1  C           *IN05     IFEQ *ON
     C                     EXSR BILAN
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F6 : CREATION NOUVEL EVENEMENT ET MAJ TEMPS DEBUT
    C**
D1  C           *IN06     IFEQ *ON
D2  C           DERRCY    IFNE 0
     C           DERRCY    CHAINF11                  99
    C           PPHFIN    CABEQ0         OUITE          41
     **
     ******  TREF = HEURE FIN OPERATION N-1 ==> HEURE DEBUT OPER N
     ******  SI REPRISE APRES INTERRUPTION => RECHERCHE HEURE FIN OP PREC
     **
D3  C           PPTFIN    IFEQ 'I'
     C                     EXSR RECTIM
X3  C                     ELSE
     C                     Z-ADDPPHFIN    TREF
F3  C                     ENDIF
     **
     ******  NOUVELLE OP => RECHERCHE HEURE FIN OP PRECEDENTE
     **
X2  C                     ELSE
     C                     EXSR RECTIM
F2  C                     ENDIF
    C**
     C                     EXSR CREOP
    C           *IN12     CABEQ*ON       OUITE
    C                     GOTO OSFIC
F1  C                     ENDIF
    C**
    C******  F7 : SAISIE OBSERVATIONS
    C**
D1  C           *IN07     IFEQ *ON
    C           *IN48     CABEQ*ON       OUITE
     C                     EXSR WINOB
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F8 : SIMULATION D'HORAIRE DEBUT ET FIN EVENEMENT/MAQUETT E
    C**                     ==> NON AUTORISE
    C**
D1  C           *IN08     IFEQ *ON
    C                     GOTO OUITE
     C                     EXFMTF99
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F9 : FIN EVENEMENT : MAJ HEURE DE FIN DS FICHIER FAB17P
    C**
D1  C           *IN09     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          46
     C           DERRCY    CHAINF11                  99
    C           PPHFIN    CABGT0         OUITE      46
     **
     ******  TEST SI HORAIRE EVENEMENT > 20H00 => ERREUR HORAIRE EQUIPE
     **
D2  C           SIMUHF    IFNE 0
     C                     MOVELSIMUHF    HEURE
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     C                     MOVELHEURE     PPHFIN
     **
D2  C           PPEQUI    IFLT 3
D3  C           PPHFIN    IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
D2  C           PPEQUI    IFEQ 3
    C           PPHFIN    ANDLTPPHDEQ
D3  C           PPHFIN    IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
     C           PPHFIN    SUB  PPHDEB    TPSEVE
D2  C           TPSEVE    IFLT 0
     C                     ADD  2400      TPSEVE
F2  C                     ENDIF
     C           PPHFEQ    SUB  PPHDEQ    TPSEQ
D2  C           TPSEQ     IFLT 0
     C                     ADD  2400      TPSEQ
F2  C                     ENDIF
D2  C           TPSEVE    IFGT TPSEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN36
    C                     GOTO OUITE
F2  C                     ENDIF
     **
     C           FINOP     TAG
     C                     EXFMTF15
    C           *IN12     CABEQ*ON       OUITE
     C           DERRCY    CHAINF11                  99
     **
     ******  SI HEURE SIMULATION RENSEIGNEE ==> HEURE SIMULATION
     **
D2  C           SIMUHF    IFNE 0
     C                     Z-ADD0         HEURE
     C                     MOVELSIMUHF    HEURE
     C                     Z-ADD0         SIMUHF
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     **
     C                     MOVELHEURE     PPHF    40
     C                     MOVELHEURE     PPHFIN
D2  C           PPHFIN    IFEQ 0
     C                     Z-ADD2359      PPHFIN
     C                     Z-ADD2359      PPHF
F2  C                     ENDIF
    C**
     C                     UPDATF11
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHF      PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  F10 : FIN DE TRAVAIL SUR UNE OP : SAISIE BILAN
    C**
D1  C           *IN10     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          43
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
    C*********  KFAB16    CHAINXFAB16              N99
    C*********  FA1602    CABNE'T'       OUITE      3737
     **
     ******  TEST SI HORAIRE FIN OP > HORAIARE FIN EQUIPE => FAIRE F11E
     **
D2  C           SIMUHF    IFNE 0
     C                     MOVELSIMUHF    HEURE
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     C                     MOVELHEURE     HRFIN
     **
D2  C           PPEQUI    IFLT 3
D3  C           HRFIN     IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
D2  C           PPEQUI    IFEQ 3
    C           HRFIN     ANDLTPPHDEQ
D3  C           HRFIN     IFGE PPHFEQ
     C                     Z-ADD0         SIMUHF
     C                     MOVE *ON       *IN32
    C                     GOTO OUITE
F3  C                     ENDIF
F2  C                     ENDIF
     **
     C                     EXSR TESHOR
    C           *IN40     CABEQ*ON       OUITE
     C                     EXSR FINEQU
    C           *IN12     CABEQ*ON       OUITE
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F11 : FIN D'EQUIPE ==> SAISIE DU BILAN
    C**
D1  C           *IN11     IFEQ *ON
    C           DERRCY    CABEQ0         OUITE          43
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
    C*******    KFAB16    CHAINXFAB16              N99
    C*******    FA1602    CABNE'T'       OUITE      3737
     **
     C                     EXSR TESHOR
    C           *IN40     CABEQ*ON       OUITE
     C                     EXSR FINEQU
D2  C           *IN12     IFEQ *ON
    C                     GOTO OUITE
F2  C                     ENDIF
     *
     C                     MOVE USINE     US720
     C                     MOVE FAATEL    SS720
     C                     MOVE NOMAC     MAC720
     C                     MOVE DATEQ     DT720
     C                     MOVE PPEQUI    EQ720
     C                     CALL 'FAB720£'
     C                     PARM           F720
     **
     ******  LEAN : IMPRESSION DES BILANS DE FAB PAR FACTION          ONSON)
     **
     C                     MOVE FAATEL    PAZATE
     C                     MOVE NOMAC     PAZMAC
     C                     MOVE DATEQ     PASDTE
     C                     MOVE PPEQUI    PASEQ
     C                     MOVE FANPRT    PASPRT 10
     C                     CALL 'FAB690L'
     C           PASUS     PARM PASUS     PASUS
     C           PAZATE    PARM PAZATE    PAZATE  2
     C           PAZMAC    PARM PAZMAC    PAZMAC  2
     C           PASDTE    PARM PASDTE    PASDTE  8
     C           PASEQ     PARM PASEQ     PASEQ   1
     C           PASPRT    PARM PASPRT    PASPRT
     **
     ******  SI EQUIPE 3 ET FIN EQUIPE => FIN SESSION (CHGT DATE SESSION)
     **
D2  C           PPEQUI    IFEQ 3
     C                     EXSR GESFEN
     C                     SETON                     LR
     C                     RETRN
F2  C                     ENDIF
     **
    C                     GOTO OINF
F1  C                     ENDIF
    C**
    C******  F17 : DEBLOCAGE SAISIE MATIERES/ENCOURS SI DEJA CLOTUREE E
    C**
D1  C           *IN17     IFEQ *ON
     **
     ******  TEST SI LES MATIERES ONT ETE CLOTUREES?
     **
     C           KFAB16    CHAINXFAB16              N99
    C           FA1602    CABNE'T'       OUITE      3434
     C                     EXFMTF96
    C           *IN12     CABEQ*ON       OUITE
     C           KFAB16    CHAINXFAB16               99
     C                     MOVE ' '       FA1602
     C                     EXCPTMAJ16B
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C******  ROLLUP : PAGE AVANT : REMPLISSAGE DU SOUS-FICHIER
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN68     IFEQ *OFF
     C                     Z-ADDSAVORD    PPORD
     C                     Z-ADDSAVEVE    DATEVE
     C                     Z-ADDSAVRCY    RCY
     C           KFAB17    SETGTXFAB17
    C                     GOTO OAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCY    RCY
    C                     GOTO OUITE
F1  C                     ENDIF
    C**
    C****** LECTURE DU SOUS-FICHIER
    C**
     C           OEXT      TAG
     C                     READCF11                    8981
    C           *IN89     CABEQ*ON       OUITE
    C           *IN81     CABEQ*ON       OSFIC
    C**
    C****** MODIFICATION HORAIRES EVENEMENT SI OP NON TERMINEE
    C**
D1  C           *IN35     IFEQ *OFF
     C                     EXSR MODHOR
    C           *IN44     CABEQ*ON       OUITE
    C           *IN45     CABEQ*ON       OUITE
    C           *IN47     CABEQ*ON       OUITE
F1  C                     ENDIF
    C**
    C                     GOTO OEXT
    C**
    C           OINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CREATION D'UN NOUVEL EVENEMENT                     *
    C*                                                               *
    C*****************************************************************
    C           CREOP     BEGSR
    C           *IN98     CABEQ*ON       CRET20
     C                     SETON                     98
     C                     Z-ADDSAVORD    SVORD1
     C                     Z-ADDSAVRCY    SVRCY1
     C                     Z-ADDSAVORD    PPORD
     C                     Z-ADDSAVRCY    RCY
    C**
     C           KFAB17    SETGTXFAB17
D1  C                     DO   *HIVAL
    C**
     C           CRET1     TAG
     C           KFAB16    READEXFAB17              N  9368
    C           *IN68     CABEQ*ON       CRET20
    C           *IN93     CABEQ*ON       CRET1
     C                     ADD  1         RCY
     C                     Z-ADDRCY       DERRCY
     C                     Z-ADDRCY       SAVRCY
     C                     MOVE PPORD     SAVORD
     C                     WRITEF11
F1  C                     ENDDO
    C**
    C******  RECHERCHE EVENEMENT DS FENETRE : SS-PROG WIN01
    C**
     C           CRET20    TAG
     C                     MOVE *BLANKS   FAEVLI
     C                     MOVE *BLANK    ZAEVTY
     C                     EXSR WIN
    C**
D1  C           *IN12     IFEQ *ON
     C                     MOVE SVORD1    PPORD
D2  C           SVRCY1    IFEQ 0
     C                     Z-ADDSAVRCY    RCY
X2  C                     ELSE
     C                     Z-ADDSVRCY1    RCY
F2  C                     ENDIF
    C                     GOTO CREF2
F1  C                     ENDIF
    C**
     C           KFAB03    CHAINXFAB03               99
    C           *IN99     CABEQ*ON       CRET20
    C**
    C******  SI EQUIPE NUIT => DATE FAB=DATE JOUR SINON DATE DEB EQUIP
    C******  ATTENTION AU CAS : HEURE EFFECTIVE=20H58 ET DEBUT EQUIPE
    C******  =21H00 => ON AJOUTE LE TEST HEUR4 < 8H00 MATIN
    C**
     C                     TIME           HEURE   60
     C                     MOVELHEURE     HEUR4   40
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      HEUR4
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 3
D2  C           HEUR4     IFLT PPHDEQ
    C           HEUR4     ANDLT800
     C                     Z-ADDPPJJ      CALJJ
     C                     Z-ADDPPMM      CALMM
     C                     MOVELPPAA      CALSS
     C                     MOVE PPAA      CALAA
     C           KCAL02    SETGTCALENDZ1
     C                     READ CALENDZ1                 99
     C                     Z-ADDDATLUE    DATEVE
X2  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F2  C                     ENDIF
X1  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F1  C                     ENDIF
    C**
    C******  HEURE DEBUT=HEURE REELLE
    C**
     C                     MOVELHEURE     PPHDEB
     C                     Z-ADD0         PPHFIN
    C**
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      PPHDEB
F1  C                     ENDIF
D1  C           PPHDEB    IFEQ 2400
     C                     Z-ADD0         PPHDEB
F1  C                     ENDIF
     **
     ******  SI SIMULATION HEURE DEBUT RENSEIGNEE ==> HEURE SIMULATION
     **
D1  C           SIMUHD    IFNE 0
    C           SIMUDT    ANDNE0
     C                     Z-ADDSIMUHD    PPHDEB
     C                     Z-ADDSIMUDT    DATEVE
     C                     Z-ADD0         SIMUHD
     C                     Z-ADD0         SIMUDT
F1  C                     ENDIF
    C**
    C******  CALCUL DU N° ORDRE EVENEMENT SUR CETTE EQUIPE
    C**
     C                     Z-ADD99        PPORD
     C           KFA17A    SETGTXFA17A
     C           KFAB16    REDPEXFA17A                   99
D1  C           *IN99     IFEQ *ON
     C                     Z-ADD1         PPORD
X1  C                     ELSE
     C                     ADD  1         PPORD
    C           PPORD     CABEQ0         CREF2
F1  C                     ENDIF
    C**
     C                     WRITEXFAB17
    C**
    C******  AJOUT NLLE OPERATION DS SS-FICHIER F11
    C**
     C                     Z-ADDSAVRCY    RCY
     C                     ADD  1         RCY
     C                     Z-ADDRCY       SAVRCY
     C                     Z-ADDRCY       DERRCY
     C                     WRITEF11
     C                     Z-ADDPPORD     SAVORD
    C**
    C           CREF2     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : MODIFICATION DES HORAIRES D'UN EVENEMENT           *
    C*                                                               *
    C*****************************************************************
    C           MODHOR    BEGSR
    C**
    C******  SUPPRESSION EVENEMENT EN COURS==> HEURE DEBUT=HEURE FIN=0
    C**
D1  C           PPHDEB    IFEQ 0
    C           PPHFIN    ANDEQ0
    C**
D2  C           RCY       IFEQ DERRCY
     C           KFA17D    CHAINZFAB17               99
D3  C           *IN99     IFEQ *OFF
     C                     DELETZFAB17
F3  C                     ENDIF
    C                     GOTO MODHOF
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C                     GOTO MODHOF
    C******  MODIFICATION => TEST HEURE DEBUT ET FIN
    C**
     C                     MOVE PPHDEB    MN      20
     C                     MOVELPPHDEB    HR      20
    C           HR        CABGT24        MODHOF     44
    C           MN        CABGT59        MODHOF     44
    C**
     C                     MOVE PPHFIN    MN
     C                     MOVELPPHFIN    HR
    C           HR        CABGT24        MODHOF     45
    C           MN        CABGT59        MODHOF     45
    C**
    C******  MODIFICATION => TEST DATE FABRICATION
    C**
D1  C           DATEVE    IFNE DATEQ
    C**
     C                     Z-ADDPPFJJ     CALJJ
     C                     Z-ADDPPFMM     CALMM
     C                     MOVELPPFAA     CALSS
     C                     MOVE PPFAA     CALAA
     C           KCAL01    CHAINCALENDF1             47
    C           *IN47     CABEQ*ON       MODHOF
    C           DATEVE    CABLTDATEQ     MODHOF       47
F1  C                     ENDIF
    C**
    C******  CONTROLE VRAISEMBLANCE HORAIRES / EQUIPE
    C**
     C                     Z-ADDPPHDEQ    HDEQ
     C                     Z-ADDPPHFEQ    HFEQ
     C                     Z-ADDPPHDEB    HDEB
     C                     Z-ADDPPHFIN    HFIN
D1  C           PPHFEQ    IFLT PPHDEQ
     C           PPHFEQ    ADD  2400      HFEQ
F1  C                     ENDIF
    C**
D1  C           PPHFIN    IFNE 0
     C                     Z-ADDPPHDEB    HDEB
     C                     Z-ADDPPHFIN    HFIN
D2  C           PPHFIN    IFLT PPHDEB
     C           PPHFIN    ADD  2400      HFIN
F2  C                     ENDIF
F1  C                     ENDIF
    C**
D1  C           DATEVE    IFGT DATEQ
     C           PPHDEB    ADD  2400      HDEB
     C           PPHFIN    ADD  2400      HFIN
F1  C                     ENDIF
    C**
D1  C           PPHFIN    IFNE 0
    C           HFIN      CABLTHDEB      MODHOF       45
F1  C                     ENDIF
    C           HDEB      CABLTHDEQ      MODHOF       44
    C           HDEB      CABGTHFEQ      MODHOF     44
    C           HFIN      CABGTHFEQ      MODHOF     45
D1  C           PPHFIN    IFNE 0
    C           HFIN      CABLTHDEQ      MODHOF       45
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB17P
    C**
     C           KFA17D    CHAINZFAB17               99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHDEB    XPHDEB
     C                     Z-ADDPPHFIN    XPHFIN
     C                     Z-ADDDATEVE    XATEVE
     C                     UPDATZFAB17
F1  C                     ENDIF
    C**
    C           MODHOF    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : TEST CONTINUITE EN TEMPS DES EVENEMENTS            *
    C*                                                               *
    C*****************************************************************
    C           TESHOR    BEGSR
    C**
    C******  SI TRAVAIL REPRIS APRES INTERRUPTION => TEST NON EFFECTUE
    C**
    C           PPTFIN    CABEQ'I'       TESHOF
    C**
     C                     MOVE *OFF      *IN40
     C                     MOVE *OFF      *IN96
     C                     Z-ADD0         DATEVE
     C                     Z-ADD0         PPORD
    C**
     C           KFAB17    SETLLXFAB17
     C           TESHO1    TAG
     C           KFAB16    READEXFAB17              N    99
    C**
    C           *IN99     CABEQ*ON       TESHOF
    C**
    C******  1ERE LECTURE
    C**
D1  C           *IN96     IFEQ *OFF
     C                     MOVE *ON       *IN96
     C                     Z-ADDPPHFIN    SVHFIN
    C                     GOTO TESHO1
F1  C                     ENDIF
    C**
D1  C           PPHDEB    IFEQ SVHFIN
     C                     Z-ADDPPHFIN    SVHFIN
    C                     GOTO TESHO1
F1  C                     ENDIF
    C**
    C******  ERREUR DE DISCONTINUITE => *IN40 ON
    C**
     C                     MOVE *ON       *IN40
    C**
     C           TESHOF    TAG
     C                     MOVE *OFF      *IN96
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : CALCUL DIFFERENCE DE TEMPS EN MINUTES                *
    C*                                                               *
    C*****************************************************************
    C           TEMPS     BEGSR
     C                     MOVE PPHDEB    MN
     C                     MOVELPPHDEB    HR
     C           HR        MULT 60        TMN1    40
     C                     ADD  MN        TMN1
     C                     MOVE PPHFIN    MN
     C                     MOVELPPHFIN    HR
     C           HR        MULT 60        TMN2    40
     C                     ADD  MN        TMN2
D1  C           PPHDEB    IFGT PPHFIN
     C                     ADD  1440      TMN2
F1  C                     ENDIF
    C**
    C******  CALCUL DIFFERENCE EN MINUTES : FIN-DEBUT
    C**
     C           TMN2      SUB  TMN1      TMN3    40
     C                     ADD  TMN3      TMN4    40
    C**
    C******  TRANSFORMATION TOTAL MINUTE EN HEURE:MINUTE
    C**
     C           TMN4      DIV  60        HR
     C                     MVR            MN
     C                     MOVELHR        TOTHRE
     C                     MOVE MN        TOTHRE
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : RECHERCHE HEURE DE FIN DU TRAVAIL PRECEDENT        *
    C*                                                               *
    C*****************************************************************
    C           RECTIM    BEGSR
     C                     Z-ADD9999      PPHDEB
     C                     Z-ADD9999      PPHFIN
     C                     Z-ADD99999999  DATEVE
     C                     Z-ADD0         TREF
     C           KFA17B    SETGTYFAB17
     C           LEC17B    TAG
     C           KFA17C    REDPEYFAB17                   99
D1  C           *IN99     IFEQ *OFF
     C                     Z-ADDPPHFIN    TREF
X1  C                     ELSE
     C                     Z-ADDPPHDEQ    TREF
F1  C                     ENDIF
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*  SR : AFFICHAGE FENETRE CHOIX OPERATION FABRICATION/MACHINE   *
    C*                                                               *
    C*****************************************************************
    C           WIN       BEGSR
     C                     MOVE *BLANK    FAEVCO
     C                     Z-ADD0         FAEVNO
     C           RAZ       TAG
     C                     MOVE *BLANK    AF1
     C                     MOVE *BLANK    AF2
     C                     MOVE *BLANK    AF3
     C                     MOVE *BLANK    PAG
     C                     Z-ADD0         PA2
     C                     Z-ADD0         I
     C                     MOVE *OFF      *IN88
     C                     Z-ADD1         SEIT
    C**
    C******  LECTURE DU FICHIER FAB03P
    C**
     C                     MOVE *BLANK    FAEVLI
     C                     MOVE *BLANK    FAEVCO
     C                     Z-ADD0         FAEVNO
    C**
     C           RELEC     TAG
     C                     Z-ADD0         I       20
     C                     MOVE *BLANK    AF1
     C                     MOVE *BLANK    AF2
     C                     MOVE *BLANK    AF3
    C**
D1  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3D    SETLLZFAB03
X1  C                     ELSE
     C                     MOVE ZAEVTY    FAEVTY
     C           KFAB3B    SETLLYFAB03
F1  C                     ENDIF
    C**
D1  C                     DO   9         I
     C           LEC       TAG
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3A    READEZFAB03                   88
X2  C                     ELSE
     C           KFAB3C    READEYFAB03                   88
F2  C                     ENDIF
    C**
D2  C           *IN88     IFEQ *ON
     C                     LEAVE
F2  C                     ENDIF
    C**
    C****** SI EVENEMENT HORODATE => OMISSION DES ARRETS DIVERS
    C****** +  OMISSION DES N°ORDRE 999 => EVENEMENTS PLUS UTILISES
    C**
D2  C           ZAEVTY    IFEQ *BLANK
    C           FAEVTY    CABEQ'D'       LEC
    C           FAEVNO    CABEQ999       LEC
F2  C                     ENDIF
    C**
D2  C           I         IFEQ 1
     C                     Z-ADDSEIT      Q       20
     C                     MOVE FAEVCO    PAG,Q
     C                     Z-ADDFAEVNO    PA2,Q
F2  C                     ENDIF
     C                     MOVE FAEVCO    AF1,I
     C                     MOVE FAEVLI    AF2,I
     C                     MOVE FAEVLI    AF3,I
F1  C                     ENDDO
    C**
    C******  AFFICHAGE D'UNE PAGE
    C**
     C           AFF       TAG
     C                     EXFMTF22
D1  C           *IN12     IFEQ *ON
     C                     MOVE *BLANK    FAEVCO
     C                     MOVE *BLANK    FAEVLI
    C                     GOTO WINF
F1  C                     ENDIF
    C**
    C******  ENTREE : CHOIX DU CODE EVENEMENT
    C**
D1  C           *IN25     IFEQ *OFF
    C           *IN26     ANDEQ*OFF
     C                     Z-ADD1         Z       20
     C           POS2      LOKUPZO,Z                     99
    C           *IN99     CABEQ*OFF      AFF
    C           AF1,Z     CABEQ*BLANK    AFF
     C                     MOVE AF1,Z     FAEVCO
     C                     MOVE AF3,Z     FAEVLI
    C                     GOTO WINF
F1  C                     ENDIF
    C**
    C******  PAGE AVANT
    C**
D1  C           *IN26     IFEQ *ON
     C                     ADD  1         SEIT
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3D    SETGTZFAB03
X2  C                     ELSE
     C           KFAB3B    SETGTYFAB03
F2  C                     ENDIF
    C**
D2  C           ZAEVTY    IFEQ *BLANK
     C           KFAB3A    READEZFAB03                   88
X2  C                     ELSE
     C           KFAB3C    READEYFAB03                   88
F2  C                     ENDIF
D2  C           *IN88     IFEQ *ON
     C                     SUB  1         SEIT
    C                     GOTO AFF
F2  C                     ENDIF
    C                     GOTO RELEC
F1  C                     ENDIF
    C**
    C******  PAGE ARRIERE
    C**
D1  C           *IN25     IFEQ *ON
     C                     SUB  1         SEIT
D2  C           SEIT      IFLT 1
     C                     ADD  1         SEIT
    C                     GOTO AFF
F2  C                     ENDIF
     C                     Z-ADDSEIT      Q
     C                     MOVE PAG,Q     FAEVCO
     C                     Z-ADDPA2,Q     FAEVNO
    C                     GOTO RELEC
F1  C                     ENDIF
    C**
    C******  RETOUR A L'AFFICHAGE
    C**
    C                     GOTO AFF
    C           WINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : FIN EQUIPE : SAISIE DU BILAN OPERATION               *
    C*                                                               *
    C*****************************************************************
    C           FINEQU    BEGSR
     C                     MOVE *OFF      *IN39
     C                     Z-ADD0         TPSTOT
     C                     MOVE *BLANK    TCAD
     C                     Z-ADD0         THAD
     C                     MOVE *BLANK    TTAD
     C                     Z-ADD0         TEAD
     C                     MOVE *BLANK    TLAD
    C**
    C**  POSITIONNEMENT DU CURSEUR SUR QTE REBUTEE SI ATELIER FINITION
    C**            SINON SUR LA QUANTITÉE FABRIQUEE
D1  C           FAATEL    IFEQ '81'
    C           FAATEL    OREQ '82'
    C           FAATEL    OREQ '83'
     C                     MOVE *ON       *IN27
X1  C                     ELSE
     C                     MOVE *OFF      *IN27
F1  C                     ENDIF
    C**
     C                     MOVE *BLANK    TAD1
     C                     Z-ADD0         TAD2
     C                     Z-ADD0         SVTAD2
     C                     MOVE *BLANK    TAD3
     C                     Z-ADD0         TAD4
    C**
    C******  F10 = FIN D'OP (EQUIPE NON TERMINEE)
    C**
D1  C           *IN10     IFEQ *ON
     C                     Z-ADDTOTHRE    SVTHRE
     C                     MOVE LIFI,1    LIBFI1
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDPPHFIN    SVHFIN
     **
     ******  SI HEURE SIMULATION RENSEIGNEE ==> HEURE SIMULATION
     **
D2  C           SIMUHF    IFNE 0
     C                     Z-ADD0         HEURE
     C                     MOVELSIMUHF    HEURE
     C                     Z-ADD0         SIMUHF
X2  C                     ELSE
     C                     TIME           HEURE
F2  C                     ENDIF
     **
     C                     MOVELHEURE     PPHFIN
D2  C           PPHFIN    IFEQ 0
     C                     Z-ADD2359      PPHFIN
F2  C                     ENDIF
     C                     UPDATF11
     C                     Z-ADDPPHFIN    SVHFI2
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFI2    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  F11 = FIN D'EQUIPE
    C**
D1  C           *IN11     IFEQ *ON
     C                     Z-ADDTOTHRE    SVTHRE
     C                     MOVE LIFI,2    LIBFI1
     **
     ******  MAJ HEURE FIN EQUIPE DS DERNIERE OPERATION
     **
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDPPHFIN    SVHFIN
     C                     Z-ADDPPHFEQ    PPHFIN
     C                     UPDATF11
     C                     Z-ADDPPHFIN    SVHFI2
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFI2    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C           KFAB16    CHAINXFAB16               99
    C**
    C******  LECTURE EVENEMENTS FABRICATION EXECUTES PAR CETTE EQUIPE
    C**
     C                     Z-ADD0         MNCAL
     C                     Z-ADD0         MNTIR
     C                     Z-ADD0         MNARR
     C                     Z-ADD0         MNPAN
     C                     Z-ADD0         MNARD
    C**
D1  C           1         DO   DERRCY    RCY2
     C           RCY2      CHAINF11                  99
     C           KFAB03    CHAINXFAB03               99
     C                     EXSR TEMPS
D2  C           FAEVTY    IFEQ 'C'
     C                     ADD  TMN3      MNCAL   40
F2  C                     ENDIF
D2  C           FAEVTY    IFEQ 'R'
     C                     ADD  TMN3      MNTIR   40
F2  C                     ENDIF
D2  C           FAEVTY    IFEQ 'A'
     C                     ADD  TMN3      MNARR   40
     C                     EXSR ARDIV1
F2  C                     ENDIF
D2  C           FAEVTY    IFEQ 'P'
     C                     ADD  TMN3      MNPAN   40
     C                     EXSR ARDIV1
F2  C                     ENDIF
F1  C                     ENDDO
    C**
    C******  CALCUL TEMPS EN HEURES/CENTIEMES ET TEMPS TOTAL OP
    C**
D1  C           MNCAL     IFNE 0
     C           MNCAL     DIV  60        PPHCAL    H
X1  C                     ELSE
     C                     Z-ADD0         PPHCAL
F1  C                     ENDIF
    C**
D1  C           MNTIR     IFNE 0
     C           MNTIR     DIV  60        PPHTIR    H
X1  C                     ELSE
     C                     Z-ADD0         PPHTIR
F1  C                     ENDIF
    C**
D1  C           MNARR     IFNE 0
     C           MNARR     DIV  60        PPHARR    H
X1  C                     ELSE
     C                     Z-ADD0         PPHARR
F1  C                     ENDIF
    C**
D1  C           MNPAN     IFNE 0
     C           MNPAN     DIV  60        PPHPAN    H
X1  C                     ELSE
     C                     Z-ADD0         PPHPAN
F1  C                     ENDIF
    C**
    C******  SAUVEGARDE DES CUMULS TEMPS => SERT SI ARRETS DIVERS
    C**
     C                     Z-ADDPPHCAL    SVHCAL
     C                     Z-ADDPPHTIR    SVHTIR
     C                     Z-ADDPPHARR    SVHARR
     C                     Z-ADDPPHPAN    SVHPAN
    C**
     C           PPHCAL    ADD  PPHTIR    TPSTOT
     C                     ADD  PPHARR    TPSTOT
     C                     ADD  PPHPAN    TPSTOT
    C**
    C******  AFFICHAGE FORMAT F16 : VALIDATION PAR F20 OU F21
    C**
    C**
    C******  CALCUL QTE FABRIQUEE D'APRES LES PALETTES PRODUITES
    C**
     C                     EXSR CALFAB
     C                     Z-ADDTOTEQ     PPQFEU
     C                     Z-ADDTOTEQ2    PPQFMA
    C**
     C           FIN1      TAG
     C                     EXSR ARDIV3
     C                     EXFMTF16
    C**
    C****** F5=AFFICHAGE DU SUIVI OF
    C**
D1  C           *IN05     IFEQ *ON
     C                     MOVE CDE       PASCDE
     C                     CALL 'FAB610£'
     C           PASCDE    PARM PASCDE    PASCDE
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C****** F12=ABANDON ET DEBLOCAGE FAB16P
    C**
D1  C           *IN12     IFEQ *ON
     C           AF98B     TAG
     C                     MOVE *OFF      *IN37
     C                     Z-ADDSVTHRE    TOTHRE
     C                     UNLCKFAB16L01
     C           DERRCY    CHAINF11                  99
     C                     Z-ADDSVHFIN    PPHFIN
     C                     UPDATF11
     **
     C           KFAB17    CHAINXFAB17               99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADDSVHFIN    PPHFIN
     C                     UPDATXFAB17
F2  C                     ENDIF
    C                     GOTO FINF
     C                     Z-ADDSVTHRE    TOTHRE
F1  C                     ENDIF
    C**
    C****** F4=RECHERCHE CODE ARRET DIVERS => TYPE 'D'
    C****** OU        DU CODE DECHET ELIMINES AVANT OP
    C**
D1  C           *IN04     IFEQ *ON
     C                     MOVE *BLANKS   POS10
     C                     MOVEL'PPDECH'  POS10
D2  C           POS2      IFNE POS10
     C                     MOVE 'D'       ZAEVTY
     C                     EXSR WIN
     C                     Z-ADD1         A
     C           '  '      LOKUPTCAD,A                   99
D3  C           *IN99     IFEQ *ON
     C                     MOVE FAEVCO    TCAD,A
F3  C                     ENDIF
    C**
X2  C                     ELSE
    C**
     C                     MOVE *BLANKS   PASCO2
     C                     MOVE '10'      LIGNE
     C                     MOVE *BLANKS   PXLIBE
     C                     CALL 'FEN504£'              85
     C           PASCO2    PARM PASCO2    PASCO2  3
     C           INDI2     PARM INDI2     INDI2   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           PXLIBE    PARM PXLIBE    PXLIBE
F2  C                     ENDIF
D2  C           PASCO2    IFNE *BLANKS
     C                     MOVE PASCO2    PPDECH
F2  C                     ENDIF
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C****** IN37 ON => VALIDATION BILAN
    C**
    C           *IN37     CABEQ*ON       OKBILA
    C**
     C                     Z-ADDSVHCAL    PPHCAL
     C                     Z-ADDSVHTIR    PPHTIR
     C                     Z-ADDSVHARR    PPHARR
     C                     Z-ADDSVHPAN    PPHPAN
    C**
    C******  CONTROLE NBRE GROUPES CALES SI IMPRESSION (12 ET 14)
    C**
D1  C           FAATEL    IFEQ '12'
    C           FAATEL    OREQ '14'
    C*    OFFSET 3B
D2  C           FAATEL    IFEQ '14'
    C           USINE     ANDEQ2
    C           NOMAC     ANDEQ'16'
    C           PPNCCA    CABGT9         FIN1       86
    C           PPNCCA    CABEQ0         FIN1           40
X2  C                     ELSE
    C           PPNCCA    CABGT6         FIN1       40
    C           PPNCCA    CABEQ0         FIN1           40
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE QTE PRODUITE=0 ET PALETTES CREES ==> ANOMALIE
    C**
D1  C           TOTEQ     IFNE 0
    C           PPQFEU    CABEQ0         FIN1           41
F1  C                     ENDIF
    C**
    C******  CONTROLE QTE FEUILLES : OBLIGATOIRE PPHTIR <> 0
    C******  TEST SUPPRIME A CAUDE DE NEUVILLE : LE 18.02.2004 (JLH)
    C**
    C                     GOTO SQUEEZ
     C           PPQFEU    ADD  PPQFMA    TOTFEU
D1  C           PPHTIR    IFGT 0
D2  C           TOTEQ     IFNE 0
    C           TOTFEU    CABEQ0         FIN1           41
F2  C                     ENDIF
X1  C                     ELSE
    C           TOTFEU    CABNE0         FIN1       4141
F1  C                     ENDIF
     C           SQUEEZ    TAG
    C**
    C******  TEST SUPPRIME => ZONE PROTEGEE
    C**
    C                     GOTO SAUT9
D1  C           PPUNIT    IFNE 'FE'
    C           PPUNIT    ANDNE'DE'
    C           PPUNIT    ANDNE'KG'
    C           PPUNIT    ANDNE'UN'
    C           PPUNIT    ANDNE'ML'
    C           PPUNIT    ANDNE'M2'
     C                     MOVE *ON       *IN52
    C                     GOTO FIN1
F1  C                     ENDIF
     C           SAUT9     TAG
    C**
    C******  CONTROLE QTE ELIMINEE AVANT SECTION
    C**
D1  C           PPDECH    IFNE *BLANK
     C                     MOVE 'MALF'    PXARGU
     C                     MOVE PPDECH    PXVALE
     C                     MOVE *BLANKS   PXLIBE
     C           KEYUSI    CHAINPARAMEF1             45
    C           *IN45     CABEQ*ON       FIN1
    C           PPQELI    CABEQ0         FIN1           44
F1  C                     ENDIF
    C**
    C******  CONTROLE CODE DECHET ELIMINE AVANT SECTION
    C**
D1  C           PPQELI    IFGT 0
    C           PPDECH    CABEQ*BLANK    FIN1           45
F1  C                     ENDIF
    C**
    C******  CONTROLE TYPE VERNIS (F/U/K)
    C**
D1  C           PPVERN    IFNE *BLANK
D2  C           PPVERN    IFNE 'F'
    C           PPVERN    ANDNE'U'
    C           PPVERN    ANDNE'K'
    C           PPVERN    ANDNE'A'
     C                     MOVE *ON       *IN43
    C                     GOTO FIN1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE OR/ALU/CUIVRE
    C**
D1  C           PPOR      IFNE *BLANK
D2  C           PPOR      IFNE 'O'
    C           PPOR      ANDNE'A'
    C           PPOR      ANDNE'C'
     C                     MOVE *ON       *IN46
    C                     GOTO FIN1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C******  CONTROLE DONNEES ARRET DIVERS
    C**
     C                     Z-ADD0         MNARD   40
     C                     Z-ADD0         PPHADI
     C                     Z-ADD0         A       10
     C                     Z-ADD0         B       10
     **
D1  C                     DO   4         A
D2  C           TCAD,A    IFNE *BLANK
     C                     MOVE TCAD,A    FAEVCO
     C           KFAB03    CHAINXFAB03               47
    C           *IN47     CABEQ*ON       FIN1
    C           FAEVTY    CABNE'D'       FIN1       4747
     **
     ******  TEST SI CODE ARRET DIVERS SAISI PLUSIEURS FOIS => ERREUR
     **
     C                     Z-ADD0         B
D3  C                     DO   4         B
D4  C           FAEVCO    IFEQ TCAD,B
    C           A         ANDNEB
     C                     MOVE *ON       *IN55
    C                     GOTO FIN1
F4  C                     ENDIF
F3  C                     ENDDO
     **
     C                     MOVE FAEVL2    TLAD,A
     **
    C           THAD,A    CABEQ0         FIN1           56
     C                     MOVELTHAD,A    HR
     C                     MOVE THAD,A    MN
    C           HR        CABGT24        FIN1       56
    C           MN        CABGT59        FIN1       56
     **
    C           TTAD,A    CABEQ*BLANK    FIN1           50
D3  C           TTAD,A    IFNE 'C'
    C           TTAD,A    ANDNE'R'
    C           TTAD,A    ANDNE'A'
    C           TTAD,A    ANDNE'P'
     C                     MOVE *ON       *IN50
    C                     GOTO FIN1
F3  C                     ENDIF
     **
    C           TEAD,A    CABEQ0         FIN1           49
     **
     C           HR        MULT 60        TMN1
     C                     ADD  MN        TMN1
     C                     ADD  TMN1      MNARD
    C**
X2  C                     ELSE
     C                     Z-ADD0         THAD,A
     C                     MOVE *BLANK    TTAD,A
     C                     Z-ADD0         TEAD,A
     C                     MOVE *BLANK    TLAD,A
F2  C                     ENDIF
    C**
     C                     EXSR ARDIV2
    C           *IN53     CABEQ*ON       FIN1
F1  C                     ENDDO
    C**
    C******  SAUVEGARDE TABLEAU ARRET POUR MAJ HISTOFA2
    C**
     C                     Z-ADDTAD2      SVTAD2
    C**
    C******  CALCUL TOTAL TEMPS ARRET DIVERS
    C**
D1  C           MNARD     IFNE 0
     C           MNARD     DIV  60        PPHADI    H
X1  C                     ELSE
     C                     Z-ADD0         PPHADI
F1  C                     ENDIF
     C           PPHCAL    ADD  PPHTIR    TOTTPS
     C                     ADD  PPHARR    TOTTPS
     C                     ADD  PPHPAN    TOTTPS
     C                     ADD  PPHADI    TOTTPS
    C           PPHADI    CABGTTOTTPS    FIN1       51
    C**
    C******  TEST SI CUMUL TEMPS < 0 DU FAIT DES ARRETS DIVERS
    C**
    C           PPHCAL    CABLT0         FIN1         54
    C           PPHTIR    CABLT0         FIN1         54
    C           PPHARR    CABLT0         FIN1         54
    C           PPHPAN    CABLT0         FIN1         54
    C**
    C******  TEST ETAT OP : E=OP NON FINIE  I=INTERROMPUE  T=TERMINEE
    C**
D1  C           PPTFIN    IFNE 'E'
    C           PPTFIN    ANDNE'I'
    C           PPTFIN    ANDNE'T'
     C                     MOVE *ON       *IN59
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C******   TEST SI OPERATEUR A SAISI OP TERMINEE
    C******   QUE L'OP PRECEDENTE SOIT TERMINEE
    C******         REFUSÉE SINON
    C******   SI L'ETAT = 'ZZ' ==> PAS D'OP PRECEDENTE
    C**
D1  C           PPTFIN    IFEQ 'T'
     C                     Z-ADDUSINE     SAUSIN
     C                     Z-ADDFACONF    SACONF
     C                     Z-ADDFASEQ     SASEQ
     C                     Z-ADDFAISEQ    SAISEQ
     C                     Z-ADDNOPRO     SNOPRO
     C                     Z-ADDFAOPNU    SAOPNU
     C                     MOVE SECT      SPSECT
     C                     MOVE SSECT     SSSECT
     C                     MOVE NOMAC     SNOMAC
     C                     MOVE *BLANKS   SETAOP
     C                     CALL 'FAB618£'              85
     C           PARM10    PARM PARM10    PARM10
D2  C           SETAOP    IFNE 'ZZ'
    C           SETAOP    CABNE'TR'      FIN1       9494
F2  C                     ENDIF
F1  C                     ENDIF
    C**
D1  C           PPTFIN    IFEQ 'I'
     C                     MOVE LIFI,3    LIBFI1
F1  C                     ENDIF
    C**
    C******  TEST SI TOUS LES ENCOURS ONT ETE CONSOMMÉS
    C******  LORSQUE L'OPERATION EST DITE TERMINÉE
    C**
D1  C           PPTFIN    IFEQ 'T'
     C                     Z-ADD0         FATENC
     C                     MOVE 'C'       FAEFC
     C           KFAB13    SETLLXFAB13
     C           LEC13P    TAG
     C           KFA13A    READEXFAB13                   99
D2  C           *IN99     IFEQ *OFF
     C                     Z-ADD0         YYOPNU
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFA10A    SETLLTFAB10
     C           LEC10A    TAG
     C           KFA10B    READETFAB10                   99
D3  C           *IN99     IFEQ *OFF
    C           FAOPNU    CABEQXAOPNU    LEC10A
     C                     EXFMTF95
    C                     GOTO SAUTR1
F3  C                     ENDIF
    C                     GOTO LEC13P
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C           SAUTR1    TAG
    C**
    C******  DOUBLE VALIDATION : *IN37 ON
    C**
D1  C           *IN37     IFEQ *OFF
     C                     MOVE *ON       *IN37
    C                     GOTO FIN1
F1  C                     ENDIF
    C**
    C******  BILAN OK : TEST SI OP SOLDEE MAIS QTE NON ATTEINTE
    C******  SQUEEZE PROVISOIREMENT / JLH LE 20/10/2003
    C**
     C           OKBILA    TAG
     C                     MOVE FAUNIT    SSUNIT  2
     C                     EXSR SPBIL
     C                     EXFMTF16B
     C                     MOVE SSUNIT    FAUNIT
    C                     GOTO OKBILF
    C**
D1  C           PPTFIN    IFEQ 'T'
    C           TOTBON    ANDLTFAQTE
     **
     C           AF98      TAG
     C                     EXFMTF98
     **
D2  C           *IN12     IFEQ *OFF
    C           *IN05     ANDEQ*OFF
    C                     GOTO AF98
F2  C                     ENDIF
     **
    C           *IN12     CABEQ*ON       AF98B
     **
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB16P : EQUIPE TERMINEE
    C**
     C           OKBILF    TAG
     C                     MOVE *OFF      *IN37
    C**
     C                     MOVE 'T'       FA1601
     C                     MOVE 'T'       FA1602
     C                     TIME           HEURE
D1  C           *IN11     IFEQ *ON
     C                     MOVELHEURE     PPHFRE
X1  C                     ELSE
     C                     Z-ADD0         PPHFRE
F1  C                     ENDIF
    C**
    C******  MEMORISATION INTERRUPTION (SERVIRA SI MODIFICATION)
    C**
D1  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'I'       FA1603
F1  C                     ENDIF
    C**
     C                     UPDATXFAB16
    C**
    C******  MAJ FICHIER FAB18P : DETAIL TEMPS DIVERS
    C**
D1  C           PPHADI    IFGT 0
     C                     Z-ADD0         A
D2  C                     DO   4         A
D3  C           TCAD,A    IFNE *BLANK
     C                     MOVE TCAD,A    PPCARD
     C                     Z-ADDTHAD,A    PPHARD
     C                     MOVE TTAD,A    PPTARD
     C                     Z-ADDTEAD,A    PPEARD
     C                     WRITEXFAB18
F3  C                     ENDIF
F2  C                     ENDDO
F1  C                     ENDIF
    C**
    C******  MAJ FICHIER FAB05P : OPERATION TERMINEE
    C**
D1  C           PPTFIN    IFEQ 'T'
    C           PPTFIN    OREQ 'I'
     C           KFAB5C    CHAINZFAB05               99
D2  C           *IN99     IFEQ *OFF
D3  C           PPTFIN    IFEQ 'T'
     C                     MOVE 'TR'      FAOPST
D4  C           USINE     IFEQ 3
    C           SECT      ANDEQ'2'
    C           SSECT     ANDEQ'1'
    C           NOMAC     ANDEQ'10'
     C                     MOVE 'S'       XA0501
F4  C                     ENDIF
F3  C                     ENDIF
D3  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'IN'      FAOPST
F3  C                     ENDIF
     C                     UPDATZFAB05
     C                     EXSR COMPLX
F2  C                     ENDIF
    C**
    C******  MAJ PRLANC => OFETA = 'TR'
    C**
D2  C           PPTFIN    IFEQ 'T'
     C                     Z-ADDUSINE     VVUSI
     C                     Z-ADDFACONF    VVCONF
     C                     Z-ADDFASEQ     VVSEQ
     C                     Z-ADDFAISEQ    VVISEQ
     C                     Z-ADDNOPRO     VVPRO
     C                     Z-ADDPRIOR1    VVPRIO
     C                     MOVE *BLANK    VVETAT
     C                     CALL 'FAB518£A'
     C           PARM9     PARM PARM9     PARM9
D3  C           VVETAT    IFEQ 'TR'
     C                     Z-ADDPRIOR1    PRIORI
     C           KLAN01    CHAINPRLANCFZ             99
D4  C           *IN99     IFEQ *OFF
     C                     MOVE 'TR'      OFETA
     C                     EXCPTMAJLAN
F4  C                     ENDIF
F3  C                     ENDIF
     ******  SOLDE DES RESERVATIONS
     C                     MOVE *BLANK    VVETAT
     C                     CALL 'FAB518£D'
     C           PARM9     PARM PARM9     PARM9
D3  C           VVETAT    IFEQ 'TR'
     C                     EXSR MAJRES
F3  C                     ENDIF
F2  C                     ENDIF
     **
     ******  MAJ SS-FICHIER F02 => OP TERMINE
     **
     C           RCD       CHAINF02                  99
D2  C           *IN99     IFEQ *OFF
D3  C           PPTFIN    IFEQ 'T'
     C                     MOVE 'TR'      FAOPST
F3  C                     ENDIF
D3  C           PPTFIN    IFEQ 'I'
     C                     MOVE 'IN'      FAOPST
F3  C                     ENDIF
     C           FAOPST    CHAINXFAB08               99
     C                     UPDATF02
F2  C                     ENDIF
F1  C                     ENDIF
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : T2207='O'
     **
     C                     MOVE 'N'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB603£'              85
     C           PARM8     PARM PARM8     PARM8
     **
F1  C                     ENDIF
    C**
    C******  MAJ DE HISTOFA2 => TRANSFERT DS ENR2 AU PROGRAMME REMI
    C**
     C                     CLEARENREG2
D1  C           SECPAP    IFNE 'I'
     C                     MOVE SECPAP    EBSUP
X1  C                     ELSE
     C                     MOVE SUPOR     EBSUP
F1  C                     ENDIF
    C**
     C                     Z-ADDUSINE     EBUSIN
     C                     Z-ADDFACONF    EBCONF
     C                     Z-ADDFASEQ     EBSEQ
    C**
    C*****  SI TANDEM COMPLEXE REMONTEE EN 2207
    C**
D1  C           T2207     IFEQ 'O'
     C                     MOVE '2'       EBSEC
     C                     MOVE '2'       EBSSEC
     C                     MOVE '07'      EBMAC
X1  C                     ELSE
     C                     MOVE SECT      EBSEC
     C                     MOVE SSECT     EBSSEC
     C                     MOVE NOMAC     EBMAC
F1  C                     ENDIF
    C**
     C                     Z-ADDSTE       EBSTE
     C                     Z-ADDNOCLI     EBCLI
     C                     Z-ADDNOPRO     EBPRO
     C                     Z-ADDPPEQUI    EBEQU
     C                     Z-ADDPPPAS     EBPAS
     C                     Z-ADDDATEQ     EBDAT1
     C                     EXSR LECSYS
     C                     MOVELSYSA      EBDAT2
     C                     MOVEL'20'      SYSC
     C                     MOVE SYSB      SYSC
     C                     MOVE SYSC      EBDAT2
    C**
    C******  HEURE DE FIN OP : EQUIPE NUIT+DATE DU LENDEMAIN => +24H
    C**
     C                     Z-ADDSVHFI2    EBHEUR
D1  C           PPEQUI    IFEQ 3
    C           SVHFI2    ANDLT700
     C                     ADD  2400      EBHEUR
F1  C                     ENDIF
    C**
     C                     Z-ADDCMATR     EBCOND
     C                     Z-ADDPPHCAL    EBTCAL
     C                     Z-ADDPPHTIR    EBTROU
     C           PPHARR    ADD  PPHPAN    EBTDIV
     C                     ADD  PPHADI    EBTDIV
    C**  PAS D'EFFECTIF CALAGE SI HEURES CALAGE=0
D1  C           EBTCAL    IFEQ 0
     C                     Z-ADD0         EBEFFC
X1  C                     ELSE
     C                     Z-ADDPPEFFC    EBEFFC
F1  C                     ENDIF
    C**  PAS D'EFFECTIF TIRAGE SI HEURES TIRAGE=0
D1  C           EBTROU    IFEQ 0
    C           EBTDIV    ANDEQ0
     C                     Z-ADD0         EBEFFR
X1  C                     ELSE
     C                     Z-ADDPPEFFR    EBEFFR
F1  C                     ENDIF
    C**
     C           PPQFEU    ADD  PPGACA    EBQTOT
     C                     Z-ADDPPQFEU    EBQBON
     C                     Z-ADDPPGACA    EBQRC
     C                     Z-ADDPPQFMA    EBQRR
    C**
     C                     MOVE PPDECH    EBCELI
     C                     Z-ADDPPQELI    EBQELI
    C**
    C*****   CONVERSION DES QTES BOITES EN FEUILLES SI DECORTICAGE
    C**
D1  C           POSF1     IFEQ 0
     C                     Z-ADD1         POSF1
F1  C                     ENDIF
    C**
D1  C           FAATEL    IFEQ '70'
    C           NOMAC     ANDNE'10'
D2  C           PPUNIT    IFEQ 'PF'
    C           PPUNIT    OREQ 'DE'
    C           PPUNIT    OREQ 'ML'
    C           PPUNIT    OREQ 'KG'
     C           EBQTOT    DIV  POSF1     EBQTOT    H
     C           EBQBON    DIV  POSF1     EBQBON    H
     C           EBQTOT    SUB  EBQBON    EBQRC
     C           EBQRR     DIV  POSF1     EBQRR     H
     C           EBQELI    DIV  POSF1     EBQELI    H
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     MOVE *BLANK    EBETIQ
     C                     Z-ADD0         EBCBPA
     C                     Z-ADD0         EBTENC
     C                     Z-ADDPPNCCA    EBCOUL
     C                     MOVE PPVERN    EBTVER
    C**
    C******  MAJ N° OP => SI OP RAJOUTEE DS SUIVI (TYPE 6) => ENVOYER
    C******               SUR OP D'ORIGINE
    C**
     C                     Z-ADDFAOPNU    EBOPNU
     **
     C                     MOVE FAOPNU    TYPOP   10
D1  C           TYPOP     IFGE 6
     C                     SUB  5         TYPOP
     C                     MOVE TYPOP     EBOPNU
F1  C                     ENDIF
    C**
    C****       FAATEL    IFEQ '82'
    C****       PPPAS     ANDGT1
    C****                 MOVE '1'       EBOPNU
    C****                 ENDIF
    C*****  SI TANDEM COMPLEXE FAOPNU CELUI DE LA 1303
D1  C           T2207     IFEQ 'O'
     C                     MOVE VAOPNU    EBOPNU
F1  C                     ENDIF
    C**
     C                     MOVE FAOPST    EBOPST
D1  C           EBOPST    IFEQ *BLANK
     C                     MOVE 'EC'      EBOPST
F1  C                     ENDIF
     C                     MOVE 'Z'       EBTAG
    C**
     C                     MOVE TAD1      EBCAD
     C                     Z-ADDSVTAD2    EBTAD
     C                     MOVE TAD3      EBIAD
     C                     Z-ADDTAD4      EBEAD
    C**
    C*****   GESTION DES A COTES : ONDULEUSE 10 DE TOURY
    C**
     C                     Z-ADD0         EBPOS1
     C                     Z-ADD0         EBPOS2
     C                     Z-ADD0         EBQACO
D1  C           USINE     IFEQ 3
    C           POSF2     ANDGT0
    C           FAATEL    ANDGE'21'
    C           FAATEL    ANDLT'70'
D2  C           TOTEQG    IFGT 0
     C                     Z-ADDPOSF1     EBPOS1
F2  C                     ENDIF
D2  C           TOTEQD    IFGT 0
     C                     Z-ADDPOSF2     EBPOS2
     C                     Z-ADDTOTEQD    EBQACO
F2  C                     ENDIF
F1  C                     ENDIF
    C**
     C                     MOVE FATRSP    EBTRSP
    C**
    C*****   SI OPERATION = MONTAGE CLICHERIE  (UTILISÉE À TOURY)
    C*****    PAS DE MAJ DE HISTOFA2
    C**
    C           FAATEL    CABEQ'18'      SAUTRR
    C**
    C*****   SI LA ZONE OPLIB (DU PRECAOP) = FINITION
    C*****        PAS DE MAJ DE HISTOFA2 ==> CONDITIONNEMENT
    C**
D1  C           USINE     IFEQ 4
    C           OPLIB     CABEQLB,1      SAUTRR
F1  C                     ENDIF
    C**
    C*****   SI OP FACONNAGE SE TERMINANT PAR 9 (OP TRANSFERT USINE)
    C*****        PAS DE MAJ DE HISTOFA2
    C**
D1  C           FAOPNU    IFGT 9000
     C                     MOVE FAOPNU    TYPOP2  10
    C           TYPOP2    CABEQ9         SAUTRR
F1  C                     ENDIF
    C**
    C*****  TEST SI DECOMPTAGE D'UN CALAGE SUR CETTE FAB
    C**
     C                     Z-ADDUSINE     XJUSIN
     C                     MOVE SECT      XJSECT
     C                     MOVE SSECT     XJSSEC
     C                     MOVE NOMAC     XJNOMA
     C                     Z-ADDFACONF    XJCONF
     C                     Z-ADDFASEQ     XJSEQ
     C                     Z-ADDFAISEQ    XJISEQ
     C                     Z-ADDNOPRO     XJPRO
     C                     Z-ADDFAOPNU    XJOPNU
     C                     Z-ADDPPAA      XJPPAA
     C                     Z-ADDPPMM      XJPPMM
     C                     Z-ADDPPJJ      XJPPJJ
     C                     Z-ADDPPEQUI    XJEQUI
     C                     Z-ADD0         XJNBCA
     C                     CALL 'FAB664£'
     C           PARM30    PARM PARM30    PARM30
     C                     Z-ADDXJNBCA    EBNCAL
    C**
     C                     CALL 'PROD79£'
     C           ENR2      PARM ENR2      ENR2
    C**
    C******  MAJ FAB21P => HISTORIQUE MVTS TRANSMIS A HISTOFA2
    C**
     C                     Z-ADDFAISEQ    EBISEQ
     C                     MOVE 'C'       EBMODI
     C                     WRITEXFAB21
    C**
     C           SAUTRR    TAG
    C**
    C**
    C******  MAJ ZONE : INIBON EN CAS DE CREATION D'UNE AUTRE EQUIPE
    C**
     C                     ADD  PPQFEU    INIBON
    C**
    C******  MAJ DANS LE CAS DE CONSOMMATION D'UNE BOBINE
    C******     SUR PLUSIEURS COMMANDES
    C******     SEULEMENT SI TERMINE ET PAS DE CONSOMMATION
    C**
    C           PPTFIN    CABEQ'E'       FINF
    C**      EXTERIEUR
D1  C           IN77      IFEQ 0
D2  C           PREEXT    IFEQ *BLANKS
    C           PREEXT    OREQ 'POST-P'
     C                     MOVE 'E'       FA1101
     C                     MOVE PAPEXT    PAPI
     C                     Z-ADDGRAEXT    GRAMM
     C                     MOVE FOUEXT    REFOUR
     C                     Z-ADDGRREXT    GRAREL
     C                     EXSR SORMUL
X2  C                     ELSE
     C                     MOVE 'E'       FA1001
D3  C           PREEXT    IFEQ 'FLEXO'
    C           PREEXT    OREQ FLEX,1
     C                     Z-ADDSTE       RRSTE
     C                     Z-ADDNOCLI     RRCLI
     C                     Z-ADDNOPRO     RRPRO
X3  C                     ELSE
     C                     Z-ADD0         RRSTE
     C                     MOVELPREEXT    RRCLI
     C                     MOVE PREEXT    RRPRO
F3  C                     ENDIF
     C                     EXSR SORMU1
F2  C                     ENDIF
F1  C                     ENDIF
    C**      CANNELURE
D1  C           IN78      IFEQ 0
D2  C           PRECAN    IFEQ *BLANKS
    C           PRECAN    OREQ 'POST-P'
     C                     MOVE 'C'       FA1101
     C                     MOVE PAPCAN    PAPI
     C                     Z-ADDGRACAN    GRAMM
     C                     MOVE FOUCAN    REFOUR
     C                     Z-ADDGRRCAN    GRAREL
     C                     EXSR SORMUL
X2  C                     ELSE
     C                     MOVE 'C'       FA1001
D3  C           PRECAN    IFEQ 'FLEXO'
    C           PRECAN    OREQ FLEX,1
     C                     Z-ADDSTE       RRSTE
     C                     Z-ADDNOCLI     RRCLI
     C                     Z-ADDNOPRO     RRPRO
X3  C                     ELSE
     C                     Z-ADD0         RRSTE
     C                     MOVELPRECAN    RRCLI
     C                     MOVE PRECAN    RRPRO
F3  C                     ENDIF
     C                     EXSR SORMU1
F2  C                     ENDIF
F1  C                     ENDIF
    C**      INTERIEUR
D1  C           IN79      IFEQ 0
D2  C           PREINT    IFEQ *BLANKS
    C           PREINT    OREQ 'POST-P'
     C                     MOVE 'I'       FA1101
     C                     MOVE PAPINT    PAPI
     C                     Z-ADDGRAINT    GRAMM
     C                     MOVE FOUINT    REFOUR
     C                     Z-ADDGRRINT    GRAREL
     C                     EXSR SORMUL
X2  C                     ELSE
     C                     MOVE 'I'       FA1001
D3  C           PREINT    IFEQ 'FLEXO'
    C           PREINT    OREQ FLEX,1
     C                     Z-ADDSTE       RRSTE
     C                     Z-ADDNOCLI     RRSTE
     C                     Z-ADDNOPRO     RRPRO
X3  C                     ELSE
     C                     Z-ADD0         RRSTE
     C                     MOVELPREINT    RRCLI
     C                     MOVE PREINT    RRPRO
F3  C                     ENDIF
     C                     EXSR SORMU1
F2  C                     ENDIF
F1  C                     ENDIF
    C**
    C           FINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : AFFICHAGE DU BILAN SUR UNE OPERATION                 *
    C*                                                               *
    C*****************************************************************
    C           BILAN     BEGSR
     C                     MOVE *ON       *IN37
     C                     MOVE *BLANK    TCAD
     C                     Z-ADD0         THAD
     C                     MOVE *BLANK    TTAD
     C                     Z-ADD0         TEAD
     C                     MOVE *BLANK    TLAD
    C**
    C******  CALCUL TEMPS TOTAL PASSE
    C**
     C           PPHCAL    ADD  PPHTIR    TPSTOT
     C                     ADD  PPHARR    TPSTOT
     C                     ADD  PPHPAN    TPSTOT
     C                     ADD  PPHADI    TPSTOT
    C**
    C******  LECTURE DES ARRETS DIVERS DS FAB18P
    C**
     C                     Z-ADD0         A
     C                     MOVE *BLANK    PPCARD
     **
     C           KFAB18    SETLLXFAB18
     C           LEC18     TAG
     C           KFAB16    READEXFAB18                   99
D1  C           *IN99     IFEQ *OFF
     **
     C                     ADD  1         A
     C                     MOVE PPCARD    TCAD,A
     C                     Z-ADDPPHARD    THAD,A
     C                     Z-ADDPPEARD    TEAD,A
     C                     MOVE PPTARD    TTAD,A
     C                     MOVE PPCARD    FAEVCO
     C           KFAB03    CHAINXFAB03               99
     C                     MOVE FAEVL2    TLAD,A
    C                     GOTO LEC18
F1  C                     ENDIF
    C**
    C******  AFFICHAGE FORMAT F16
    C**
     C                     EXFMTF16
     C                     MOVE FAUNIT    SSUNIT  2
     C                     EXSR SPBIL
     C                     EXFMTF16B
     C                     MOVE SSUNIT    FAUNIT
    C**
     C                     MOVE *OFF      *IN37
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*  SR : AFFICHAGE FENETRE SAISIE OBSERVATIONS                   *
    C*                                                               *
    C*****************************************************************
    C           WINOB     BEGSR
    C**
    C****** TRAVAIL TERMINE => VISU SLT ET *IN49 ON
    C**
D1  C           FA1601    IFEQ 'T'
     C                     MOVE *ON       *IN49
X1  C                     ELSE
     C                     MOVE *OFF      *IN49
F1  C                     ENDIF
    C**
     C                     Z-ADD0         PPOROB
     C                     MOVE *BLANK    PPOBS
     C                     MOVEA'1000'    *IN,55
     C                     WRITEF20
     C                     Z-ADD0         RCT
     C                     Z-ADD0         SAVRCT
     C                     Z-ADD0         SAVORB
     C                     SETOF                     55
    C**
    C****** REMPLISSAGE DU SOUS-FICHIER
    C**
     C           QAB       TAG
D1  C                     DO   7
     C                     ADD  1         PPOROB
    C**
    C****** NBRE MAXI OBSERVATIONS = 99 (99+1=00 DS UNE ZONE DE 2)
    C**
D2  C           PPOROB    IFEQ 17
     C                     MOVE *ON       *IN58
     C                     LEAVE
F2  C                     ENDIF
    C**
     C           KFAB19    CHAINXFAB19              N99
D2  C           *IN99     IFEQ *ON
     C                     MOVE *BLANK    PPOBS
F2  C                     ENDIF
    C**
     C                     ADD  1         RCT
     C                     Z-ADDRCT       SAVRCT
     C                     Z-ADDPPOROB    SAVORB
     C                     WRITEF19
F1  C                     ENDDO
    C**
    C****** AFFICHAGE DU FORMAT DE CONTROLE F20
    C**
     C           QUITE     TAG
     C                     SETON                     57
     C           RCT       COMP 0                    56
     C                     EXFMTF20
D1  C           *IN12     IFEQ *ON
     C                     Z-ADD0         PPOROB
    C                     GOTO QINF
F1  C                     ENDIF
    C**
D1  C           *IN04     IFEQ *ON
     C                     CLEARDSPARM
     C                     MOVEL'OBSA'    TBLNOM
     C                     Z-ADD6         LG
     C                     CALL 'DEV002£'
     C                     PARM           DSPARM
    C                     GOTO QUITE
F1  C                     ENDIF
    C**
D1  C           *IN26     IFEQ *ON
D2  C           *IN58     IFEQ *OFF
     C                     Z-ADDSAVORB    PPOROB
     C                     Z-ADDSAVRCT    RCT
    C                     GOTO QAB
F2  C                     ENDIF
     C                     Z-ADDSAVRCT    RCT
    C                     GOTO QUITE
F1  C                     ENDIF
    C**
    C           *IN49     CABEQ*ON       QINF
    C**
    C****** LECTURE DU SOUS-FICHIER
    C**
D1  C                     DO   17        KK      20
     C           KK        CHAINF19                  81
D2  C           PPOB2     IFNE *BLANKS
     C                     MOVE 'OBSA'    PXARGU
     C                     MOVE PPOB2     PXVALE    P
     C           KEYUSI    CHAINPARAMEF1             69
    C           *IN69     CABEQ'1'       QUITE
F2  C                     END
    C**
D2  C           PPOBS     IFEQ *BLANK
     C           KFAB19    CHAINXFAB19               99
D3  C           *IN99     IFEQ *OFF
     C                     DELETXFAB19
F3  C                     ENDIF
X2  C                     ELSE
     C                     MOVE PPOBS     SAVOBS
     C           KFAB19    CHAINXFAB19               99
D3  C           *IN99     IFEQ *OFF
     C                     MOVE SAVOBS    PPOBS
     C                     UPDATXFAB19
X3  C                     ELSE
     C                     WRITEXFAB19
F3  C                     ENDIF
F2  C                     ENDIF
    C**
F1  C                     END
    C**
    C           QINF      ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CALCUL QTE FABRIQUEE SUR UN TRAVAIL EN COURS       *
    C*                                                               *
    C*****************************************************************
    C           CALFAB    BEGSR
    C**
     C                     Z-ADD0         TOTEQ
     C                     Z-ADD0         TOTEQG
     C                     Z-ADD0         TOTEQD
     C                     Z-ADD0         TOTEQ2
    C**
D1  C           FAATEL    IFNE '13'
    C           FAATEL    ANDNE'15'
    C           FAATEL    ANDNE'22'
    C**
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFAB10    SETLLXFAB10
    C**
     C           LEC10     TAG
     C           KFAB16    READEXFAB10                   99
D2  C           *IN99     IFEQ *OFF
    C           NOBOU     CABNE0         LEC10
     C                     ADD  FAQTFE    TOTEQ
     C                     ADD  FAQTGA    TOTEQ2
D3  C           FA1001    IFEQ 'G'
     C                     ADD  FAQTFE    TOTEQG
F3  C                     ENDIF
D3  C           FA1001    IFEQ 'P'
     C                     ADD  FAQTFE    TOTEQD
F3  C                     ENDIF
    C                     GOTO LEC10
F2  C                     ENDIF
    C**
X1  C                     ELSE
    C**
    C******  CALCUL DE LA QUANTITÉ PAPIER PRODUITE
    C**
     C                     MOVE *BLANKS   PAPI
     C                     Z-ADD0         GRAMM
     C                     MOVE *BLANKS   REFOUR
     C                     Z-ADD0         GRAREL
     C                     MOVE *BLANKS   FOUB
     C                     Z-ADD0         FACBPA
     C           KFAB11    SETLLZFAB11
     **
     C           LEC11     TAG
     C           KFAB16    READEZFAB11                   99
D2  C           *IN99     IFEQ *OFF
     C                     ADD  NBFE      TOTEQ
     C                     SUB  FAQRES    TOTEQ
    C                     GOTO LEC11
F2  C                     ENDIF
    C**
F1  C                     ENDIF
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR : REMPLISSAGE DES TABLES ARRETS DIVERS POUR MAJ HISTOFA2   *
    C*      EVENEMENTS HORODATES <=> FAEVCO = 'A' OU 'P'             *
    C*                                                               *
    C*****************************************************************
    C           ARDIV1    BEGSR
     C           TMN3      DIV  60        HCT     42H
    C           HCT       CABEQ0         ARDIF1
    C**
    C******  RECHERCHE DU 1ER POSTE DE LIBRE DS TABLEAU
    C**
     C                     Z-ADD1         Y       10
     C           FAEVCO    LOKUPTAD1,Y                   99
D1  C           *IN99     IFEQ *ON
     C                     ADD  HCT       TAD2,Y
X1  C                     ELSE
     C           '  '      LOKUPTAD1,Y                   99
     **
     ******  SI TABLEAU PLEIN <=> + 6 POSTES => IMPOSSIBLE
     **
    C           *IN99     CABEQ*OFF      ARDIF1         53
     **
     C                     ADD  HCT       TAD2,Y
     C                     MOVE FAEVCO    TAD1,Y
    C**
    C******  SI CODE="NU" : NON UTILISE ==> EFFECTIF=0
    C**
D2  C           TAD1,Y    IFEQ 'NU'
     C                     Z-ADD0         TAD4,Y
X2  C                     ELSE
     C                     Z-ADDPPEFFR    TAD4,Y
F2  C                     ENDIF
     C                     MOVE *BLANK    TAD3,Y
F1  C                     ENDIF
    C**
    C           ARDIF1    ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR : REMPLISSAGE DES TABLES ARRETS DIVERS POUR MAJ HISTOFA2   *
    C*      EVENEMENTS NON HORODATES <=> FAEVCO = 'D'                *
    C*                                                               *
    C*****************************************************************
    C           ARDIV2    BEGSR
    C           THAD,A    CABEQ0         ARDIF2
    C**
     C                     MOVE THAD,A    MN
     C                     MOVELTHAD,A    HR
     C           HR        MULT 60        TMN1
     C                     ADD  MN        TMN1
     C           TMN1      DIV  60        HCT       H
    C**
    C******  DEDUCTION TEMPS ARRET DIVERS DES AUTRES TOTAUX
    C**
D1  C           TTAD,A    IFEQ 'C'
     C                     SUB  HCT       PPHCAL
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'R'
     C                     SUB  HCT       PPHTIR
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'A'
     C                     SUB  HCT       PPHARR
F1  C                     ENDIF
D1  C           TTAD,A    IFEQ 'P'
     C                     SUB  HCT       PPHPAN
F1  C                     ENDIF
    C**
    C******  RECHERCHE DU 1ER POSTE DE LIBRE DS TABLEAU
    C**
     C                     Z-ADD1         Y
     C                     MOVE TCAD,A    EVCO
     C           EVCO      LOKUPTAD1,Y                   99
D1  C           *IN99     IFEQ *ON
     C                     ADD  HCT       TAD2,Y
X1  C                     ELSE
     C           '  '      LOKUPTAD1,Y                   99
     **
     ******  SI TABLEAU PLEIN <=> + 6 POSTES => IMPOSSIBLE
     **
    C           *IN99     CABEQ*OFF      ARDIF2         53
     **
     C                     ADD  HCT       TAD2,Y
     C                     MOVE TCAD,A    TAD1,Y
     C                     Z-ADDTEAD,A    TAD4,Y
     C                     MOVE TTAD,A    TAD3,Y
F1  C                     ENDIF
    C**
    C           ARDIF2    ENDSR
    C*****************************************************************
    C*                                                               *
    C* SR:REMISE A ZERO CUMULS TEMPS ARRETS DIVERS SI ERREUR TROUVEE *
    C*                                                               *
    C*****************************************************************
    C           ARDIV3    BEGSR
    C           *IN39     CABEQ*ON       ARDIF3
    C**
     C                     Z-ADD0         B
    C**
D1  C                     DO   6         B
     **
D2  C           TAD1,B    IFNE *BLANK
     C                     MOVE TAD1,B    FAEVCO
     C           KFAB03    CHAINXFAB03               99
     **
D3  C           *IN99     IFEQ *OFF
    C           FAEVTY    ANDEQ'D'
     C                     Z-ADD0         TAD2,B
F3  C                     ENDIF
F2  C                     ENDIF
F1  C                     ENDDO
    C**
    C           ARDIF3    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : LECTURE DATE SYSTEME PAR RTVSYSVAL                 *
    C*                                                               *
    C*****************************************************************
    C           LECSYS    BEGSR
     C                     MOVE *ZEROS    PASSYS  6
     C                     CALL 'FAB000L'
     C           PASSYS    PARM PASSYS    PASSYS
     C                     MOVELPASSYS    SYSA    4
     C                     MOVE PASSYS    SYSB    2
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : MAJ DANS LE CAS DE CONSOMMATION D'UNE BOBINE         *
    C*             PAPIER SUR PLUSIEURS COMMANDES                    *
    C*                                                               *
    C*****************************************************************
    C           SORMUL    BEGSR
    C**
     C                     MOVE *BLANKS   FOUB
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         BOUCH2
     C           KFA11E    CHAINRFAB11               99
    C           *IN99     CABEQ*OFF      FINMUL
    C**
    C*****    RECHERCHE DU DERNIER N° DE BOBINE SORTIE
    C*****              POUR LA QUALITE
    C**
     C                     Z-ADD9999      FAAES
     C                     Z-ADD99        FAMES
     C                     Z-ADD99        FAJES
     C                     Z-ADD99        FAHES
     C                     Z-ADD999999    FACBPA
     C                     Z-ADD99        BOUCH2
    C**
     C           KFA11C    SETGTXFA11C
     C           KFA11D    REDPEXFA11C                   99
    C           *IN99     CABEQ*ON       FINMUL
     C                     Z-ADD1         RTYPST
    C**
     C                     Z-ADDFACONF    RCONF
     C                     Z-ADDFASEQ     RSEQ
     C                     Z-ADDNOPRO     RPRO
     C                     MOVE SECT      RSECT
     C                     MOVE SSECT     RSSECT
     C                     MOVE NOMAC     RMAC
     C                     MOVE *BLANKS   RTYPSO
     C                     Z-ADDUSINE     RUSIN
     C                     Z-ADD0         RQTE
     C                     Z-ADDFACBPA    RBOB
     C                     MOVE *BLANKS   ROK
     C                     MOVE *BLANKS   RVAL2
     C                     MOVE '*'       SMU
     C                     Z-ADDNOCLI     PASCLI
     **
     C                     CALL 'STOCK45£'
     C           PARM13    PARM PARM13    PARM13
     C           PASCLI    PARM PASCLI    PASCLI
     **
D1  C           ROK       IFEQ 'C'
    C           ROK       OREQ 'E'
    C           ROK       OREQ 'I'
     C                     MOVE '*'       SMU
     C                     MOVE '2'       RVAL2
     C                     CALL 'STOCK45£'
     C           PARM13    PARM PARM13    PARM13
     C           PASCLI    PARM PASCLI    PASCLI
F1  C                     ENDIF
     **
    C           FINMUL    ENDSR
    C*****************************************************************
    C*                                                               *
    C*     SR : MAJ DANS LE CAS DE CONSOMMATION D'UNE BOBINE         *
    C*              IMPRIME SUR PLUSIEURS COMMANDES                  *
    C*                                                               *
    C*****************************************************************
    C           SORMU1    BEGSR
    C**
     C                     Z-ADD0         FACBPA
     C                     Z-ADD0         NOBOU
     C           KFA10G    CHAINRFAB10               99
    C           *IN99     CABEQ*OFF      FINMU1
    C**
    C*****    RECHERCHE DU DERNIER N° DE BOBINE SORTIE
    C**
     C                     Z-ADD9999      FAASOR
     C                     Z-ADD99        FAMSOR
     C                     Z-ADD99        FAJSOR
     C                     Z-ADD99        FAHSOR
     C                     Z-ADD999999    FACBPA
     C                     Z-ADD99        NOBOU
    C**
     C           KFA10C    SETGTXFA10C
     C           KFA10D    REDPEXFA10C                   99
    C           *IN99     CABEQ*ON       FINMU1
     C                     Z-ADD2         RTYPST
    C**
     C                     Z-ADDFACONF    RCONF
     C                     Z-ADDFASEQ     RSEQ
     C                     Z-ADDNOPRO     RPRO
     C                     MOVE SECT      RSECT
     C                     MOVE SSECT     RSSECT
     C                     MOVE NOMAC     RMAC
     C                     MOVE *BLANKS   RTYPSO
     C                     Z-ADDUSINE     RUSIN
     C                     Z-ADD0         RQTE
     C                     Z-ADDFACBPA    RBOB
     C                     MOVE *BLANKS   ROK
     C                     MOVE *BLANKS   RVAL2
     C                     MOVE '*'       SMU
     C                     Z-ADDNOCLI     PASCLI
     **
     C                     CALL 'STOCK45£'
     C           PARM13    PARM PARM13    PARM13
     C           PASCLI    PARM PASCLI    PASCLI
    C**
    C           FINMU1    ENDSR
    C*                                                               *
    C*       SR : INITIALISATION DES FENETRES EXTERNES               *
    C*                                                               *
    C*****************************************************************
    C           GESFEN    BEGSR
D1  C           *IN03     IFEQ *ON
     C                     MOVE '2'       INDIC
     C                     MOVE '2'       INDIC1
     C                     MOVE '2'       INDI1
     C                     MOVE '2'       INDI2
X1  C                     ELSE
     C                     MOVE *BLANK    INDIC
     C                     MOVE *BLANK    INDIC1
     C                     MOVE *BLANK    INDI1
     C                     MOVE *BLANK    INDI2
F1  C                     ENDIF
    C**         FENETRE DES MATRICULES
     C                     CALL 'FEN502£'              85
     C           PAS1      PARM PAS1      PAS1    7
     C           INDIC     PARM INDIC     INDIC   1
     C           LIGNE     PARM LIGNE     LIGNE   2
     C           PAS2      PARM PAS2      PAS2   40
     C           PAS3      PARM PAS3      PAS3    5
    C**         FENETRE DES CODES TRAVAIL SPECIAL
     C                     CALL 'FEN505£'              85
     C           PASRES    PARM PASRES    PASRES  4
     C           PASCOD    PARM PASCOD    PASCOD  2
     C           INDI1     PARM INDI1     INDI1   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           NATRAV    PARM NATRAV    NATRAV
    C**         FENETRE DES CODES DECHETS ELIMINES AVANT OP
     C                     CALL 'FEN504£'              85
     C           PASCO2    PARM PASCO2    PASCO2  3
     C           INDI2     PARM INDI2     INDI2   1
     C           LIGNE     PARM LIGNE     LIGNE
     C           PXLIBE    PARM PXLIBE    PXLIBE
    C**         FENETRE APPEL DES PROGRAMMES ANNEXES
     C                     CALL 'FAB579£'              85
     C           INDIC1    PARM INDIC1    INDIC1  1
     C           PAS6      PARM PAS6      PAS6   50
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : MAJ ETAT OP 2206 EQUIVALENT AU 1303 SI TANDEM 2207 *
    C*                                                               *
    C*****************************************************************
    C           COMPLX    BEGSR
     **
     ******  SI ROCHECHOUART COMPLEXEUSE EN TANDEM => FORCER EN 2206
     ******  SAISIE SUR 1303 MAIS MAJ SORTIE PAPIER 2206
     ******  SI TANDEM : T2207='O'
     **
     C                     MOVE 'O'       T2207
D1  C           USINE     IFEQ 2
    C           FAATEL    ANDEQ'13'
    C           NOMAC     ANDEQ'03'
     C                     Z-ADDUSINE     VAUSIN
     C                     Z-ADDFACONF    VACONF
     C                     Z-ADDFASEQ     VASEQ
     C                     Z-ADDFAISEQ    VAISEQ
     C                     Z-ADDNOPRO     VNOPRO
     C                     Z-ADDFAOPNU    VAOPNU
     C                     MOVE 'N'       T2207
     C                     CALL 'FAB604£'              85
     C           PARM8     PARM PARM8     PARM8
     **
F1  C                     ENDIF
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : LANCEMENT CDE PAR OPTION 6 (ONDULEUSE 10)          *
    C*                                                               *
    C*****************************************************************
    C           SUIFA2    BEGSR
     C           FAOPST    CHAINXFAB08               99
     C                     MOVE *BLANKS   LIBETA
     C                     MOVEL'BILAN OP'LIBETA
     **
     ******  TEST SI TRAVAIL EST EN COURS SUR LA MACHINE => AVERTISSEM
     ******  TERMINER ARBITRAIREMENT LE TRAVAIL SUR L'EQUIPE TROUVEE
     **
     C           KFA16C    CHAINXFA16D               99
D1  C           *IN99     IFEQ *OFF
     C                     EXFMTF17
D2  C           *IN12     IFEQ *ON
     C                     UNLCKFAB16L06
    C                     GOTO SUITE
F2  C                     ENDIF
     C                     MOVE 'T'       TA1601
     C                     MOVE 'T'       TA1602
     C                     EXCPTMAJ16D
F1  C                     ENDIF
    C**
     C                     EXSR CREEQ
    C           *IN12     CABEQ*ON       SUITE
     C                     MOVE *OFF      *IN35
     C                     MOVE *OFF      *IN39
     C                     MOVE *OFF      *IN38
     C                     MOVE *BLANK    LIBFIN
    C**
    C******  CREATION EVENEMENT ROULAGE PAR DEFAUT
    C**
     C                     EXSR RECTIM
     C                     EXSR CREOP2
    C**
     C                     EXSR OPERA
    C           *IN10     CABEQ*ON       SSFIC
    C           *IN11     CABEQ*ON       SSFIC
    C                     GOTO SSFIC
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : CREATION AUTOMATIQUE DU ROULAGE SI ONDULEUSE 10    *
    C*                                                               *
    C*****************************************************************
    C           CREOP2    BEGSR
     C                     MOVE *BLANKS   FAEVLI
     C                     MOVE 'RO'      FAEVCO
    C**
     C           KFAB03    CHAINXFAB03               99
    C**
    C******  SI EQUIPE NUIT => DATE FAB=DATE JOUR SINON DATE DEB EQUIP
    C******  ATTENTION AU CAS : HEURE EFFECTIVE=20H58 ET DEBUT EQUIPE
    C******  =21H00 => ON AJOUTE LE TEST HEUR4 < 8H00 MATIN
    C**
     C                     TIME           HEURE   60
     C                     MOVELHEURE     HEUR4   40
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      HEUR4
F1  C                     ENDIF
    C**
D1  C           PPEQUI    IFEQ 3
D2  C           HEUR4     IFLT PPHDEQ
    C           HEUR4     ANDLT800
     C                     Z-ADDPPJJ      CALJJ
     C                     Z-ADDPPMM      CALMM
     C                     MOVELPPAA      CALSS
     C                     MOVE PPAA      CALAA
     C           KCAL02    SETGTCALENDZ1
     C                     READ CALENDZ1                 99
     C                     Z-ADDDATLUE    DATEVE
X2  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F2  C                     ENDIF
X1  C                     ELSE
     C                     Z-ADDDATEQ     DATEVE
F1  C                     ENDIF
    C**
    C******  HEURE DEBUT=HEURE REELLE
    C**
     C                     MOVELHEURE     PPHDEB
     C                     Z-ADD0         PPHFIN
    C**
D1  C           TREF      IFNE 0
     C                     Z-ADDTREF      PPHDEB
F1  C                     ENDIF
D1  C           PPHDEB    IFEQ 2400
     C                     Z-ADD0         PPHDEB
F1  C                     ENDIF
    C**
    C******  CALCUL DU N° ORDRE EVENEMENT SUR CETTE EQUIPE
    C**
     C                     Z-ADD99        PPORD
     C           KFA17A    SETGTXFA17A
     C           KFAB16    REDPEXFA17A                   99
D1  C           *IN99     IFEQ *ON
     C                     Z-ADD1         PPORD
X1  C                     ELSE
     C                     ADD  1         PPORD
F1  C                     ENDIF
    C**
     C                     WRITEXFAB17
    C**
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : TEST SI CHANGEMENT D'AU MOINS UN PAPIER            *
    C*                                                               *
    C*****************************************************************
    C           TESPAP    BEGSR
     C                     MOVEA'000111'  *IN,74
    C**
    C******  CHANGEMENT QUALITE ONDULE
    C**
D1  C           TYPOND    IFNE TYPON1
     C                     MOVE '1'       IN76
     C                     MOVE *ON       *IN76
     C                     MOVE TYPOND    TYPON1  4
X1  C                     ELSE
     C                     MOVE *OFF      *IN76
     C                     MOVE '0'       IN76
F1  C                     ENDIF
    C**
    C******  CHANGEMENT EXTERIEUR
    C**
     C                     MOVE '0'       IN74
     C                     MOVE '0'       IN75
     C                     MOVE '1'       IN77
     C                     MOVE '1'       IN78
     C                     MOVE '1'       IN79
D1  C           PREEXT    IFNE *BLANKS
     C                     MOVE *ON       *IN74
     C                     MOVE '1'       IN74
F1  C                     ENDIF
D1  C           PAPEXT    IFNE PAPEX1
    C           GRAEXT    ORNE GRAEX1
    C           LAIEXT    ORNE LAIEX1
    C           PREEXT    ORNE PREEX1
     C                     MOVE PAPEXT    PAPEX1  3
     C                     MOVE GRAEXT    GRAEX1  30
     C                     MOVE LAIEXT    LAIEX1  41
     C                     MOVE PREEXT    PREEX1  9
X1  C                     ELSE
     C                     MOVE *OFF      *IN77
     C                     MOVE '0'       IN77
F1  C                     ENDIF
    C**
    C******  CHANGEMENT CANNELEURE
    C**
D1  C           PAPCAN    IFNE PAPCA1
    C           GRACAN    ORNE GRACA1
    C           LAICAN    ORNE LAICA1
     C                     MOVE '1'       IN78
     C                     MOVE PAPCAN    PAPCA1  3
     C                     MOVE GRACAN    GRACA1  30
     C                     MOVE LAICAN    LAICA1  41
X1  C                     ELSE
     C                     MOVE *OFF      *IN78
     C                     MOVE '0'       IN78
F1  C                     ENDIF
    C**
    C******  CHANGEMENT INTERIEUR
    C**
D1  C           PREINT    IFNE *BLANKS
     C                     MOVE *ON       *IN75
     C                     MOVE '1'       IN75
F1  C                     ENDIF
D1  C           PAPINT    IFNE PAPIN1
    C           GRAINT    ORNE GRAIN1
    C           LAIINT    ORNE LAIIN1
    C           PREINT    ORNE PREIN1
     C                     MOVE '1'       IN79
     C                     MOVE PAPINT    PAPIN1  3
     C                     MOVE GRAINT    GRAIN1  30
     C                     MOVE LAIINT    LAIIN1  41
     C                     MOVE PREINT    PREIN1  9
X1  C                     ELSE
     C                     MOVE *OFF      *IN79
     C                     MOVE '0'       IN79
F1  C                     ENDIF
    C**
    C           TESPAF    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : SOLDE DES RESERVATIONS DE PAPIERS,D'IMPRIMÉS       *
    C*                  ET DE COMMANDES DE PRÉ-IMPRIMÉS              *
    C*                                                               *
    C*****************************************************************
    C           MAJRES    BEGSR
    C**  SOLDE DES RESERVATIONS DE PAPIERS      (RESPAP/RESCXH)
     C                     Z-ADDUSINE     YAUSIN
     C                     MOVE SECT      YSECT
     C                     MOVE SSECT     YSSECT
     C                     MOVE NOMAC     YNOMAC
     C                     Z-ADDFACONF    YACONF
     C                     Z-ADDFASEQ     YASEQ
     C                     Z-ADDFAISEQ    YAISEQ
     C                     Z-ADDSTE       YSTE
     C                     Z-ADDNOCLI     YNOCLI
     C                     Z-ADDNOPRO     YNOPRO
     C                     Z-ADDFAOPNU    YAOPNU
     C                     CALL 'FAB640£'
     C           PARM15    PARM PARM15    PARM15
    C**  SOLDE DES RESERVATIONS DE PRÉ-IMPRIMÉS (RESIMP)
     C                     CALL 'FAB640£A'
     C           PARM15    PARM PARM15    PARM15
    C           FINRES    ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : LIBELLE IMPRIME STOCKE                             *
    C*            EX : 572-   1 ==> 572-0001                         *
    C*                                                               *
    C*****************************************************************
    C           LIBPRE    BEGSR
    C           PREI5     CABNE'-'       LIBPRF
D1  C           PREI6     IFEQ *BLANK
     C                     MOVE '0'       PREI6
F1  C                     ENDIF
D1  C           PREI7     IFEQ *BLANK
     C                     MOVE '0'       PREI7
F1  C                     ENDIF
D1  C           PREI8     IFEQ *BLANK
     C                     MOVE '0'       PREI8
F1  C                     ENDIF
    C           LIBPRF    ENDSR
    C*****************************************************************
     * MINI/MAXI  ==> CDEC92C
    C           MINMAX    BEGSR
     C                     Z-ADD0         MINI
     C                     Z-ADD0         MAXI
     C                     Z-ADDNOPRO     NOP92
     C                     Z-ADDNOCLI     NOC92
     C                     Z-ADDFACONF    NCF92
     C                     Z-ADDFAQTE     SURF
     C                     Z-ADDFAQTE     SURFF
     C                     Z-ADD1,000     SF
     C                     MOVE '*'       EXP
     C                     CALL 'CDEC92C'
     C                     PARM           DSPARA
    C                     ENDSR
    C*****************************************************************
     * BILAN OP --> F16B
    C           SPBIL     BEGSR
     C                     Z-ADD*ZEROS    TCALF
     C                     Z-ADD*ZEROS    FATXTM
     C                     Z-ADD*ZEROS    FACAD
     C                     SETOF                     69
    C*
D1  C           USINE     IFEQ 3
    C           SECT      ANDEQ'1'
    C           SSECT     ANDEQ'2'
     C                     SETON                     69
     C                     Z-ADDPPNCCA    NBC     20
D2  C           PPVERN    IFEQ 'E'
     C                     ADD  2         NBC
X2  C                     ELSE
D3  C           PPVERN    IFNE *BLANK
     C                     ADD  1         NBC
F3  C                     END
F2  C                     END
     C           PPHCAL    DIV  NBC       TCALF
F1  C                     END
    C*
D1  C           SECT      IFEQ '2'
    C           SSECT     ANDEQ'1'
     C           ONDH      DIV  1000      DEVM    43
     C           PPQFEU    MULT DEVM      PPQTE
D2  C           LMINI     IFNE *ZEROS
    C           ONDL      ANDNE*ZEROS
     C                     MOVE LMINI     LMMM    40
     C           LMMM      DIV  ONDL      FENL    20
D3  C           FENL      IFNE *ZEROS
     C           PPQTE     DIV  FENL      PPQTE
F3  C                     END
F2  C                     END
     C                     MOVE 'ML'      FAUNIT
X1  C                     ELSE
     C                     Z-ADDPPQFEU    PPQTE   70
F1  C                     END
    C*
D1  C           PPHTIR    IFNE 0
     C           PPQTE     DIV  PPHTIR    FACAD
F1  C                     END
    C*
     C           PPHCAL    ADD  PPHTIR    PPTTT   62
     C           PPHADI    ADD  PPHARR    PPAAA   62
     C                     ADD  PPHPAN    PPAAA
     C                     Z-ADDUSINE     YZUSIN
     C                     MOVE SECT      YZSECT
     C                     MOVE SSECT     YZSSEC
     C                     MOVE NOMAC     YZMAC
     C                     Z-ADDFACONF    YZCONF
     C                     Z-ADDFASEQ     YZSEQ
     C                     Z-ADDFAISEQ    YZISEQ
     C                     Z-ADDNOPRO     YZPRO
     C                     Z-ADDFAOPNU    YZOPNU
     C                     Z-ADDPPJJ      YZJJ
     C                     Z-ADDPPMM      YZMM
     C                     Z-ADDPPAA      YZAA
     C                     Z-ADDPPEQUI    YZEQUI
     C                     MOVE *ZEROS    PARMYY  5
     C                     CALL 'FAB696£A'
     C                     PARM           PARMYZ
     C                     PARM           PARMYY
     C                     MOVE PARMYY    ARPLA   52
     C           PPAAA     SUB  ARPLA     PPAAA
     C                     ADD  PPAAA     PPTTT
D1  C           PPTTT     IFNE 0
     C           PPAAA     DIV  PPTTT     XXTXTM  54
     C           XXTXTM    MULT 100       FATXTM
F1  C                     END
    C*
    C                     ENDSR
    C*****************************************************************
    C*                                                               *
    C*       SR : SOUS ROUTINE DE DETECTION CONSIGNES  POUR TOURY    *
    C*                                                    (*IN15)    *
    C*****************************************************************
    C           SRCCSG    BEGSR
     C                     MOVE '0'       *IN14            Detection consignes
     C                     MOVE *BLANK    IVCSG
     *
     *    --------------------------------------------------------------
     *  Si Consigne existe --> *IN14 à '1' pour surbrillance
     *
    C*
     C           KCSG1     SETLLCSGCMDL1                 99
D1  C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN14
     C                     MOVE '1'       IVCSG
X1  C                     ELSE
     C                     MOVE '0'       *IN14
     C                     MOVE *BLANK    IVCSG
F1  C                     ENDIF
    C*
    C**
    C                     ENDSR
    C*===============================================================*
    C*                                                               *
    C*                     SORTIES FICHIERS                          *
    C*                                                               *
    C*===============================================================*
     OXFAB15  E                MAJ15
     O                         FATRSP
     OXFAB16  E                MAJ16
     O                         FA1601
     O                         FA1602
     OXFAB16  E                MAJ16B
     O                         FA1602
     OXFA16D  E                MAJ16D
     O                         TA1601
     O                         TA1602
     OZFAB05  E                MAJ05
     O                         FAOPST
     OXFA10B  E                MAJ10
     O                         PPAA11
     O                         PPMM11
     O                         PPJJ11
     O                         PPEQ11
     OXFA11B  E                MAJ11
     O                         PPAA11
     O                         PPMM11
     O                         PPJJ11
     O                         PPEQ11
     OPRLANCFZE                MAJLAN
     O                         OFETA
**
LIB001
LIB002
LIB003
LIB004
LIB005
LIB006
LIB007
LIB008
LIB009
**
CREATION
MODIFICATION
INTERROGATION
SUPPRESSION
**
  MATIN
APRES-MIDI
  NUIT
**
OP.  TERMINEE => CONFIRMER
EQUIPE TERMINEE => CONFIRMER
OP. INTERROMPUE => CONFIRMER
**
TRAVAIL TERMINE
EQUIPE TERMINEE
TRAV.INTERROMPU
**
N° Equipe ............ :
N° Faction ........... :
**
FINITION
**
23457
**
05001300
13002100
21000500
05001300
13002100
21000500
04301230
12302030
20300430
05001300
13002100
21000500
05001300
13002100
21000500
**
FLEXO REP
